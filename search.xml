<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[iOSä¸Šä½¿ç”¨Cocos2d-xå’ŒOpenGL ESç»˜åˆ¶å‡¹å¤šè¾¹å½¢]]></title>
      <url>/2018/03/26/OpenGL-ES-concave-polygon-iOS/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…ˆçœ‹çœ‹åœ¨iPhoneä¸Šä½¿ç”¨Cocos2d-xä¸OpenGL ESç»˜åˆ¶å‡ºæ¥çš„æœ€ç»ˆæ•ˆæœã€‚</p>
<p><img src="/lionheart/1803/tess.jpeg" alt="tess"></p>
<p>å›¾ä¸­ç»˜åˆ¶çš„éƒ½æ˜¯åœ†ç¯ï¼Œæˆ–è€…å…‰æ»‘æ›²çº¿æ„æˆçš„å›¾å½¢ã€‚ä¸è¿‡æœ¬è´¨è¿˜æ˜¯ç»˜åˆ¶å¤šè¾¹å½¢ï¼Œåªè¦è¿™äº›å¤šè¾¹å½¢çš„é¡¶ç‚¹è¶³å¤Ÿå¤šï¼Œé‚£ä¹ˆå°±å¯ä»¥å½¢æˆ<em>å…‰æ»‘çš„</em>æ›²çº¿ã€‚</p>
<p>åœ¨ç»˜åˆ¶è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„ç›¸å…³çŸ¥è¯†ç‚¹ï¼š</p>
<ol>
<li>Cocos2d-xæ¸²æŸ“æœºåˆ¶</li>
<li>OpenGL ESç»˜å›¾åŸºç¡€</li>
<li>Objectice-Cä¸C++æ··ç¼–</li>
<li>OpenGL Tessellationå°†å¤šè¾¹å½¢åˆ‡åˆ†æˆå¤šä¸ªä¸‰è§’å½¢</li>
</ol>
<a id="more"></a>
<h2 id="é—®é¢˜çš„å‘ç°"><a href="#é—®é¢˜çš„å‘ç°" class="headerlink" title="é—®é¢˜çš„å‘ç°"></a>é—®é¢˜çš„å‘ç°</h2><p>åœ¨ä½¿ç”¨Cococs2d-xç»˜åˆ¶å¡«å……é¢œè‰²çš„å¤šè¾¹å½¢çš„æ—¶å€™ï¼Œæœ€å…ˆæƒ³åˆ°çš„å°±æ˜¯ä½¿ç”¨<strong>DrawNode</strong> ã€‚DrawNodeæä¾›ä»¥ä¸‹æ¥å£ï¼š</p>
<pre><code class="c++">// ç»˜åˆ¶å¡«å……é¢œè‰²çš„å¤šè¾¹å½¢ï¼Œå‚æ•°åŒ…æ‹¬ï¼šå¤šè¾¹å½¢é¡¶ç‚¹åæ ‡ï¼Œå®šç‚¹æ•°ï¼Œä»¥åŠéœ€è¦å¡«å……çš„é¢œè‰²
void drawSolidPoly(const Vec2 *poli, unsigned int numberOfPoints, const Color4F &amp;color);
</code></pre>
<p>ä½¿ç”¨è¯¥æ¥å£ç»˜åˆ¶ä¸€ä¸ªå››åˆ†ä¹‹ä¸€åœ†ç¯çš„æ—¶å€™ï¼Œ<strong>æƒ³è¾¾åˆ°çš„æ•ˆæœ</strong>å¦‚ä¸‹ğŸ‘‡</p>
<p><img src="/lionheart/1803/tess3.jpeg" alt="tess3"></p>
<p>ä½†æ˜¯<strong>å®é™…çš„æ•ˆæœ</strong>å´æ˜¯è¿™æ ·çš„ğŸ‘‡</p>
<p><img src="/lionheart/1803/tess2.jpeg" alt="tess2"></p>
<h2 id="æŸ¥çœ‹æºç "><a href="#æŸ¥çœ‹æºç " class="headerlink" title="æŸ¥çœ‹æºç "></a>æŸ¥çœ‹æºç </h2><p>æŸ¥çœ‹Cocos2d-xçš„DrawNodeçš„æºç ï¼š<strong>CCDrawNode.cpp</strong></p>
<pre><code class="c++">// drawSolidPolyæ¥å£çš„å…·ä½“å®ç°
void DrawNode::drawSolidPoly(const Vec2 *poli, unsigned int numberOfPoints, const Color4F &amp;color)
{
    drawPolygon(poli, numberOfPoints, color, 0.0, Color4F(0.0, 0.0, 0.0, 0.0));
}
</code></pre>
<p>é—®é¢˜çš„å…³é”®è¿˜æ˜¯åœ¨<strong>drawPolygon</strong>æ¥å£ï¼Œè¯¥æ¥å£ç»˜åˆ¶ä¸€èˆ¬çš„å¤šè¾¹å½¢ï¼Œå®ƒçš„å®ç°åŸç†å¾ˆç®€å•ï¼š<strong>æ ¹æ®é¡¶ç‚¹ï¼Œå°†å¤šè¾¹å½¢åˆ’åˆ†æˆå¤šä¸ªä¸‰è§’å½¢ï¼Œç„¶åä½¿ç”¨OpenGLç»˜åˆ¶æŒ‡ä»¤äº¤ç”±GPUç»˜åˆ¶</strong></p>
<p>æ¥çœ‹çœ‹å…·ä½“å®ç°ï¼š</p>
<pre><code class="c++">/*------- drawPolygonå…·ä½“å®ç° ----------*/
void DrawNode::drawPolygon(const Vec2 *verts, int count, const Color4F &amp;fillColor, float borderWidth, const Color4F &amp;borderColor)
{
    CCASSERT(count &gt;= 0, &quot;invalid count value&quot;);

      // çœ‹æ˜¯å¦éœ€è¦ç»˜åˆ¶è¾¹æ¡†ï¼Œæœ¬æ–‡åˆ†æçš„æ˜¯æ— è¾¹æ¡†çš„æƒ…å†µ
    bool outline = (borderColor.a &gt; 0.0f &amp;&amp; borderWidth &gt; 0.0f);

      // æ ¹æ®é¡¶ç‚¹æ•°ï¼Œè®¡ç®—åº•å±‚éœ€è¦ç»˜åˆ¶çš„ä¸‰è§’å½¢çš„ä¸ªæ•°ï¼štriangle_count
    auto  triangle_count = outline ? (3*count - 2) : (count - 2);
      // æ ¹æ®ä¸‰è§’å½¢çš„ä¸ªæ•°ï¼Œç®—å‡ºéœ€è¦ä¼ é€’ç»™GPUçš„é¡¶ç‚¹ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯ä¹˜3
    auto vertex_count = 3*triangle_count;
    ensureCapacity(vertex_count);

      // å­˜æ”¾é¡¶ç‚¹æ•°æ®çš„buffer
    V2F_C4B_T2F_Triangle *triangles = (V2F_C4B_T2F_Triangle *)(_buffer + _bufferCount);
    V2F_C4B_T2F_Triangle *cursor = triangles;

      // å…³é”®ä»£ç ï¼š åˆ’åˆ†ä¸‰è§’å½¢çš„ç®—æ³•
    for (int i = 0; i &lt; count-2; i++)
    {
        V2F_C4B_T2F_Triangle tmp = {
                {verts[0], Color4B(fillColor), __t(v2fzero)},
                {verts[i+1], Color4B(fillColor), __t(v2fzero)},
                {verts[i+2], Color4B(fillColor), __t(v2fzero)},
        };

        *cursor++ = tmp;
    }

    if(outline)
    {
        /* æ­¤å¤„çœç•¥800å­—ï¼Œä¸»è¦æ˜¯ç»˜åˆ¶å¤šè¾¹å½¢çš„è¾¹æ¡†*/
    }

    _bufferCount += vertex_count;
    _dirty = true;
}
</code></pre>
<p>å…·ä½“åˆ†æä¸‹å°†å¤šè¾¹å½¢åˆ’åˆ†æˆä¸‰è§’å½¢çš„æ­¥éª¤ï¼š</p>
<blockquote>
<p>å‡è®¾æœ‰5ä¸ªé¡¶ç‚¹ï¼ˆ1-5ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥åˆ†æˆ 5 - 2 = 3 ä¸ªä¸‰è§’å½¢ã€‚ä»¥1å·é¡¶ç‚¹ä¸ºåŸºç¡€ï¼Œè¿™ä¸‰ä¸ªä¸‰è§’å½¢åˆ†åˆ«æ˜¯</p>
<p>â‘ â‘¡â‘¢</p>
<p>â‘ â‘¢â‘£</p>
<p>â‘ â‘£â‘¤</p>
</blockquote>
<p>é‚£ä¹ˆå½“è¿™äº›é¡¶ç‚¹æ„æˆçš„å¤šè¾¹å½¢æ˜¯å‡¹å¤šè¾¹å½¢æ—¶å°±ä¼šå‡ºç°é—®é¢˜ï¼ˆè¦†ç›–äº†ä¸éœ€è¦ç»˜åˆ¶çš„åŒºåŸŸï¼‰ï¼Œç”»ä¸ªå›¾è§£é‡Šä¸€ä¸‹ï¼š</p>
<p><img src="/lionheart/1803/tess4.jpeg" alt="tess4"></p>
<p>å‡è®¾å°†è¿™ä¸ªå››åˆ†ä¹‹ä¸€åœ†ç¯åˆ†æˆ10ä¸ªé¡¶ç‚¹çš„å¤šè¾¹å½¢æ—¶ï¼Œè¿˜æ˜¯ä»¥åˆšè¯´çš„åˆ’åˆ†ä¸‰è§’å½¢çš„ç®—æ³•ï¼Œé‚£ä¹ˆå°åœ†å¼§ä¸Šçš„ç‚¹ä¸â‘ å·ç‚¹æ„æˆçš„ä¸‰è§’å½¢ï¼Œå°±è¶…å‡ºäº†ç»˜åˆ¶èŒƒå›´ã€‚å…¶ä¸­æœ€ä¸ºæ˜æ˜¾çš„å°±æ˜¯â‘ â‘¥â‘¦è¿™ä¸‰ä¸ªç‚¹æ„æˆçš„ä¸‰è§’å½¢ã€‚</p>
<h2 id="ä½¿ç”¨Tessellationæ­£ç¡®çš„åˆ’åˆ†ä¸‰è§’å½¢"><a href="#ä½¿ç”¨Tessellationæ­£ç¡®çš„åˆ’åˆ†ä¸‰è§’å½¢" class="headerlink" title="ä½¿ç”¨Tessellationæ­£ç¡®çš„åˆ’åˆ†ä¸‰è§’å½¢"></a>ä½¿ç”¨Tessellationæ­£ç¡®çš„åˆ’åˆ†ä¸‰è§’å½¢</h2><p>ç»è¿‡åˆšåˆšçš„æºç åˆ†æï¼Œå¯ä»¥å‘ç°å‡ºç°æ¸²æŸ“é”™è¯¯çš„åŸå› å°±æ˜¯ï¼šç»˜åˆ¶å‡¹å¤šè¾¹å½¢æ—¶ï¼Œåˆ’åˆ†ä¸‰è§’å½¢çš„æ–¹æ³•æœ‰é—®é¢˜ã€‚è°·æ­Œä¸€ç•ªï¼Œå…¶å®OpenGLæä¾›äº†<a href="http://www.songho.ca/opengl/gl_tessellation.html" target="_blank" rel="external">Tessellation</a>çš„æ–¹æ³•ï¼Œæ¥æ­£ç¡®çš„åˆ’åˆ†ä¸‰è§’å½¢ï¼›ä½†æ˜¯OpenGL ESæš‚ä¸æ”¯æŒã€‚ä¸è¿‡2008å¹´çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“æä¾›äº†<a href="https://code.google.com/archive/p/iphone-glu/" target="_blank" rel="external">iOSä¸ŠTessellation</a>çš„åŠŸèƒ½ã€‚</p>
<p>ä¸‹è½½è¯¥æºä»£ç ï¼Œç„¶åä¿®æ”¹Makefileï¼Œç”Ÿæˆé™æ€åº“ï¼Œå¯¼å…¥Cocos2d-xä¸­ã€‚ç„¶åçœ‹çœ‹å¦‚ä½•ä¿®æ”¹Cocos2d-xæºç æ¥å®ç°ç»˜åˆ¶å‡¹å¤šè¾¹å½¢çš„ï¼š</p>
<pre><code class="c++">/*-------- CCDrawNode.cppä¸­æ–°å¢ drawPolygonUseTessllation æ–¹æ³• ---------*/
void DrawNode::drawPolygonUseTessllation(const Vec2 *verts, int count, const Color4F &amp;fillColor, float borderWidth, const Color4F &amp;borderColor) {
    CCASSERT(count &gt;= 0, &quot;invalid count value&quot;);

      // æ–°å»ºä¸€ä¸ªtessellationå¤„ç†æ¨¡å—
    GLUtesselator *tess = gluNewTess();
    if (tess) {
        totolTessVecPointNum = 0;
        drawNum = 0;

          // ç»‘å®štessellation å›è°ƒå‡½æ•°
        gluTessCallback(tess, GLU_TESS_BEGIN, (void (*)())tessBeginCB);
        gluTessCallback(tess, GLU_TESS_END, (void (*)())tessEndCB);
        gluTessCallback(tess, GLU_TESS_ERROR, (void (*)())tessErrorCB);
        gluTessCallback(tess, GLU_TESS_VERTEX, (void (*)())tessVertexCB);

        gluTessBeginPolygon(tess, 0);
        gluTessBeginContour(tess);
        // å‘tessellationå¤„ç†æ¨¡å—ä¸­ï¼Œä¾æ¬¡ä¼ å…¥å¤šè¾¹å½¢é¡¶ç‚¹åæ ‡
        GLdouble *quad = new GLdouble[count * 3];
        for (int i = 0; i &lt; count; i++) {
            quad[i * 3] = verts[i].x;
            quad[i * 3 + 1] = verts[i].y;
            quad[i * 3 + 2] = 0;
        }

        for (int i = 0; i &lt; count; ++i) {
            gluTessVertex(tess, quad + i * 3, quad + i * 3);
        }
        gluTessEndContour(tess);
        gluTessEndPolygon(tess);

          // ç»“æŸtessellationå¤„ç†
        gluDeleteTess(tess);

        delete[] quad;
    } else {
        std::cout &lt;&lt; &quot;no tessellation&quot;;
        exit(1);
    }


    V2F_C4B_T2F *triangles = (V2F_C4B_T2F *)(_buffer + _bufferCount);
    V2F_C4B_T2F *cursor = triangles;

    // ç»è¿‡tessellation, ä»¥åŠå°†é¡¶ç‚¹é‡æ–°æ’åºäº†ï¼Œç°åœ¨å°†é‡æ–°æ’åºåçš„é¡¶ç‚¹æ”¾å…¥é¡¶ç‚¹bufferï¼Œä»¥å¾…GPUæ¸²æŸ“
    for (int i = 0; i &lt; totolTessVecPointNum; i++)
    {
        V2F_C4B_T2F tmp = {tessVec2[i], Color4B(fillColor), __t(v2fzero)};
        *cursor++ = tmp;
    }

    std::cout &lt;&lt; &quot;draw node is &quot; &lt;&lt; drawNum &lt;&lt; std::endl;
    _TSCommand.clear();
    _TSNumber.clear();
    _TSCommand.resize(drawNum);
    _TSNumber.resize((drawNum));
    for (int j = 0; j &lt; drawNum; ++j) {
        _TSCommand.push_back(tessSort[j][0]);
        _TSNumber.push_back(tessSort[j][1]);
    }

    _bufferCount += totolTessVecPointNum;
    _useTessellation = true;
    _dirty = true;
}
</code></pre>
<p>Tessellationçš„ä¸»è¦å·¥ä½œå°±æ˜¯ï¼š<strong>å°†å¤šè¾¹å½¢çš„é¡¶ç‚¹é‡æ–°æ’åºï¼Œç„¶åä¾æ¬¡æŒ‡å®šè¿™äº›é¡¶ç‚¹çš„ç»˜åˆ¶æ–¹å¼ã€‚æœ‰ä¸‰ç§ç»˜åˆ¶æ–¹å¼ï¼šGL_TRIANGLESï¼ŒGL_TRIANGLE_STRIPå’ŒGL_TRIANGLE_FAN</strong></p>
<p>æ¥çœ‹çœ‹Tessellationçš„å›è°ƒå‡½æ•°ï¼šå›è°ƒå‡½æ•°ä¼šåœ¨è¿™äº›æƒ…å†µä¸‹å‘ç”Ÿï¼š</p>
<ol>
<li>é‡æ–°æŒ‡å®šä¸€ç§ç»˜åˆ¶æ–¹å¼æ—¶ <strong>GLU_TESS_BEGIN</strong></li>
<li>ä»¥è¯¥ç§ç»˜åˆ¶æ–¹å¼æ—¶ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„é¡¶ç‚¹æ—¶ <strong>GLU_TESS_VERTEX</strong></li>
<li>ç»“æŸè¯¥ç»˜åˆ¶æ–¹å¼æ—¶ <strong>GLU_TESS_END</strong></li>
<li>å‘ç”Ÿé”™è¯¯æ—¶ <strong>GLU_TESS_ERROR</strong></li>
</ol>
<pre><code class="c++">float tessVec2[5000][2];
int tessSort[100][2];
int totolTessVecPointNum = 0;
int currentDrawTessPointNum = 0;
int drawNum = 0;
GLenum tessType;

const char* getPrimitiveType(GLenum type) {
    // çœç•¥800å­—ï¼Œ è·å–ç»˜åˆ¶æ–¹å¼
}

void tessBeginCB(GLenum which) {
    currentDrawTessPointNum = 0;
    switch(which)
    {
        case 0x0004:
            tessType = 1;
            break;
        case 0x0005:
            tessType = 2;
            break;
        case 0x0006:
            tessType = 3;
            break;
        default:
            std::cout &lt;&lt; &quot;error tess type&quot; &lt;&lt; std::endl;
    }
    std::cout &lt;&lt; &quot;glBegin(&quot; &lt;&lt; getPrimitiveType(which) &lt;&lt; &quot;);\n&quot;;
}

void tessEndCB() {
    tessSort[drawNum][0] = tessType;
    tessSort[drawNum][1] = currentDrawTessPointNum;
    drawNum++;
    std::cout  &lt;&lt; &quot;glEnd();\n&quot;;
}

void tessVertexCB(const GLvoid *data) {
    const GLdouble *ptr = (const GLdouble*)data;

    GLfloat pos1 = *ptr;
    GLfloat pos2 = *(ptr + 1);
    GLfloat pos3 = *(ptr + 2);

    std::cout &lt;&lt; &quot;pos1 is &quot; &lt;&lt; pos1 &lt;&lt; &quot;, pos2 is &quot; &lt;&lt; pos2 &lt;&lt; &quot;, pos3 is &quot; &lt;&lt; pos3 &lt;&lt; std::endl;
    tessVec2[totolTessVecPointNum][0] = pos1;
    tessVec2[totolTessVecPointNum][1] = pos2;
    totolTessVecPointNum++;
    currentDrawTessPointNum++;
}

void tessErrorCB(GLenum errorCode) {
    const GLubyte *errorStr;

    errorStr = gluErrorString(errorCode);
    std::cerr &lt;&lt; &quot;[ERROR]: &quot; &lt;&lt; errorStr &lt;&lt; std::endl;
}
</code></pre>
<h2 id="Cocos2d-xåº•å±‚æ¸²æŸ“"><a href="#Cocos2d-xåº•å±‚æ¸²æŸ“" class="headerlink" title="Cocos2d-xåº•å±‚æ¸²æŸ“"></a>Cocos2d-xåº•å±‚æ¸²æŸ“</h2><p>é€šè¿‡Tessellationä¹‹åï¼Œå·²ç»å°†å¤šè¾¹å½¢çš„é¡¶ç‚¹é‡æ–°æ’åºï¼Œå¹¶é‡æ–°æŒ‡å®šäº†ç»˜åˆ¶æ–¹å¼ã€‚ç°åœ¨è¿™äº›ç»˜åˆ¶æ–¹å¼å’Œé¡¶ç‚¹å·²ç»è®°å½•ä¸‹æ¥äº†ï¼Œéœ€è¦ä¿®æ”¹<strong>DrawNode</strong>çš„<strong>draw</strong>æ–¹æ³•è¿›è¡Œæ¸²æŸ“ã€‚</p>
<pre><code class="c++">void DrawNode::draw(Renderer *renderer, const Mat4 &amp;transform, uint32_t flags)
{
      // å¦‚æœä½¿ç”¨Tessellationï¼Œé‚£ä¹ˆè°ƒç”¨onDrawUseTessellationæ–¹æ³•ç»˜åˆ¶
    if (_useTessellation) {
        _customCommand.init(_globalZOrder, transform, flags);
        _customCommand.func = CC_CALLBACK_0(DrawNode::onDrawUseTessellation, this, transform, flags);
        renderer-&gt;addCommand(&amp;_customCommand);
        return;
    }
    if(_bufferCount)
    {
        _customCommand.init(_globalZOrder, transform, flags);
        _customCommand.func = CC_CALLBACK_0(DrawNode::onDraw, this, transform, flags);
        renderer-&gt;addCommand(&amp;_customCommand);
    }

    // æ­¤å¤„çœç•¥800å­—ï¼Œ cocos2d-xè‡ªå¸¦äº†ç»˜åˆ¶ç‚¹å’Œçº¿çš„æ–¹æ³•
}

/*-----------  çœŸæ­£çš„ç»˜åˆ¶æ–¹æ³• --------------*/
// onDrawUseTessellationä»¿é€ äº†DrawNodeè‡ªå¸¦çš„onDrawæ–¹æ³•ï¼Œå¹¶å…±ç”¨åº•å±‚çš„shaderï¼Œä»¥åŠCPUä¸­çš„é¡¶ç‚¹buffer
void DrawNode::onDrawUseTessellation(const Mat4 &amp;transform, uint32_t flags) {
    // åŸºæœ¬è®¾ç½®ï¼ŒåŒonDrawæ–¹æ³•
      getGLProgramState()-&gt;apply(transform);
    auto glProgram = this-&gt;getGLProgram();
    glProgram-&gt;setUniformLocationWith1f(glProgram-&gt;getUniformLocation(&quot;u_alpha&quot;), _displayedOpacity / 255.0);
    GL::blendFunc(_blendFunc.src, _blendFunc.dst);


    if (_dirty)
    {
          // ç»‘å®šé¡¶ç‚¹æ•°æ®ï¼Œé¡¶ç‚¹æ•°æ®ä»CPUçš„_bufferç¼“å­˜ä¸­ï¼Œä¼ é€’ç»™GPUçš„GL_ARRAY_BUFFER
        glBindBuffer(GL_ARRAY_BUFFER, _vbo);
        glBufferData(GL_ARRAY_BUFFER, sizeof(V2F_C4B_T2F)*_bufferCapacity, _buffer, GL_STREAM_DRAW);

        _dirty = false;
    }

      // æ­¤å¤„çœç•¥800å­—ï¼Œä¸€äº›åŸºæœ¬çš„è®¾ç½®

    int curIndex = 0;
    int drawNumber = _TSCommand.size();
      // æ ¸å¿ƒä»£ç ï¼š ä¸€ä¸ªå‡¹å¤šè¾¹å½¢å¯èƒ½éœ€è¦è°ƒç”¨å¤šæ¬¡drawArraysæ–¹æ³•ï¼Œå¹¶ä¸”ç»˜åˆ¶çš„æ–¹å¼ä¸åŒ
      // ç»˜åˆ¶çš„æ¬¡æ•°ï¼Œä»¥åŠæ¯æ¬¡çš„ç»˜åˆ¶æ–¹å¼ï¼Œä»¥åŠæ¯æ¬¡ç»˜åˆ¶æ—¶ç»˜åˆ¶å“ªäº›é¡¶ç‚¹ éƒ½åœ¨Tessellationæ­¥éª¤é‡Œé¢ç”Ÿæˆå¥½äº†
      // _TSCommandæ•°ç»„å­˜å‚¨ç»˜åˆ¶æ–¹å¼ï¼Œ_TSNumberæ•°ç»„å­˜å‚¨æ¯æ¬¡ç»˜åˆ¶çš„å®šç‚¹æ•°
    for (int i = 0; i &lt; drawNumber; ++i) {
        int curDrawType = _TSCommand[i];
        int curVexNum = _TSNumber[i];
        if (curDrawType == 1) {
            glDrawArrays(GL_TRIANGLES, curIndex, curVexNum);
        } else if (curDrawType == 2) {
            glDrawArrays(GL_TRIANGLE_STRIP, curIndex, curVexNum);
        } else {
            glDrawArrays(GL_TRIANGLE_FAN, curIndex, curVexNum);
        }
        curIndex += curVexNum;
    }

    // æ­¤å¤„çœç•¥800å­—ï¼Œä¸€äº›æ”¶å°¾å·¥ä½œ
}
</code></pre>
<p>åˆ°æ­¤ï¼Œå°±å®ç°äº†åœ¨iOSè®¾å¤‡ä¸Šä½¿ç”¨Cocos2d-xå’ŒOpenGL ESç»˜åˆ¶å‡¹å¤šè¾¹å½¢ã€‚</p>
<h2 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h2><p>ç”±äºæ˜¯åœ¨iOSä¸Šä½¿ç”¨Cocos2d-xï¼Œæ‰€ä»¥ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šéœ€è¦Objective-Cå’ŒC++æ··ç¼–ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ªæ•™ç¨‹ - <a href="https://awhisper.github.io/2016/05/01/%E6%B7%B7%E7%BC%96ObjectiveC/" target="_blank" rel="external">æ··ç¼–ObjectiveC++</a></p>
<p>å¯¹äº†ï¼Œè¿˜æœ‰ä¸€äº›åŸºæœ¬çš„Cocos2d-xæ¸²æŸ“æœºåˆ¶ï¼Œæˆ‘å­¦ä¹ çš„è¿™ç³»åˆ—åšå®¢ - <a href="https://github.com/sric0880/coco2d-x-sourcecode-analysis" target="_blank" rel="external">coco2d-x sourcecode analysis</a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://www.songho.ca/opengl/gl_tessellation.html" target="_blank" rel="external">OpenGL Tessellation</a></li>
<li><a href="https://code.google.com/archive/p/iphone-glu/" target="_blank" rel="external">iOSä¸ŠTessellation - iPhone GLU</a></li>
<li><a href="https://awhisper.github.io/2016/05/01/%E6%B7%B7%E7%BC%96ObjectiveC/" target="_blank" rel="external">æ··ç¼–ObjectiveC++</a></li>
<li><a href="https://github.com/sric0880/coco2d-x-sourcecode-analysis" target="_blank" rel="external">coco2d-x sourcecode analysis</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[ARKitä¸‹çš„é­”æ–¹]]></title>
      <url>/2017/12/02/ar-rubik/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¦‚é¢˜ï¼Œå…ˆçœ‹çœ‹æ•ˆæœğŸ‘‡</p>
<video width="650" height="488" src="http://ota80mtsn.bkt.clouddn.com/rubikDemoForWeb" controls></video>

<a id="more"></a>
<p>ä»£ç åœ¨æˆ‘çš„<a href="https://github.com/vanney9/ARRubik" target="_blank" rel="external">Github</a>ï¼Œè¿è¡Œèµ·æ¥ï¼Œåœ¨æ‰‹åŠ¿æ£€æµ‹ä¸Šè¿˜æœ‰äº›ä¸å¤Ÿç²¾å‡†ã€‚æœ‰å…´è¶£çš„å¯ä»¥ä¸€èµ·è®¨è®º</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://github.com/olucurious/Awesome-ARKit" target="_blank" rel="external">Awesome ARKit</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[ä¸€æ¬¡ç§‹æ‹›]]></title>
      <url>/2017/12/02/job-summary/</url>
      <content type="html"><![CDATA[<p>å¦‚é¢˜ï¼Œè®°å½•ä¸€ä¸‹è¾›è‹¦çš„ç§‹æ‹›</p>
<a id="more"></a>
<p>ç§‹æ‹›ç»“æŸæœ‰ä¸€æ®µæ—¶é—´äº†ã€‚æ„Ÿè°¢ä»Šå¹´è‰¯å¥½çš„æ•´ä½“ç¯å¢ƒï¼Œæˆ‘ä¹Ÿæ‹¿äº†å¤§å¤§å°å°å‡ ä¸ªofferï¼Œæœ€åé€‰æ‹©äº†è…¾è®¯çš„iOSå¼€å‘å²—ä½ã€‚</p>
<p>ä»ä¸ƒæœˆä¸­æ—¬å¼€å§‹æ­£å¼å‡†å¤‡ç®—èµ·ï¼Œåˆ°10æœˆåˆç¡®å®šä¸‹æ¥ï¼Œä¸€å…±æœ‰2ä¸ªåŠæœˆæ—¶é—´å§ã€‚</p>
<ol>
<li>7æœˆä¸­æ—¬çœ‹ä¹¦ï¼Œåˆ·é¢˜</li>
<li>7æœˆåº•å†…æ¨å¼€å§‹ï¼Œä¸€æ¥å°±æ˜¯é˜¿é‡Œå’Œè…¾è®¯ï¼Œç›´æ¥ä¸€æ³¢ä¸¤è¿è·ªï¼Œå¿ƒæƒ…è·Œå€’è°·åº•=ã€‚=</li>
<li>å¼€å§‹æ‰¾ä¸è¶³ï¼Œå‘ç°iOSæ–¹é¢çŸ¥è¯†è¿˜ç®—åº”ä»˜çš„è¿‡æ¥ï¼›ç¼ºçš„æ˜¯è®¡ç®—æœºåŸºç¡€çŸ¥è¯†ï¼Œèµ¶ç´§è¡¥ä¸€è¡¥æœ¬ç§‘çš„æ•°æ®ç»“æ„ï¼Œè®¡ç®—æœºç½‘ç»œå’Œæ“ä½œç³»ç»Ÿ</li>
<li>8æœˆå¤¹æ‚ç€å„ç§å†…æ¨é¢è¯•ï¼Œæ€»ç®—ç†Ÿæ‚‰äº†å„å®¶çš„é¢è¯•å¥—è·¯ã€‚é—®æ¥é—®å»éƒ½å·®ä¸å¤šé‚£äº›ä¸œè¥¿</li>
<li>9.3å·ï¼Œä»Šæ—¥å¤´æ¡å†…æ¨è§†é¢‘é¢è¯•ï¼Œä¸€ä¸‹åˆé¢äº†ä¸‰é¢ã€‚è·Ÿæ°å“¥å»åƒé¥­çš„æ—¶å€™æ¥åˆ°äº†hrçš„ç”µè¯ï¼Œè¯´å·²ç»é€šè¿‡äº†ã€‚å‡è£…å¹³é™çš„è·Ÿhrå°å§å§èŠå®Œä¹‹åï¼Œå°±å¼€å§‹æ¿€åŠ¨çš„å’Œæ°å“¥å™¼é‡Œå•ªå•¦çš„è®²èµ·æ¥äº†ã€‚ä¿¡å¿ƒå¤§å¢ã€‚</li>
<li>ä¹‹åå°±åªé¢äº†äº›å¤§å‚ï¼Œé—®çš„é—®é¢˜éƒ½å¤§åŒå°å¼‚ã€‚è¯´è¯´å…¶ä¸­è…¾è®¯çš„é¢è¯•å§ï¼Œè…¾è®¯äºŒé¢ï¼Œå°±æŒç»­äº†20åˆ†é’Ÿï¼Œå…¨ç¨‹å°±åƒèŠå¤©ã€‚æ°”æ°›è½»æ¾çš„è®©æˆ‘ä»¥ä¸ºæˆ‘å·²ç»æŒ‚äº†ã€‚ã€‚ã€‚</li>
<li>9æœˆåº•é™†ç»­æ”¶åˆ°äº†å‡ ä»½offerï¼Œåä¸€ä¹‹åæ”¶åˆ°äº†è…¾è®¯çš„offerã€‚</li>
</ol>
<p>å¦å¤–ï¼Œå›é¡¾è¿™ä¸¤ä¸ªå¤šæœˆçš„ç§‹æ‹›ï¼Œå¤§éƒ¨åˆ†å…¬å¸é¢è¯•ä½“éªŒéƒ½æ˜¯å¾ˆå¥½çš„ã€‚å…¶ä¸­ä»Šæ—¥å¤´æ¡ç»™æˆ‘çš„æ„Ÿè§‰æ˜¯æœ€å¥½çš„ï¼šä¸‰é¢æŠ€æœ¯é¢é—®çš„é—®é¢˜å¾ˆå…¨é¢ï¼Œå¾ˆæ·±å…¥ï¼›å½“å¤©å°±å‡ºç»“æœï¼Œæ²¡æœ‰æ‹–æ‹–æ‹‰æ‹‰çš„ï¼›æœ€ååœ¨å¾—çŸ¥æˆ‘é€‰æ‹©è…¾è®¯ä¹‹åï¼Œä¸»ç®¡ä¹Ÿåˆ†ä¸¤æ¬¡è·Ÿæˆ‘æ‰“äº†å°†è¿‘2å°æ—¶çš„ç”µè¯ï¼Œéå¸¸æ„ŸåŠ¨ã€‚</p>
<p>å°å­¦å¼Ÿè¯´è®©æˆ‘å†™ä¸€ç¯‡é¢ç»ï¼Œæ„Ÿè§‰æˆ‘æœ‰ç‚¹è·‘é¢˜â€¦é‚£ä¸‹é¢å°±è¨€å½’æ­£ä¼ ï¼Œæ­£æ­£ç»ç»å†™ä¸€ç¯‡<strong>iOSç§‹æ‹›é¢ç»</strong></p>
<p>â€¦â€¦</p>
<h4 id="å‡†å¤‡é˜¶æ®µ"><a href="#å‡†å¤‡é˜¶æ®µ" class="headerlink" title="å‡†å¤‡é˜¶æ®µ"></a>å‡†å¤‡é˜¶æ®µ</h4><p>ç¨‹åºå‘˜é¢è¯•å¿…çœ‹ä¹¦ç±ï¼š</p>
<ol>
<li>å‰‘æŒ‡Offer</li>
<li>è®¡ç®—æœºç½‘ç»œï¼Œæ“ä½œç³»ç»Ÿï¼Œæ•°æ®ç»“æ„ â€” æ‰¾æ‰¾æœ¬ç§‘çš„ä¹¦çœ‹çœ‹å°±è¡Œ</li>
</ol>
<p>iOSç¨‹åºå‘˜é™„åŠ ä¹¦ç±ï¼š</p>
<ol>
<li>Effective Objective-C</li>
<li>iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†</li>
<li><a href="https://github.com/ChenYilong/iOSInterviewQuestions/blob/master/01%E3%80%8A%E6%8B%9B%E8%81%98%E4%B8%80%E4%B8%AA%E9%9D%A0%E8%B0%B1%E7%9A%84iOS%E3%80%8B%E9%9D%A2%E8%AF%95%E9%A2%98%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88/%E3%80%8A%E6%8B%9B%E8%81%98%E4%B8%80%E4%B8%AA%E9%9D%A0%E8%B0%B1%E7%9A%84iOS%E3%80%8B%E9%9D%A2%E8%AF%95%E9%A2%98%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88%EF%BC%88%E4%B8%8A%EF%BC%89.md" target="_blank" rel="external">æ‹›è˜ä¸€ä¸ªé è°±çš„iOS</a></li>
</ol>
<h4 id="é¢è¯•é˜¶æ®µ"><a href="#é¢è¯•é˜¶æ®µ" class="headerlink" title="é¢è¯•é˜¶æ®µ"></a>é¢è¯•é˜¶æ®µ</h4><p>å‰é¢å‡†å¤‡å†å¤šï¼Œéƒ½ä¸å¦‚æ¥åœºçœŸçœŸåˆ‡åˆ‡çš„é¢è¯•ã€‚ä¸€åœºé¢è¯•ä¸‹æ¥ï¼Œèƒ½å‘ç°å¾ˆå¤šè‡ªèº«ä¸è¶³çš„åœ°æ–¹ã€‚æ¯åœºé¢è¯•ä¸‹æ¥ï¼Œ<strong>åšå¥½æ€»ç»“</strong>ï¼Œè¿™æ˜¯æœ€é‡è¦çš„ï¼Œæ¯•ç«Ÿèƒ½é—®çš„é—®é¢˜ä¹Ÿå°±é‚£ä¹ˆå¤š=ã€‚=</p>
<p>â€¦â€¦</p>
<p>ç§‹æ‹›ç»“æŸæœ‰æ®µæ—¶é—´äº†ï¼Œæœ‰äº›ç»†èŠ‚å·²ç»æƒ³ä¸èµ·æ¥äº†ï¼Œé‚£æ€»ç»“å°±åˆ°è¿™é‡Œäº†ã€‚æ€»ç»“å®Œäº†ä¸å¾—æ¥ä¸ªå±•æœ›ï¼šé¢å¯¹æœªæ¥ï¼Œä¸å®‰ä¸æœŸå¾…</p>
<p>æœ€åçš„æœ€åï¼Œç«‹ä¸ªflagï¼šå¹´å‰æˆä¸€ä¸ªkickflipï¼Ÿ</p>
<h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><ul>
<li><a href="https://github.com/ChenYilong/iOSInterviewQuestions/blob/master/01%E3%80%8A%E6%8B%9B%E8%81%98%E4%B8%80%E4%B8%AA%E9%9D%A0%E8%B0%B1%E7%9A%84iOS%E3%80%8B%E9%9D%A2%E8%AF%95%E9%A2%98%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88/%E3%80%8A%E6%8B%9B%E8%81%98%E4%B8%80%E4%B8%AA%E9%9D%A0%E8%B0%B1%E7%9A%84iOS%E3%80%8B%E9%9D%A2%E8%AF%95%E9%A2%98%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88%EF%BC%88%E4%B8%8A%EF%BC%89.md" target="_blank" rel="external">æ‹›è˜ä¸€ä¸ªé è°±çš„iOS</a></li>
</ul>
]]></content>
      
        
        <tags>
            
            <tag> æ‚ä¸ƒæ‚å…« </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[CALayerçš„æ—¶é—´åæ ‡ç³»]]></title>
      <url>/2017/07/24/calayer-time-coordinate-system/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸Šå‘¨æœ«ï¼Œåˆè¿›è¡Œäº†ä¸€æ¬¡å®éªŒå®¤å†…éƒ¨çš„iOSåˆ†äº«ä¼šã€‚è¿™æ¬¡æ˜¯å°å­¦å¼Ÿç»™æˆ‘ä»¬è®²çš„<a href="https://wanston.github.io/2017/07/12/CAMediaTiming%E5%8D%8F%E8%AE%AE/" target="_blank" rel="external">CAMediaTiming</a>ä»¥åŠ<a href="https://wanston.github.io/2017/07/19/RunLoop/" target="_blank" rel="external">Runloop</a>çš„ä¸€äº›å†…å®¹ã€‚è®²çš„å¾ˆç»†ï¼Œä¹Ÿå¾ˆæ·±=ã€‚=</p>
<p>å…¶ä¸­æåˆ°äº†ä¸€ç‚¹ï¼š<strong>CALayerçš„æ—¶é—´åæ ‡ç³»</strong>ï¼Œä¹Ÿå°±æ˜¯æœ¬æ–‡è¦è®²çš„ä¸»è¦å†…å®¹</p>
<a id="more"></a>
<h2 id="æ—¶é—´åæ ‡ç³»"><a href="#æ—¶é—´åæ ‡ç³»" class="headerlink" title="æ—¶é—´åæ ‡ç³»"></a>æ—¶é—´åæ ‡ç³»</h2><p>æ—¶é—´åæ ‡ç³»è¿™ä¸ªåå­—å¬ç€æœ‰ç‚¹å¥‡æ€ªï¼Œç±»ä¼¼layerçš„ç©ºé—´åæ ‡ç³»ã€‚å®ƒçš„æ„æ€æ˜¯ï¼šæ¯ä¸ªCALyeréƒ½æœ‰è‡ªå·±çš„æ—¶é—´åˆ»åº¦ï¼›åœ¨åŒä¸€ä¸ªå…¨å±€æ—¶é—´ä¸‹ï¼Œæ¯ä¸ªCALyerè‡ªå·±çš„æ—¶é—´æ˜¯å¯ä»¥ä¸ä¸€æ ·çš„ã€‚è€ŒCAAnimationå‚ç…§çš„æ—¶é—´åˆ™æ˜¯ä»–æ‰€å±çš„CALyerçš„æ—¶é—´ç³»ã€‚</p>
<h2 id="CAMediaTiming"><a href="#CAMediaTiming" class="headerlink" title="CAMediaTiming"></a>CAMediaTiming</h2><p><a href="https://developer.apple.com/documentation/quartzcore/camediatiming" target="_blank" rel="external">CAMediaTiming</a>æ˜¯ä¸€ä¸ªåè®®ï¼Œå®šä¹‰äº†<code>beginTime</code>ï¼Œ<code>timeOffset</code>ï¼Œ<code>speed</code>ç­‰å±æ€§ã€‚<strong>CALayer</strong>ä»¥åŠ<strong>CAAnimation</strong>éƒ½å®ç°äº†è¯¥åè®®ã€‚</p>
<p>åœ¨<strong>CALayer</strong>ä¸­è®¾ç½®<code>CAMediaTiming</code>çš„ç›¸å…³å±æ€§æ˜¯ç”¨æ¥æ›´æ”¹CALyerçš„æ—¶é—´ç³»ï¼Œä¹Ÿå°±æ˜¯æ”¹å˜æ¯ä¸€æ—¶åˆ»çš„CALyerçš„æ—¶é—´ã€‚è€Œåœ¨<strong>CAAnimation</strong>ä¸­è®¾ç½®è¿™äº›å±æ€§ï¼Œåˆ™æ˜¯ä¸ºäº†ä¿®æ”¹åŠ¨ç”»çš„ç›¸å…³æ—¶é—´å±æ€§ï¼›è¿™äº›æ—¶é—´å±æ€§éƒ½æ˜¯å¯¹åº”ç›¸åº”çš„layerçš„æ—¶é—´ç³»çš„ã€‚</p>
<h2 id="CALayerçš„æ—¶é—´å¦‚ä½•è®¡ç®—"><a href="#CALayerçš„æ—¶é—´å¦‚ä½•è®¡ç®—" class="headerlink" title="CALayerçš„æ—¶é—´å¦‚ä½•è®¡ç®—"></a>CALayerçš„æ—¶é—´å¦‚ä½•è®¡ç®—</h2><blockquote>
<p>t = (tp - begin) * speed + offset</p>
</blockquote>
<p>ä¸Šé¢çš„å…¬å¼å°±æ˜¯è®¡ç®—å½“å‰layerçš„æ—¶é—´ã€‚</p>
<ol>
<li>tpï¼šçˆ¶layerå½“å‰çš„æ—¶é—´</li>
<li>beginï¼šå½“å‰layerçš„beginTimeå±æ€§</li>
<li>speedï¼šå½“å‰layerçš„speedå±æ€§</li>
<li>offsetï¼šå½“å‰layerçš„timeOffsetå±æ€§</li>
</ol>
<p>é‚£ä¹ˆå¦‚ä½•è·å–root layerçš„æ—¶é—´å‘¢ï¼š</p>
<pre><code class="objective-c">[[rootLayer convertTime:CACurrentMediaTime() fromLayer:nil]];
</code></pre>
<p>çœ‹ä¸€æ®µä»£ç ï¼š</p>
<pre><code class="objective-c">NSLog(@&quot;global time %f&quot;, CACurrentMediaTime());
NSLog(@&quot;layer time %f&quot;, [self.fatherLayer convertTime:CACurrentMediaTime() fromLayer:nil]);
</code></pre>
<p>å®ƒçš„è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code>2017-07-24 11:11:44.909 test2[67727:3342255] global time 247346.964195
2017-07-24 11:11:44.910 test2[67727:3342255] layer time 247356.964486
</code></pre><p><strong>å¯ä»¥çœ‹åˆ°åœ¨ä¸æ”¹å˜ä»»ä½•layerçš„å±æ€§çš„æƒ…å†µä¸‹ï¼šlayerçš„æ—¶é—´å’Œå…¨å±€æ—¶é—´æ˜¯ä¸€è‡´çš„ï¼›é‚£ä¹ˆæ ¹æ®çˆ¶å­æ—¶é—´åæ ‡ç³»çš„å…³ç³»ï¼Œå¦‚æœçˆ¶å­layeréƒ½æ˜¯é»˜è®¤è®¾ç½®ï¼Œé‚£ä¹ˆä»–ä»¬çš„æ—¶é—´æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯å…¨å±€æ—¶é—´</strong></p>
<h2 id="CALyeræ—¶é—´ä¸åŠ¨ç”»æ—¶é—´"><a href="#CALyeræ—¶é—´ä¸åŠ¨ç”»æ—¶é—´" class="headerlink" title="CALyeræ—¶é—´ä¸åŠ¨ç”»æ—¶é—´"></a>CALyeræ—¶é—´ä¸åŠ¨ç”»æ—¶é—´</h2><p>ä¸€ä¸ªCAAnimationçš„<code>duration</code>ï¼Œ<code>startime</code>ç­‰å±æ€§æ˜¯åŸºäºå“ªä¸ªæ—¶åˆ»çš„CALyeræ—¶é—´å‘¢ï¼Ÿæ˜¯è¿è¡Œå®Œ<code>[layer addAnimation:]</code>è¿™ä¸€å‡½æ•°çš„é‚£ä¸ªæ—¶åˆ»å—ï¼Ÿ</p>
<p>æ¥çœ‹æ®µä»£ç ï¼š</p>
<pre><code class="objective-c">CABasicAnimation *basic = [CABasicAnimation animationWithKeyPath:@&quot;position.x&quot;];

/* åŠ¨ç”»çš„è®¾ç½® */
basec.duration = 2.0f;

[self.fatherLayer addAnimation:basic forKey:nil];

// æ‰“å°addAnimationæ—¶å€™çš„æ—¶é—´
NSLog(@&quot;layer time %f&quot;, [self.fatherLayer convertTime:CACurrentMediaTime() fromLayer:nil]);

// ä¸»çº¿ç¨‹sleep 4ç§’é’Ÿ
[NSThread sleepForTimeInterval:4.0f];

// æ‰“å°sleepä¹‹åçš„æ—¶é—´
NSLog(@&quot;layer time %f&quot;, [self.fatherLayer convertTime:CACurrentMediaTime() fromLayer:nil]);
</code></pre>
<p>æ¥çœ‹çœ‹è¾“å‡ºï¼š</p>
<pre><code>2017-07-24 11:11:44.910 test2[67727:3342255] layer time 247356.964486
2017-07-24 11:11:48.911 test2[67727:3342255] layer time 247360.965715
</code></pre><p>ä¸¤æ¬¡æ‰“å°çš„æ—¶é—´ç¡®å®ç›¸å·®4sï¼Œè€Œä¸”åŠ¨ç”»ä¹Ÿæ˜¯æ­£å¸¸æ‰§è¡Œçš„ã€‚<strong>æ‰€ä»¥å¯ä»¥çœ‹åˆ°åŠ¨ç”»çš„å‚è€ƒæ—¶é—´ç‚¹å¹¶ä¸æ˜¯addAnimationçš„é‚£ä¸€åˆ»ï¼›è€Œåº”è¯¥æ˜¯ä¸»çº¿ç¨‹runloopè¿›è¡Œç•Œé¢æ›´æ–°ï¼ŒåŠ¨ç”»çœŸæ­£å¼€å§‹çš„é‚£ä¸€åˆ»ã€‚</strong></p>
<h2 id="è¿˜æœ‰ä¸€äº›å…¶ä»–çš„â€¦"><a href="#è¿˜æœ‰ä¸€äº›å…¶ä»–çš„â€¦" class="headerlink" title="è¿˜æœ‰ä¸€äº›å…¶ä»–çš„â€¦"></a>è¿˜æœ‰ä¸€äº›å…¶ä»–çš„â€¦</h2><p>æ¥ä¸¤å¼ åˆ†äº«ä¼šçš„ç°åœºç…§ç‰‡</p>
<p><img src="/lionheart/1707/share1.JPG" alt="share1"></p>
<p><img src="/lionheart/1707/share2.JPG" alt="share2"></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://wanston.github.io/2017/07/12/CAMediaTiming%E5%8D%8F%E8%AE%AE/" target="_blank" rel="external">CAMediaTiming</a></li>
<li><a href="https://stackoverflow.com/questions/20946481/comprehend-pause-and-resume-animation-on-a-layer" target="_blank" rel="external">Comprehend pause and resume animation on a layer</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[OCå…³è”å¯¹è±¡åŠå…¶å†…å­˜ç®¡ç†]]></title>
      <url>/2017/07/14/association-object-and-retain-count/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>OCçš„å…³è”å¯¹è±¡ç»å¸¸è¢«ç”¨æ¥å­˜å‚¨Categoryä¸­çš„å±æ€§å¯¹åº”çš„å®ä¾‹å˜é‡ï¼Œå½“ç„¶å®ƒè¿˜æœ‰å…¶ä»–çš„ç”¨é€”ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« å°†è®¨è®ºå…³è”å¯¹è±¡æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä»¥åŠå…³è”å¯¹è±¡çš„å†…å­˜ç®¡ç†é—®é¢˜ã€‚</p>
<a id="more"></a>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>å…ˆç”¨ä¸€æ®µä»£ç æ¥å¼•å…¥è¦è®²çš„ä¸œè¥¿ï¼š</p>
<pre><code class="objective-c">#import &quot;HCBase.h&quot;

@interface HCBase (vanney)

@property (nonatomic, assign) int cui;
@property (nonatomic, strong) NSString *van;

@end

/* -----------------  è¿™é‡Œæ˜¯åˆ†å‰²çº¿  -------------- */

#import &quot;HCBase+vanney.h&quot;

@implementation HCBase (vanney)

- (void)setCui:(int)cui {
    objc_setAssociatedObject(self, &quot;cui&quot;, @(cui), OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}

- (int)cui {
    return [objc_getAssociatedObject(self, &quot;cui&quot;) intValue];
}

- (void)setVan:(NSString *)van {
    objc_setAssociatedObject(self, &quot;van&quot;, van, OBJC_ASSOCIATION_COPY_NONATOMIC);
}

- (NSString *)van {
    return objc_getAssociatedObject(self, &quot;van&quot;);
}

@end
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼š</p>
<ol>
<li>åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªå±æ€§ <strong>cui</strong> å’Œ <strong>van</strong></li>
<li>åœ¨.mæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å…³è”å¯¹è±¡æ¥å­˜å‚¨è¿™ä¸¤ä¸ªå®ä¾‹å˜é‡</li>
<li>ä½¿ç”¨å…³è”å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬è¿˜æŒ‡å®šäº†å®ƒçš„å†…å­˜ç®¡ç†çš„æ–¹å¼ <strong>OBJC_ASSOCIATION_RETAIN_NONATOMIC</strong> å’Œ <strong>OBJC_ASSOCIATION_COPY_NONATOMIC</strong></li>
</ol>
<h2 id="å…³è”å¯¹è±¡çš„å®ç°"><a href="#å…³è”å¯¹è±¡çš„å®ç°" class="headerlink" title="å…³è”å¯¹è±¡çš„å®ç°"></a>å…³è”å¯¹è±¡çš„å®ç°</h2><p>å…³è”å¯¹è±¡çš„å®ç°æ˜¯å¼€æºçš„ï¼Œåœ¨runtimeçš„<code>objc-references.m</code>æºæ–‡ä»¶ä¸­ã€‚åœ¨OCä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„è¡¨æ¥å­˜å‚¨æ‰€æœ‰çš„å…³è”å¯¹è±¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/lionheart/1706/association.png" alt="association"></p>
<p>å…³äºè¿™å¼ å›¾çš„è§£é‡Šå¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡æ–‡ç« <a href="http://vanney9.com/2017/06/07/objective-c-runtime-category/" target="_blank" rel="external">Objective-C runtime - åˆ†ç±»ä¸å…³è”å¯¹è±¡</a></p>
<p>ä¸Šé¢çš„Demoä½¿ç”¨äº†ä¸‹é¢ä¸¤ä¸ªå‡½æ•°æ¥å­˜å–å…³è”å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä»–ä»¬çš„æºç </p>
<ol>
<li><strong>objc_setAssociatedObject</strong></li>
<li><strong>objc_getAssociatedObject</strong></li>
</ol>
<h3 id="objc-setAssociatedObject"><a href="#objc-setAssociatedObject" class="headerlink" title="objc_setAssociatedObject"></a>objc_setAssociatedObject</h3><p>è¿™ä¸ªæ–¹æ³•ç”¨æ¥è®¾ç½®å…³è”å¯¹è±¡ï¼š</p>
<pre><code class="objective-c">void _object_set_associative_reference(id object, void *key, id value, uintptr_t policy) {
    // å…³è”å¯¹è±¡ä½¿ç”¨ ObjcAssociation è¿™ä¸ªc++å¯¹è±¡æ¥å­˜å‚¨ã€‚
      // è®¾ç½®æ–°å¯¹è±¡ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½æœ‰è€çš„å¯¹è±¡ä¼šè¢«åºŸå¼ƒã€‚é‚£ä¹ˆæ–°å»ºä¸€ä¸ªObjcAssociationå¯¹è±¡ï¼Œä¹‹åç”¨æ¥å­˜å‚¨è€çš„å¯¹è±¡
    ObjcAssociation old_association(0, nil);

      // acquireValueå‡½æ•°ï¼š è®¾ç½®æ–°çš„å¯¹è±¡çš„retainCountï¼Œä¹Ÿå°±æ˜¯å¯¹ä»–è¿›è¡Œæ‰‹åŠ¨å†…å­˜ç®¡ç†
    id new_value = value ? acquireValue(value, policy) : nil;
    {
        AssociationsManager manager;
        AssociationsHashMap &amp;associations(manager.associations());
        disguised_ptr_t disguised_object = DISGUISE(object);

          // å¦‚æœç¡®å®æ˜¯è¦è®¾ç½®æ–°å…³è”å¯¹è±¡çš„æ—¶å€™
        if (new_value) {
            // break any existing association.
            AssociationsHashMap::iterator i = associations.find(disguised_object);

              // è¿™ä¸ªå¯¹è±¡ä¹‹å‰è®¾ç½®è¿‡å…³è”å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥å¯¹è±¡çš„å…³è”å¯¹è±¡æ•°é‡å¤§äº1
            if (i != associations.end()) {
                // secondary table exists
                ObjectAssociationMap *refs = i-&gt;second;
                ObjectAssociationMap::iterator j = refs-&gt;find(key);

                  // å¯»æ‰¾å…¨å±€çš„å…³è”å¯¹è±¡è¡¨ï¼Œå¦‚æœå­˜åœ¨è€å¯¹è±¡çš„è¯
                if (j != refs-&gt;end()) {
                      // å­˜å‚¨è€å¯¹è±¡åˆ°ä¹‹å‰æ–°å»ºçš„ObjcAssociationå¯¹è±¡ä¸­
                    old_association = j-&gt;second;
                      // è®¾ç½®æ–°çš„å…³è”å¯¹è±¡
                    j-&gt;second = ObjcAssociation(policy, new_value);
                }
                  // ä¸å­˜åœ¨è€å¯¹è±¡ï¼Œç›´æ¥è®¾ç½®æ–°å…³è”å¯¹è±¡
                  else {
                    (*refs)[key] = ObjcAssociation(policy, new_value);
                }
            }

              // è¿™ä¸ªå¯¹è±¡ä¹‹å‰æ²¡æœ‰è®¾ç½®è¿‡ä»»ä½•çš„å…³è”å¯¹è±¡
              else {
                // create the new association (first time).
                ObjectAssociationMap *refs = new ObjectAssociationMap;
                associations[disguised_object] = refs;
                (*refs)[key] = ObjcAssociation(policy, new_value);

                  // å°†å¯¹è±¡çš„isaçš„has_assocå­—æ®µè®¾ç½®æˆtrue
                object-&gt;setHasAssociatedObjects();
            }
        } 
          // è¦å°†å…³è”å¯¹è±¡è®¾æˆ nilï¼Œä¹Ÿå°±æ˜¯å–æ¶ˆè¯¥å…³è”å¯¹è±¡ã€‚å…ˆå­˜è€å¯¹è±¡ï¼Œå†åœ¨å…¨å±€è¡¨ä¸­åˆ é™¤è¯¥å…³è”å¯¹è±¡
          else {
            // setting the association to nil breaks the association.
            AssociationsHashMap::iterator i = associations.find(disguised_object);
            if (i !=  associations.end()) {
                ObjectAssociationMap *refs = i-&gt;second;
                ObjectAssociationMap::iterator j = refs-&gt;find(key);
                if (j != refs-&gt;end()) {
                    old_association = j-&gt;second;
                    refs-&gt;erase(j);
                }
            }
        }
    }


    // é‡Šæ”¾è€å¯¹è±¡ï¼ŒretainCountç›¸å…³ï¼Œå†…å­˜ç®¡ç†ç›¸å…³
    if (old_association.hasValue()) ReleaseValue()(old_association);
}
</code></pre>
<p> å¯ä»¥çœ‹åˆ°è®¾ç½®æ–°çš„å…³è”å¯¹è±¡å…¶å®å¾ˆç®€å•ï¼š</p>
<ol>
<li>ç°åœ¨å…¨å±€å…³è”å¯¹è±¡è¡¨ä¸­å¯»æ‰¾è¿™ä¸ªkey</li>
<li>å…ˆå­˜åŸæ¥å…³è”å¯¹è±¡</li>
<li>å†è®¾ç½®æ–°çš„å…³è”å¯¹è±¡</li>
<li>é‡Šæ”¾åŸæœ‰çš„å…³è”å¯¹è±¡</li>
</ol>
<h3 id="objc-getAssociatedObject"><a href="#objc-getAssociatedObject" class="headerlink" title="objc_getAssociatedObject"></a>objc_getAssociatedObject</h3><p>è·å–å…³è”å¯¹è±¡å°±æ›´ç®€å•äº†ï¼Œç›´æ¥åˆ°è¡¨ä¸­å»æ‰¾å¯¹åº”çš„keyçš„å¯¹è±¡å°±å¥½äº†ã€‚</p>
<h2 id="å…³è”å¯¹è±¡çš„å†…å­˜ç®¡ç†"><a href="#å…³è”å¯¹è±¡çš„å†…å­˜ç®¡ç†" class="headerlink" title="å…³è”å¯¹è±¡çš„å†…å­˜ç®¡ç†"></a>å…³è”å¯¹è±¡çš„å†…å­˜ç®¡ç†</h2><p>åœ¨ä¸Šé¢è®²åˆ°çš„æºä»£ç ä¸­ï¼Œæ¶‰åŠåˆ°ç®¡ç†å¯¹è±¡å†…å­˜ç®¡ç†çš„æœ‰ä¸¤ä¸ªå‡½æ•°</p>
<ol>
<li><strong>acquireValue</strong></li>
<li><strong>ReleaseValue</strong></li>
</ol>
<h3 id="requireValue"><a href="#requireValue" class="headerlink" title="requireValue"></a>requireValue</h3><pre><code class="objective-c">static id acquireValue(id value, uintptr_t policy) {
    switch (policy &amp; 0xFF) {
    case OBJC_ASSOCIATION_SETTER_RETAIN:
        return ((id(*)(id, SEL))objc_msgSend)(value, SEL_retain);
    case OBJC_ASSOCIATION_SETTER_COPY:
        return ((id(*)(id, SEL))objc_msgSend)(value, SEL_copy);
    }
    return value;
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè®¾ç½®å…³è”å¯¹è±¡çš„å†…å­˜ç®¡ç†æ–¹å¼å’Œä½ æ‰‹åŠ¨ä¼ è¿›æ¥çš„policyæœ‰å…³ã€‚</p>
<p>å°†policyå’Œ0XFFç›¸ä¸ï¼š</p>
<ol>
<li>ç»“æœæ˜¯<strong>OBJC_ASSOCIATION_SETTER_RETAIN</strong>çš„è¯ï¼Œå°±è°ƒç”¨å¯¹è±¡çš„retainå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å°†retainCountåŠ ä¸€</li>
<li>ç»“æœæ˜¯<strong>OBJC_ASSOCIATION_SETTER_COPY</strong>çš„è¯ï¼Œå°±è°ƒç”¨å¯¹è±¡çš„copyå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å°†æ‹·è´å¯¹è±¡ï¼Œå¹¶ç»™æ–°å¯¹è±¡çš„retainCountèµ‹1</li>
</ol>
<p><strong>PS</strong> :</p>
<ol>
<li>æ²¡æœ‰æ‰¾åˆ°å…·ä½“çš„SEL_copyçš„å®ç°ã€‚</li>
<li>è‡³äºretainçš„å®ç°ï¼Œå…¶å®å°±æ˜¯å°†å¯¹è±¡çš„isaçš„extra_rcå­—æ®µåŠ 1 å…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢<a href="http://www.jianshu.com/p/18c3e88dfbf1" target="_blank" rel="external">OCæºç  â€”â€” retainå’Œrelease</a></li>
</ol>
<h3 id="å„ç§å¸¸é‡"><a href="#å„ç§å¸¸é‡" class="headerlink" title="å„ç§å¸¸é‡"></a>å„ç§å¸¸é‡</h3><p>åœ¨æˆ‘ä»¬è‡ªå·±è°ƒç”¨å­˜å–å…³è”å¯¹è±¡çš„æ—¶å€™ä½¿ç”¨äº†<code>objc_AssociationPolicy</code>å¸¸é‡ï¼š</p>
<pre><code class="objective-c">typedef OBJC_ENUM(uintptr_t, objc_AssociationPolicy) {
    OBJC_ASSOCIATION_ASSIGN = 0,           /**&lt; Specifies a weak reference to the associated object. */
    OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1, /**&lt; Specifies a strong reference to the associated object. 
                                            *   The association is not made atomically. */
    OBJC_ASSOCIATION_COPY_NONATOMIC = 3,   /**&lt; Specifies that the associated object is copied. 
                                            *   The association is not made atomically. */
    OBJC_ASSOCIATION_RETAIN = 01401,       /**&lt; Specifies a strong reference to the associated object.
                                            *   The association is made atomically. */
    OBJC_ASSOCIATION_COPY = 01403          /**&lt; Specifies that the associated object is copied.
                                            *   The association is made atomically. */
};
</code></pre>
<p>æ ¹æ®åå­—å¾ˆå®¹æ˜“æƒ³åˆ°æ‰€å¯¹åº”çš„å†…å­˜ç®¡ç†è¯­ä¹‰ã€‚</p>
<p>åœ¨<code>objc-references.mm</code>ä¸­ä½¿ç”¨çš„æ˜¯å¦å¤–çš„å¸¸é‡ï¼š</p>
<pre><code class="objective-c">enum { 
    OBJC_ASSOCIATION_SETTER_ASSIGN      = 0,
    OBJC_ASSOCIATION_SETTER_RETAIN      = 1,
    OBJC_ASSOCIATION_SETTER_COPY        = 3,            // NOTE:  both bits are set, so we can simply test 1 bit in releaseValue below.
    OBJC_ASSOCIATION_GETTER_READ        = (0 &lt;&lt; 8), 
    OBJC_ASSOCIATION_GETTER_RETAIN      = (1 &lt;&lt; 8), 
    OBJC_ASSOCIATION_GETTER_AUTORELEASE = (2 &lt;&lt; 8)
};
</code></pre>
<p>å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªenumä¸­ï¼Œå‰ä¸‰ä¸ªæ˜¯ç›¸å¯¹åº”çš„ï¼Œä»–ä»¬æœ‰ç›¸åŒçš„å€¼</p>
<h3 id="ReleaseValue"><a href="#ReleaseValue" class="headerlink" title="ReleaseValue"></a>ReleaseValue</h3><pre><code class="objective-c">static void releaseValue(id value, uintptr_t policy) {
    if (policy &amp; OBJC_ASSOCIATION_SETTER_RETAIN) {
        ((id(*)(id, SEL))objc_msgSend)(value, SEL_release);
    }
}

struct ReleaseValue {
    void operator() (ObjcAssociation &amp;association) {
        releaseValue(association.value(), association.policy());
    }
};
</code></pre>
<p>å†æ¥çœ‹çœ‹å¦‚ä½•é‡Šæ”¾å¯¹è±¡ã€‚å¯ä»¥çœ‹åˆ°ï¼Œä»–æ˜¯å°†å…³è”å¯¹è±¡çš„<code>policy</code>å’Œ<code>OBJC_ASSOCIATION_SETTER_RETAIN</code>ç›¸ä¸ï¼Œç®€å•è®¡ç®—å°±ä¼šå‘ç°ï¼š<strong>å½“policyä¸ºretainå’Œcopyæ—¶ï¼Œè¿™ä¸ªifåˆ¤æ–­éƒ½æ˜¯æ­£ç¡®çš„ï¼Œä¹Ÿå°±ä¼šå¯¹ç›¸åº”å…³è”å¯¹è±¡æ‰§è¡Œreleaseæ“ä½œã€‚å’Œæˆ‘ä»¬é¢„æƒ³çš„æ˜¯ä¸€è‡´çš„ã€‚</strong></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://vanney9.com/2017/06/07/objective-c-runtime-category/" target="_blank" rel="external">Objective-C runtime - åˆ†ç±»ä¸å…³è”å¯¹è±¡</a></li>
<li><a href="http://www.jianshu.com/p/de95ff8230bd" target="_blank" rel="external">Runtimeæºç  â€”â€” Associated Object</a></li>
<li><a href="http://www.jianshu.com/p/18c3e88dfbf1" target="_blank" rel="external">OCæºç  â€”â€” retainå’Œrelease</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[ARCä¸‹å…³äºautoreleaseçš„ä¸€äº›ç–‘é—®]]></title>
      <url>/2017/07/13/question-about-autorelease/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šå¤©åœ¨çœ‹<a href="http://blog.sunnyxx.com/2014/10/15/behind-autorelease/" target="_blank" rel="external">é»‘å¹•èƒŒåçš„Autorelease</a>è¿™ç¯‡åšå®¢çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€äº›é—®é¢˜ã€‚ä¸»è¦é—®é¢˜åœ¨äºï¼š</p>
<pre><code class="objective-c">// ARC æƒ…å†µä¸‹
@autoreleasepool {
  id __strong array = [NSMutableArray array];
  NSLog(@&quot;array count is %lu&quot;, _objc_rootRetainCount(array));
  _objc_autoreleasePoolPrint();
}
</code></pre>
<p><strong>è¿™é‡Œçš„arrayå¯¹è±¡çš„retainCountåˆ°åº•æ˜¯1è¿˜æ˜¯2ï¼Ÿ</strong></p>
<p>æŒ‰ç…§æŸ¥æ‰¾çš„åšå®¢ï¼Œä»¥åŠä¹‹å‰çœ‹çš„ã€ŠObjective-Cé«˜çº§ç¼–ç¨‹ iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹è¿™æœ¬ä¹¦çš„ç»“è®ºï¼šè¿™é‡Œçš„retainCountåº”è¯¥æ˜¯1ï¼Œå› ä¸ºè¿™ä¸ªå¯¹è±¡æ²¡æœ‰æ³¨å†Œåˆ°autoreleasepoolä¸­ã€‚ä½†æ˜¯å®é™…è¿è¡Œä¸‹æ¥å´å¹¶éå¦‚æ­¤ã€‚</p>
<p><a href="https://stackoverflow.com/questions/45075336/ios-arc-objc-rootretaincount" target="_blank" rel="external">Stack Overflow</a></p>
<a id="more"></a>
<h2 id="Autorelease"><a href="#Autorelease" class="headerlink" title="Autorelease"></a>Autorelease</h2><h3 id="AutoreleasePool-è‡ªåŠ¨é‡Šæ”¾æ± "><a href="#AutoreleasePool-è‡ªåŠ¨é‡Šæ”¾æ± " class="headerlink" title="AutoreleasePool è‡ªåŠ¨é‡Šæ”¾æ± "></a>AutoreleasePool è‡ªåŠ¨é‡Šæ”¾æ± </h3><p>Autoreleaseå°±æ˜¯å»¶è¿Ÿreleaseçš„è°ƒç”¨æ—¶é—´ï¼Œå°†éœ€è¦å»¶è¿Ÿreleaseçš„å¯¹è±¡åŠ å…¥autoreleasepoolã€‚å½“poolå€¾å€’æ—¶ï¼Œå°±å¼€å§‹è°ƒç”¨poolä¸­çš„å¯¹è±¡çš„releaseæ–¹æ³•ã€‚æ¯ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ã€‚</p>
<p>åœ¨ARCä¸­ï¼Œä½¿ç”¨<code>@autoreleasepool{}</code>æ¥è¡¨ç¤ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ã€‚å°†OCä»£ç é€šè¿‡clangçš„<code>-rewrite-objc</code>ï¼Œå¯ä»¥ç”ŸæˆC++ä»£ç ã€‚å¯ä»¥çœ‹åˆ°è‡ªåŠ¨é‡Šæ”¾æ± æ˜¯ä¸€ä¸ª<code>__AtAutoreleasePool</code>C++å¯¹è±¡ã€‚ç„¶åè¿™ä¸ªå¯¹è±¡åªæ˜¯å¯¹<code>AutoreleasePoolPage</code>å¯¹è±¡çš„å°è£…ï¼Œå¯ä»¥åœ¨<code>NSObject.mm</code>æ–‡ä»¶ä¸­æ‰¾åˆ°å®ƒçš„è¯¦ç»†å®šä¹‰ã€‚</p>
<p>ä¸‹é¢è¿™ä¸¤ç¯‡åšå®¢å¯¹è‡ªåŠ¨é‡Šæ”¾æ± æœ‰è¯¦ç»†çš„è§£é‡Šï¼š</p>
<ol>
<li><a href="http://blog.sunnyxx.com/2014/10/15/behind-autorelease/" target="_blank" rel="external">é»‘å¹•èƒŒåçš„Autorelease</a></li>
<li><a href="http://www.jianshu.com/p/ca7835b41699" target="_blank" rel="external">OCæºç  â€”â€” autoreleasepool</a></li>
</ol>
<h3 id="Autoreleaseè¿”å›å€¼çš„å¿«é€Ÿé‡Šæ”¾æœºåˆ¶"><a href="#Autoreleaseè¿”å›å€¼çš„å¿«é€Ÿé‡Šæ”¾æœºåˆ¶" class="headerlink" title="Autoreleaseè¿”å›å€¼çš„å¿«é€Ÿé‡Šæ”¾æœºåˆ¶"></a>Autoreleaseè¿”å›å€¼çš„å¿«é€Ÿé‡Šæ”¾æœºåˆ¶</h3><pre><code class="objective-c">// ARCä¸‹
id array = [NSMutableArray array];

+ (NSMutableArray *)array {
  return [[NSMutableArray alloc] init];
}
</code></pre>
<p>å› ä¸º<code>array</code>ç±»æ–¹æ³•æ˜¯ä¸æŒæœ‰å¯¹è±¡çš„ï¼Œé‚£ä¹ˆæ­£å¸¸æƒ…å†µä¸‹è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šå°†è¿”å›å¯¹è±¡å…ˆæ³¨å†Œåˆ°è‡ªåŠ¨é‡Šæ”¾æ± ï¼›ä½†æ˜¯ç”±äºARCä¸‹é¢å­˜åœ¨è¿™ä¹ˆä¸€ä¸ªæœºåˆ¶ï¼Œå¯ä»¥ä¸å°†å¯¹è±¡æ³¨å†Œåˆ°è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œç›´æ¥ç»™arrayæŒæœ‰ã€‚</p>
<p>è¿™ä¸ªæœºåˆ¶ä¸»è¦ç”±è¿™ä¸¤ä¸ªå‡½æ•°æ„æˆï¼š</p>
<ol>
<li><code>objc_autoreleaseReturnValue(id);</code></li>
<li><code>objc_retainAutoreleasedReturnValue(id);</code></li>
</ol>
<p>ä¸è¿‡é€šè¿‡æˆ‘çš„æµ‹è¯•ï¼Œå‘ç°è¿™ä¸ªè¯´æ³•æœ‰ç‚¹è¯´ä¸é€šå•Šã€‚æ¥çœ‹çœ‹å®é™…çš„æƒ…å†µ</p>
<h2 id="å®åœ°æµ‹è¯•"><a href="#å®åœ°æµ‹è¯•" class="headerlink" title="å®åœ°æµ‹è¯•"></a>å®åœ°æµ‹è¯•</h2><p><strong>æµ‹è¯•çš„æ—¶å€™éœ€è¦ä¸¤ä¸ªå…³é”®çš„å‡½æ•°ï¼š</strong></p>
<ol>
<li><code>uintptr_t _objc_rootRetainCount(id obj);</code> : è¿”å›å¯¹è±¡çš„retainCount</li>
<li><code>void _objc_autoreleasePoolPrint();</code> ï¼šæ‰“å°æ­¤æ—¶çš„è‡ªåŠ¨é‡Šæ”¾æ± çš„å†…å®¹</li>
</ol>
<h3 id="MacOS-Command-Line-Tools"><a href="#MacOS-Command-Line-Tools" class="headerlink" title="MacOS Command Line Tools"></a>MacOS Command Line Tools</h3><p>æ–°å»ºä¸€ä¸ªMacOS Command Line Toolsçš„é¡¹ç›®ï¼Œæ€»å…±åªæœ‰ä¸‹é¢è¿™äº›ä»£ç ï¼š</p>
<pre><code class="objective-c">#import &lt;Foundation/Foundation.h&gt;

extern uintptr_t _objc_rootRetainCount(id obj);
extern void _objc_autoreleasePoolPrint();

int main(int argc, const char * argv[]) {
    @autoreleasepool {
        id array = [NSMutableArray array];
        NSLog(@&quot;array count is %lu&quot;, _objc_rootRetainCount(array));
        _objc_autoreleasePoolPrint();
    }

    return 0;
}
</code></pre>
<p>æ¥çœ‹çœ‹è¾“å‡ºç»“æœï¼š</p>
<pre><code>2017-07-13 20:21:52.419722 autoreleaseMac[87916:6040616] array count is 2
objc[87916]: ##############
objc[87916]: AUTORELEASE POOLS for thread 0x10012c3c0
objc[87916]: 2 releases pending.
objc[87916]: [0x102001000]  ................  PAGE  (hot) (cold)
objc[87916]: [0x102001038]  ################  POOL 0x102001038
objc[87916]: [0x102001040]       0x1004032b0  __NSArrayM
objc[87916]: ##############
Program ended with exit code: 0
</code></pre><p>å¯ä»¥å‘ç°ï¼šä½¿ç”¨<code>array</code>ç±»å‡½æ•°ç”Ÿæˆçš„å¯¹è±¡ä¸ä»…è¢«arrayç»™å¼ºå¼•ç”¨ï¼Œè¿˜è¢«æ³¨å…¥åˆ°äº†è‡ªåŠ¨é‡Šæ”¾æ± ï¼›æ‰€ä»¥ä»–çš„retainCountä¸º2ã€‚<strong>è¿™å°±è¯´æ˜äº†åœ¨Macä¸‹é¢ï¼Œè²Œä¼¼è¿™ä¸ªAutoreleaseè¿”å›å€¼çš„å¿«é€Ÿé‡Šæ”¾æœºåˆ¶ä¸èµ·ä½œç”¨</strong></p>
<h3 id="iOS-APP"><a href="#iOS-APP" class="headerlink" title="iOS APP"></a>iOS APP</h3><p>æ–°å»ºä¸€ä¸ªiOSçš„é¡¹ç›®ï¼Œæ¥çœ‹çœ‹iOSçš„<code>viewDidLoad</code>æ–¹æ³•ï¼š</p>
<pre><code class="objective-c">- (void)viewDidLoad {
    [super viewDidLoad];

    // id __weak ref = nil;   å…ˆæš‚æ—¶æ³¨é‡Šæ‰è¿™ä¸€è¡Œ

    id array = [NSMutableArray array];
      NSLog(@&quot;%p&quot;, array);
    NSLog(@&quot;array count is %lu&quot;, _objc_rootRetainCount(array));
    _objc_autoreleasePoolPrint();
}
</code></pre>
<p>æ¥çœ‹çœ‹æ‰“å°ç»“æœï¼š</p>
<pre><code class="objective-c">2017-07-13 20:31:29.637 autorelease[89067:6068334] array count is 1
objc[89067]: ##############
objc[89067]: AUTORELEASE POOLS for thread 0x112c2b3c0
objc[89067]: 888 releases pending.
...
// å¹¶æ²¡æœ‰å‘ç°arrayå¯¹è±¡åŠ å…¥äº†è‡ªåŠ¨é‡Šæ”¾æ± 
</code></pre>
<p>åœ¨iOSä¸‹é¢è¿™ä¸ªarrayå¯¹è±¡çš„retainCountä½1ï¼Œä¹Ÿæ²¡æœ‰åŠ å…¥åˆ°è‡ªåŠ¨é‡Šæ”¾æ± ã€‚<strong>è¿™ä¹ˆçœ‹è²Œä¼¼è¿™ä¸ªå¿«é€Ÿé‡Šæ”¾æœºåˆ¶èµ·ä½œç”¨äº†</strong></p>
<p>å…ˆåˆ«æ€¥ï¼šè®©æˆ‘ä»¬å–æ¶ˆæ³¨é‡Šï¼Œå£°æ˜ä¸€ä¸ª__weakå˜é‡ï¼Œå†æ¥çœ‹çœ‹è¿è¡Œç»“æœï¼š</p>
<pre><code class="objective-c">2017-07-13 20:35:39.510 autorelease[89587:6080048] 0x6080000468a0  // å¯¹è±¡åœ°å€
2017-07-13 20:35:39.510 autorelease[89587:6080048] array count is 2
objc[89587]: ##############
objc[89587]: AUTORELEASE POOLS for thread 0x1110ce3c0
objc[89587]: 889 releases pending.
...
objc[89587]: [0x7ff4b281ec20]    0x7ff4b4005f80  ViewController
objc[89587]: [0x7ff4b281ec28]    0x7ff4b4005f80  ViewController
objc[89587]: [0x7ff4b281ec30]    0x6080000468a0  __NSArrayM   // åŠ å…¥åˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­çš„å¯¹è±¡åœ°å€ï¼Œå’Œä¸Šé¢çš„ç›¸åŒ
objc[89587]: ##############
</code></pre>
<p>å¯ä»¥çœ‹åˆ°retainCountå˜æˆäº†2ï¼Œè€Œä¸”ä¹Ÿç¡®å®æ˜¯å°†arrayå¯¹è±¡åŠ å…¥åˆ°äº†è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ã€‚<strong>è¿™æ—¶å€™è¿™ä¸ªå¿«é€Ÿé‡Šæ”¾æœºåˆ¶è²Œä¼¼åˆå¤±æ•ˆäº†ã€‚ã€‚</strong></p>
<p><strong>è¿™é‡Œçš„ä¸€ä¸ªå®Œå…¨æ— å…³çš„__weakå˜é‡çš„å£°æ˜ï¼Œä¼¼ä¹æ˜¯è¿™ä¸ªå¿«é€Ÿé‡Šæ”¾æœºåˆ¶çš„å¼€å…³ï¼›æœ‰ç‚¹ç„å­¦=ã€‚=</strong></p>
<h2 id="åç»­æ“ä½œ"><a href="#åç»­æ“ä½œ" class="headerlink" title="åç»­æ“ä½œ"></a>åç»­æ“ä½œ</h2><h3 id="clang-S"><a href="#clang-S" class="headerlink" title="clang -S"></a>clang -S</h3><p>å¯ä»¥é€šè¿‡clangçš„<code>-S</code>é€‰é¡¹ï¼Œæ¥çœ‹çœ‹è¿™äº›æ–‡ä»¶ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ï¼Œæˆ–è®¸å¯ä»¥ä»ä¸­çœ‹å‡ºäº›ç«¯å€ªã€‚ä½†æ˜¯æˆ‘ä¸æ‡‚æ±‡ç¼–=.=</p>
<h3 id="LinkMap"><a href="#LinkMap" class="headerlink" title="LinkMap"></a>LinkMap</h3><p>å¼€å¯Xcodeçš„Write Link Map Fileé€‰é¡¹ï¼ŒæŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„æ„æˆã€‚</p>
<p>å½“æ²¡æœ‰å®šä¹‰__weakå˜é‡æ—¶ï¼š</p>
<p><img src="/lionheart/1707/without.png" alt="without"></p>
<p>å½“æœ‰å®šä¹‰__weakå˜é‡æ—¶ï¼š</p>
<p><img src="/lionheart/1707/with.png" alt="with"></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨å®šä¹‰äº†__weakå˜é‡æ—¶ï¼Œå¤šäº†ä¸¤ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼š</p>
<ol>
<li>__Unwind_Resume</li>
<li>_objc_destroyWeak</li>
</ol>
<p>æ‰€ä»¥æ„Ÿè§‰é—®é¢˜å°±åœ¨è¿™ä¸¤ä¸ªå‡½æ•°ä¹‹ä¸­</p>
<h3 id="Stack-Overflow"><a href="#Stack-Overflow" class="headerlink" title="Stack Overflow"></a>Stack Overflow</h3><p>æˆ‘å°†è¯¥é—®é¢˜æ”¾åœ¨äº†<a href="https://stackoverflow.com/questions/45075336/ios-arc-objc-rootretaincount" target="_blank" rel="external">Stack Overflow</a>ä¸Šé¢äº†ã€‚å¦‚æœå“ªä½å¤§ç¥ç¢°å·§çœ‹åˆ°äº†è¿™ç¯‡æ–‡ç« ï¼Œå¹¶ä¸”è¿˜è€å¿ƒçš„çœ‹åˆ°äº†è¿™é‡Œï¼Œç¢°å·§è¿˜çŸ¥é“ç­”æ¡ˆçš„è¯ï¼Œå¯ä»¥åˆ°StackOverflowä¸Šé¢å¸®æˆ‘è§£è§£æƒ‘</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://blog.cnbang.net/tech/2296/" target="_blank" rel="external">iOS APPå¯æ‰§è¡Œæ–‡ä»¶çš„ç»„æˆ</a></li>
<li><a href="https://reverseengineering.stackexchange.com/questions/8163/in-a-mach-o-executable-how-can-i-find-which-function-a-stub-targets" target="_blank" rel="external">In a Mach-O executable, how can I find which function a stub targets?</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[JSPatchæºç åˆ†æ]]></title>
      <url>/2017/07/07/JSPatch-source-analyze/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><a href="https://github.com/bang590/JSPatch" target="_blank" rel="external">JSPatch</a>æ˜¯ä¸€ä¸ªå¯ä»¥åŠ¨æ€æ›´æ–°iOS APPçš„å¼€æºåº“ã€‚é€šè¿‡JSPatchï¼Œå¯ä»¥ä½¿ç”¨JSä¹¦å†™åŸç”Ÿä»£ç ï¼ŒåŠ¨æ€æ›´æ–°APPï¼Œæ›¿æ¢é¡¹ç›®åŸç”Ÿä»£ç ä¿®å¤Bugã€‚</p>
<p>JSPatchå……åˆ†åº”ç”¨äº†Objective-Cçš„runtimeï¼Œæ¥å®ç°è‡ªå·±çš„åŠŸèƒ½ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« å°†ç»“åˆDemoï¼Œæ¥åˆ†æJSPatchçš„ä¸»è¦çš„å®ç°è¿‡ç¨‹ã€‚åŒ…æ‹¬ï¼š</p>
<ol>
<li>ä½¿ç”¨JSæ–°å»ºç±»</li>
<li>ä½¿ç”¨JSæ›¿æ¢åŸæœ‰æ–¹æ³•</li>
<li>ä½¿ç”¨JSæ·»åŠ å…¨æ–°æ–¹æ³•</li>
<li>OCè°ƒç”¨JSå®šä¹‰çš„æ–¹æ³•</li>
<li>JSè°ƒç”¨OCå®šä¹‰çš„æ–¹æ³•</li>
</ol>
<a id="more"></a>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>ä½¿ç”¨å®˜æ–¹æä¾›çš„<a href="https://github.com/bang590/JSPatch/tree/master/Demo/iOSDemo" target="_blank" rel="external">Demo</a>ã€‚å…ˆæ¥çœ‹çœ‹Demoçš„å…³é”®ä»£ç ï¼š</p>
<h4 id="JPViewController"><a href="#JPViewController" class="headerlink" title="JPViewController"></a>JPViewController</h4><pre><code class="objective-c">@implementation JPViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    UIButton *btn = [[UIButton alloc] initWithFrame:CGRectMake(0, 100, [UIScreen mainScreen].bounds.size.width, 50)];
    [btn setTitle:@&quot;Push JPTableViewController&quot; forState:UIControlStateNormal];
    [btn addTarget:self action:@selector(handleBtn:) forControlEvents:UIControlEventTouchUpInside];
    [btn setBackgroundColor:[UIColor grayColor]];
    [self.view addSubview:btn];
}

- (void)handleBtn:(id)sender
{
}

@end
</code></pre>
<p>è¿™ä¸ªJPViewControlleråˆ›å»ºäº†ä¸€ä¸ªbuttonï¼Œå¹¶ç»™è¯¥buttonèµ‹äºˆäº†ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ã€‚<strong>ä½†æ˜¯è¯¥ç‚¹å‡»äº‹ä»¶<code>- (void)handleBtn:(id)sender;</code>æ²¡åšä»»ä½•äº‹æƒ…</strong></p>
<h4 id="demo-js"><a href="#demo-js" class="headerlink" title="demo.js"></a>demo.js</h4><pre><code class="javascript">/* ç»™JPViewControlleré‡æ–°å®šä¹‰ handleBtn: æ–¹æ³• */
defineClass(&#39;JPViewController&#39;, {
  handleBtn: function(sender) {
    var tableViewCtrl = JPTableViewController.alloc().init()
    self.navigationController().pushViewController_animated(tableViewCtrl, YES)
  }
})

// å®šä¹‰äº†ä¸€ä¸ªæ–°çš„ç±»å‹ JPTableViewController
defineClass(&#39;JPTableViewController : UITableViewController &lt;UIAlertViewDelegate&gt;&#39;, [&#39;data&#39;], {
  dataSource: function() {
    var data = self.data();
    if (data) return data;
    var data = [];
    for (var i = 0; i &lt; 20; i ++) {
      data.push(&quot;cell from js &quot; + i);
    }
    self.setData(data)
    return data;
  },
  numberOfSectionsInTableView: function(tableView) {
    return 1;
  },
  tableView_numberOfRowsInSection: function(tableView, section) {
    return self.dataSource().length;
  },
  tableView_cellForRowAtIndexPath: function(tableView, indexPath) {
    var cell = tableView.dequeueReusableCellWithIdentifier(&quot;cell&quot;) 
    if (!cell) {
      cell = require(&#39;UITableViewCell&#39;).alloc().initWithStyle_reuseIdentifier(0, &quot;cell&quot;)
    }
    cell.textLabel().setText(self.dataSource()[indexPath.row()])
    return cell
  },
  tableView_heightForRowAtIndexPath: function(tableView, indexPath) {
    return 60
  },
  tableView_didSelectRowAtIndexPath: function(tableView, indexPath) {
     var alertView = require(&#39;UIAlertView&#39;).alloc().initWithTitle_message_delegate_cancelButtonTitle_otherButtonTitles(&quot;Alert&quot;,self.dataSource()[indexPath.row()], self, &quot;OK&quot;,  null);
     alertView.show()
  },
  alertView_willDismissWithButtonIndex: function(alertView, idx) {
    console.log(&#39;click btn &#39; + alertView.buttonTitleAtIndex(idx).toJS())
  }
})
</code></pre>
<p>è¯¥JSæ˜¯Demoçš„å”¯ä¸€ä¸€ä¸ªJSã€‚å®ƒåšäº†ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>é‡æ–°å®šä¹‰<code>JPViewController</code>çš„<code>handleBtn:</code>æ–¹æ³•ï¼›ç°åœ¨ç‚¹å‡»è¯¥buttonçš„è¯ï¼Œä¼šæ–°å»ºä¸€ä¸ªtableView</li>
<li>å®šä¹‰ä¸€ä¸ªæ–°çš„ç±»å‹ <code>JPTableViewController</code>ï¼›è¿™ä¸ªæ–°çš„ç±»å‹è´Ÿè´£åˆ›å»ºç›¸å…³çš„tableView</li>
</ol>
<h4 id="JPEngine-m-å’Œ-JSPatch-js"><a href="#JPEngine-m-å’Œ-JSPatch-js" class="headerlink" title="JPEngine.m å’Œ JSPatch.js"></a>JPEngine.m å’Œ JSPatch.js</h4><p> è¿™æ˜¯JSPatchåº“çš„æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªæ–‡ä»¶ã€‚</p>
<p><strong>è¯¥Demoåˆ›å»ºäº†ä¸€ä¸ªbuttonï¼Œç‚¹å‡»buttonä¹‹åï¼Œä¼šè°ƒç”¨JSé‡Œé¢çš„æ–¹æ³•ï¼šè¯¥JSæ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªtableViewï¼Œå¹¶ç»™æ¯ä¸ªcellè®¾ç½®ä¸€ä¸ªclickäº‹ä»¶</strong></p>
<h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><h3 id="ä½¿ç”¨JSåˆ›å»ºObjective-Cçš„ç±»"><a href="#ä½¿ç”¨JSåˆ›å»ºObjective-Cçš„ç±»" class="headerlink" title="ä½¿ç”¨JSåˆ›å»ºObjective-Cçš„ç±»"></a>ä½¿ç”¨JSåˆ›å»ºObjective-Cçš„ç±»</h3><p>åœ¨<code>demo.js</code>ä¸­ä½¿ç”¨äº† <code>defineClass</code> æ–¹æ³•æ¥åˆ›å»ºæ–°çš„Objective-Cç±»ã€‚è¿™ä¸ªæ–¹æ³•å®šä¹‰åœ¨<code>JSPatch.js</code>ä¸­ã€‚ç°åœ¨æ¥çœ‹çœ‹å®ƒçš„å®ç°ï¼š(<strong>åªæ˜¾ç¤ºäº†æ ¸å¿ƒä»£ç </strong>)</p>
<pre><code class="javascript">global.defineClass = function(declaration, properties, instMethods, clsMethods) {
    var newInstMethods = {}, newClsMethods = {}

    // è·å¾—ç±»åï¼Œå¿½ç•¥å†’å·ä¹‹åçš„superClassä»¥åŠprotocol //
    var realClsName = declaration.split(&#39;:&#39;)[0].trim()

    // JS &lt;=&gt; OC çš„ä¸€äº›æ ¼å¼åŒ– æš‚æ—¶ä¸ç®¡ï¼Œè¿™ä¸€æ­¥ä¹‹åå°†ä¼šäº§ç”Ÿ
    _formatDefineMethods(instMethods, newInstMethods, realClsName)
    _formatDefineMethods(clsMethods, newClsMethods, realClsName)

    // æ ¸å¿ƒä»£ç ï¼š åœ¨_OC_defineClassä¸­è°ƒç”¨OCçš„æ–¹æ³•ï¼Œåˆ›å»ºæ–°çš„Objective-Cç±»ï¼Œå¹¶æ·»åŠ æˆ–è€…æ›¿ä»£æ–¹æ³•
    var ret = _OC_defineClass(declaration, newInstMethods, newClsMethods)

    /* æ­¤å¤„çœç•¥800å­— */
    return require(className)
}
</code></pre>
<p>ä½¿ç”¨iOS7å¼•å…¥çš„<strong>JavaScriptCoreæ¡†æ¶</strong> ï¼Œå¯ä»¥å®ç°åœ¨JSä¸­è°ƒç”¨OCçš„æ–¹æ³•ï¼ˆå…·ä½“å‚è€ƒ<a href="http://nshipster.cn/javascriptcore/" target="_blank" rel="external">JavaScriptCore</a>ï¼‰ã€‚<code>defineClass</code>æ–¹æ³•ä¸­ï¼Œè°ƒç”¨<code>_OC_defineClass</code>æ–¹æ³•æ¥åˆ›å»ºæ–°çš„ç±»ï¼Œä»¥åŠæ›¿æ¢åŸæœ‰æ–¹æ³•æˆ–è€…ç”Ÿæˆæ–°çš„æ–¹æ³•ã€‚</p>
<p>æ¥çœ‹çœ‹å®šä¹‰åœ¨<code>JPEngine.m</code>æ–‡ä»¶ä¸­çš„è¿™ä¸ªæ–¹æ³•ï¼š</p>
<pre><code class="objective-c">+ (void)startEngine {
  context[@&quot;_OC_defineClass&quot;] = ^(NSString *classDeclaration, JSValue *instanceMethods, JSValue *classMethods) {
    return defineClass(classDeclaration, instanceMethods, classMethods);
  };
}
</code></pre>
<p>è¿™é‡Œçš„<code>context</code> å˜é‡æ˜¯<strong>JSContext</strong>å˜é‡ï¼Œä¹Ÿå°±æ˜¯JSçš„æ‰§è¡Œç¯å¢ƒï¼›åœ¨è¯¥æ‰§è¡Œç¯å¢ƒé‡Œé¢å®šä¹‰äº†ä¸€ä¸ª<code>_OC_defineClass</code> Blockã€‚é‚£ä¹ˆJSå°±å¯ä»¥è°ƒç”¨è¯¥<code>_OC_defineClass</code>æ–¹æ³•ï¼Œå¹¶æ‰§è¡ŒBlockï¼Œä¹Ÿå°±æ˜¯æ‰§è¡ŒOCä»£ç ã€‚</p>
<p>æ¥çœ‹çœ‹Blocké‡Œé¢çš„<code>defineClass</code>è¿™ä¸€ä¸ªCæ–¹æ³•</p>
<pre><code class="objective-c">static NSDictionary *defineClass(NSString *classDeclaration, JSValue *instanceMethods, JSValue *classMethods)
{
      // è¿™é‡Œçš„classDeclarationç±»ä¼¼è¿™ç§æ ¼å¼ ï¼š ClassName : NSObject &lt;protocolName&gt;
    NSScanner *scanner = [NSScanner scannerWithString:classDeclaration];

    NSString *className;
    NSString *superClassName;
    NSString *protocolNames;

      /* æ­¤å¤„çœç•¥800å­— è§£æç”ŸæˆclassName  superClassName å’Œ protocolName*/

    Class cls = NSClassFromString(className);

    // å¦‚æœOCä¸­ä¸å­˜åœ¨è¿™ä¸ªç±» åˆ™æ–°å»ºclass
    if (!cls) {
        Class superCls = NSClassFromString(superClassName);
        cls = objc_allocateClassPair(superCls, className.UTF8String, 0);
        objc_registerClassPair(cls);
    }

    // ç»™è¯¥ç±»æ·»åŠ åè®®
    if (protocols.count &gt; 0) {
        for (NSString* protocolName in protocols) {
            Protocol *protocol = objc_getProtocol([trim(protocolName) cStringUsingEncoding:NSUTF8StringEncoding]);
            class_addProtocol (cls, protocol);
        }
    }

      /* æ­¤å¤„çœç•¥800å­— */
}
</code></pre>
<p><strong>æ€»ç»“ï¼š å¯ä»¥çœ‹åˆ°ï¼Œåœ¨JSä¸­åˆ›å»ºçš„ç±»åä¼šè¢«ä¼ å…¥OCã€‚OCä¼šåˆ¤æ–­è¯¥ç±»åå¯¹åº”çš„ç±»æ˜¯å¦å­˜åœ¨ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¼šä½¿ç”¨runtimeæ–¹æ³•æ¥åŠ¨æ€åˆ›å»ºè¿™ä¸ªç±»</strong></p>
<h3 id="ä½¿ç”¨JSæ›¿æ¢åŸæœ‰æ–¹æ³•"><a href="#ä½¿ç”¨JSæ›¿æ¢åŸæœ‰æ–¹æ³•" class="headerlink" title="ä½¿ç”¨JSæ›¿æ¢åŸæœ‰æ–¹æ³•"></a>ä½¿ç”¨JSæ›¿æ¢åŸæœ‰æ–¹æ³•</h3><p>å†æ¥çœ‹ä¸€ä¸‹<code>demo.js</code></p>
<pre><code class="javascript">defineClass(&#39;JPViewController&#39;, {
  handleBtn: function(sender) {
    var tableViewCtrl = JPTableViewController.alloc().init()
    self.navigationController().pushViewController_animated(tableViewCtrl, YES)
  }
})
</code></pre>
<p>è¿™é‡Œä½¿ç”¨JSå®šä¹‰äº†<code>JPViewController</code>ç±»çš„<code>handleBtn:</code>æ–¹æ³•ï¼›æ‰§è¡Œå®Œ<code>defineClass</code>è¿™ä¸ªJSæ–¹æ³•ä¹‹åï¼Œè¿™é‡Œçš„å®ç°ä¼šæ›¿æ¢åŸæ¥çš„<code>handleBtn:</code>çš„å®ç°ã€‚</p>
<p>å…ˆæ¥è¯´ä¸€ä¸‹<strong>æ–¹æ³•æ›¿æ¢</strong>çš„å…·ä½“æµç¨‹ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª<code>ORIGhandleBtn:</code>  selectorï¼ŒæŒ‡å‘<code>handleBtn:</code>çš„IMP</li>
<li>åˆ›å»ºä¸€ä¸ª<code>ORIGforwardInvocation:</code> selectorï¼ŒæŒ‡å‘<code>JPViewController</code> çš„ <code>forwardInvocation:</code> çš„IMP</li>
<li>å°†<code>handleBtn:</code> selector æŒ‡å‘ <code>_objc_msgForward</code> ï¼›ä¹Ÿå°±æ˜¯è¯´æ‰§è¡Œ<code>handleBtn:</code>è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¸ä¼šå»æŸ¥æ‰¾å®ƒçš„å®ç°ï¼Œä¼šç›´æ¥è¿›è¡Œæ¶ˆæ¯è½¬å‘(å…³äºæ¶ˆæ¯è½¬å‘ï¼Œå¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç«  <a href="http://vanney9.com/2017/06/08/objective-c-runtime-message/" target="_blank" rel="external">Objective-C runtime - æ¶ˆæ¯</a>)</li>
<li>åœ¨OCçš„å…¨å±€å˜é‡ <code>_JSOverideMethods</code> ä¸­ä¿å­˜è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯ä¿å­˜JSä¸­å®šä¹‰çš„è¿™ä¸ªæ–¹æ³•</li>
<li>å°†<code>forwardInvocation:</code> è¿™ä¸ªselectoræŒ‡å‘ <code>JPForwardInvocation</code>çš„å®ç°ï¼›<strong><code>JPForwardInvocation</code>åˆæ˜¯JSPatché‡Œé¢çš„ä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•</strong>ã€‚åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ä¼šå¯»æ‰¾JSå®šä¹‰çš„<code>handleBtn</code>ï¼Œå¹¶è°ƒç”¨è¯¥æ–¹æ³•</li>
</ol>
<p>æ¥çœ‹çœ‹ä»£ç </p>
<pre><code class="objective-c">static NSDictionary *defineClass(NSString *classDeclaration, JSValue *instanceMethods, JSValue *classMethods)
{
    /* æ­¤å¤„çœç•¥800å­— */

      // i == 0 æ·»åŠ å®ä¾‹æ–¹æ³•ï¼› i == 1 æ·»åŠ ç±»æ–¹æ³•
    for (int i = 0; i &lt; 2; i ++) {
        BOOL isInstance = i == 0;
        JSValue *jsMethods = isInstance ? instanceMethods: classMethods;

        Class currCls = isInstance ? cls: objc_getMetaClass(className.UTF8String);

          // è·å–æ–¹æ³•åˆ—è¡¨ï¼Œforå¾ªç¯é€ä¸ªç»™ç±»æ·»åŠ æ–¹æ³•
        NSDictionary *methodDict = [jsMethods toDictionary];
        for (NSString *jsMethodName in methodDict.allKeys) {
            JSValue *jsMethodArr = [jsMethods valueForProperty:jsMethodName];
            int numberOfArg = [jsMethodArr[0] toInt32];
            NSString *selectorName = convertJPSelectorString(jsMethodName);
            if ([selectorName componentsSeparatedByString:@&quot;:&quot;].count - 1 &lt; numberOfArg) {
                selectorName = [selectorName stringByAppendingString:@&quot;:&quot;];
            }

            JSValue *jsMethod = jsMethodArr[1];
            if (class_respondsToSelector(currCls, NSSelectorFromString(selectorName))) {
                // å·²ç»æœ‰å¯¹åº”çš„æ–¹æ³•äº†ï¼Œæ›¿æ¢æ–¹æ³•
                overrideMethod(currCls, selectorName, jsMethod, !isInstance, NULL);
            } else {
                // æ–°å¢æ–¹æ³•
               /* å…ˆçœç•¥800å­— åæ–‡å†è¯´ */
            }
        }
    }

      // æ·»åŠ ç»Ÿä¸€çš„setter/getterå‡½æ•°
    class_addMethod(cls, @selector(getProp:), (IMP)getPropIMP, &quot;@@:@&quot;);
    class_addMethod(cls, @selector(setProp:forKey:), (IMP)setPropIMP, &quot;v@:@@&quot;);

    return @{@&quot;cls&quot;: className, @&quot;superCls&quot;: superClassName};
}
</code></pre>
<p>çœ‹æ¥æ›¿æ¢æ–¹æ³•çš„æ ¸å¿ƒè¿˜åœ¨<code>overrideMethod</code> é‡Œé¢ï¼Œæ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•</p>
<pre><code class="objective-c">static void overrideMethod(Class cls, NSString *selectorName, JSValue *function, BOOL isClassMethod, const char *typeDescription)
{
      // è·å–æ–¹æ³•åå¯¹åº”çš„selector
    SEL selector = NSSelectorFromString(selectorName);

    // è·å–methodçš„typeDescription:ä¹Ÿå°±æ˜¯è·å–æ–¹æ³•çš„typeEncoding
    if (!typeDescription) {
        Method method = class_getInstanceMethod(cls, selector);
        typeDescription = (char *)method_getTypeEncoding(method);
    }

      // è·å–æ–¹æ³•çš„æœ€åˆçš„å®ç°
    IMP originalImp = class_respondsToSelector(cls, selector) ? class_getMethodImplementation(cls, selector) : NULL;

      // è·å–_objc_msgForwardçš„å®ç°
    IMP msgForwardIMP = _objc_msgForward;

    // ä¿ç•™forwardInvocation:çš„åŸæœ‰å®ç°ï¼Œå¹¶å°†å®ƒæŒ‡å‘JPForwardInvocationè¿™ä¸ªæ–°çš„å®ç°ä¸Šé¢
    if (class_getMethodImplementation(cls, @selector(forwardInvocation:)) != (IMP)JPForwardInvocation) {
        IMP originalForwardImp = class_replaceMethod(cls, @selector(forwardInvocation:), (IMP)JPForwardInvocation, &quot;v@:@&quot;);
        if (originalForwardImp) {
            class_addMethod(cls, @selector(ORIGforwardInvocation:), originalForwardImp, &quot;v@:@&quot;);
        }
    }

    // ä¿ç•™å°†è¦æ›¿æ¢çš„æ–¹æ³•ï¼šä½¿ç”¨ORIGselectorNameè¿™ä¸€ä¸ªselectoræŒ‡å‘åŸæœ‰çš„å®ç°
    if (class_respondsToSelector(cls, selector)) {
        NSString *originalSelectorName = [NSString stringWithFormat:@&quot;ORIG%@&quot;, selectorName];
        SEL originalSelector = NSSelectorFromString(originalSelectorName);
        if(!class_respondsToSelector(cls, originalSelector)) {
            class_addMethod(cls, originalSelector, originalImp, typeDescription);
        }
    }

      // å°†JSå®šä¹‰çš„å®ç°ä¿å­˜åˆ°OCçš„å…¨å±€å˜é‡ä¸­
    NSString *JPSelectorName = [NSString stringWithFormat:@&quot;_JP%@&quot;, selectorName];
    _initJPOverideMethods(cls);
    _JSOverideMethods[cls][JPSelectorName] = function;

       // å°†è¦æ›¿æ¢çš„æ–¹æ³•ï¼ŒæŒ‡å‘_objc_msgForwardè¿™ä¸€å‡½æ•°ï¼Œç›´æ¥è¿›è¡Œæ¶ˆæ¯è½¬å‘
    class_replaceMethod(cls, selector, msgForwardIMP, typeDescription);
}
</code></pre>
<h3 id="ä½¿ç”¨JSåˆ›å»ºæ–°çš„æ–¹æ³•"><a href="#ä½¿ç”¨JSåˆ›å»ºæ–°çš„æ–¹æ³•" class="headerlink" title="ä½¿ç”¨JSåˆ›å»ºæ–°çš„æ–¹æ³•"></a>ä½¿ç”¨JSåˆ›å»ºæ–°çš„æ–¹æ³•</h3><p>è¿˜æ˜¯å…ˆæ¥çœ‹çœ‹<code>demo.js</code></p>
<pre><code class="javascript">defineClass(&#39;JPTableViewController : UITableViewController &lt;UIAlertViewDelegate&gt;&#39;, [&#39;data&#39;], {
  dataSource: function() {
    var data = self.data();
    if (data) return data;
    var data = [];
    for (var i = 0; i &lt; 20; i ++) {
      data.push(&quot;cell from js &quot; + i);
    }
    self.setData(data)
    return data;
  },
  numberOfSectionsInTableView: function(tableView) {
    return 1;
  },
  tableView_numberOfRowsInSection: function(tableView, section) {
    return self.dataSource().length;
  },
  tableView_cellForRowAtIndexPath: function(tableView, indexPath) {
    var cell = tableView.dequeueReusableCellWithIdentifier(&quot;cell&quot;) 
    if (!cell) {
      cell = require(&#39;UITableViewCell&#39;).alloc().initWithStyle_reuseIdentifier(0, &quot;cell&quot;)
    }
    cell.textLabel().setText(self.dataSource()[indexPath.row()])
    return cell
  },
  tableView_heightForRowAtIndexPath: function(tableView, indexPath) {
    return 60
  },
  tableView_didSelectRowAtIndexPath: function(tableView, indexPath) {
     var alertView = require(&#39;UIAlertView&#39;).alloc().initWithTitle_message_delegate_cancelButtonTitle_otherButtonTitles(&quot;Alert&quot;,self.dataSource()[indexPath.row()], self, &quot;OK&quot;,  null);
     alertView.show()
  },
  alertView_willDismissWithButtonIndex: function(alertView, idx) {
    console.log(&#39;click btn &#39; + alertView.buttonTitleAtIndex(idx).toJS())
  }
})
</code></pre>
<p>åœ¨è¿™ä¸ªJSæ–¹æ³•é‡Œé¢ï¼Œä¸ä»…å®šä¹‰äº†ä¸€ä¸ªæ–°çš„OCç±»<code>JPTableViewController</code>ï¼Œå¹¶ç»™ä»–æ·»åŠ äº†å¤šä¸ªæ–¹æ³•ã€‚æ¥çœ‹çœ‹å…·ä½“å®ç°ï¼š</p>
<pre><code class="objective-c">static NSDictionary *defineClass(NSString *classDeclaration, JSValue *instanceMethods, JSValue *classMethods)
{
    /* ä¸Šæ–‡æè¿‡ï¼Œçœç•¥ */

      // i == 0 æ·»åŠ å®ä¾‹æ–¹æ³•ï¼› i == 1 æ·»åŠ ç±»æ–¹æ³•
    for (int i = 0; i &lt; 2; i ++) {
        BOOL isInstance = i == 0;
        JSValue *jsMethods = isInstance ? instanceMethods: classMethods;

        Class currCls = isInstance ? cls: objc_getMetaClass(className.UTF8String);
        NSDictionary *methodDict = [jsMethods toDictionary];
        for (NSString *jsMethodName in methodDict.allKeys) {
            JSValue *jsMethodArr = [jsMethods valueForProperty:jsMethodName];
            int numberOfArg = [jsMethodArr[0] toInt32];
            NSString *selectorName = convertJPSelectorString(jsMethodName);
            if ([selectorName componentsSeparatedByString:@&quot;:&quot;].count - 1 &lt; numberOfArg) {
                selectorName = [selectorName stringByAppendingString:@&quot;:&quot;];
            }

            JSValue *jsMethod = jsMethodArr[1];
            if (class_respondsToSelector(currCls, NSSelectorFromString(selectorName))) {
                overrideMethod(currCls, selectorName, jsMethod, !isInstance, NULL);
            } else {
                /* å¼€å§‹æ–°å¢æ–¹æ³• */
                BOOL overrided = NO;

                // å…ˆæ·»åŠ protocolçš„æ–¹æ³•
                for (NSString *protocolName in protocols) {
                      // é€šè¿‡protocolè·å–æ–¹æ³•çš„typeEncoding
                    char *types = methodTypesInProtocol(protocolName, selectorName, isInstance, YES);
                    if (!types) types = methodTypesInProtocol(protocolName, selectorName, isInstance, NO);
                    if (types) {
                          // è¿˜æ˜¯ä½¿ç”¨ overrideMethod æ–¹æ³•æ¥åˆ›å»ºæ–°çš„æ–¹æ³•ã€‚èµ°çš„æ˜¯æ¶ˆæ¯è½¬å‘çš„é‚£ä¸€å¥—
                        overrideMethod(currCls, selectorName, jsMethod, !isInstance, types);
                        free(types);
                        overrided = YES;
                        break;
                    }
                }

                // ä¸æ˜¯protocolæ–¹æ³•ï¼Œæ–°å¢ç±»çš„æ–¹æ³•
                if (!overrided) {
                    if (![[jsMethodName substringToIndex:1] isEqualToString:@&quot;_&quot;]) {
                        NSMutableString *typeDescStr = [@&quot;@@:&quot; mutableCopy];
                        for (int i = 0; i &lt; numberOfArg; i ++) {
                            [typeDescStr appendString:@&quot;@&quot;];
                        }
                        overrideMethod(currCls, selectorName, jsMethod, !isInstance, [typeDescStr cStringUsingEncoding:NSUTF8StringEncoding]);
                    }
                }
            }
        }
    }

      /* çœç•¥æ— å…³ä»£ç  */

    return @{@&quot;cls&quot;: className, @&quot;superCls&quot;: superClassName};
}
</code></pre>
<p><strong>å¯ä»¥çœ‹åˆ°ï¼šæ–°å¢æ–¹æ³•å…¶å®å’Œæ›¿æ¢æ–¹æ³•æ˜¯ä¸€ä¸ªåŸç†ï¼Œèµ°çš„éƒ½æ˜¯æ¶ˆæ¯è½¬å‘é‚£ä¸€å¥—ï¼›ä½†æ˜¯æ–°å¢æ–¹æ³•æ²¡æœ‰å¿…è¦ä¿ç•™åŸæœ‰æ–¹æ³•çš„å®ç°ï¼Œå› ä¸ºæœ¬æ¥å°±ä¸å­˜åœ¨åŸæœ‰çš„æ–¹æ³•</strong></p>
<h3 id="OCè°ƒç”¨JSå®šä¹‰çš„æ–¹æ³•"><a href="#OCè°ƒç”¨JSå®šä¹‰çš„æ–¹æ³•" class="headerlink" title="OCè°ƒç”¨JSå®šä¹‰çš„æ–¹æ³•"></a>OCè°ƒç”¨JSå®šä¹‰çš„æ–¹æ³•</h3><p>ç°åœ¨JSå·²ç»å®šä¹‰å¥½äº†éœ€è¦çš„ç±»ï¼Œä»¥åŠéœ€è¦çš„æ–¹æ³•äº†ã€‚é‚£ä¹ˆä½•æ—¶æ¥è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œä»¥åŠå¦‚ä½•è°ƒç”¨å‘¢ï¼Ÿ</p>
<p>å›é¡¾ä¸€ä¸‹<code>JPViewController.m</code></p>
<pre><code class="objective-c">#import &quot;JPViewController.h&quot;

@implementation JPViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    UIButton *btn = [[UIButton alloc] initWithFrame:CGRectMake(0, 100, [UIScreen mainScreen].bounds.size.width, 50)];
    [btn setTitle:@&quot;Push JPTableViewController&quot; forState:UIControlStateNormal];
    [btn addTarget:self action:@selector(handleBtn:) forControlEvents:UIControlEventTouchUpInside];
    [btn setBackgroundColor:[UIColor grayColor]];
    [self.view addSubview:btn];
}

- (void)handleBtn:(id)sender
{
}

@end
</code></pre>
<p>è¿™ä¸ªæ–‡ä»¶å¾ˆç®€å•ï¼šåˆ›å»ºä¸€ä¸ªbuttonï¼Œç»™buttonæ·»åŠ ä¸€ä¸ªæ‰§è¡Œæ–¹æ³•<code>handleBtn:</code> ã€‚é‚£ä¹ˆå½“è¿è¡ŒAPPï¼Œå¹¶ç‚¹å‡»è¿™ä¸€buttonçš„æ—¶å€™ï¼›ä¼šå»è°ƒç”¨<code>handleBtn:</code>æ–¹æ³•ã€‚ä½†æ˜¯ç”±ä¸Šé¢çš„åˆ†æå¯çŸ¥ï¼š<code>handleBtn:</code>æ–¹æ³•å·²ç»æŒ‡å‘<code>_objc_msgForward</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šå¯¹è¿™ä¸€æ–¹æ³•ç›´æ¥è¿›è¡Œè½¬å‘ï¼Œè°ƒç”¨<code>forwardInvocation:</code>æ–¹æ³•ã€‚ä¸‹é¢æ¥çœ‹çœ‹è¿™ä¸ª<code>JPForwardInvocation</code>æ–¹æ³•ï¼š</p>
<pre><code class="objective-c">static void JPForwardInvocation(__unsafe_unretained id assignSlf, SEL selector, NSInvocation *invocation)
{
      // æ ¹æ®Invocationï¼Œæ¥è·å–æ–¹æ³•çš„å‚æ•°ä¿¡æ¯ç­‰ç­‰
    BOOL deallocFlag = NO;
    id slf = assignSlf;
    NSMethodSignature *methodSignature = [invocation methodSignature];
    NSInteger numberOfArguments = [methodSignature numberOfArguments];
    NSString *selectorName = NSStringFromSelector(invocation.selector);
    NSString *JPSelectorName = [NSString stringWithFormat:@&quot;_JP%@&quot;, selectorName];

      // ä»å…¨å±€JSæ–¹æ³•åˆ—è¡¨ä¸­è·å–å½“å‰çš„JSæ–¹æ³•
    JSValue *jsFunc = getJSFunctionInObjectHierachy(slf, JPSelectorName);

    // JS æ²¡æœ‰å®šä¹‰è¯¥æ–¹æ³• é‚£ä¹ˆå°±èµ°åŸå§‹çš„è½¬å‘æ–¹æ³•
    if (!jsFunc) {
        JPExecuteORIGForwardInvocation(slf, selector, invocation);
        return;
    }

    NSMutableArray *argList = [[NSMutableArray alloc] init];
    /* çœç•¥800å­— */

    // ä»Invocationä¸­æ ¹æ®methodçš„ type Encoding æ¥è·å–å‚æ•°åˆ—è¡¨ï¼Œå¹¶å°†å…¶æ·»ç½®argListæ•°ç»„ä¸­
    for (NSUInteger i = 2; i &lt; numberOfArguments; i++) {
        const char *argumentType = [methodSignature getArgumentTypeAtIndex:i];

        // æ ¹æ®type Encodingæ¥æ·»åŠ ç›¸åº”çš„å‚æ•°ã€‚rä»£è¡¨const
        switch(argumentType[0] == &#39;r&#39; ? argumentType[1] : argumentType[0]) {
            /* æ­¤å¤„çœç•¥ä¸åª800å­—ã€‚ã€‚ å…·ä½“å®ç°çœ‹æºç  */

          // for example
          case &#39;@&#39;:
              // è¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªOCå¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦å¾€argListä¸­æ·»åŠ å¯¹è±¡
              id arg;
              [invocation getArgument:&amp;arg atIndex:i];
              [argList addObject:arg];
              break;
          case &#39;:&#39;:
              // æ·»åŠ selectorå¯¹åº”çš„NSString
        }
    }

    /* æ­¤å¤„çœç•¥800å­— */

      // å‚æ•°åˆ—è¡¨ï¼Œå°†OCå¯¹è±¡è½¬åŒ–æˆJSå¯ä»¥ä½¿ç”¨çš„å¯¹è±¡
    NSArray *params = _formatOCToJSList(argList);

      // ä¿å­˜è¿”å›å€¼çš„ç±»å‹
    char returnType[255];
    strcpy(returnType, [methodSignature methodReturnType]);

      // æ ¹æ®è¿”å›ç±»å‹æ¥è°ƒç”¨JSå‡½æ•°
    switch (returnType[0] == &#39;r&#39; ? returnType[1] : returnType[0]) {
        /* æ­¤å¤„çœç•¥ä¸åª800å­—  è¿™ä¸€å—æ˜¯è¯¥å‡½æ•°çš„æ ¸å¿ƒä»£ç   ä¸‹é¢åªè¯´ä¸»è¦è¿‡ç¨‹ */

          // jsvalç”¨æ¥å­˜å‚¨JSè°ƒç”¨çš„è¿”å›å€¼
          JSValue *jsval;

           // JSè°ƒç”¨æ—¶å•çº¿ç¨‹ï¼Œéœ€è¦åŠ é”
        [_JSMethodForwardCallLock lock];

          // !!!  æ ¸å¿ƒä»£ç å‡ºç°å•¦  OCè°ƒç”¨JSå®šä¹‰çš„æ–¹æ³•  !!!  */
        jsval = [jsFunc callWithArguments:params];
        [_JSMethodForwardCallLock unlock];

          // æ£€æŸ¥JSæ–¹æ³•çš„è¿”å›å€¼ï¼Œçœ‹æ˜¯å¦éœ€è¦æ‰§è¡Œå›è°ƒå‡½æ•°
        while (![jsval isNull] &amp;&amp; ![jsval isUndefined] &amp;&amp; [jsval hasProperty:@&quot;__isPerformInOC&quot;]) {
            NSArray *args = nil;
            JSValue *cb = jsval[@&quot;cb&quot;];
            if ([jsval hasProperty:@&quot;sel&quot;]) {
                id callRet = callSelector(![jsval[@&quot;clsName&quot;] isUndefined] ? [jsval[@&quot;clsName&quot;] toString] : nil, [jsval[@&quot;sel&quot;] toString], jsval[@&quot;args&quot;], ![jsval[@&quot;obj&quot;] isUndefined] ? jsval[@&quot;obj&quot;] : nil, NO);
                args = @[[_context[@&quot;_formatOCToJS&quot;] callWithArguments:callRet ? @[callRet] : _formatOCToJSList(@[_nilObj])]];
            }
            [_JSMethodForwardCallLock lock];
              //  æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ä¹Ÿæ˜¯åœ¨JSä¸­å®šä¹‰çš„
            jsval = [cb callWithArguments:args];
            [_JSMethodForwardCallLock unlock];
        }

          // è®¾ç½®æ¶ˆæ¯è½¬å‘çš„è°ƒç”¨ç»“æœï¼Œä¹Ÿå°±æ˜¯è®¾ç½® invocation çš„ returnValue
          [invocation setReturnValue:&amp;jsval];
    }

    /* æ­¤å¤„çœç•¥800å­— å’Œå¯¹è±¡é‡Šæ”¾ç›¸å…³çš„ */
}
</code></pre>
<p>äº†è§£äº†è¿™ä¸ªæ¶ˆæ¯è½¬å‘çš„è¿‡ç¨‹ä¹‹åï¼Œå°±ä¼šçŸ¥é“OCè°ƒç”¨JSå®šä¹‰çš„æ–¹æ³•æ˜¯åœ¨<code>JSForwardInvocation</code>ä¸­ã€‚å®ƒå›å»æŸ¥æ‰¾å®šä¹‰åœ¨OCé‡Œé¢çš„å­˜å‚¨JSæ–¹æ³•çš„å…¨å±€å˜é‡ï¼Œæ‰¾åˆ°è¯¥JSæ–¹æ³•ï¼Œå¹¶æ‰§è¡Œã€‚</p>
<h3 id="JSè°ƒç”¨OCçš„æ–¹æ³•"><a href="#JSè°ƒç”¨OCçš„æ–¹æ³•" class="headerlink" title="JSè°ƒç”¨OCçš„æ–¹æ³•"></a>JSè°ƒç”¨OCçš„æ–¹æ³•</h3><p>å›é¡¾ä¸€ä¸‹<code>demo.js</code>çš„ä»£ç ï¼š</p>
<pre><code class="javascript">defineClass(&#39;JPViewController&#39;, {
  handleBtn: function(sender) {
    var tableViewCtrl = JPTableViewController.alloc().init()
    self.navigationController().pushViewController_animated(tableViewCtrl, YES)
  }
})
</code></pre>
<p>å½“OCè°ƒç”¨<code>handleBtn:</code>æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯è¿™ä¸ªJSå®šä¹‰çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸ªJSæ–¹æ³•é‡Œé¢ä¼šåˆ›å»ºä¸€ä¸ª<code>JPTableViewController</code>å¯¹è±¡ï¼Œå¹¶å°†è¯¥å¯¹è±¡æ˜¾ç¤ºå‡ºæ¥ã€‚æ¥çœ‹çœ‹JSå¦‚ä½•è°ƒç”¨OCçš„ä»£ç ï¼š</p>
<pre><code class="javascript">__c: function(methodName) {
  /* çœç•¥ä¸€ç³»åˆ—è¿·äººçš„JSæ“ä½œ */

  return function(){
    var args = Array.prototype.slice.call(arguments)
    // è·å–è°ƒç”¨æ–¹æ³•çš„ç±»åï¼Œè°ƒç”¨æ–¹æ³•çš„å¯¹è±¡ï¼Œè°ƒç”¨çš„æ–¹æ³•çš„å‚æ•°ï¼Œå¹¶ä¸”æ‰§è¡Œè¿™ä¸ª _methodFunc æ–¹æ³•
    return _methodFunc(slf.__obj, slf.__clsName, methodName, args, slf.__isSuper)
  }
},
</code></pre>
<p>åœ¨JSé‡Œé¢è°ƒç”¨OCæ–¹æ³•ï¼šå¦‚ <code>UIView.alloc().init()</code> éƒ½ä¼šè¢«è½¬åŒ–æˆè¿™ç§æ ¼å¼ <code>UIView.__c(&#39;alloc&#39;)().__c(&#39;init&#39;)()</code>ã€‚ä¹Ÿå°±æ˜¯è°ƒç”¨ä¸Šè¿°çš„<code>__c</code>æ–¹æ³•ã€‚</p>
<p>è€Œ<code>__c()</code>æ–¹æ³•ä¹Ÿå°±æ˜¯è·å–è°ƒç”¨è¯¥æ–¹æ³•çš„ç±»åï¼Œå¯¹è±¡ï¼›ä»¥åŠè¯¥æ–¹æ³•çš„å‚æ•°ã€‚å¹¶å°†è¿™äº›å…¨éƒ¨ä¼ ç»™<code>_methodFunc()</code>æ–¹æ³•ã€‚æ‰€ä»¥è¯´<code>__c()</code>æ–¹æ³•æœ‰ç‚¹åƒOCçš„<code>objc_megSend(id self, selector, ...)</code>ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªè½¬å‘å™¨ã€‚</p>
<p>çœŸæ­£è°ƒç”¨OCçš„JSæ–¹æ³•æ˜¯è¿™ä¸ª<code>_methodFunc</code>ï¼ˆå®šä¹‰åœ¨<code>JSPatch.js</code>ä¸­ï¼‰ï¼š</p>
<pre><code class="javascript">var _methodFunc = function(instance, clsName, methodName, args, isSuper, isPerformSelector) {
  // åšä¸€äº›å‡†å¤‡æ´»åŠ¨ï¼šå°†JSæ–¹æ³•åè½¬æˆç›¸åº”çš„OCæ–¹æ³•å(é©¼å³°å‘½å)
  var selectorName = methodName
  if (!isPerformSelector) {
    methodName = methodName.replace(/__/g, &quot;-&quot;)
    selectorName = methodName.replace(/_/g, &quot;:&quot;).replace(/-/g, &quot;_&quot;)
    var marchArr = selectorName.match(/:/g)
    var numOfArgs = marchArr ? marchArr.length : 0
    if (args.length &gt; numOfArgs) {
      selectorName += &quot;:&quot;
    }
  }

  // ä½¿ç”¨_OC_callI / _OC_callC æ¥è°ƒç”¨OCçš„æ–¹æ³•ã€‚ä¼ é€’ç»™è¿™ä¸¤æ–¹æ³•çš„å‚æ•°æ˜¯å¯¹è±¡ï¼Œå‚æ•°ï¼Œselectorç­‰ç­‰
  var ret = instance ? _OC_callI(instance, selectorName, args, isSuper):
  _OC_callC(clsName, selectorName, args)
  return _formatOCToJS(ret)
}
</code></pre>
<p>æˆ‘ä»¬ä»¥<code>_OC_callI</code>ä¸ºä¾‹ ï¼ˆå®šä¹‰åœ¨<code>JPEngine.m</code>ä¸­ï¼‰ï¼š</p>
<pre><code class="objective-c">context[@&quot;_OC_callI&quot;] = ^id(JSValue *obj, NSString *selectorName, JSValue *arguments, BOOL isSuper) {
    return callSelector(nil, selectorName, arguments, obj, isSuper);
};
</code></pre>
<p>åœ¨OCä¸­ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶objï¼ŒselectorNameï¼Œargumentsç­‰å‚æ•°ï¼›å®é™…è°ƒç”¨çš„<code>callSelector</code>æ–¹æ³•ï¼š</p>
<pre><code class="objective-c">static id callSelector(NSString *className, NSString *selectorName, JSValue *arguments, JSValue *instance, BOOL isSuper)
{
      /* çœç•¥800å­— åšä¸€äº›å‰æœŸå‡†å¤‡ï¼šè·å–ç±»ï¼Œselectorï¼Œæ ¼å¼åŒ–å‚æ•°åˆ—è¡¨ç­‰ç­‰ */

       /* å†çœç•¥800å­— è®¾ç½®Invocationçš„target è¿™ä¸ªè°ƒç”¨è¿˜æ˜¯ä»¥æ¶ˆæ¯è½¬å‘çš„å½¢å¼æ¥çš„ */
      [invocation setTarget:instance];

      // å’ŒOCè°ƒç”¨JSä¸€æ ·ï¼Œset Invocationçš„è°ƒç”¨å‚æ•°
      // æ³¨æ„ï¼šåœ¨OCè°ƒç”¨JSä¸­ï¼Œè¿™é‡Œæ˜¯ get Invocationçš„å‚æ•°
    for (NSUInteger i = 2; i &lt; numberOfArguments; i++) {
        const char *argumentType = [methodSignature getArgumentTypeAtIndex:i];
        id valObj = argumentsObj[i-2];
        switch (argumentType[0] == &#39;r&#39; ? argumentType[1] : argumentType[0]) {
              // ä»£ç çœç•¥äº†
             [invocation setArgument:&amp;value atIndex:i];       
        }
    }

      // æ‰§è¡ŒOCä»£ç ï¼Œä¹Ÿå°±æ˜¯è®¾ç½®å¥½è¿™ä¸€ä¸ªinvocationä¹‹åï¼Œinvokeå®ƒ
      [invocation invoke];

    char returnType[255];
    strcpy(returnType, [methodSignature methodReturnType]);

      // ä½¿ç”¨returnValueæ¥å­˜å‚¨Invocationè¿”å›å€¼
    id returnValue;
    [invocation getReturnValue:&amp;result];

    // æ ¹æ®è¿”å›å€¼ç±»å‹æ¥åˆ›å»ºreturnValueï¼Œå¹¶è¿”å›ã€‚ for example
      returnValue = (__bridge id)result;
      return returnValue;
}
</code></pre>
<p>è¿™æ ·å°±å®ç°äº†OCä»£ç çš„è°ƒç”¨ã€‚</p>
<h2 id="JSPatchæ ¸å¿ƒæ–¹æ³•"><a href="#JSPatchæ ¸å¿ƒæ–¹æ³•" class="headerlink" title="JSPatchæ ¸å¿ƒæ–¹æ³•"></a>JSPatchæ ¸å¿ƒæ–¹æ³•</h2><h3 id="JPEngine-m"><a href="#JPEngine-m" class="headerlink" title="JPEngine.m"></a>JPEngine.m</h3><ol>
<li>defineClass</li>
<li>overrideMethod</li>
<li>JPForwardInvocation</li>
<li>callSelector</li>
</ol>
<h3 id="JSPatch-js"><a href="#JSPatch-js" class="headerlink" title="JSPatch.js"></a>JSPatch.js</h3><ol>
<li>__c()</li>
<li>_methodFunc()</li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>JSPatchå……åˆ†åº”ç”¨äº† <strong>runtime</strong> å’Œ <strong>JavaScriptCore</strong> ä¸¤å¤§æŠ€æœ¯ï¼Œå®ç°äº†OCå’ŒJSçš„é€šä¿¡ã€‚</p>
<p>å¯¹äºOCè°ƒç”¨JSï¼Œå’ŒJSè°ƒç”¨OC éƒ½æ˜¯ä½¿ç”¨çš„æ¶ˆæ¯è½¬å‘çš„æœºåˆ¶ï¼›è¿™ä¸¤ç§è°ƒç”¨æ˜¯ä¸€ä¸ªç›¸åçš„è¿‡ç¨‹ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://github.com/bang590/JSPatch/wiki/JSPatch-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3" target="_blank" rel="external">JSPatch å®ç°åŸç†è¯¦è§£</a></li>
<li><a href="http://nshipster.cn/javascriptcore/" target="_blank" rel="external">JavaScriptCore</a></li>
<li><a href="http://vanney9.com/2017/06/08/objective-c-runtime-message/" target="_blank" rel="external">Objective-C runtime - æ¶ˆæ¯</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[å…³äºARCï¼ŒBlockä»¥åŠGCDï¼Œrunloop]]></title>
      <url>/2017/06/27/iOS-ARC-Block-GCD-Runloop/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åˆçœ‹äº†ä¸€é <strong>Objective-Cé«˜çº§ç¼–ç¨‹ iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†</strong> è¿™æœ¬ä¹¦ã€‚å¯¹ä¸€äº›é—®é¢˜æœ‰äº†ä¸€äº›æ–°çš„è®¤è¯†ã€‚è¿™ç¯‡æ–‡ç« å°†è®²è®²ä¸‹é¢å‡ ä¸ªè¯é¢˜ï¼š</p>
<ol>
<li><strong>ARCï¼ŒMRC ä¸ å¼•ç”¨è®¡æ•°</strong></li>
<li><strong>Blockçš„å®ç°</strong></li>
<li><strong>GCDä¸runloop</strong></li>
</ol>
<a id="more"></a>
<h2 id="ARC-MRC-ä¸-å¼•ç”¨è®¡æ•°"><a href="#ARC-MRC-ä¸-å¼•ç”¨è®¡æ•°" class="headerlink" title="ARC, MRC ä¸ å¼•ç”¨è®¡æ•°"></a>ARC, MRC ä¸ å¼•ç”¨è®¡æ•°</h2><h3 id="å¼•ç”¨è®¡æ•°"><a href="#å¼•ç”¨è®¡æ•°" class="headerlink" title="å¼•ç”¨è®¡æ•°"></a>å¼•ç”¨è®¡æ•°</h3><p>Objective Cçš„ç”Ÿæˆçš„æ•°æ®ä¼šå­˜æ”¾åœ¨æ ˆæˆ–è€…å †ä¸Šé¢ã€‚å¯¹äºå­˜æ”¾åœ¨æ ˆä¸Šé¢çš„æ•°æ®ï¼ˆæ¯”å¦‚å±€éƒ¨intå˜é‡ç­‰ï¼‰åœ¨ä¸éœ€è¦æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜ç©ºé—´ï¼›å¯¹äºå­˜æ”¾åœ¨å †ä¸Šé¢çš„æ•°æ®ï¼ˆæ¯”å¦‚å¯¹è±¡ç­‰ï¼‰ä¼šä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥å†³å®šæ˜¯å¦é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¼šmallocä¸€å—å¯¹è±¡æ‰€éœ€å¤§å°çš„å†…å­˜ç©ºé—´ï¼›å½“æœ‰ä¸€å˜é‡æŒæœ‰è¯¥å¯¹è±¡æ—¶ï¼ˆä¸€èˆ¬æ˜¯æœ‰ä¸€æŒ‡é’ˆæŒ‡å‘è¯¥å†…å­˜æ—¶ï¼‰è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°åŠ ä¸€ï¼›å½“æŒæœ‰è¯¥å¯¹è±¡çš„å˜é‡ä¸å†æŒæœ‰å®ƒæ—¶ï¼ˆä¸€èˆ¬æ˜¯æŒ‡é’ˆè¢«é”€æ¯ï¼Œæˆ–æŒ‡å‘å…¶ä»–åœ°æ–¹ï¼‰è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å‡ä¸€ã€‚<strong>å½“å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œfreeè¿™ä¸€å—å†…å­˜</strong></p>
<p><strong>MRCå’ŒARCå®è´¨ä¸Šéƒ½æ˜¯å¯¹è¿™ä¸ªå¼•ç”¨è®¡æ•°è¿›è¡Œæ“ä½œ</strong></p>
<h3 id="æ‰‹åŠ¨å¼•ç”¨è®¡æ•°-MRC"><a href="#æ‰‹åŠ¨å¼•ç”¨è®¡æ•°-MRC" class="headerlink" title="æ‰‹åŠ¨å¼•ç”¨è®¡æ•° MRC"></a>æ‰‹åŠ¨å¼•ç”¨è®¡æ•° MRC</h3><p>æ‰‹åŠ¨å¼•ç”¨è®¡æ•°è¦ç¡®ä¿<strong>åœ¨å¯¹è±¡ä»è¢«åˆ›å»ºåˆ°é”€æ¯çš„ä¸€ç”Ÿä¸­ï¼Œè¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¹Ÿä»1å˜æˆ0</strong>ã€‚</p>
<p>ä¸å¯¹è±¡å¼•ç”¨è®¡æ•°ç›¸å…³çš„å‡½æ•°åªæœ‰3ä¸ªï¼š</p>
<ol>
<li>alloc/new/copy/mutableCopy</li>
<li>retain</li>
<li>release</li>
</ol>
<h4 id="alloc-new-copy-mutableCopy"><a href="#alloc-new-copy-mutableCopy" class="headerlink" title="alloc/new/copy/mutableCopy"></a>alloc/new/copy/mutableCopy</h4><p>è¿™å‡ ä¸ªå‡½æ•°ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º1</p>
<h4 id="retain"><a href="#retain" class="headerlink" title="retain"></a>retain</h4><p><code>retain</code>å‡½æ•°å°†å¯¹è±¡çš„å¼•ç”¨è®¡æ•°åŠ 1</p>
<h4 id="release"><a href="#release" class="headerlink" title="release"></a>release</h4><p><code>release</code>å‡½æ•°å°†å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å‡ä¸€</p>
<h4 id="examples"><a href="#examples" class="headerlink" title="examples"></a>examples</h4><h5 id="autoreleaseå‡½æ•°"><a href="#autoreleaseå‡½æ•°" class="headerlink" title="autoreleaseå‡½æ•°"></a>autoreleaseå‡½æ•°</h5><pre><code class="objective-c">NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init]  // 1
id obj = [[NSObject alloc] init];                           // 2
[obj autorelease];                                          // 3
[id dosomething];                                           // 4
[pool drain];                                               // 5
</code></pre>
<ol>
<li>æ³¨é‡Š2å¤„ï¼Œä½¿ç”¨<code>alloc</code>æ–¹æ³•æ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º1</li>
<li>æ³¨é‡Š3å¤„ï¼Œè°ƒç”¨äº†<code>autorelease</code>å‡½æ•°ï¼›è¯¥å‡½æ•°å¹¶æ²¡æœ‰æ›´æ”¹å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œä½†æ˜¯å®ƒå°†å¯¹è±¡æ³¨å†Œåˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­</li>
<li>æ³¨é‡Š4å¤„ï¼Œå› ä¸ºæ³¨é‡Š3æ²¡æœ‰å‡å°‘å¼•ç”¨è®¡æ•°ï¼Œæ‰€ä»¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°è¿˜æ˜¯1ã€‚æ‰€ä»¥è¿™ä¸ªåœ°æ–¹å¯¹è±¡ä¾ç„¶å­˜åœ¨ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨å¯¹è±¡</li>
<li>æ³¨é‡Š5å¤„ï¼Œå› ä¸ºåœ¨æ³¨é‡Š3æ—¶å°†å¯¹è±¡æ³¨å†Œè¿›poolã€‚æ­¤æ—¶<code>[pool drain]</code>æ–¹æ³•ä¼šå»è°ƒç”¨å¯¹è±¡çš„<code>release</code>æ–¹æ³•ï¼Œå°†å¯¹è±¡å¼•ç”¨è®¡æ•°å‡1ï¼›æ­¤æ—¶å¼•ç”¨è®¡æ•°ä¸º0ï¼Œé‚£ä¹ˆé‡Šæ”¾å†…å­˜ç©ºé—´</li>
</ol>
<p>æ‰€ä»¥ä»ä¸Šé¢çœ‹å‡ºï¼š<strong><code>autorelease</code>å‡½æ•°å¹¶æ²¡æœ‰æ”¹å˜å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œåªæ˜¯ç®€å•çš„å°†å¯¹è±¡ä¸é‡Šæ”¾æ± æŒ‚é’©ï¼›å½“<code>pool drain</code>æ—¶æ‰è°ƒç”¨å¯¹è±¡çš„<code>release</code>å‡½æ•°</strong>ã€‚</p>
<p>æ‰€ä»¥ <strong><code>autorelease</code>å‡½æ•°å®è´¨å°±æ˜¯å»¶è¿Ÿå¯¹è±¡çš„<code>release</code>æ–¹æ³•ï¼›å¯ä»¥è®©ä½ æ”¾å¿ƒä½¿ç”¨å¯¹è±¡ï¼Œä½†åˆé˜²æ­¢äº†ä½ å¿˜è®°é‡Šæ”¾å¯¹è±¡</strong></p>
<h5 id="arrayç±»å¯¹è±¡"><a href="#arrayç±»å¯¹è±¡" class="headerlink" title="arrayç±»å¯¹è±¡"></a>arrayç±»å¯¹è±¡</h5><pre><code class="objective-c">id obj = [NSMutableArray array];
</code></pre>
<p>è¿™é‡Œä¸éœ€è¦è°ƒç”¨å¯¹è±¡çš„<code>release</code>æ–¹æ³•ã€‚å› ä¸ºåœ¨å†…éƒ¨çš„å®ç°æ˜¯ï¼š</p>
<pre><code class="objective-c">+ (id)array {
      id obj = [[NSMutableArray alloc] init];
      [obj autorelease];
      return obj;
}
</code></pre>
<p><code>array</code>ç±»æ–¹æ³•è¿”å›çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º1ï¼›ä½†æ˜¯å·²ç»æ³¨å†Œåˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­äº†ï¼Œä¼šåœ¨é‡Šæ”¾æ± ç»“æŸæ—¶è°ƒç”¨<code>release</code>æ–¹æ³•</p>
<h4 id="MRCæ€»ç»“"><a href="#MRCæ€»ç»“" class="headerlink" title="MRCæ€»ç»“"></a>MRCæ€»ç»“</h4><p>å¯¹è±¡ä¸€å®šæˆå¯¹çš„å­˜åœ¨ <code>alloc</code> å’Œ  <code>release</code>æ–¹æ³•ï¼›æˆ–è€…æˆå¯¹çš„å­˜åœ¨<code>retain</code> å’Œ  <code>release</code> æ–¹æ³•ã€‚åªæœ‰è¿™æ ·æ‰èƒ½å¯¹å¼•ç”¨è®¡æ•°æœ‰å¢æœ‰å‡ï¼Œæ‰èƒ½ä¿è¯å¯¹è±¡èƒ½æ­£ç¡®çš„é‡Šæ”¾ã€‚</p>
<p>å¦‚æœæ²¡æœ‰æˆå¯¹çš„å‡ºç°ï¼Œä½†æ˜¯ç¨‹åºåˆæ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆè¿™3ä¸ªæ–¹æ³•çš„è°ƒç”¨è‚¯å®šåœ¨æŸå‡½æ•°çš„å†…éƒ¨ã€‚æ¯”å¦‚<code>[pool drain]</code> æˆ–è€… <code>[NSMutableArray array]</code> ç­‰å‡½æ•°ä¸­ã€‚</p>
<h3 id="è‡ªåŠ¨å¼•ç”¨è®¡æ•°-ARC"><a href="#è‡ªåŠ¨å¼•ç”¨è®¡æ•°-ARC" class="headerlink" title="è‡ªåŠ¨å¼•ç”¨è®¡æ•° ARC"></a>è‡ªåŠ¨å¼•ç”¨è®¡æ•° ARC</h3><p>ARCä¸å†éœ€è¦ä½ æ¥æ‰‹åŠ¨è°ƒç”¨<code>retain</code> å’Œ <code>release</code> å‡½æ•°äº†ï¼Œç³»ç»Ÿä¼šè‡ªå·±è°ƒç”¨è¿™äº›å‡½æ•°ã€‚é‚£ä¹ˆARCéœ€è¦æ³¨æ„çš„æ˜¯ä»€ä¹ˆå‘¢ï¼š</p>
<ol>
<li><strong>__strong</strong></li>
<li><strong>__weak</strong></li>
<li><strong>__autorelease</strong></li>
</ol>
<p>ä½¿ç”¨ä»¥ä¸Šä¸‰ä¸ªä¿®é¥°ç¬¦å¯¹å¯¹è±¡è¿›è¡Œä¿®é¥°ï¼Œé‚£ä¹ˆå°±ä¼šè‡ªåŠ¨å¢å‡å¼•ç”¨è®¡æ•°</p>
<h4 id="strong"><a href="#strong" class="headerlink" title="__strong"></a>__strong</h4><p><strong>ä¼šè‡ªåŠ¨release</strong></p>
<pre><code class="objective-c">{
      id obj = [[NSObject alloc] init];
}

// è½¬åŒ–ä¹‹å

id obj = objc_msgSend(NSObject, @selector(alloc));
objc_msgSend(obj, @selector(init));
objc_release(obj);

/*--------------------------åˆ†å‰²ç¬¦------------------*/
{
      id __strong obj = obj2;
    // do something
}

// è½¬åŒ–ä¹‹å

id obj = obj2;
[obj retain];
// do something
[obj release];
</code></pre>
<p>å¯ä»¥çœ‹åˆ°<code>__strong</code>ä¼šæŒæœ‰å¯¹è±¡ï¼Œå¹¶è‡ªåŠ¨è°ƒç”¨releaseå°†å¼•ç”¨è®¡æ•°å‡ä¸€</p>
<p><strong>ä¼šé˜»æ­¢å¯¹è±¡æ³¨å†Œåˆ°release poolä¸­ï¼Œå¹¶æŒæœ‰å¯¹è±¡</strong></p>
<pre><code class="objective-c">{
   id __strong obj = [NSMutableArray array];
}

// è½¬åŒ–ä¹‹å

id obj = objc_msgSend(NSMutableArray, @selector(alloc));
objc_msgSend(obj, @selector(init));
return objc_autoreleaseReturnValue(obj);  

objc_retainAutoreleasedReturnValue(obj);
objc_release(obj);
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ__strongä¼šå°†å³å°†æ³¨å†Œåˆ°poolçš„å¯¹è±¡æŠ¢è¿‡æ¥ï¼Œè‡ªå·±æŒæœ‰ï¼Œå¹¶é‡Šæ”¾ã€‚</p>
<h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p><code>__strong</code>ä¿®é¥°ç¬¦ä¼šæŒæœ‰å¯¹è±¡ï¼Œå¹¶è‡ªåŠ¨é‡Šæ”¾ã€‚æœ‰æ—¶ä¼šæŠ¢è¿‡poolçš„å¯¹è±¡ï¼Œæ¥è‡ªå·±é‡Šæ”¾</p>
<h4 id="autorelease"><a href="#autorelease" class="headerlink" title="__autorelease"></a>__autorelease</h4><p>ä¸å¸¸ç”¨ï¼ŒåŸºæœ¬åŸç†ï¼š</p>
<ol>
<li>å¯¹äºå·²ç»/æˆ–å³å°†æ³¨å†Œåˆ°poolçš„å¯¹è±¡ï¼Œæ²¡æœ‰å˜åŒ–ã€‚ä¼šç”±poolæ¥é‡Šæ”¾è¯¥å¯¹è±¡</li>
<li>å¯¹äºå…¶ä»–å¯¹è±¡ï¼Œä¼šå°†å¯¹è±¡retainï¼Œå¹¶å¼ºåˆ¶æ³¨å†Œåˆ°poolï¼Œç”±poolæ¥release</li>
</ol>
<h4 id="weak"><a href="#weak" class="headerlink" title="__weak"></a>__weak</h4><p>weakå˜é‡ä¸å¯¹å¼•ç”¨è®¡æ•°äº§ç”Ÿå½±å“ã€‚æ¥çœ‹ä¸€ä¸‹ä»£ç ï¼š</p>
<pre><code class="objective-c">id __weak obj1 = obj;
id __weak obj2 = obj;
</code></pre>
<p>APPç®¡ç†ä¸€ä¸ªå…¨å±€çš„weakè¡¨ï¼Œä¸Šé¢è¿™ä¸¤è¡Œä»£ç ï¼Œä¼šå¾€è¯¥è¡¨ä¸­æ’å…¥2è¡Œè®°å½•ï¼š</p>
<p>æ¯è¡Œè®°å½•çš„keyæ˜¯å¯¹è±¡çš„é¦–åœ°å€ï¼Œä¹Ÿå°±æ˜¯ <code>obj</code> ï¼›valueæ˜¯å­˜æ”¾weakå˜é‡çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯<code>&amp;obj1</code> å’Œ <code>&amp;obj2</code> ã€‚</p>
<ol>
<li>å½“weakå˜é‡obj1è¢«åºŸå¼ƒæ—¶ï¼Œå°†weakè¡¨ä¸­çš„valueä¸º<code>&amp;obj1</code>çš„è®°å½•åˆ é™¤</li>
<li>å½“å¯¹è±¡è¢«åºŸå¼ƒæ—¶ï¼Œè¿™æ—¶å€™obj1,obj2åº”è¯¥æŒ‡å‘nilã€‚è¿™æ—¶å°±å°†weakè¡¨ä¸­ï¼Œkeyä¸º<code>obj</code>çš„è®°å½•çš„keyç½®æˆnil</li>
</ol>
<p><strong>æ‰€ä»¥å¯»æ‰¾weakå˜é‡å¯¹åº”çš„å¯¹è±¡åœ°å€æ—¶ï¼Œå…¶å®å°±æ˜¯å¯»æ‰¾weakè¡¨ä¸­çš„keyå€¼</strong></p>
<h5 id="ä½¿ç”¨-weakå˜é‡æ—¶"><a href="#ä½¿ç”¨-weakå˜é‡æ—¶" class="headerlink" title="ä½¿ç”¨__weakå˜é‡æ—¶"></a>ä½¿ç”¨__weakå˜é‡æ—¶</h5><pre><code class="objective-c">{
      id __weak o = obj;
      NSLog(@&quot;%@&quot;, o);
}

// è½¬åŒ–ä¹‹å

id o;
objc_initWeak(&amp;o, obj);
id tmp = objc_loadWeakRetained(&amp;o);
objc_autorelease(tmp);
NSLog(@&quot;%@&quot;, tmp);
objc_destoryWeak(&amp;o);
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨weakå˜é‡æ—¶ï¼Œå…¶å®æ˜¯å°†è¯¥weakå˜é‡æŒ‡å‘çš„å¯¹è±¡äº¤ç”±ä¸€ä¸ªtmpå˜é‡æŒæœ‰ï¼Œå¹¶å°†è¯¥å¯¹è±¡æ³¨å†Œåˆ°poolä¸­ã€‚è¿™æ ·å¯ä»¥ä¿è¯å¯¹è±¡ä¸‡ä¸€è¢«é‡Šæ”¾äº†ï¼Œä¹Ÿè‡³å°‘è¿˜æœ‰tmpæŒæœ‰ä»–ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚</p>
<h2 id="Blockçš„å®ç°"><a href="#Blockçš„å®ç°" class="headerlink" title="Blockçš„å®ç°"></a>Blockçš„å®ç°</h2><p><strong>ä½¿ç”¨clangçš„<code>-rewrite-objc</code>é€‰é¡¹ï¼Œå¯ä»¥å°†OCä»£ç è½¬æ¢æˆC++ä»£ç ã€‚è¿™æ ·å°±å¯ä»¥çœ‹åˆ°Blockçš„C++çš„å®ç°</strong></p>
<h3 id="ä¸æˆªè·ä»»ä½•å˜é‡çš„Block"><a href="#ä¸æˆªè·ä»»ä½•å˜é‡çš„Block" class="headerlink" title="ä¸æˆªè·ä»»ä½•å˜é‡çš„Block"></a>ä¸æˆªè·ä»»ä½•å˜é‡çš„Block</h3><pre><code class="objective-c">int main() {
  void (^blk)(void) = ^{printf(&quot;Block\n&quot;);};
  blk();
  return 0;
}
</code></pre>
<p>ç»è¿‡ <code>clang -rewrite-objc main.m</code> è½¬åŒ–ä¹‹åï¼Œç”Ÿæˆ<code>main.cpp</code> ã€‚æ¥çœ‹çœ‹Blockåœ¨C++ä¸­å¦‚ä½•è¡¨ç°ï¼š</p>
<pre><code class="c">// åªæˆªå–å…³é”®ä»£ç 
struct __main_block_impl_0 {
  void *isa;
  int Flags;
  int Reserved;
  void *FuncPtr;
  struct __main_block_desc_0 *Desc;

  __main_block_impl_0(void *fp) {
    isa = &amp;_NSConcreteStackBlock;
    FuncPtr = fp;
  }
};

static void __main_block_func_0(struct __main_block_impl_0 *__cself) {
  printf(&quot;Block\n&quot;);
};

int main() {
  struct __main_block_impl_0 tmp = __main_block_impl_0(__main_block_func_0);
  struct __main_block_impl_0 *blk = &amp;tmp;
  (*blk-&gt;FuncPtr)(blk);
  return 0;
}
</code></pre>
<p><strong>å¯ä»¥å‘ç°Blockå®é™…ä¸Šæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œblkå˜é‡æ˜¯æŒ‡å‘<code>__main_block_impl_0</code>ç»“æ„ä½“çš„æŒ‡é’ˆã€‚è¯¥ç»“æ„ä½“ä¸­æœ‰ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ <code>FuncPtr</code>ï¼Œæ‰§è¡ŒBlockæ—¶ï¼Œå…¶å®å°±æ˜¯æ‰§è¡Œè¯¥ç»“æ„ä½“ä¸­å‡½æ•°æŒ‡é’ˆå¯¹åº”çš„å‡½æ•°ã€‚</strong></p>
<h3 id="æˆªè·å˜é‡ä½†ä¸ä¿®æ”¹çš„Block"><a href="#æˆªè·å˜é‡ä½†ä¸ä¿®æ”¹çš„Block" class="headerlink" title="æˆªè·å˜é‡ä½†ä¸ä¿®æ”¹çš„Block"></a>æˆªè·å˜é‡ä½†ä¸ä¿®æ”¹çš„Block</h3><pre><code class="objective-c">int main() {
  int val = 10;
  void (^blk)(void) = ^{printf(&quot;%d&quot;, val);};
  blk();
  return 0;
}
</code></pre>
<p>ç›¸åŒçš„æ–¹æ³•ï¼Œæ¥çœ‹ä¸€ä¸‹è½¬åŒ–ä¹‹åçš„ç»“æœï¼š</p>
<pre><code class="c">struct __main_block_impl_0 {
  void *fp;
  int Flags;
  int Reserved;
  void *FuncPtr;
  struct __main_block_desc_0 *Desc;

  int val;

  __main_block_impl_0(void *fp, int _val) : val(_val) {
    isa = &amp;_NSConcreteStackBlock;
    FuncPtr = fp;
  }
};

static void __main_block_func_0(struct __main_block_impl_0 *__cself) {
  int val = __cself-&gt;val;
  printf(&quot;%d&quot;, val);
}

int main() {
  int val = 10;
  struct __main_block_impl_0 = __main_block_impl_0(__main_block_func_0, val);
  struct __main_block_impl_0 *blk = &amp;tmp;
  (*blk-&gt;FuncPtr)(blk);

  return 0;
}
</code></pre>
<p><strong>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºæˆªè·ä½†æ˜¯æœªæ›¾æ”¹å˜çš„å˜é‡<code>val</code>ï¼ŒBlockç»“æ„ä½“ä¼šå°†è¯¥å˜é‡æ‹·è´åˆ°ç»“æ„ä½“ä¸­çš„åŒåæˆå‘˜å˜é‡ä¸­ã€‚æ‰€ä»¥å½“mainå‡½æ•°é‡Œé¢å®šä¹‰çš„valä¹‹åæ— è®ºå¦‚ä½•æ”¹å˜ï¼Œéƒ½ä¸ä¼šå½±å“åˆ°Blockä¸­å­˜å‚¨çš„valå˜é‡ï¼›å› ä¸ºä»–ä»¬ä¸¤ä¸ªæ˜¯ä¸åŒçš„ä¸¤ä¸ªå˜é‡ã€‚</strong></p>
<h3 id="æˆªè·-blockå˜é‡"><a href="#æˆªè·-blockå˜é‡" class="headerlink" title="æˆªè·__blockå˜é‡"></a>æˆªè·__blockå˜é‡</h3><p>å½“è¦åœ¨Blocké‡Œé¢æ”¹å˜æˆªè·çš„å˜é‡æ—¶ï¼Œéœ€è¦ä½¿ç”¨<strong>__block</strong>ä¿®é¥°ç¬¦ã€‚</p>
<h4 id="å…¨å±€å˜é‡"><a href="#å…¨å±€å˜é‡" class="headerlink" title="å…¨å±€å˜é‡"></a>å…¨å±€å˜é‡</h4><pre><code class="c">int global_val = 2;
int main() {
  // do something
}
</code></pre>
<p>å¯¹äºå…¨å±€å˜é‡ï¼ŒBlockå¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦åšä»»ä½•çš„æ”¹å˜</p>
<h4 id="é™æ€å±€éƒ¨å˜é‡"><a href="#é™æ€å±€éƒ¨å˜é‡" class="headerlink" title="é™æ€å±€éƒ¨å˜é‡"></a>é™æ€å±€éƒ¨å˜é‡</h4><pre><code class="objective-c">int main() {
  static int static_val = 3;
  void (^blk)(void) = ^{
    static_val += 1;
  }

  return 0;
}
</code></pre>
<p>æ¥çœ‹è½¬åŒ–ä¹‹åï¼š</p>
<pre><code class="c">struct __main_block_impl_0 {
  // ä¸€äº›å…¶ä»–æˆå‘˜
  int *static_val;

  __main_block_impl_0(void *fp, int *_static_val) : static_val(_static_val) {
    isa = &amp;_NSConcreteStackBlock;
    FuncPrt = fp;
  }
};

static void __main_block_func_0(struct __main_block_impl_0 *__cself) {
  int *static_val = __cself-&gt;static_val;
  *static_val += 1;
}

int main() {
  static int static_val = 3;
  blk = &amp;__main_block_impl_0(__main_block_func_0, &amp;static_val);

  return 0;
}
</code></pre>
<p><strong>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºé™æ€å±€éƒ¨å˜é‡ï¼ŒBlockçš„ç»“æ„ä½“ä¸­å­˜æ”¾çš„æ˜¯æŒ‡å‘è¯¥å˜é‡çš„æŒ‡é’ˆï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æŒ‡é’ˆæ¥æ”¹å˜è¯¥é™æ€å±€éƒ¨å˜é‡ã€‚è¿™æ˜¯å› ä¸ºï¼Œé™æ€å±€éƒ¨å˜é‡å³ä½¿å…¶ä½œç”¨åŸŸå·²ç»ç»“æŸï¼Œä½†æ˜¯å®ƒå¹¶ä¸ä¼šè¢«é”€æ¯ï¼Œå…¶å†…å­˜ç©ºé—´æ˜¯ä¸€ç›´å­˜åœ¨çš„</strong></p>
<h4 id="å±€éƒ¨å˜é‡"><a href="#å±€éƒ¨å˜é‡" class="headerlink" title="å±€éƒ¨å˜é‡"></a>å±€éƒ¨å˜é‡</h4><pre><code class="objective-c">int main() {
  __block int val = 10;
  void (^blk)(void) = ^{val = 1;};
  return 0;
}
</code></pre>
<p><strong>åœ¨Blockä¸­æ”¹å˜å±€éƒ¨è‡ªåŠ¨å˜é‡éœ€è¦ä½¿ç”¨<code>__block</code>ä¿®é¥°ç¬¦</strong>ï¼›è½¬åŒ–æˆC++ä»£ç ï¼š</p>
<pre><code class="c">struct __Block_byref_val_0 {
  void *__isa;
  __Block_byref_val_0 *__forwarding;
  int __flags;
  int __size;
  int val;
};

struct __main_block_impl_0 {
  // å…¶ä»–æˆå‘˜å˜é‡

  __Block_byref_val_0 *val;

  __main_block_impl_0(void *fp, __Block_byref_val_0 *_val) : val(_val-&gt;__forwarding) {
    //
  }
};

static void __main_block_func_0(struct __main_block_impl_0 *__cself) {
  __Block_byref_val_0 *val = __cself-&gt;val;
  (val-&gt;forwarding-&gt;val) = 1;
}

int main() {
  __Block_byref_val_0 val = {
    0,
    &amp;val,
    0,
    sizeof(__Block_byref_val_0),
    10
  };

  blk = &amp;__main_block_impl_0(__main_block_func_0, &amp;val);
  return 0;
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°_<em>blockå˜é‡valå…¶å®æ˜¯ä¸€ä¸ªç»“æ„ä½“ \</em>_Block_byref_val_0ã€‚åœ¨é‡Œé¢æœ‰valè¿™ä¸ªå˜é‡ã€‚</p>
<p>å› ä¸ºæ­£å¸¸ç”Ÿæˆçš„Blockéƒ½æ˜¯åœ¨æ ˆä¸Šé¢çš„ï¼Œä½†æ˜¯åœ¨åˆé€‚çš„æƒ…å†µä¸‹é¢ï¼Œæ ˆä¸Šçš„Blockä¼šè¢«æ‹·è´åˆ°å †ä¸Šï¼›ä¸æ­¤åŒæ—¶ï¼ŒBlockæ‰€æ‹¥æœ‰çš„__blockç»“æ„ä½“ä¹Ÿä¼šè¢«æ‹·è´åˆ°å †ä¸Šï¼Œç›¸å½“äºBlockæŒæœ‰__blockå˜é‡ã€‚</p>
<p>å½“blockå˜é‡è¿˜åœ¨æ ˆä¸Šæ—¶ï¼Œå®ƒçš„forwardingæŒ‡å‘è‡ªå·±ï¼›å½“è¢«æ‹·è´åˆ°å †ä¸Šæ—¶ï¼ŒforwardingæŒ‡å‘å †ä¸Šçš„blockå˜é‡ã€‚åœ¨ä½¿ç”¨æ—¶å…¨éƒ¨ä½¿ç”¨forwardingï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ”¹å˜çš„æ˜¯åŒä¸€ä¸ªå˜é‡ã€‚</p>
<p><strong>ä½¿ç”¨è¿™ä¹ˆä¸€ä¸ªç»“æ„ä½“æ¥å­˜æ”¾å±€éƒ¨å˜é‡ï¼Œå¯ä»¥ä¿è¯å±€éƒ¨å˜é‡å¯ä»¥æ—¶æ—¶åˆ»åˆ»è¢«æ›´æ”¹ï¼Œä¹Ÿå¯ä»¥ä¿è¯æ ˆä¸Šå±€éƒ¨å˜é‡è¢«é‡Šæ”¾åï¼Œå †ä¸Šçš„å±€éƒ¨å˜é‡ä¾ç„¶å¯ä»¥è®¿é—®</strong></p>
<h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><p>åœ¨å †ä¸Šçš„Blockæˆ–è€…blockå˜é‡æ‰è°ˆè®ºå¯¹è±¡çš„retainä»¥åŠreleaseï¼›åœ¨æ ˆä¸Šçš„Blockå’Œblockä¼šè¢«æ ˆè‡ªåŠ¨é‡Šæ”¾ï¼Œä¹Ÿä¸å­˜åœ¨å¯¹è±¡çš„retainå’Œrelease</p>
<p>Blockä¼šåœ¨ä¸€ä¸‹æƒ…å†µä¸‹è¢«å¤åˆ¶åˆ°å †ä¸Šé¢ï¼š</p>
<ol>
<li>æ˜¾å¼è°ƒç”¨Blockçš„<code>copy</code>æ–¹æ³•</li>
<li>Blockä½œä¸ºå‡½æ•°è¿”å›å€¼è¿”å›</li>
<li>å°†Blockèµ‹ç»™<code>__strong</code>çš„idç±»å‹æˆ–è€…Blockçš„ç±»çš„æˆå‘˜å˜é‡æ—¶ ï¼ˆè¿™æ—¶å€™è¦æ³¨æ„selfå’ŒBlockçš„å¾ªç¯å¼•ç”¨ï¼‰</li>
<li>æ–¹æ³•åä¸­å«æœ‰usingBlockçš„Cocoaæ¡†æ¶æ–¹æ³•ï¼Œæˆ–è€…GCDä¸­ä½¿ç”¨çš„Block</li>
</ol>
<h2 id="GCD-ä¸-runloop"><a href="#GCD-ä¸-runloop" class="headerlink" title="GCD ä¸ runloop"></a>GCD ä¸ runloop</h2><ol>
<li>GCDæ“ä½œçš„æ˜¯<code>queue</code>ï¼Œç„¶åç”±queueæ¥ç¡®å®šblockè¯¥ç”±å“ªä¸ªçº¿ç¨‹æ¥æ‰§è¡Œã€‚</li>
<li>runloopå¯¹åº”çš„åˆ™ç›´æ¥æ˜¯çº¿ç¨‹ã€‚ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æœ‰0-1ä¸ªrunloopåœ¨ä¸Šé¢æ‰§è¡Œã€‚</li>
</ol>
<h3 id="runloop"><a href="#runloop" class="headerlink" title="runloop"></a>runloop</h3><p>runloopå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹å®šçº¿ç¨‹ä¸Šé¢çš„do-whileå¾ªç¯ã€‚åœ¨do-whileå¾ªç¯é‡Œé¢ï¼Œå¯ä»¥å¤„ç†å¤šç§äº‹ä»¶ï¼š</p>
<ol>
<li>port-based eventï¼Œå¤šåŠæ˜¯ç³»ç»Ÿäº‹ä»¶</li>
<li>å…¶ä»–çº¿ç¨‹ä¼ é€’ç»™å½“å‰çº¿ç¨‹æ¥ç›´çº¿çš„block</li>
<li>Timerï¼Œå®šæ—¶äº‹ä»¶</li>
<li>Observerï¼Œå½“runloopçŠ¶æ€å˜åŒ–æ—¶ï¼Œæ‰§è¡Œç›¸åº”çš„ç›‘å¬å™¨</li>
</ol>
<p>æœ‰äº‹ä»¶æ¥æ—¶ï¼Œrunloopå°±æ‰§è¡Œäº‹ä»¶ï¼›æ²¡æœ‰äº‹ä»¶ï¼Œå°±è¿›å…¥ä¼‘çœ ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰é€€å‡ºdo-whileå¾ªç¯ã€‚åªæœ‰å½“runloopåˆ°è¾¾é™å®šæ—¶é—´ï¼Œæˆ–è€…æ‰‹åŠ¨é€€å‡ºrunloopï¼›è¿™ä¸ªdo-whileå¾ªç¯æ‰ä¼šç»“æŸ</p>
<h4 id="ä¸»çº¿ç¨‹ä¸runloop"><a href="#ä¸»çº¿ç¨‹ä¸runloop" class="headerlink" title="ä¸»çº¿ç¨‹ä¸runloop"></a>ä¸»çº¿ç¨‹ä¸runloop</h4><p>APPçš„ä¸»çº¿ç¨‹ä¸€ç›´è¿è¡Œç€ä¸€ä¸ªrunloopå¾ªç¯ï¼Œè¿™ä¸ªrunloopç”±ç³»ç»Ÿè¿è¡Œï¼Œå¹¶ä¸”å·²ç»å¾€è¯¥runloopä¸­æ·»åŠ äº†ä¸€äº›äº‹ä»¶ã€‚</p>
<h5 id="ç¡¬ä»¶äº‹ä»¶å“åº”"><a href="#ç¡¬ä»¶äº‹ä»¶å“åº”" class="headerlink" title="ç¡¬ä»¶äº‹ä»¶å“åº”"></a>ç¡¬ä»¶äº‹ä»¶å“åº”</h5><p>å½“å‘ç”Ÿç¡¬ä»¶äº‹ä»¶æ—¶ï¼Œä¹Ÿå°±æ˜¯è§¦æ‘¸ï¼Œé”å±ï¼Œæ‘‡åŠ¨ç­‰äº‹ä»¶æ—¶ï¼›è¿™äº›äº‹ä»¶éƒ½æ˜¯ç³»ç»Ÿäº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯port-basedçš„ç±»å‹ã€‚é‚£ä¹ˆrunloopä¼šä½¿ç”¨<code>_UIApplicationHandleEventQueue()</code>è¯¥å‡½æ•°æ¥å¤„ç†è¿™ä¸€ç±»äº‹ä»¶</p>
<h5 id="æ‰‹åŠ¿è¯†åˆ«"><a href="#æ‰‹åŠ¿è¯†åˆ«" class="headerlink" title="æ‰‹åŠ¿è¯†åˆ«"></a>æ‰‹åŠ¿è¯†åˆ«</h5><p>åœ¨<code>_UIApplicationHandleEventQueue()</code>å‡½æ•°ä¸­ï¼Œä¼šè¯†åˆ«å‡ºéœ€è¦å¾…å¤„ç†çš„æ‰‹åŠ¿ã€‚å½“runloopè¿›å…¥ä¼‘çœ ä¹‹å‰ï¼Œä¼šå‡ºå‘Observerï¼Œåœ¨è¿™ä¸ªObserverä¸­ä¼šè°ƒç”¨<code>_UIGestureRecognizerUpdateObserver()</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šå¤„ç†æ‰‹åŠ¿ï¼ˆä¹Ÿå°±æ˜¯è¿™è¡Œæ‰‹åŠ¿çš„å›è°ƒå‡½æ•°ï¼‰</p>
<h5 id="ç•Œé¢æ›´æ–°"><a href="#ç•Œé¢æ›´æ–°" class="headerlink" title="ç•Œé¢æ›´æ–°"></a>ç•Œé¢æ›´æ–°</h5><p>æ¯å½“runloopå³å°†è¿›å…¥ä¼‘çœ ï¼Œæˆ–è€…å³å°†é€€å‡ºæ—¶ï¼Œä¼šæ‰§è¡Œä¸€ä¸ªObserverã€‚åœ¨è¿™ä¸ªObserveré‡Œé¢ä¼šæŸ¥çœ‹æ¯ä¸ªViewçš„frameç­‰å±æ€§ï¼Œå¦‚æœéœ€è¦é‡æ–°ç»˜åˆ¶ï¼Œé‚£ä¹ˆå¼€å§‹é‡æ–°ç»˜åˆ¶çš„è¿‡ç¨‹ã€‚ï¼ˆlayout -&gt; display -&gt; draw ç­‰ç­‰ï¼‰</p>
<p><strong>æ‰€ä»¥å½“å…¶ä»–çš„äº‹ä»¶æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œè¶…è¿‡16msçš„è¯ï¼Œå°±ä¼šæ¨è¿Ÿè¿›å…¥ä¼‘çœ ï¼Œä¹Ÿå°±ä¼šæ¨è¿ŸObserverçš„è§¦å‘ï¼Œä¹Ÿå°±ä¼šæ¨è¿Ÿç•Œé¢çš„æ›´æ–°ã€‚é‚£ä¹ˆå°±ä¼šé€ æˆå¡é¡¿çš„ç°è±¡ã€‚</strong></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://blog.ibireme.com/2015/05/18/runloop/" target="_blank" rel="external">æ·±å…¥ç†è§£RunLoop</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Objective-C runtime - å¦‚æœè¿˜æœ‰å…¶ä»–çš„è¯]]></title>
      <url>/2017/06/10/objective-c-runtime-other/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç³»åˆ—åº”è¯¥æ˜¯æœ€åä¸€ç¯‡ï¼šè¿˜çœŸè¦æ¥è®²ä¸€ç‚¹å…¶ä»–çš„ä¸œè¥¿ï¼š</p>
<ol>
<li><strong>self &amp;&amp; super</strong></li>
<li><strong>alloc &amp;&amp; init</strong></li>
</ol>
<a id="more"></a>
<h2 id="self-amp-amp-super"><a href="#self-amp-amp-super" class="headerlink" title="self &amp;&amp; super"></a>self &amp;&amp; super</h2><h3 id="self"><a href="#self" class="headerlink" title="self"></a>self</h3><p>selfæ˜¯æ¯ä¸ªç±»å‡½æ•°ä¸­çš„éšè—å‚æ•°ï¼Œæ¯”å¦‚ä¸€ä¸ªç±»çš„å‡½æ•°<code>- (void)someFunc;</code> å®ƒç»è¿‡ç¼–è¯‘ä¹‹åä¼šå˜æˆ <code>void someFunc(id self, SEL _cmd);</code>  å½“æœ‰ä¸€ä¸ªå¯¹è±¡å»è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œæ¯”å¦‚ <code>[someObj someFunc];</code> é‚£ä¹ˆç­‰ä»·äº <code>someFunc(a, @selector(someFunc));</code> ä¼šå°†aè‡ªå·±ä¼ å…¥è¯¥å‡½æ•°</p>
<h3 id="super"><a href="#super" class="headerlink" title="super"></a>super</h3><p>superæ˜¯ä¸€ä¸ªé¢„ç¼–è¯‘å‘½ä»¤ï¼Œä»–ä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ã€‚æ¯”å¦‚åœ¨initæ–¹æ³•ä¸­ [super init]; è¯¥æ–¹æ³•ä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„initæ–¹æ³• </p>
<h2 id="alloc-amp-amp-init"><a href="#alloc-amp-amp-init" class="headerlink" title="alloc &amp;&amp; init"></a>alloc &amp;&amp; init</h2><h3 id="alloc"><a href="#alloc" class="headerlink" title="alloc"></a>alloc</h3><p>allocæ–¹æ³•ä¼šç”Ÿæˆä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œå¹¶å°†è¯¥ç±»å¯¹è±¡çš„isaå˜é‡åˆå§‹åŒ–</p>
<h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3><p>è®²é“ç†ï¼Œ[NSObject init]æ–¹æ³•æ²¡åšå•¥äº‹</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://www.jianshu.com/p/15fa5e84c897" target="_blank" rel="external">OCä¸­çš„selfå’Œsuper</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Objective-C runtime - åº”ç”¨å’Œç¤ºä¾‹]]></title>
      <url>/2017/06/10/objective-c-runtime-example/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç³»åˆ—ç¬¬äº”ç¯‡ï¼šå°†å±•ç¤ºå‡ ä¸ªruntimeçš„ä¾‹å­ä»¥åŠruntimeçš„å®é™…åº”ç”¨ã€‚è¿™äº›ä¾‹å­åŒ…æ‹¬ï¼š</p>
<ol>
<li>åŠ¨æ€<strong>æ·»åŠ å±æ€§</strong>ä»¥åŠæ·»åŠ ç”¨æ¥å­˜å‚¨å±æ€§å¯¹åº”çš„å®ä¾‹å˜é‡çš„<strong>å…³è”å¯¹è±¡</strong></li>
<li>æ–¹æ³•å†³è®®ï¼šçˆ¶ç±»å®ç°<code>resolveInstanceMethod</code>ï¼Œç„¶ååœ¨å­ç±»ä¸­æ·»åŠ æ–¹æ³•</li>
<li>æ¶ˆæ¯è½¬å‘ç¤ºä¾‹ï¼š<ol>
<li><code>forwardingTargetForSelector</code></li>
<li><code>forwardInvocation</code></li>
</ol>
</li>
</ol>
<p>æœ¬æ–‡çš„demoä»£ç å¯ä»¥åœ¨<a href="https://github.com/vanney9/runtime" target="_blank" rel="external">æˆ‘çš„github</a>ä¸Šæ‰¾åˆ°</p>
<a id="more"></a>
<h2 id="å‡ ä¸ªæœ‰è¶£çš„ç¤ºä¾‹"><a href="#å‡ ä¸ªæœ‰è¶£çš„ç¤ºä¾‹" class="headerlink" title="å‡ ä¸ªæœ‰è¶£çš„ç¤ºä¾‹"></a>å‡ ä¸ªæœ‰è¶£çš„ç¤ºä¾‹</h2><h3 id="åŠ¨æ€æ·»åŠ ä»»æ„å±æ€§"><a href="#åŠ¨æ€æ·»åŠ ä»»æ„å±æ€§" class="headerlink" title="åŠ¨æ€æ·»åŠ ä»»æ„å±æ€§"></a>åŠ¨æ€æ·»åŠ ä»»æ„å±æ€§</h3><blockquote>
<p><code>class_addProperty</code> runtimeæ·»åŠ å±æ€§API</p>
<p><code>class_addMethod</code> runtimeæ·»åŠ æ–¹æ³•API</p>
</blockquote>
<p>ä»…ä»…æ·»åŠ å±æ€§æ˜¯æ²¡ä»€ä¹ˆç”¨çš„ï¼Œå› ä¸ºè¿˜éœ€è¦æ·»åŠ å±æ€§å¯¹åº”çš„å®ä¾‹å˜é‡ã€‚</p>
<p><strong>è™½ç„¶runtimeæä¾›äº†<code>class_addIvar</code>æ–¹æ³•æ¥ç»™ç±»æ·»åŠ å®ä¾‹å˜é‡ï¼Œä½†æ˜¯æ³¨æ„ï¼Œè¯¥æ–¹æ³•åªèƒ½åœ¨åˆ›å»ºæ–°çš„ç±»çš„æ—¶å€™æ‰èƒ½ä½¿ç”¨ï¼›å¯¹äºå·²ç»å­˜åœ¨çš„ç±»ï¼Œæ˜¯ä¸å…è®¸æ·»åŠ å®ä¾‹å˜é‡çš„</strong></p>
<p>é‰´äºä¸Šè¿°åŸå› ï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨åŠ¨æ€æ·»åŠ å…³è”å¯¹è±¡æ¥å­˜å‚¨å±æ€§å¯¹åº”çš„å®ä¾‹å˜é‡ã€‚</p>
<h4 id="æ·»åŠ å±æ€§"><a href="#æ·»åŠ å±æ€§" class="headerlink" title="æ·»åŠ å±æ€§"></a>æ·»åŠ å±æ€§</h4><p><code>BOOL class_addProperty(Class cls, const char *name, const objc_property_attribute_t *attributes, unsigned int attributeCount)</code></p>
<ol>
<li><code>cls</code> : è¦æ·»åŠ å±æ€§çš„ç±»</li>
<li><code>name</code> : æ·»åŠ å±æ€§çš„åå­—</li>
<li><code>attributes</code> : å±æ€§çš„ç‰¹æ€§</li>
<li><code>attributeCount</code> : å±æ€§ç‰¹æ€§æ•°é‡</li>
</ol>
<pre><code class="objective-c">// runtime add property
objc_property_attribute_t attribute1 = {&quot;T&quot;, @encode(NSString *)};
objc_property_attribute_t attribute2 = {&quot;N&quot;, &quot;&quot;};
objc_property_attribute_t attribute3 = {&quot;&amp;&quot;, &quot;&quot;};
objc_property_attribute_t attribute[] = {attribute1, attribute2, attribute3};
class_addProperty([HCBase class], &quot;sb&quot;, attribute, 3);
</code></pre>
<p>å¦‚ä¸Šä»£ç ï¼Œæ·»åŠ äº†ä¸€ä¸ªå±æ€§<code>sb</code>ï¼Œè¯¥å±æ€§æœ‰3ä¸ªç‰¹æ€§ï¼š1. NSStringç±»å‹ 2. nonatomic 3. strong</p>
<h4 id="æ·»åŠ å…³è”å¯¹è±¡"><a href="#æ·»åŠ å…³è”å¯¹è±¡" class="headerlink" title="æ·»åŠ å…³è”å¯¹è±¡"></a>æ·»åŠ å…³è”å¯¹è±¡</h4><p>ä¸ºäº†å‘æ­£å¸¸å±æ€§é‚£æ ·è®¿é—®ï¼Œç»™è¯¥ç±»æ·»åŠ <code>sb</code>å±æ€§çš„å­˜å–æ–¹æ³•<code>sb</code> å’Œ <code>setSb:</code></p>
<pre><code class="objective-c">// add property getter and setter
//class_addMethod([HCBase class], @selector(sb), (IMP) sb, &quot;@@:&quot;);
class_addMethod([HCBase class], NSSelectorFromString(@&quot;sb&quot;), (IMP) customGetter, &quot;@@:&quot;);
//class_addMethod([HCBase class], @selector(setSb:), (IMP) setSb, &quot;v@:@&quot;);
class_addMethod([HCBase class], NSSelectorFromString(@&quot;setSb:&quot;), (IMP) customSetter, &quot;v@:@&quot;);
</code></pre>
<p>æ³¨æ„è¯¥æ–¹æ³•çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯æ·»åŠ çš„æ–¹æ³•çš„ç­¾åï¼š<code>è¿”å›ç±»å‹ + self + selector + å‚æ•°</code> çš„å­—ç¬¦ä¸²ï¼š</p>
<ol>
<li><code>sb</code>æ–¹æ³•ï¼Œè¿”å›ç±»å‹ä¸ºid(<strong>@</strong>)ï¼Œselfä¸ºid(<strong>@</strong>)ï¼Œé€‰æ‹©å­(<strong>:</strong>)ï¼Œå‚æ•°ä¸ºç©º =&gt; @@:</li>
<li><code>setSb:</code>æ–¹æ³•ï¼Œè¿”å›ç±»å‹ä¸ºvoid(<strong>v</strong>)ï¼Œselfä¸ºid(<strong>@</strong>)ï¼Œé€‰æ‹©å­(<strong>:</strong>)ï¼Œå‚æ•°ä¸ºid(<strong>@</strong>) =&gt;  v@:@</li>
</ol>
<p>ç°åœ¨æ¥çœ‹çœ‹setterå’Œgetterçš„é€šç”¨å®ç°æ–¹æ³•</p>
<pre><code class="objective-c">// custom getter &amp;&amp; setter

void customSetter(id self, SEL _cmd, id value) {
    NSString *propertyStr = NSStringFromSelector(_cmd);
    // divide set
    NSString *realProperty = [propertyStr substringFromIndex:3];
    realProperty = [realProperty substringToIndex:realProperty.length - 1];
    realProperty = [realProperty lowercaseString];
    //const NSString *key = [realProperty copy];
    objc_setAssociatedObject(self, NSSelectorFromString(realProperty), value, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
    //objc_setAssociatedObject(self, &quot;sb&quot;, value, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}

id customGetter(id self, SEL _cmd) {
    id result = objc_getAssociatedObject(self, _cmd);
    //id result = objc_getAssociatedObject(self, &quot;sb&quot;);
    return result;
}
</code></pre>
<p>è¿™ä¸¤ä¸ªæ–¹æ³•é€šè¿‡åˆ¤æ–­selectoræ¥åˆ¤æ–­è¦æ·»åŠ çš„æ˜¯å“ªä¸€ä¸ªå±æ€§çš„å…³è”å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ–¹æ³•æ˜¯å¯¹ä»»ä½•å±æ€§é€šç”¨çš„ï¼ˆä¹‹åæ–°æ·»åŠ å…¶ä»–çš„å±æ€§ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥å®ç°ï¼‰</p>
<p>æ³¨æ„ï¼š<code>objc_setAssociationObject</code> å’Œ <code>objc_getAssociationObject</code>æ–¹æ³•ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡çš„keyæ˜¯ä¸€ä¸ª <code>const void *</code> ç±»å‹ï¼šå¸¸é‡æŒ‡é’ˆï¼›æ­£å¥½@selectorä¹Ÿæ˜¯å¸¸é‡æŒ‡é’ˆã€‚</p>
<h4 id="è®¿é—®å±æ€§"><a href="#è®¿é—®å±æ€§" class="headerlink" title="è®¿é—®å±æ€§"></a>è®¿é—®å±æ€§</h4><pre><code class="objective-c">// new HCBase and set &amp;&amp; printf sb
HCBase *baseOBJ = [[HCBase alloc] init];
//[baseOBJ performSelector:@selector(setSb:) withObject:@&quot;sb&quot;];
[baseOBJ performSelector:NSSelectorFromString(@&quot;setSb:&quot;) withObject:@&quot;sb&quot;];
//NSLog(@&quot;vanney code log : new property is %@&quot;, [baseOBJ performSelector:@selector(sb)]);
NSLog(@&quot;vanney code log : new property is %@&quot;, [baseOBJ performSelector:NSSelectorFromString(@&quot;sb&quot;)]);
</code></pre>
<p>å·²ç»æ·»åŠ äº†å±æ€§ï¼Œå¹¶æ·»åŠ äº†å­˜å–æ–¹æ³•ã€‚ç°åœ¨å¯ä»¥ä½¿ç”¨<code>performSelector</code>æ–¹æ³•æ¥æ‰§è¡Œå­˜å–æ–¹æ³•</p>
<h3 id="æ–¹æ³•å†³è®®"><a href="#æ–¹æ³•å†³è®®" class="headerlink" title="æ–¹æ³•å†³è®®"></a>æ–¹æ³•å†³è®®</h3><blockquote>
<pre><code class="objective-c">+ (BOOL)resolveInstanceMethod:(SEL)sel;
</code></pre>
</blockquote>
<p>å½“æ²¡æœ‰æ‰¾åˆ°æ–¹æ³•çš„å®ç°æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå¯ä»¥åœ¨è¯¥æ–¹æ³•é‡Œé¢åŠ¨æ€æ·»åŠ ç¼ºå¤±çš„æ–¹æ³•çš„å®ç°ã€‚</p>
<p>æ¥çœ‹çœ‹ä¸¤ä¸ªç±»çš„å£°æ˜ï¼š</p>
<pre><code class="objective-c">/*--------- HCBase -----------*/
#import &quot;runtime.h&quot;
#import &lt;Foundation/Foundation.h&gt;

@interface HCBase : NSObject

//@property (nonatomic, strong) NSString *curry;
//@property (nonatomic, copy) NSString *kd;
//@property (nonatomic, assign) int kt;

- (void)needResolve;

- (void)needForwardTarget;

- (void)needFinalForward;

@end

/*----------- HCSon -----------*/
#import &quot;HCBase.h&quot;

@interface HCSon : HCBase

@end
</code></pre>
<p><code>HCSon</code> ç»§æ‰¿è‡ª <code>HCBase</code> ç±»ï¼Œå¦å¤–<code>HCBase</code>ä¸­å£°æ˜äº†ä¸€ä¸ªæ–¹æ³•<code>needResolve</code>ï¼Œä½†æ˜¯æ²¡æœ‰æä¾›å®ç°ã€‚</p>
<p>é‚£ä¹ˆå½“ä¸€ä¸ª<code>HCSon</code>å¯¹è±¡è°ƒç”¨<code>needResolve</code>æ–¹æ³•æ—¶ï¼Œæ— æ³•æ‰¾åˆ°å®ç°ï¼›æ¥ç€ä¼šå»å¯»æ‰¾<code>resolveInstanceMethod:</code>ï¼Œå¹¶æ‰§è¡Œè¯¥æ–¹æ³•ã€‚ä½†æ˜¯è¯¥<code>resolveInstanceMethod</code>æ–¹æ³•å®šä¹‰åœ¨çˆ¶ç±»<code>HCBase</code>é‡Œé¢</p>
<pre><code class="objective-c">void resolveImp(id self, SEL _cmd) {
    NSLog(@&quot;vanney code log : resolved function&quot;);
}

@implementation HCBase
+ (BOOL)resolveInstanceMethod:(SEL)sel {
    if ([NSStringFromSelector(sel) isEqualToString:@&quot;needResolve&quot;]) {
        class_addMethod(self, @selector(needResolve), (IMP) resolveImp, &quot;v@:&quot;);
        return YES;
    } else {
        return [[self superclass] resolveInstanceMethod:sel];
    }
}
@end
</code></pre>
<p>è¯¥æ–¹æ³•ç»™selfç±»æ·»åŠ ä¸€ä¸ª<code>needResolve</code>æ–¹æ³•ï¼Œä¹‹åä¼šé‡æ–°æ‰§è¡Œ<code>needResolve</code>æ–¹æ³•ã€‚</p>
<p>ç°åœ¨æ¥çœ‹çœ‹ä¸€ä¸ªHCSonå¯¹è±¡è°ƒç”¨<code>needResolve</code>çš„è¿‡ç¨‹</p>
<pre><code class="objective-c">// resolve

// print method
int methodCount;
Method *methodList = class_copyMethodList([HCBase class], &amp;methodCount);
for (int j = 0; j &lt; methodCount; ++j) {
Method curMethod = methodList[j];
printf(&quot;before HCBase method name is %s, and type encoding is %s\n&quot;, method_getName(curMethod), method_getTypeEncoding(curMethod));
}

int methodCountS;
Method *methodListS = class_copyMethodList([HCSon class], &amp;methodCountS);
for (int j = 0; j &lt; methodCountS; ++j) {
Method curMethod = methodListS[j];
printf(&quot;before HCSon method name is %s, and type encoding is %s\n&quot;, method_getName(curMethod), method_getTypeEncoding(curMethod));
}

HCSon *son = [[HCSon alloc] init];
//[baseOBJ needResolve];
[son needResolve];

Method *newMethodList = class_copyMethodList([HCBase class], &amp;methodCount);
for (int j = 0; j &lt; methodCount; ++j) {
Method curMethod = newMethodList[j];
printf(&quot;new HCBase method name is %s, and type encoding is %s\n&quot;, method_getName(curMethod), method_getTypeEncoding(curMethod));
}

Method *newMethodListS = class_copyMethodList([HCSon class], &amp;methodCountS);
for (int j = 0; j &lt; methodCountS; ++j) {
Method curMethod = newMethodListS[j];
printf(&quot;new HCSon method name is %s, and type encoding is %s\n&quot;, method_getName(curMethod), method_getTypeEncoding(curMethod));
}
</code></pre>
<p>åœ¨æ‰§è¡Œ<code>[son needResolve]</code>ä¹‹å‰ï¼Œå…ˆæ‰“å°çˆ¶ç±»å’Œå­ç±»çš„æ–¹æ³•ï¼Œå¯ä»¥å‘ç°éƒ½æ²¡æœ‰<code>needResolve</code>æ–¹æ³•ï¼›æ‰§è¡Œä¹‹åå†æ¬¡æ‰“å°ï¼Œå‘ç°<code>HCSon</code>é‡Œé¢å¢åŠ äº†<code>needResolve</code>æ–¹æ³•ã€‚</p>
<p><strong>å› ä¸ºæ‰§è¡Œ<code>resolveInstanceMethod</code>æ–¹æ³•æ—¶ï¼Œä¼ å…¥çš„<code>self</code>æ˜¯<code>HCSon</code>ï¼Œæ‰€ä»¥æ–¹æ³•å°±æ·»åŠ åœ¨<code>HCSon</code>é‡Œé¢</strong></p>
<p><img src="/lionheart/1706/resolve.png" alt="resolve"></p>
<p><strong>æ³¨æ„å›¾ç‰‡çš„æœ€åä¸€è¡Œ</strong></p>
<h3 id="æ¶ˆæ¯è½¬å‘"><a href="#æ¶ˆæ¯è½¬å‘" class="headerlink" title="æ¶ˆæ¯è½¬å‘"></a>æ¶ˆæ¯è½¬å‘</h3><h4 id="å¤‡æ´å¯¹è±¡"><a href="#å¤‡æ´å¯¹è±¡" class="headerlink" title="å¤‡æ´å¯¹è±¡"></a>å¤‡æ´å¯¹è±¡</h4><blockquote>
<p><code>- (id)forwardingTargetForSelector:(SEL)selector;</code></p>
</blockquote>
<p><code>HCBase</code>å£°æ˜äº†<code>needForwardTarget</code>æ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰å®ç°ï¼›ä½†æ˜¯<code>HCBeitai</code>ç±»æœ‰è¯¥æ–¹æ³•ã€‚å¯ä»¥ä½¿ç”¨<code>forwardingTargetForSelector</code>æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª<code>HCBeitai</code>å¯¹è±¡ï¼Œè®©è¯¥å¯¹è±¡æ¥æ‰§è¡Œ<code>needForwardTarget</code>æ–¹æ³•ã€‚</p>
<pre><code class="objective-c">/*------------ HCBeiTai -----------*/
#import &lt;Foundation/Foundation.h&gt;

@interface HCBeiTai : NSObject

- (void)needForwardTarget;

- (void)beitaiForwarding:(int)index;

@end

@implementation HCBeiTai

- (void)needForwardTarget {
    NSLog(@&quot;bei tai ä½œç”¨äº†&quot;);
}

- (void)beitaiForwarding:(int)index {
    NSLog(@&quot;vanney code log : bei tai ç»ˆæforwardingèµ·ä½œç”¨äº† : index is %d&quot;, index);
}

@end

/*-------------- HCBase ------------*/
- (id)forwardingTargetForSelector:(SEL)aSelector {
    if (aSelector == @selector(needForwardTarget)) {
        NSLog(@&quot;vanney code log : forwarding Target start&quot;);
        HCBeiTai *beitai = [[HCBeiTai alloc] init];
        return beitai;
    } else {
        return [super forwardingTargetForSelector:aSelector];
    }
}
</code></pre>
<p>è¿™ä¹ˆä¸€æ¥ï¼Œå°±å¥½åƒ<code>HCBase</code>ç»§æ‰¿äº†<code>HCBeitai</code>ä¸€æ ·ï¼Œå¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿå¤šé‡ç»§æ‰¿ã€‚æ¥çœ‹çœ‹è¿è¡Œçš„ç»“æœï¼š</p>
<pre><code class="objective-c">// forwardingTarget
[baseOBJ needForwardTarget];
</code></pre>
<p><img src="/lionheart/1706/forwarding1.png" alt="forwarding1"></p>
<h4 id="å®Œæ•´çš„æ¶ˆæ¯è½¬å‘"><a href="#å®Œæ•´çš„æ¶ˆæ¯è½¬å‘" class="headerlink" title="å®Œæ•´çš„æ¶ˆæ¯è½¬å‘"></a>å®Œæ•´çš„æ¶ˆæ¯è½¬å‘</h4><blockquote>
<p><code>- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector;</code></p>
<p><code>- (void)forwardInvocation:(NSInvocation *)invocation;</code></p>
</blockquote>
<p>å½“æ‰€æœ‰çš„æ‰‹æ®µéƒ½æ— æ³•å¤„ç†è¯¥æ–¹æ³•æ—¶ï¼Œå°±å¼€å¯äº†å®Œæ•´çš„æ¶ˆæ¯è½¬å‘ã€‚å…ˆè°ƒç”¨<code>methodSignatureForSelector</code>æ–¹æ³•ï¼Œç»™è¯¥æœªçŸ¥æ–¹æ³•ç­¾åâ€” ç±»ä¼¼<strong>@@:</strong> ã€‚å½“ç­¾åä¸ä¸ºç©ºæ—¶ï¼Œè°ƒç”¨<code>forwardInvocation</code>ï¼Œå°†ä½ç½®æ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯å­˜æ”¾åœ¨<code>NSInvocation</code>å¯¹è±¡ä¸­ï¼›è¿™æ—¶å¯ä»¥æ›´æ”¹æ–¹æ³•çš„ä¿¡æ¯ï¼Œæ¯”å¦‚selectorï¼Œsignatureç­‰ç­‰ï¼Œç„¶åäº¤ç”±å…¶ä»–å¯¹è±¡æ¥æ‰§è¡Œæ›´æ”¹ä¹‹åçš„æ–¹æ³•ã€‚</p>
<p>æ¥çœ‹çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š<code>HCBase</code>å£°æ˜äº†<code>needFinalForward</code>æ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰æä¾›å®ç°ï¼›<code>HCBeitai</code>å®ç°äº†<code>beitaiForwarding:</code>æ–¹æ³•ã€‚æ¶ˆæ¯è½¬å‘ï¼Œå°†ç»™<code>HCBase</code>å¯¹è±¡çš„<code>needFinalForward</code>æ–¹æ³• è½¬å‘ç»™äº† <code>HCBeitai</code>å¯¹è±¡çš„<code>beitaiForwarding:</code>æ–¹æ³•ã€‚<strong>æ³¨æ„ï¼šè¿™ä¸¤ä¸ªæ–¹æ³•çš„selectorå’Œsignatureéƒ½ä¸ä¸€æ ·</strong></p>
<pre><code class="objective-c">- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector {
    NSLog(@&quot;vanney code log : selector is %@&quot;, NSStringFromSelector(aSelector));
    NSMethodSignature *methodSignature = [super methodSignatureForSelector:aSelector];
    if (!methodSignature) {
        NSLog(@&quot;vanney code log : inside create method signature&quot;);
        methodSignature = [NSMethodSignature signatureWithObjCTypes:&quot;v@:i&quot;];
    }

    return methodSignature;
}

- (void)forwardInvocation:(NSInvocation *)anInvocation {
    NSLog(@&quot;vanney code log : forwarding invocation selector is %@&quot;, NSStringFromSelector(anInvocation.selector));
    NSLog(@&quot;vanney code log : invocation is %@, and method signature is %@&quot;, anInvocation, anInvocation.methodSignature);

    if (anInvocation.selector == @selector(needFinalForward)) {
        NSLog(@&quot;vanney code log : inside forwarding&quot;);
        anInvocation.selector = NSSelectorFromString(@&quot;beitaiForwarding:&quot;);
        int *a;
        *a = 99;
        [anInvocation setArgument:a atIndex:2];
        HCBeiTai *beiTai = [[HCBeiTai alloc] init];
        [anInvocation invokeWithTarget:beiTai];
    } else {
        NSLog(@&quot;vanney code log : else forwarding&quot;);
        [super forwardInvocation:anInvocation];
    }

}
</code></pre>
<p>è½¬å‘çš„åŒæ—¶ï¼Œè¿˜å¯ä»¥è®¾ç½®å‚æ•°ã€‚æŠŠ99ä¼ é€’ç»™æ–°çš„æ–¹æ³•ã€‚æ¥çœ‹çœ‹è¿è¡Œç»“æœï¼š</p>
<pre><code class="objective-c">// final forwarding
[baseOBJ needFinalForward];
</code></pre>
<p><img src="/lionheart/1706/forwarding2.png" alt="forwarding2"></p>
<h2 id="runtimeåº”ç”¨"><a href="#runtimeåº”ç”¨" class="headerlink" title="runtimeåº”ç”¨"></a>runtimeåº”ç”¨</h2><h3 id="Method-Swizzling"><a href="#Method-Swizzling" class="headerlink" title="Method Swizzling"></a>Method Swizzling</h3><p>å¯ä»¥åœ¨ç±»çš„<code>load</code>æ–¹æ³•ä¸­ï¼Œé€šè¿‡<code>class_addMethod</code> <code>class_replaceMethod</code>æ¥æ”¹å˜æ–¹æ³•çš„é»˜è®¤å®ç°æ–¹å¼ã€‚å› ä¸º<code>load</code>æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œæ‰€æœ‰ç±»çš„æ–¹æ³•éƒ½æœ‰äº†ï¼Œä½†éƒ½è¿˜æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ¬¡</p>
<h3 id="JSON-gt-Model"><a href="#JSON-gt-Model" class="headerlink" title="JSON -&gt; Model"></a>JSON -&gt; Model</h3><pre><code class="objective-c">- (instancetype)initWithDict:(NSDictionary *)dict {

    if (self = [self init]) {
        //(1)è·å–ç±»çš„å±æ€§åŠå±æ€§å¯¹åº”çš„ç±»å‹
        NSMutableArray * keys = [NSMutableArray array];
        NSMutableArray * attributes = [NSMutableArray array];
        /*
         * ä¾‹å­
         * name = value3 attribute = T@&quot;NSString&quot;,C,N,V_value3
         * name = value4 attribute = T^i,N,V_value4
         */
        unsigned int outCount;
        objc_property_t * properties = class_copyPropertyList([self class], &amp;outCount);
        for (int i = 0; i &lt; outCount; i ++) {
            objc_property_t property = properties[i];
            //é€šè¿‡property_getNameå‡½æ•°è·å¾—å±æ€§çš„åå­—
            NSString * propertyName = [NSString stringWithCString:property_getName(property) encoding:NSUTF8StringEncoding];
            [keys addObject:propertyName];
            //é€šè¿‡property_getAttributeså‡½æ•°å¯ä»¥è·å¾—å±æ€§çš„åå­—å’Œ@encodeç¼–ç 
            NSString * propertyAttribute = [NSString stringWithCString:property_getAttributes(property) encoding:NSUTF8StringEncoding];
            [attributes addObject:propertyAttribute];
        }
        //ç«‹å³é‡Šæ”¾propertiesæŒ‡å‘çš„å†…å­˜
        free(properties);

        //(2)æ ¹æ®ç±»å‹ç»™å±æ€§èµ‹å€¼
        for (NSString * key in keys) {
            if ([dict valueForKey:key] == nil) continue;
            [self setValue:[dict valueForKey:key] forKey:key];
        }
    }
    return self;

}
</code></pre>
<p>è¯¥æ–¹æ³•å‚è€ƒè‡ª<a href="http://www.jianshu.com/p/07b6c4a40a90" target="_blank" rel="external">[iOS] runtime çš„ä½¿ç”¨åœºæ™¯â€“å®æˆ˜ç¯‡</a></p>
<h3 id="KVO-KVC"><a href="#KVO-KVC" class="headerlink" title="KVO, KVC"></a>KVO, KVC</h3><p>æµ·å¸¦å­¦ä¹ </p>
<h3 id="JSPatch"><a href="#JSPatch" class="headerlink" title="JSPatch"></a>JSPatch</h3><p>JSPatchå……åˆ†çš„åº”ç”¨äº†runtimeçš„æ€§è´¨ï¼Œè¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡æ–‡ç« <a href="http://vanney9.com/2017/07/07/JSPatch-source-analyze/" target="_blank" rel="external">JSPatchæºç åˆ†æ</a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://www.jianshu.com/p/07b6c4a40a90" target="_blank" rel="external">[iOS] runtime çš„ä½¿ç”¨åœºæ™¯â€“å®æˆ˜ç¯‡</a></li>
<li><a href="https://github.com/vanney9/runtime" target="_blank" rel="external">æˆ‘çš„github</a></li>
<li><a href="http://vanney9.com/2017/07/07/JSPatch-source-analyze/" target="_blank" rel="external">JSPatchæºç åˆ†æ</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Objective-C runtime - API]]></title>
      <url>/2017/06/09/objective-c-runtime-api/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç³»åˆ—ç¬¬å››ç¯‡ï¼šå‰é¢3ç¯‡ï¼Œä¸»è¦ä»å¯¹è±¡ï¼Œå±æ€§ï¼Œæ–¹æ³•ç­‰æ–¹é¢åˆ†æäº†runtimeçš„æºç ã€‚è¿™ä¸€ç¯‡ï¼Œæ¥çœ‹çœ‹runtimeæä¾›çš„APIã€‚è¿™äº›APIå¯ä»¥ç”¨æ¥æ“ä½œç±»ï¼Œå¯¹è±¡ï¼Œå±æ€§ï¼Œæ–¹æ³•ç­‰ç­‰ã€‚äº†è§£äº†è¿™äº›åº•å±‚çš„å®ç°ï¼ŒAPIçš„å·¥ä½œåªæ˜¯å¯¹è¿™äº›åº•å±‚æ“ä½œåšäº†ä¸ªå°è£…ã€‚</p>
<p><a href="https://developer.apple.com/documentation/objectivec/objective_c_runtime?language=objc" target="_blank" rel="external">å®˜æ–¹runtimeAPIæ–‡æ¡£</a></p>
<a id="more"></a>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>runtimeçš„APIå…¨éƒ¨å®šä¹‰åœ¨<code>runtime.h</code> å¤´æ–‡ä»¶ä¸­ï¼Œè¯¥APIä½œç”¨ä¸ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š(<strong>APIçš„å¼€å¤´éƒ½æ˜¯ä»¥ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å‘½åçš„</strong>)</p>
<ol>
<li>ç±»</li>
<li>å®ä¾‹å¯¹è±¡</li>
<li>å®ä¾‹å˜é‡</li>
<li>å…³è”å¯¹è±¡</li>
<li>æ¶ˆæ¯å‘é€</li>
<li>æ–¹æ³•</li>
<li>é€‰æ‹©å­</li>
<li>åè®®</li>
<li>å±æ€§</li>
</ol>
<p>å…·ä½“çš„å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://developer.apple.com/documentation/objectivec/objective_c_runtime?language=objc" target="_blank" rel="external">å®˜æ–¹runtimeAPIæ–‡æ¡£</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Objective-C runtime - æ¶ˆæ¯]]></title>
      <url>/2017/06/08/objective-c-runtime-message/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç³»åˆ—ç¬¬ä¸‰ç¯‡ï¼šæ¥çœ‹çœ‹OCçš„æ¶ˆæ¯ã€‚åŒ…æ‹¬<strong>æ–¹æ³•æŸ¥æ‰¾ã€ç¼“å­˜ã€æ–¹æ³•å†³è®®ä»¥åŠæ¶ˆæ¯è½¬å‘</strong></p>
<a id="more"></a>
<h2 id="objc-msgSend"><a href="#objc-msgSend" class="headerlink" title="objc_msgSend"></a>objc_msgSend</h2><blockquote>
<p><code>objc_msgSend</code> å‡½æ•°çš„åŸå‹ä¸º <code>void objc_msgSend(id self, SEL cmd, ...)</code></p>
</blockquote>
<p>ç»™ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯ï¼š</p>
<pre><code class="objective-c">id returnValue = [someObject messageName:parameter];
</code></pre>
<p>ç¼–è¯‘å™¨ä¼šå°†è¯¥OCè¯­å¥è½¬æ¢æˆ<code>objc_msgSend</code>å‡½æ•°:</p>
<pre><code class="c++">id returnValue = objc_msgSend(someObject, @selector(messageName:), parameter);
</code></pre>
<p>å…¶ä¸­çš„SELé€‰æ‹©å­å¯ä»¥ç†è§£æˆæ–¹æ³•çš„åå­—ã€‚</p>
<p><strong>ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œç»™OCå¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨<code>objc_msgSend</code>å‡½æ•°ï¼Œæ‰€æœ‰è¿™ç¯‡æ–‡ç« çš„é‡ç‚¹ä¹Ÿæ˜¯è¯¥å‡½æ•°çš„å…·ä½“å®ç°è¿‡ç¨‹</strong></p>
<h2 id="OCæ–¹æ³•æœ¬è´¨"><a href="#OCæ–¹æ³•æœ¬è´¨" class="headerlink" title="OCæ–¹æ³•æœ¬è´¨"></a>OCæ–¹æ³•æœ¬è´¨</h2><pre><code class="c++">- (void)hello:(int)a;

// è¯¥æ–¹æ³•ç¼–è¯‘çš„æ—¶å€™ä¼šè¢«è½¬åŒ–æˆï¼š

void hello(id self, SEL _cmd, int a);
</code></pre>
<p>å½“æœ‰ä¸€ä¸ªå¯¹è±¡è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼š</p>
<pre><code class="c++">[someObj hello:2];

// ç¼–è¯‘ä¹‹åå°±æ˜¯
objc_msgSend(someObj, @selector(hello:), 2);

// å½“objc_msgSendæ‰¾åˆ°æ–¹æ³•çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯helloæ–¹æ³•æ—¶ï¼Œç›¸å½“äºè°ƒç”¨ï¼š
hello(someObj, @selector(hello:), 2);
</code></pre>
<h2 id="æ–¹æ³•æŸ¥æ‰¾-amp-amp-ç¼“å­˜"><a href="#æ–¹æ³•æŸ¥æ‰¾-amp-amp-ç¼“å­˜" class="headerlink" title="æ–¹æ³•æŸ¥æ‰¾ &amp;&amp; ç¼“å­˜"></a>æ–¹æ³•æŸ¥æ‰¾ &amp;&amp; ç¼“å­˜</h2><p>å›å¿†ä¸€ä¸‹<code>objc_class</code>ç»“æ„ä½“</p>
<p><img src="/lionheart/1706/bits.png" alt="objc_class"></p>
<p>ç±»çš„æ–¹æ³•éƒ½å­˜æ”¾åœ¨<code>bits</code>æˆå‘˜å˜é‡ä¸­ï¼Œè€Œæ–¹æ³•çš„ç¼“å­˜åˆ™æ˜¯å­˜æ”¾åœ¨<code>cache</code>æˆå‘˜å˜é‡ä¸­ã€‚</p>
<p><code>objc_msgSend</code>å‡½æ•°é€šè¿‡è°ƒç”¨<code>lookUpImpOrForward</code>å‡½æ•°æ¥æŸ¥æ‰¾æ–¹æ³•çš„å®ç°</p>
<h3 id="å½“å‰ç±»æŸ¥è¯¢"><a href="#å½“å‰ç±»æŸ¥è¯¢" class="headerlink" title="å½“å‰ç±»æŸ¥è¯¢"></a>å½“å‰ç±»æŸ¥è¯¢</h3><p><code>objc_msgSend</code>å‡½æ•°æŸ¥è¯¢æ–¹æ³•çš„å®ç°ï¼Œå…ˆä¼šåœ¨å½“å‰ç±»ä¸­æŸ¥è¯¢ã€‚</p>
<ol>
<li>å…ˆåœ¨ç¼“å­˜<code>cache</code>ä¸­å¯»æ‰¾æ˜¯å¦å­˜åœ¨è¯¥æ–¹æ³•ï¼Œæ‰¾åˆ°å°±å»æ‰§è¡Œ</li>
<li>å¦‚æœæ²¡åœ¨ç¼“å­˜ä¸­æ‰¾åˆ°è¯¥æ–¹æ³•ï¼Œå°±åˆ°<code>bits</code>ä¸­å¯»æ‰¾æ–¹æ³•ã€‚å¦‚æœæ‰¾åˆ°ï¼Œä¼šå…ˆå†™å…¥ç¼“å­˜<code>cache</code>ï¼Œå†å»æ‰§è¡Œæ–¹æ³•ï¼›å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±ä¼šå»<code>super_class</code>é‡Œé¢å¯»æ‰¾</li>
</ol>
<h3 id="æ²¿ç€ç±»ç»§æ‰¿å…³ç³»æŸ¥è¯¢"><a href="#æ²¿ç€ç±»ç»§æ‰¿å…³ç³»æŸ¥è¯¢" class="headerlink" title="æ²¿ç€ç±»ç»§æ‰¿å…³ç³»æŸ¥è¯¢"></a>æ²¿ç€ç±»ç»§æ‰¿å…³ç³»æŸ¥è¯¢</h3><p>æ¯ä¸ª<code>objc_class</code>éƒ½ä¼šæœ‰æŒ‡å‘çˆ¶ç±»çš„æŒ‡é’ˆã€‚å½“å­ç±»æ— æ³•æä¾›æ–¹æ³•çš„å®ç°æ—¶ï¼Œä¼šè·‘åˆ°çˆ¶ç±»æ¥å¯»æ‰¾è¯¥å®ç°ï¼Œè¿‡ç¨‹ç›¸ä¼¼ï¼š</p>
<ol>
<li>åœ¨çˆ¶ç±»çš„ç¼“å­˜<code>cache</code>ä¸­å¯»æ‰¾ã€‚å¦‚æœæ‰¾åˆ°ï¼Œå†™åˆ°è°ƒç”¨è¯¥æ–¹æ³•çš„ç±»çš„<code>cache</code>ä¸­ï¼Œå†æ‰§è¡Œ</li>
<li>åœ¨ç¼“å­˜ä¸­æ²¡æ‰¾åˆ°ï¼Œå°±ç»§ç»­åœ¨çˆ¶ç±»çš„<code>bits</code>ä¸­æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ï¼Œå†™å…¥ç¼“å­˜å¹¶æ‰§è¡Œ</li>
<li>å¦‚æœè¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œç»§ç»­æ²¿ç€ç±»ç»§æ‰¿å…³ç³»å¯»æ‰¾æ–¹æ³•çš„å®ç°</li>
</ol>
<h3 id="æ–¹æ³•å†³è®®"><a href="#æ–¹æ³•å†³è®®" class="headerlink" title="æ–¹æ³•å†³è®®"></a>æ–¹æ³•å†³è®®</h3><blockquote>
<p><code>+ (BOOL)resolveInstanceMethod:(SEL)selector</code> </p>
<p><code>+ (BOOL)resolveClassMethod:(SEL)selector</code></p>
</blockquote>
<p>å¦‚æœåœ¨å½“å‰ç±»ä»¥åŠæ‰€æœ‰çˆ¶ç±»ä¹‹ä¸­éƒ½æ— æ³•æ‰¾åˆ°æ–¹æ³•çš„å®ç°çš„è¯ï¼Œå°±è¿›å…¥äº†æ–¹æ³•å†³è®®çš„é˜¶æ®µã€‚æ¥çœ‹çœ‹æ–¹æ³•å†³è®®çš„è¿‡ç¨‹ï¼š(<strong>è¯¥è¿‡ç¨‹çš„æºç ä¹Ÿåœ¨<code>lookUpImpOrForward</code>æ–¹æ³•ä¸­</strong>)</p>
<ol>
<li><p>æŸ¥çœ‹å½“å‰ç±»æ˜¯å¦å®ç°äº†resolveæ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰ï¼Œå†³è®®ç›´æ¥å¤±è´¥</p>
</li>
<li><p>å¦‚æœå­˜åœ¨resolveæ–¹æ³•ï¼Œé‚£ä¹ˆæ‰§è¡Œè¯¥æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•é‡Œé¢ä¸€èˆ¬ä¼šåŠ¨æ€ç»™å½“å‰ç±»æ·»åŠ æ–¹æ³•ï¼Œæ˜¯çš„ä¹‹å‰æ²¡æœ‰æ‰¾åˆ°å®ç°çš„æ–¹æ³•å¯ä»¥å®ç°ã€‚ä¾‹å¦‚ï¼Œæ¥å®ç°@dynamicçš„å±æ€§çš„å­˜å–æ–¹æ³•</p>
</li>
</ol>
<pre><code class="objective-c">// æ³¨æ„ï¼šä»¥ä¸‹ä¸¤æ–¹æ³•çš„ç›¸å…³å®ç°ä»£ç å·²ç»å†™å¥½
id autoDictionaryGetter(id self, SEL _cmd);
void autoDictionarySetter(id self, SEL _cmd, id value);

+ (BOOL)resolveInstanceMethod:(SEL)selector {
    NSString *selectorString = NSStringFromSelector(selector);
    if ([selectorString hasPrefix:@&quot;set&quot;]) {
        class_addMethod(self, selector, (IMP)autoDictionarySetter, &quot;v@:@&quot;);
    } else {
        class_addMethod(self, selector, (IMP)autoDictionaryGetter, &quot;@@:&quot;);
    }

    return YES;
}
</code></pre>
<p>   åœ¨è¿™ä¸€ä¸ªresolveæ–¹æ³•é‡Œé¢ï¼Œç»™ç±»æ–°å¢åŠ äº†ä¸€ä¸ªæ–¹æ³•ã€‚</p>
<ol>
<li>æ‰§è¡Œå®Œresolveæ–¹æ³•ä¹‹åï¼Œä¼šé‡æ–°è¿›è¡Œä¸€æ¬¡æ–¹æ³•çš„æŸ¥æ‰¾ã€‚å¦‚æœæ‰¾åˆ°æ–¹æ³•äº†ï¼Œæ‰§è¡Œ</li>
</ol>
<h3 id="æ¶ˆæ¯è½¬å‘"><a href="#æ¶ˆæ¯è½¬å‘" class="headerlink" title="æ¶ˆæ¯è½¬å‘"></a>æ¶ˆæ¯è½¬å‘</h3><p>å¦‚æœæ–¹æ³•å†³è®®ä¹Ÿæ²¡æœ‰ç”¨çš„è¯ï¼Œä¼šç»™è¿™ä¸ªæ–¹æ³•æœ€åä¸€ä¸ªæœºä¼šï¼šæ¶ˆæ¯è½¬å‘</p>
<h4 id="å¤‡æ´æ¥æ”¶è€…"><a href="#å¤‡æ´æ¥æ”¶è€…" class="headerlink" title="å¤‡æ´æ¥æ”¶è€…"></a>å¤‡æ´æ¥æ”¶è€…</h4><blockquote>
<p><code>- (id)forwardingTargetForSelector:(SEL)selector;</code></p>
</blockquote>
<p>æ‰§è¡Œè¯¥å‡½æ•°ï¼Œçœ‹èƒ½å¦è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥å¤„ç†è¯¥æ–¹æ³•ã€‚å…·ä½“å‚è§<a href="https://developer.apple.com/documentation/objectivec/nsobject/1418855-forwardingtargetforselector" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></p>
<h4 id="å®Œæ•´çš„æ¶ˆæ¯è½¬å‘"><a href="#å®Œæ•´çš„æ¶ˆæ¯è½¬å‘" class="headerlink" title="å®Œæ•´çš„æ¶ˆæ¯è½¬å‘"></a>å®Œæ•´çš„æ¶ˆæ¯è½¬å‘</h4><p>å¦‚æœæ— æ³•æ‰¾åˆ°å¤‡èƒçš„è¯ï¼Œå°±è¦è¿›è¡Œå®Œæ•´çš„æ¶ˆæ¯è½¬å‘äº†ã€‚å°†æœªå¤„ç†çš„æ¶ˆæ¯å°è£…æˆ<code>NSInvocation</code>å¯¹è±¡ï¼Œç„¶åè°ƒç”¨<code>- (void)forwardInvocation:(NSInvocation *)invocation;</code> æ–¹æ³•ã€‚</p>
<p>è¿™ä¸ªè½¬å‘çš„æ–¹æ³•å±äº <code>NSObject</code>ï¼Œéœ€è¦å­ç±»é‡å†™è¯¥æ–¹æ³•ã€‚å…·ä½“å‚è§<a href="https://developer.apple.com/documentation/objectivec/nsobject/1571955-forwardinvocation" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></p>
<h4 id="å®Œæ•´çš„æ¶ˆæ¯è½¬å‘å›¾ç¤º"><a href="#å®Œæ•´çš„æ¶ˆæ¯è½¬å‘å›¾ç¤º" class="headerlink" title="å®Œæ•´çš„æ¶ˆæ¯è½¬å‘å›¾ç¤º"></a>å®Œæ•´çš„æ¶ˆæ¯è½¬å‘å›¾ç¤º</h4><p><img src="/lionheart/1706/forward.JPG" alt="forwarding"></p>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p><strong>åœ¨åç»­çš„ä¸€ç‰‡æ–‡ç« ä¸­ä¼šæœ‰è¯¦ç»†çš„ç¤ºä¾‹æ¥è¯´æ˜æ¶ˆæ¯å†³è®®å’Œè½¬å‘</strong></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://draveness.me/message.html" target="_blank" rel="external">ä»æºä»£ç çœ‹ ObjC ä¸­æ¶ˆæ¯çš„å‘é€</a></li>
<li>Effective Objective-C 2.0</li>
<li><a href="https://developer.apple.com/documentation/objectivec/nsobject/1418855-forwardingtargetforselector" target="_blank" rel="external">forwardingTargetForSelector:</a></li>
<li><a href="https://developer.apple.com/documentation/objectivec/nsobject/1571955-forwardinvocation" target="_blank" rel="external">forwardInvocation:</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Objective-C runtime - åˆ†ç±»ä¸å…³è”å¯¹è±¡]]></title>
      <url>/2017/06/07/objective-c-runtime-category/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç³»åˆ—ç¬¬ä¸‰ç¯‡ï¼šæ·±å…¥åˆ†æOCä¸­çš„åˆ†ç±» - <strong>Category</strong> ä»¥åŠåœ¨åˆ†ç±»é‡Œé¢ä¼šæ¶‰åŠåˆ°äº† <strong>å…³è”å¯¹è±¡</strong></p>
<a id="more"></a>
<h2 id="Category"><a href="#Category" class="headerlink" title="Category"></a>Category</h2><h3 id="category-t"><a href="#category-t" class="headerlink" title="category_t"></a>category_t</h3><p>å…ˆæ¥çœ‹çœ‹categoryçš„çœŸé¢ç›®ï¼š<strong>category_t</strong></p>
<pre><code class="c++">struct category_t {
    const char *name;
    classref_t cls;
    struct method_list_t *instanceMethods;
    struct method_list_t *classMethods;
    struct protocol_list_t *protocols;
    struct property_list_t *instanceProperties;
    // Fields below this point are not always present on disk.
    struct property_list_t *_classProperties;

    method_list_t *methodsForMeta(bool isMeta) {
        if (isMeta) return classMethods;
        else return instanceMethods;
    }

    property_list_t *propertiesForMeta(bool isMeta, struct header_info *hi);
};
</code></pre>
<p><code>category_t</code>ç»“æ„ä½“å®šä¹‰åœ¨<code>objc-runtime-new.h</code>ä¸­ï¼Œå¯ä»¥çœ‹å‡ºè¯¥ç»“æ„ä½“ä¸­å«æœ‰ï¼šå®ä¾‹æ–¹æ³•åˆ—è¡¨ã€ç±»æ–¹æ³•åˆ—è¡¨ã€åè®®åˆ—è¡¨ã€å±æ€§åˆ—è¡¨ã€‚</p>
<h3 id="ç¼–è¯‘ä¹‹åï¼Œruntimeä¹‹å‰"><a href="#ç¼–è¯‘ä¹‹åï¼Œruntimeä¹‹å‰" class="headerlink" title="ç¼–è¯‘ä¹‹åï¼Œruntimeä¹‹å‰"></a>ç¼–è¯‘ä¹‹åï¼Œruntimeä¹‹å‰</h3><p>æ¥çœ‹çœ‹NSObjectçš„åˆ†ç±»ï¼š</p>
<pre><code class="objective-c">#import &lt;Foundation/Foundation.h&gt;

@interface NSObject (vc)

- (void)test;

@end
</code></pre>
<p>åœ¨ç¼–è¯‘ç»“æŸä¹‹åï¼Œruntimeè¿è¡Œä¹‹å‰ã€‚NSObjectè¢«ç¼–è¯‘æˆä¸€ä¸ª<code>objc_class</code> ç»“æ„ä½“ï¼›è€ŒNSObject (vc) è¢«ç¼–è¯‘æˆä¸€ä¸ª<code>category_t</code> ç»“æ„ä½“ã€‚</p>
<p>æ‰“å°å‡ºè¿™ä¸ªç»“æ„ä½“ï¼š(åœ¨<code>attachCategories</code>æ–¹æ³•ä¸­åˆ¤æ–­å½“å‰çš„categoryä½vcï¼Œå¹¶è¿›å…¥æ–­ç‚¹)</p>
<p><img src="/lionheart/1706/breakpoint.png" alt="break point"></p>
<p>æ‰“å°å‡ºçš„categoryç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="/lionheart/1706/category.png" alt="category"></p>
<h3 id="runtimeä¹‹å"><a href="#runtimeä¹‹å" class="headerlink" title="runtimeä¹‹å"></a>runtimeä¹‹å</h3><p>è¿è¡Œ<code>attachCategories</code> æ–¹æ³•ä¹‹åï¼Œä¼šå°†categoryä¸­çš„æ‰€æœ‰æ–¹æ³•ã€å±æ€§ã€åè®®æ·»åŠ åˆ°ç±»çš„<code>class_rw_t</code>ä¸­ã€‚</p>
<p>æˆ‘ä»¬ä»¥æ·»åŠ æ–¹æ³•ä¸ºä¾‹ï¼Œåœ¨æ·»åŠ ä»»ä½•çš„åˆ†ç±»æ–¹æ³•ä¹‹å‰ï¼ŒNSObjectçš„<code>class_rw_t</code>ä¸­çš„<code>methods</code>æ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯<code>class_ro_t</code>ä¸­çš„<code>baseMethodList</code>åˆ—è¡¨ã€‚æ·»åŠ ä¸€ä¸ªåˆ†ç±»ä¹‹åï¼Œä¼šå¾€<code>methods</code>æ•°ç»„ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œè¯¥å…ƒç´ çš„ç±»å‹æ˜¯<code>entsize_list_tt</code>ã€‚</p>
<p>ä½¿ç”¨lldbæŸ¥çœ‹ï¼Œå‘ç°åœ¨æ·»åŠ vcåˆ†ç±»åï¼ŒNSObjecté‡Œé¢å·²ç»æ·»åŠ äº†64ä¸ªåˆ†ç±»äº†ï¼›åŠ ä¸Š<code>baseMethodList</code>ï¼Œ<code>methods</code>æ•°ç»„å·²ç»æœ‰65ä¸ªå…ƒç´ ã€‚ï¼ˆ<strong>åæ·»åŠ çš„åˆ†ç±»åœ¨æ•°ç»„ä¸­çš„ä½ç½®é å‰ï¼ŒbaseMethodListå…ƒç´ åœ¨æœ€åé¢</strong>ï¼‰</p>
<p><img src="/lionheart/1706/nsobject.png" alt="category"></p>
<h3 id="ä¾‹å¤–"><a href="#ä¾‹å¤–" class="headerlink" title="ä¾‹å¤–"></a>ä¾‹å¤–</h3><p><strong>å¯¹äºç³»ç»Ÿè‡ªå¸¦çš„ç±»ï¼Œæ‰ä¼šåœ¨runtimeæ—¶åŠ è½½åˆ†ç±»ï¼›ä½†æ˜¯å¯¹äºè‡ªå·±åˆ›å»ºçš„ç±»ï¼Œåœ¨ç¼–è¯‘ç»“æŸä¹‹åå°±ç›´æ¥å°†åˆ†ç±»çš„æ–¹æ³•æ·»åŠ åˆ°<code>baseMethodList</code>ä¸­äº†ï¼Œå°±å¥½åƒæ²¡æœ‰åˆ†ç±»ä¸€è¯´ã€‚ã€‚</strong></p>
<pre><code class="objective-c">// TestOBJ
@interface TestOBJ : NSObject {
    NSInteger ivatInt;
}
@property (nonatomic, assign) NSInteger propertyInt;
- (void)test;
@end

// TestOBJ+vc
#import &quot;TestOBJ.h&quot;
@interface TestOBJ (vc)
@property (nonatomic, assign) NSInteger vc;
- (void)test;
@end
</code></pre>
<p>åœ¨<code>_objc_init</code>é‡Œé¢æ‰“ä¸Šæ–­ç‚¹ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯runtimeçš„å…¥å£å‡½æ•°ã€‚åœ¨è¿™ä¸ªæ—¶å€™ä½¿ç”¨lldbï¼Œå°±å‘ç°åœ¨TestOBJçš„<code>baseMethodList</code>é‡Œé¢æœ‰2ä¸ªtestæ–¹æ³•äº†ï¼Œå½“ç„¶åˆ†ç±»çš„testæ–¹æ³•åœ¨å‰é¢ï¼Œä¹Ÿå°±æ˜¯ä¼šè¢«å…ˆæ£€ç´¢åˆ°ã€‚</p>
<h2 id="å…³è”å¯¹è±¡"><a href="#å…³è”å¯¹è±¡" class="headerlink" title="å…³è”å¯¹è±¡"></a>å…³è”å¯¹è±¡</h2><p>è§‚å¯Ÿå‘ç°ï¼Œcategoryé‡Œé¢æœ‰å±æ€§ï¼Œä½†æ˜¯æ²¡æœ‰å®ä¾‹å˜é‡ã€‚åœ¨ç³»åˆ—ä¸Šä¸€ç¯‡<a href="http://vanney9.com/2017/06/05/objective-c-runtime-property-method/" target="_blank" rel="external">Objective-C runtime - å±æ€§ä¸æ–¹æ³•</a>äº†è§£åˆ°ï¼Œå±æ€§æ²¡ä»€ä¹ˆç”¨ï¼ŒçœŸæ­£å­˜æ”¾çš„è¿˜æ˜¯å®ä¾‹å˜é‡ã€‚</p>
<p><strong>é‚£ä¹ˆä¸ºä»€ä¹ˆä¸èƒ½æ·»åŠ å®ä¾‹å˜é‡å‘¢ï¼Ÿ</strong> å› ä¸ºå®ä¾‹å˜é‡åœ¨æ¯ä¸ªå¯¹è±¡ä¸­éƒ½æœ‰ä¸€ä»½ã€‚å¯¹äºä½¿ç”¨åˆ†ç±»ä¹‹å‰ï¼Œå¯¹è±¡çš„å†…å­˜æ˜¯å¦‚æ­¤åˆ†å¸ƒçš„ï¼›å¦‚æœæ·»åŠ äº†åˆ†ç±»ï¼Œé‚£ä¹ˆæ¯ä¸ªå¯¹è±¡çš„å†…å­˜ç»“æ„éƒ½éœ€è¦æ”¹å˜ã€‚è€Œå¯¹äºæ–¹æ³•æ¥è¯´ï¼Œåªéœ€è¦ç±»çš„ç»“æ„ä½“æ¥å­˜å‚¨æ–¹æ³•ï¼Œç±»çš„ç»“æ„ä½“ä¹Ÿå°±åªæœ‰ä¸€ä¸ªï¼Œå°±å¯ä»¥éšæ„æ›´æ”¹ã€‚</p>
<p><strong>é‚£ä¹ˆä¸ºä»€ä¹ˆå¯ä»¥æ·»åŠ å±æ€§å‘¢ï¼Ÿ</strong> åªæ·»åŠ å±æ€§ä¸æ·»åŠ å®ä¾‹å˜é‡ï¼Œæ¯«æ— æ„ä¹‰ã€‚æ­£æ˜¯å› ä¸º<strong>å…³è”å¯¹è±¡</strong>çš„å¼•å…¥ï¼Œä½¿å¾—è¿™ä¸ªåšæ³•æœ‰æ„ä¹‰èµ·æ¥ã€‚å› ä¸º<strong>å…³è”å¯¹è±¡çš„ä½œç”¨å’Œå®ä¾‹å˜é‡ç›¸ä¼¼</strong>ã€‚</p>
<h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>å…³è”å¯¹è±¡ç›¸å…³çš„æºç å…¨éƒ¨æ”¾åœ¨<code>objc-reference.h</code> å’Œ <code>objc-reference.mm</code> ä¸¤ä¸ªæ–‡ä»¶ä¸­ã€‚</p>
<p><strong>å…³è”å¯¹è±¡å’Œå¯¹è±¡æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œè€Œä¸æ˜¯å’Œç±»ä¸€ä¸€å¯¹åº”çš„</strong></p>
<ol>
<li>æ‰€æœ‰çš„å…³è”å¯¹è±¡éƒ½ç”±ä¸€ä¸ª<strong>AssociationsManager</strong>å¯¹è±¡æ¥ç®¡ç†ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œé¢æœ‰ä¸€ä¸ª<strong>AssociationsHashMap</strong>ã€‚</li>
<li><strong>AssociationsHashMap</strong>ç”±è®¸å¤škey-valueæ„æˆã€‚keyæ˜¯å¯¹è±¡çš„åœ°å€ï¼›valueæ˜¯ä¸€ä¸ª<strong>ObjectAssociationMap</strong>ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„å…³è”å¯¹è±¡ã€‚</li>
<li><strong>ObjectAssociationMap</strong>å°±æ˜¯å…³è”å¯¹è±¡ï¼Œæ¯ä¸ªå…³è”å¯¹è±¡é‡Œé¢åŒ…å«å¤šä¸ªkey-valueå¯¹ã€‚keyæ˜¯å±æ€§åï¼›valueæ˜¯<strong>ObjcAssociation</strong>ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºå±æ€§å¯¹åº”çš„å®ä¾‹å˜é‡ã€‚</li>
<li><strong>ObjcAssociation</strong>ç›¸å½“äºå®ä¾‹å˜é‡ï¼Œè¯¥ç»“æ„ä½“æœ‰ä¸¤ä¸ªæˆå‘˜ï¼š<strong>_policy</strong> å±æ€§çš„å†…å­˜ç®¡ç†è¯­ä¹‰ï¼›<strong>_value</strong> å±æ€§çš„å€¼</li>
</ol>
<p><img src="/lionheart/1706/association.png" alt="association"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li>categoryå¯ä»¥ç»™æ—¢æœ‰ç±»æ·»åŠ å±æ€§ã€æ–¹æ³•ã€åè®®ï¼Œä½†æ˜¯ä¸èƒ½æ·»åŠ å®ä¾‹å˜é‡</li>
<li>æ·»åŠ å±æ€§å¯¹åº”çš„å®ä¾‹å˜é‡å¯ä»¥ä½¿ç”¨å…³è”å¯¹è±¡æ¥å®ç°</li>
<li>categoryé‡Œé¢çš„æ–¹æ³•ä¸ä¼šè¦†ç›–åŸæœ‰çš„åŒåæ–¹æ³•ï¼Œåªæ˜¯ä¼šè¢«æå‰æ£€ç´¢åˆ°ã€‚æ‰€ä»¥æ„Ÿå®˜ä¸Šè§‰å¾—è¢«è¦†ç›–æ‰äº†</li>
<li>å¯¹äºç³»ç»Ÿè‡ªå¸¦çš„ç±»ï¼Œåœ¨runtimeæ—¶æ‰ä¼šåŠ è½½categoryï¼›ä½†æ˜¯è‡ªå®šä¹‰ç±»çš„åˆ†ç±»åœ¨ç¼–è¯‘æœŸå°±å·²ç»å…¨éƒ¨åŠ è½½äº†ï¼Œå°±åƒä¸å­˜åœ¨åˆ†ç±»ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªå¤§å¤§çš„è‡ªå®šä¹‰ç±»ä¸€æ ·ã€‚</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://www.jianshu.com/p/de95ff8230bd" target="_blank" rel="external">Runtimeæºç  â€”â€” Associated Object</a></li>
<li><a href="http://tech.meituan.com/DiveIntoCategory.html" target="_blank" rel="external">æ·±å…¥ç†è§£Objective-Cï¼šCategory</a></li>
<li><a href="http://www.jianshu.com/p/7ff34885999f" target="_blank" rel="external">Runtimeæºç  â€”â€” å…³äºcategoryçš„ä¸€ä¸ªé—®é¢˜</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Objective-C runtime - å±æ€§ä¸æ–¹æ³•]]></title>
      <url>/2017/06/05/objective-c-runtime-property-method/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç³»åˆ—ç¬¬äºŒç¯‡ï¼šæ·±å…¥åˆ†æOCä¸­çš„å±æ€§ä¸æ–¹æ³•çš„æœ¬è´¨ã€‚é€šè¿‡ä¸Šä¸€ç¯‡<a href="http://vanney9.com/2017/06/03/objective-c-runtime-class-object/" target="_blank" rel="external">Objective-C runtime - ç±»å’Œå¯¹è±¡</a>ï¼Œæˆ‘ä»¬äº†è§£äº†objc_classä¸­çš„ <strong>isa</strong> æˆå‘˜å˜é‡ï¼›åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œåˆ™ä¼šè¯¦ç»†ä»‹ç»objc_classçš„å¦ä¸€æˆå‘˜å˜é‡ <strong>bits</strong>ã€‚</p>
<a id="more"></a>
<h2 id="bits"><a href="#bits" class="headerlink" title="bits"></a>bits</h2><p>å…ˆå›å¿†ä¸€ä¸‹objc_classçš„ç»“æ„</p>
<p><img src="/lionheart/1706/bits.png" alt="objc_class"></p>
<p><code>bits</code> ç”¨æ¥å­˜å‚¨ç±»çš„å±æ€§ï¼Œæ–¹æ³•ï¼Œåè®®ç­‰ä¿¡æ¯ã€‚å®ƒæ˜¯ä¸€ä¸ª<code>class_data_bits_t</code>ç±»å‹</p>
<h3 id="class-data-bits-t"><a href="#class-data-bits-t" class="headerlink" title="class_data_bits_t"></a>class_data_bits_t</h3><pre><code class="c++">struct class_data_bits_t {
    uintptr_t bits;
    // method here
}
</code></pre>
<p>è¿™ä¸ªç»“æ„ä½“åªæœ‰ä¸€ä¸ª64bitçš„æˆå‘˜å˜é‡<code>bits</code>ï¼Œå…ˆæ¥çœ‹çœ‹è¿™64bitåˆ†åˆ«å­˜æ”¾çš„ä»€ä¹ˆä¿¡æ¯ï¼š</p>
<p><img src="/lionheart/1706/class_bits.png" alt="class_data_bits_t"></p>
<p><code>is_swift</code> : ç¬¬ä¸€ä¸ªbitï¼Œåˆ¤æ–­ç±»æ˜¯å¦æ˜¯Swiftç±»</p>
<p><code>has_default_rr</code> ï¼šç¬¬äºŒä¸ªbitï¼Œåˆ¤æ–­å½“å‰ç±»æˆ–è€…çˆ¶ç±»å«æœ‰é»˜è®¤çš„<code>retain/release/autorelease/retainCount/_tryRetain/_isDeallocating/retainWeakReference/allowsWeakReference</code> æ–¹æ³•</p>
<p><code>require_raw_isa</code> ï¼šç¬¬ä¸‰ä¸ªbitï¼Œ åˆ¤æ–­å½“å‰ç±»çš„å®ä¾‹æ˜¯å¦éœ€è¦raw_isa (ä¸æ˜¯å¾ˆæ‡‚)</p>
<p><code>data</code> ï¼šç¬¬4-48ä½ï¼Œå­˜æ”¾ä¸€ä¸ªæŒ‡å‘class_rw_tç»“æ„ä½“çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„ä½“åŒ…å«äº†è¯¥ç±»çš„å±æ€§ï¼Œæ–¹æ³•ï¼Œåè®®ç­‰ä¿¡æ¯ã€‚è‡³äºä¸ºä½•åªç”¨44bitæ¥å­˜æ”¾åœ°å€ï¼Œå¯ä»¥å‚è€ƒ<a href="http://vanney9.com/2017/06/03/objective-c-runtime-class-object/" target="_blank" rel="external">Objective-C runtime - ç±»å’Œå¯¹è±¡</a></p>
<h3 id="class-rw-t-å’Œ-class-ro-t"><a href="#class-rw-t-å’Œ-class-ro-t" class="headerlink" title="class_rw_t å’Œ class_ro_t"></a>class_rw_t å’Œ class_ro_t</h3><p>å…ˆæ¥çœ‹çœ‹ä¸¤ä¸ªç»“æ„ä½“çš„å†…éƒ¨æˆå‘˜å˜é‡</p>
<pre><code class="c++">struct class_rw_t {
    uint32_t flags;
    uint32_t version;

    const class_ro_t *ro;

    method_array_t methods;
    property_array_t properties;
    protocol_array_t protocols;

    Class firstSubclass;
    Class nextSiblingClass;
};

struct class_ro_t {
    uint32_t flags;
    uint32_t instanceStart;
    uint32_t instanceSize;
    uint32_t reserved;

    const uint8_t * ivarLayout;

    const char * name;
    method_list_t * baseMethodList;
    protocol_list_t * baseProtocols;
    const ivar_list_t * ivars;

    const uint8_t * weakIvarLayout;
    property_list_t *baseProperties;
};
</code></pre>
<p>å¯ä»¥çœ‹å‡ºï¼Œclass_rw_tç»“æ„ä½“å†…æœ‰ä¸€ä¸ªæŒ‡å‘class_ro_tç»“æ„ä½“çš„æŒ‡é’ˆã€‚</p>
<p>æ¯ä¸ªç±»éƒ½å¯¹åº”æœ‰ä¸€ä¸ªclass_ro_tç»“æ„ä½“å’Œä¸€ä¸ªclass_rw_tç»“æ„ä½“ã€‚åœ¨ç¼–è¯‘æœŸé—´ï¼Œclass_ro_tç»“æ„ä½“å°±å·²ç»ç¡®å®šï¼Œobjc_classä¸­çš„bitsçš„dataéƒ¨åˆ†å­˜æ”¾ç€è¯¥ç»“æ„ä½“çš„åœ°å€ã€‚åœ¨runtimeè¿è¡Œä¹‹åï¼Œå…·ä½“è¯´æ¥æ˜¯åœ¨è¿è¡Œruntimeçš„<code>realizeClass</code> æ–¹æ³•æ—¶ï¼Œä¼šç”Ÿæˆclass_rw_tç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“åŒ…å«äº†class_ro_tï¼Œå¹¶ä¸”æ›´æ–°dataéƒ¨åˆ†ï¼Œæ¢æˆclass_rw_tç»“æ„ä½“çš„åœ°å€ã€‚</p>
<p>ç”¨ä¸¤å¼ å›¾æ¥è¯´æ˜è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<p>ç±»çš„<code>realizeClass</code>è¿è¡Œä¹‹å‰ï¼š</p>
<p><img src="/lionheart/1706/before_bits.png" alt="before runtime"></p>
<p>ç±»çš„<code>realizeClass</code>è¿è¡Œä¹‹åï¼š</p>
<p><img src="/lionheart/1706/after_bits.png" alt="before runtime"></p>
<p>ç»†çœ‹ä¸¤ä¸ªç»“æ„ä½“çš„æˆå‘˜å˜é‡ä¼šå‘ç°å¾ˆå¤šç›¸åŒçš„åœ°æ–¹ï¼Œä»–ä»¬éƒ½å­˜æ”¾ç€å½“å‰ç±»çš„å±æ€§ã€å®ä¾‹å˜é‡ã€æ–¹æ³•ã€åè®®ç­‰ç­‰ã€‚åŒºåˆ«åœ¨äºï¼šclass_ro_tå­˜æ”¾çš„æ˜¯ç¼–è¯‘æœŸé—´å°±ç¡®å®šçš„ï¼›è€Œclass_rw_tæ˜¯åœ¨runtimeæ—¶æ‰ç¡®å®šï¼Œå®ƒä¼šå…ˆå°†class_ro_tçš„å†…å®¹æ‹·è´è¿‡å»ï¼Œç„¶åå†å°†å½“å‰ç±»çš„åˆ†ç±»çš„è¿™äº›å±æ€§ã€æ–¹æ³•ç­‰æ‹·è´åˆ°å…¶ä¸­ã€‚æ‰€ä»¥å¯ä»¥è¯´class_rw_tæ˜¯class_ro_tçš„è¶…é›†ï¼Œ<strong>å½“ç„¶å®é™…è®¿é—®ç±»çš„æ–¹æ³•ã€å±æ€§ç­‰ä¹Ÿéƒ½æ˜¯è®¿é—®çš„class_rw_tä¸­çš„å†…å®¹</strong></p>
<h2 id="å±æ€§å’Œå®ä¾‹å˜é‡"><a href="#å±æ€§å’Œå®ä¾‹å˜é‡" class="headerlink" title="å±æ€§å’Œå®ä¾‹å˜é‡"></a>å±æ€§å’Œå®ä¾‹å˜é‡</h2><p>ç°åœ¨çŸ¥é“äº†å±æ€§(<strong>property</strong>)å­˜æ”¾åœ¨class_rw_tä¸­ï¼Œå®ä¾‹å˜é‡(<strong>ivar</strong>)å­˜æ”¾åœ¨class_ro_tä¸­ã€‚ä¸‹é¢æ¥çœ‹çœ‹ä»–ä»¬çš„çœŸå®é¢ç›®ã€‚</p>
<p>å…ˆçœ‹ä¸€æ®µä»£ç ï¼š</p>
<pre><code class="objective-c">@interface TestOBJ : NSObject {
      NSInteger ivarInt;
}
@property (nonatomic, assign) NSInteger propertyInt;
</code></pre>
<p>è¿™ä¸ªTestOBJç±»æœ‰ä¸€ä¸ªå®ä¾‹å˜é‡<code>ivarInt</code> å’Œ ä¸€ä¸ªå±æ€§<code>propertyInt</code> ã€‚ä½¿ç”¨lldbæ‰“å°å‡ºclass_ro_tçš„ivarsï¼š</p>
<p><img src="/lionheart/1706/ivars.png" alt="ivars list"></p>
<p>å†ä½¿ç”¨lldbæ‰“å°å‡ºclass_ro_tçš„baseProperties:</p>
<p><img src="/lionheart/1706/properties.png" alt="properties list"></p>
<p>é¡ºä¾¿ä¹ŸæŠŠclass_ro_tçš„baseMethodListæ‰“å°å‡ºæ¥å§ï¼š</p>
<p><img src="/lionheart/1706/methods.png" alt="methods list"></p>
<p>ä»ä¸Šé¢ä¸‰å¼ lldbçš„ç»“æœå¯ä»¥çœ‹å‡ºï¼š<strong>TestOBJç±»å«æœ‰2ä¸ªå®ä¾‹å˜é‡ï¼Œ1ä¸ªå±æ€§å’Œ2ä¸ªæ–¹æ³•</strong>ã€‚ä½†æ˜¯ä»£ç é‡Œåªæœ‰ä¸€ä¸ªå®ä¾‹å˜é‡ä¸€ä¸ªå±æ€§å’Œ0ä¸ªæ–¹æ³•ã€‚åŸå› å°±æ˜¯å£°æ˜ä¸€ä¸ªå±æ€§çš„åŒæ—¶ï¼Œä¼šåŒæ—¶ç”Ÿæˆä¸€ä¸ªå®ä¾‹å˜é‡å’Œè¯¥å®ä¾‹å˜é‡çš„å­˜å–æ–¹æ³•ã€‚</p>
<p>ä»¥<code>propertyInt</code>ä¸ºä¾‹ï¼šç”Ÿæˆäº† <code>_propertyInt</code> å®ä¾‹å˜é‡å’Œ <code>- (NSInteger)propertyInt;</code> ä»¥åŠ <code>- (void)setPropertyInt:(NSInteger)propertyInt</code> ä¸¤ä¸ªå­˜å–æ–¹æ³•</p>
<h3 id="property-t"><a href="#property-t" class="headerlink" title="property_t"></a>property_t</h3><p><em>class_ro_t</em>ä¸­<em>çš„baseProperties</em>æ˜¯ä¸€ä¸ªå­˜æ”¾<em>property_t</em>ç»“æ„ä½“çš„listã€‚<strong>property_t</strong>ç»“æ„ä½“ç”¨æ¥å­˜æ”¾å±æ€§çš„ä¿¡æ¯</p>
<pre><code class="c++">struct property_t {
    const char *name;
    const char *attributes;
};
</code></pre>
<p>è¯¥ç»“æ„ä½“ä¿å­˜äº†å±æ€§çš„åå­—å’Œtype encodingã€‚</p>
<h3 id="ivar-t"><a href="#ivar-t" class="headerlink" title="ivar_t"></a>ivar_t</h3><p>å…¶å®åˆ°è¿™é‡Œä½ å°±ä¼šå‘ç°<em>property_t</em>ç»“æ„ä½“ä¸­å­˜æ”¾çš„ä¿¡æ¯æ²¡å•¥ç”¨ï¼ŒçœŸæ­£æœ‰ç”¨çš„è¿˜æ˜¯å­˜æ”¾å®ä¾‹å˜é‡çš„ç»“æ„ä½“<strong>ivar_t</strong></p>
<pre><code class="c++">struct ivar_t {
    int32_t *offset;
    const char *name;
    const char *type;
    // alignment is sometimes -1; use alignment() instead
    uint32_t alignment_raw;
    uint32_t size;

    uint32_t alignment() const {
        if (alignment_raw == ~(uint32_t)0) return 1U &lt;&lt; WORD_SHIFT;
        return 1 &lt;&lt; alignment_raw;
    }
};
</code></pre>
<p>ä»¥<em>TestOBJ</em>ä¸­çš„ <strong>ivarInt</strong> å®ä¾‹å˜é‡ä¸ºä¾‹æ¥è¯´æ˜ï¼Œå…ˆä½¿ç”¨lldbæ‰“å°è¯¥å®ä¾‹å˜é‡çš„è¯¦ç»†ä¿¡æ¯ï¼š</p>
<p><img src="/lionheart/1706/ivar_t.png" alt="ivar_t"></p>
<p><code>name</code> : <strong>å®ä¾‹å˜é‡çš„åå­—</strong> -&gt; ivarInt</p>
<p><code>type</code> : <strong>å®ä¾‹å˜é‡çš„ç±»å‹ï¼Œtype encoding</strong> -&gt; q è¡¨ç¤ºintç±»å‹ </p>
<p><code>size</code> : <strong>å®ä¾‹å˜é‡çš„å†…å­˜å¤§å°</strong> -&gt; 8 å› ä¸ºNSIntegerç±»å‹å 8ä¸ªå­—èŠ‚</p>
<p><code>offset</code> : <strong>å®ä¾‹å˜é‡è·ç¦»å¯¹è±¡çš„é¦–åœ°å€çš„åç§»é‡</strong> -&gt; offsetæ˜¯ä¸€ä¸ªæŒ‡å‘intçš„æŒ‡é’ˆï¼Œå–å‡ºoffsetæŒ‡å‘çš„intï¼Œå‘ç°åç§»é‡ä¸º8</p>
<p>ä¸Šå›¾è¿˜æ‰“å°äº†class_ro_tï¼Œé‡Œé¢æœ‰2ä¸ªå˜é‡éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼š</p>
<p><code>instanceStart</code> : <strong>å¯¹è±¡å¼€å§‹å­˜æ”¾å®ä¾‹å˜é‡çš„åœ°å€çš„åç§»é‡</strong> -&gt; 8 å› ä¸ºå¯¹è±¡çš„å‰8å­—èŠ‚å­˜æ”¾çš„æ˜¯<code>isa_t</code>ç»“æ„ä½“</p>
<p><code>instanceSize</code> : <strong>å¯¹è±¡çš„å¤§å°</strong> -&gt; 24 = isa_t + ivarInt + _propertyInt</p>
<p><strong>æ‰€ä»¥ï¼šè·å–TestOBJå®ä¾‹açš„ivarIntçš„è¿‡ç¨‹ï¼šå–å‡º å¯¹è±¡é¦–åœ°å€åŠ ivarIntçš„åç§»é‡ çš„å†…å­˜ç©ºé—´çš„int</strong></p>
<p><img src="/lionheart/1706/get_ivar.png" alt="get ivar"></p>
<h3 id="ç±»ç»§æ‰¿å…³ç³»ä¸­çš„å¯¹è±¡çš„å†…å­˜ç©ºé—´ç»“æ„"><a href="#ç±»ç»§æ‰¿å…³ç³»ä¸­çš„å¯¹è±¡çš„å†…å­˜ç©ºé—´ç»“æ„" class="headerlink" title="ç±»ç»§æ‰¿å…³ç³»ä¸­çš„å¯¹è±¡çš„å†…å­˜ç©ºé—´ç»“æ„"></a>ç±»ç»§æ‰¿å…³ç³»ä¸­çš„å¯¹è±¡çš„å†…å­˜ç©ºé—´ç»“æ„</h3><p>å…ˆçœ‹çœ‹æ²¡æœ‰ç»§æ‰¿å…³ç³»çš„ç±» TestOBJï¼š</p>
<p><img src="/lionheart/1706/testObj.png" alt="testObj"></p>
<p>å†çœ‹çœ‹ç»§æ‰¿TestOBJçš„Sonç±»ï¼š</p>
<pre><code class="objective-c">@interface Son : TestOBJ
@property (nonatomic, strong) NSString *sonStr
@end
</code></pre>
<p>å®ƒçš„å¯¹è±¡æ—¢å­˜å‚¨äº†TestOBJçš„å®ä¾‹å˜é‡ï¼Œä¹Ÿå­˜æ”¾äº†Sonè‡ªå·±çš„å®ä¾‹å˜é‡</p>
<p><img src="/lionheart/1706/son.png" alt="son"></p>
<p>ä½¿ç”¨lldbæ‰“å°sonçš„class_ro_t:</p>
<p><img src="/lionheart/1706/super.png" alt="super"></p>
<p>å¯ä»¥å‘ç°Sonç±»çš„ <code>instanceStart</code> ä¸º24ï¼Œå› ä¸ºSonçš„å®ä¾‹çš„å‰8å­—èŠ‚å­˜æ”¾isaï¼Œåé¢16å­—èŠ‚å­˜æ”¾çˆ¶ç±»çš„ivarIntå’Œ_propertyIntä¸¤ä¸ªNSIntegerå‹å®ä¾‹å˜é‡ã€‚Sonç±»çš„ <code>instanceSize</code>ä¸º32å­—èŠ‚ï¼Œå› ä¸ºä»–è¿˜æœ‰è‡ªå·±çš„ä¸€ä¸ªæŒ‡å‘NSStringç»“æ„ä½“çš„æŒ‡é’ˆ <strong>_sonStr</strong> ï¼Œè¿™ä¸ªæŒ‡é’ˆä¹Ÿå 8å­—èŠ‚ã€‚</p>
<p>å¦å¤–<strong>_sonStr</strong> è¿™ä¸€ä¸ªivar_tçš„offsetæ˜¯24ï¼Œä¹Ÿç¬¦åˆåˆ†æ</p>
<p>æ³¨æ„Sonç±»çš„class_ro_tåœ¨<code>realizeClass</code>æ–¹æ³•å®Œæˆåå°±ç¡®å®šä¸‹æ¥äº†</p>
<h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p>ç¼–è¯‘ç»“æŸä¹‹åï¼Œç±»çš„æ–¹æ³•å°±å·²ç»å­˜å‚¨åœ¨class_ro_té‡Œé¢çš„baseMethodListå˜é‡ä¸­äº†ï¼›å½“è¿è¡Œå®Œruntimeçš„<code>realizeClass</code>æ–¹æ³•ä¹‹åï¼Œä¼šå°†baseMethodListæ‹·è´åˆ°class_rw_tçš„<code>methods</code>å˜é‡ä¸­ï¼Œå¹¶å°†å„ç§åˆ†ç±»çš„æ–¹æ³•æ‹·è´åˆ°<code>methods</code>ä¸­ã€‚<strong>è¿™æ ·ç±»çš„æ‰€æœ‰æ–¹æ³•å°±éƒ½èšé›†åœ¨class_rw_tçš„methodså˜é‡ä¸­äº†ã€‚</strong></p>
<p>ä½¿ç”¨lldbæ‰“å°å‡ºclass_rw_tä¸­çš„methods:</p>
<p><img src="/lionheart/1706/realmethods.png" alt="methods"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„<code>methods</code>å’Œä¸Šé¢æ‰“å°å‡ºæ¥çš„class_ro_tä¸­çš„<code>baseMethodList</code>ä¸€æ¨¡ä¸€æ ·ã€‚è¿™æ˜¯å› ä¸ºè¿™ä¸ªç±»æ²¡æœ‰åˆ†ç±»ï¼Œåªæ˜¯ç®€å•çš„å°†baseMethodListçš„å†…å®¹æ‹·è´è¿‡å»ã€‚</p>
<h3 id="method-t"><a href="#method-t" class="headerlink" title="method_t"></a>method_t</h3><p>runtimeä½¿ç”¨<code>method_t</code>ç»“æ„ä½“æ¥å­˜æ”¾æ–¹æ³•ï¼š</p>
<pre><code class="c++">struct method_t {
    SEL name;
    const char *types;
    IMP imp;

    struct SortBySELAddress :
        public std::binary_function&lt;const method_t&amp;,
                                    const method_t&amp;, bool&gt;
    {
        bool operator() (const method_t&amp; lhs,
                         const method_t&amp; rhs)
        { return lhs.name &lt; rhs.name; }
    };
};
</code></pre>
<p><code>name</code> : æ–¹æ³•åï¼Œç±»å‹ä¸º<code>SEL</code>é€‰æ‹©å­ï¼Œå¯ä»¥ç®€å•åœ°ç†è§£æˆæ–¹æ³•çš„idï¼Œå­—ç¬¦ä¸²ç±»å‹</p>
<p><code>types</code> : æ–¹æ³•çš„type encoding</p>
<p><code>imp</code> : æ–¹æ³•çš„å®ç°ï¼Œç±»å‹ä¸º<code>IMP</code>ã€‚IMPæ˜¯å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘æ–¹æ³•çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘å®ç°è¯¥æ–¹æ³•çš„ä»£ç åŒº</p>
<h2 id="åº•å±‚å­˜å‚¨æ–¹å¼"><a href="#åº•å±‚å­˜å‚¨æ–¹å¼" class="headerlink" title="åº•å±‚å­˜å‚¨æ–¹å¼"></a>åº•å±‚å­˜å‚¨æ–¹å¼</h2><pre><code class="c++">struct class_rw_t {
    uint32_t flags;
    uint32_t version;

    const class_ro_t *ro;

    method_array_t methods;
    property_array_t properties;
    protocol_array_t protocols;

    Class firstSubclass;
    Class nextSiblingClass;
};

struct class_ro_t {
    uint32_t flags;
    uint32_t instanceStart;
    uint32_t instanceSize;
    uint32_t reserved;

    const uint8_t * ivarLayout;

    const char * name;
    method_list_t * baseMethodList;
    protocol_list_t * baseProtocols;
    const ivar_list_t * ivars;

    const uint8_t * weakIvarLayout;
    property_list_t *baseProperties;
};
</code></pre>
<p>class_ro_té‡Œé¢çš„<code>method_list_t</code> å’Œ <code>ivar_list_t</code> éƒ½æ˜¯ <code>entsize_list_tt</code> çš„ç»“æ„ä½“ï¼›class_rw_té‡Œé¢çš„ <code>method_array_t</code> å’Œ <code>property_array_t</code> éƒ½æ˜¯ <code>list_array_tt</code> çš„ç»“æ„ä½“ã€‚æ¥çœ‹çœ‹è¿™ä¸ªåº•å±‚å­˜å‚¨æ–¹å¼</p>
<h3 id="entsize-list-tt"><a href="#entsize-list-tt" class="headerlink" title="entsize_list_tt"></a>entsize_list_tt</h3><pre><code class="c++">template &lt;typename Element, typename List, uint32_t FlagMask&gt;
struct entsize_list_tt {
    uint32_t entsizeAndFlags;
    uint32_t count;
    Element first;
      // other code
}
</code></pre>
<p>ä¸€ä¸ªå­˜å‚¨Elementçš„åºåˆ—ï¼Œå¯ä»¥ä½¿ç”¨<code>get(index)</code>æ–¹æ³•è·å–ç‰¹å®šindexçš„Elementï¼›å®ƒä¹Ÿæä¾›äº†iteratoréå†å™¨ï¼Œå…·ä½“å®ç°ç»†èŠ‚å¯ä»¥æŸ¥çœ‹ä»£ç ã€‚<code>objc-runtime-new.h</code></p>
<h3 id="list-array-tt"><a href="#list-array-tt" class="headerlink" title="list_array_tt"></a>list_array_tt</h3><pre><code class="c++">template &lt;typename Element, typename List&gt;
class list_array_tt {
    private:
    union {
        List* list;
        uintptr_t arrayAndFlag;
    };
}
</code></pre>
<p>ç®€å•æ¥è¯´æ˜¯ä¸€ä¸ªå­˜æ”¾<code>entsize_list_tt</code>çš„æ•°ç»„ã€‚ä¹Ÿæä¾›äº†iteratoréå†å™¨ã€‚ä¹Ÿå®šä¹‰åœ¨<code>objc-runtime-new.h</code></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å…¶å®è¿™ç¯‡æ–‡ç« å°±æ˜¯ğŸ‘‡ä¸¤ç¯‡å‚è€ƒæ–‡ç« çš„ä¸€ä¸ªåˆä½“ã€‚æ€»ç»“æ¥è¯´ï¼šobjc_classç»“æ„ä½“ä¸­çš„bitsæˆå‘˜å˜é‡å­˜æ”¾ç€ç±»çš„å±æ€§ã€æ–¹æ³•ã€åè®®ç­‰ä¿¡æ¯ã€‚è¿™ä¸€äº›ä¿¡æ¯ï¼Œæœ‰çš„æ˜¯åœ¨ç¼–è¯‘æœŸé—´å°±ç¡®å®šçš„ï¼›å¦å¤–ä¸€äº›åˆ™æ˜¯åœ¨è¿è¡Œruntimeçš„<code>realizeClass</code>çš„æ–¹æ³•æ—¶æ·»åŠ ä¸Šå»çš„ã€‚</p>
<p>é‚£ä¹ˆå½“runtimeå°†ç±»åˆå§‹åŒ–ä¹‹åï¼Œæ‰€æœ‰çš„ç±»æ‰€éœ€çš„ä¿¡æ¯éƒ½å­˜æ”¾åœ¨äº†<strong>class_rw_t</strong>ç»“æ„ä½“ä¸­</p>
<h2 id="fixme"><a href="#fixme" class="headerlink" title="fixme"></a>fixme</h2><p><strong>åœ¨è¿™é‡Œåšä¸ªæ›´æ­£ï¼š</strong>åœ¨<code>realizeClass</code>æ–¹æ³•ä¸­ï¼Œå¹¶ä¸æ˜¯å°†<code>class_ro_t</code>ä¸­çš„å±æ€§ã€æ–¹æ³•çš„listæ‹·è´åˆ°<code>class_rw_t</code>ä¸­ï¼›è€Œåªæ˜¯é€šè¿‡<code>class_rw_t</code>æ¥æ“ä½œ<code>class_ro_t</code>ä¸­çš„å„ç§listã€‚<code>class_rw_t</code>ä¸­çš„<code>list_array_tt</code> æœ‰æŒ‡å‘ <code>class_ro_t</code>ä¸­çš„ <code>entsize_list_tt</code> çš„æŒ‡é’ˆã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://www.jianshu.com/p/89ac27684693" target="_blank" rel="external">Runtimeæºç  â€”â€” propertyå’Œivar</a></li>
<li><a href="http://draveness.me/method-struct.html" target="_blank" rel="external">æ·±å…¥è§£æ ObjC ä¸­æ–¹æ³•çš„ç»“æ„</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Objective-C runtime - ç±»å’Œå¯¹è±¡]]></title>
      <url>/2017/06/03/objective-c-runtime-class-object/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>OCæ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œè¿™ç¯‡æ–‡ç« å…ˆæ¥çœ‹çœ‹OCçš„ç±»å’Œå¯¹è±¡(<strong>Class &amp;&amp; Object</strong>)</p>
<a id="more"></a>
<h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><ol>
<li>OCä¸­çš„å¯¹è±¡æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>objc_object</strong>ç»“æ„ä½“</li>
<li>OCä¸­çš„ç±»æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>objc_class</strong>ç»“æ„ä½“</li>
<li><strong>id</strong>ï¼šæŒ‡å‘objc_objectçš„ç»“æ„ä½“æŒ‡é’ˆ</li>
<li><strong>Class</strong>ï¼šæŒ‡å‘objc_classçš„ç»“æ„ä½“æŒ‡é’ˆ</li>
</ol>
<h3 id="objc-class-å’Œ-objc-object"><a href="#objc-class-å’Œ-objc-object" class="headerlink" title="objc_class å’Œ objc_object"></a>objc_class å’Œ objc_object</h3><p>å…ˆæ¥çœ‹çœ‹ä¸¤ä¸ªç»“æ„ä½“çš„ç»“æ„ï¼ˆå…ˆåªè€ƒè™‘ç»“æ„ä½“çš„æˆå‘˜å˜é‡ï¼Œä¸è€ƒè™‘å®ƒçš„æˆå‘˜å‡½æ•°ï¼‰</p>
<pre><code class="c++">struct objc_object {
private:
    isa_t isa;
public:
    // function here
}

struct objc_class : objc_object {
    Class superclass;
    cache_t cache;             // formerly cache pointer and vtable
    class_data_bits_t bits;
      // method here
}
</code></pre>
<p><strong>objc_object</strong> å®šä¹‰åœ¨ <code>objc-private.h</code> é‡Œé¢ï¼Œè¯¥ç»“æ„ä½“åªåŒ…å«ä¸€ä¸ªå«åš isa çš„isa_tç±»å‹çš„å˜é‡</p>
<p><strong>objc_class</strong> å®šä¹‰åœ¨ <code>objc-runtime-new.h</code> é‡Œé¢ï¼Œå®ƒç»§æ‰¿è‡ªobjc_objectï¼Œæ‰€ä»¥é™¤äº†isaæˆå‘˜å˜é‡ä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ï¼š</p>
<ol>
<li>æŒ‡å‘å¦ä¸€ä¸ªobjc_classç»“æ„ä½“çš„æŒ‡é’ˆ <strong>super_class</strong>ï¼›è¿™ä¸€ä¸ªobjc_classåŒ…å«äº†çˆ¶ç±»çš„ä¿¡æ¯</li>
<li>ä¸€ä¸ªåŒ…å«å‡½æ•°ç¼“å­˜çš„cache_tç±»å‹å˜é‡ <strong>cache</strong></li>
<li>ä¸€ä¸ªåŒ…å«ç±»çš„æ–¹æ³•ï¼Œå±æ€§ç­‰ä¿¡æ¯çš„class_data_bits_tç±»å‹çš„å˜é‡ <strong>bits</strong></li>
</ol>
<p>ç¼–è¯‘ç»“æŸä¹‹åï¼ŒOCçš„æ¯ä¸ªç±»éƒ½æ˜¯ä»¥objc_classçš„ç»“æ„ä½“å½¢å¼å­˜åœ¨äºå†…å­˜ä¹‹ä¸­ï¼Œè€Œä¸”åœ¨å†…å­˜ä¸­çš„ä½ç½®å·²ç»å›ºå®šã€‚è¿è¡ŒæœŸé—´ï¼Œåˆ›å»ºæ–°çš„å¯¹è±¡çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯åˆ›å»ºobjc_objectçš„ç»“æ„ä½“</p>
<h3 id="isa"><a href="#isa" class="headerlink" title="isa"></a>isa</h3><p>æˆå‘˜å˜é‡isaåŒ…å«äº†è¯¥å¯¹è±¡ï¼Œæˆ–è€…è¯¥ç±»çš„ä¿¡æ¯ã€‚isaå˜é‡çš„ç±»å‹æ˜¯<strong>isa_t</strong>ï¼Œå®šä¹‰åœ¨<code>objc_private.h</code></p>
<pre><code class="c++">union isa_t 
{
    Class cls;
    uintptr_t bits;

#   define ISA_MASK        0x00007ffffffffff8ULL
#   define ISA_MAGIC_MASK  0x001f800000000001ULL
#   define ISA_MAGIC_VALUE 0x001d800000000001ULL
    struct {
        uintptr_t nonpointer        : 1;
        uintptr_t has_assoc         : 1;
        uintptr_t has_cxx_dtor      : 1;
        uintptr_t shiftcls          : 44; // MACH_VM_MAX_ADDRESS 0x7fffffe00000
        uintptr_t magic             : 6;
        uintptr_t weakly_referenced : 1;
        uintptr_t deallocating      : 1;
        uintptr_t has_sidetable_rc  : 1;
        uintptr_t extra_rc          : 8;
#       define RC_ONE   (1ULL&lt;&lt;56)
#       define RC_HALF  (1ULL&lt;&lt;7)
    };
}
</code></pre>
<p>ps ï¼š ä»¥ä¸Šä»£ç æ˜¯åœ¨x86_64ä¸Šçš„å®ç°ï¼ˆMacä¸Šé¢ï¼‰ï¼›iPhoneï¼ˆarm64ç­‰ï¼‰ä¸Šé¢çš„å®ç°å¤§åŒå°å¼‚ã€‚å…·ä½“å®ç°å¯ä»¥å‚è§runtimeæºç </p>
<h4 id="has-assoc"><a href="#has-assoc" class="headerlink" title="has_assoc"></a>has_assoc</h4><p>è¡¨ç¤ºè¯¥å¯¹è±¡æ˜¯å¦æœ‰å…³è”å¯¹è±¡</p>
<h4 id="has-cxx-dtor"><a href="#has-cxx-dtor" class="headerlink" title="has_cxx_dtor"></a>has_cxx_dtor</h4><p>è¡¨ç¤ºæ˜¯å¦æœ‰ææ„å‡½æ•°</p>
<h4 id="shiftcls"><a href="#shiftcls" class="headerlink" title="shiftcls"></a>shiftcls</h4><p>è¡¨ç¤ºå¯¹è±¡æ‰€å±çš„ç±»æˆ–è€…ç±»æ‰€å±çš„å…ƒç±»(meta class)çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘ä¸€ä¸ªobjc_classçš„æŒ‡é’ˆï¼Œä¸è¿‡è¯¥æŒ‡é’ˆåªæœ‰44ä½ã€‚</p>
<p>64ä½ç³»ç»Ÿçš„æŒ‡é’ˆå ç”¨64bitçš„å†…å­˜ï¼Œä½†æ˜¯ä½¿ç”¨æ•´ä¸ªæŒ‡é’ˆå¤§å°æ¥å­˜å‚¨åœ°å€æœ‰ç‚¹æµªè´¹ã€‚åœ¨macçš„64ä½ç³»ç»Ÿä¸Šé¢ï¼Œä½¿ç”¨47ä½ä½œä¸ºæŒ‡é’ˆï¼Œå…¶ä»–çš„17ä½ç”¨äºå…¶ä»–ç›®çš„ï¼ˆiPhoneä¸Šé¢åªä½¿ç”¨33ä½ï¼‰ã€‚åˆç”±äºæ‰€æœ‰å¯¹è±¡æŒ‰ç…§8å­—èŠ‚å¯¹é½ï¼Œæ‰€ä»¥æŒ‡é’ˆéƒ½æ˜¯èƒ½è¢«8æ•´é™¤çš„ï¼Œä¹Ÿå°±æ˜¯å3bitå‡ä¸º0ï¼›æ‰€ä»¥ç±»æŒ‡é’ˆçš„å®é™…æœ‰æ•ˆä½æ•°ä¸º <code>47 - 3 = 44</code> ä½ã€‚è¿™ä¹Ÿæ˜¯shiftclsåªæœ‰44ä½çš„åŸå› </p>
<h4 id="isaåˆå§‹åŒ–"><a href="#isaåˆå§‹åŒ–" class="headerlink" title="isaåˆå§‹åŒ–"></a>isaåˆå§‹åŒ–</h4><p>åœ¨åˆ›å»ºæ–°çš„objc_objectçš„æ—¶å€™ï¼Œä¼šä½¿ç”¨objc_objectçš„æˆå‘˜å‡½æ•°<code>initIsa</code>æ¥åˆå§‹åŒ–isaå˜é‡</p>
<pre><code class="c++">inline void 
objc_object::initInstanceIsa(Class cls, bool hasCxxDtor)
{
    initIsa(cls, true, hasCxxDtor);
}

inline void 
objc_object::initIsa(Class cls, bool indexed, bool hasCxxDtor) 
{ 
    if (!indexed) {
        isa.cls = cls;
    } else {
        isa.bits = ISA_MAGIC_VALUE;
        isa.has_cxx_dtor = hasCxxDtor;
        isa.shiftcls = (uintptr_t)cls &gt;&gt; 3;
    }
}
</code></pre>
<p>è¿™é‡Œçš„<strong>indexed</strong>ç”¨æ¥æ ‡è®°isaæ˜¯å¦æœ‰ç»“æ„ä½“éƒ¨åˆ†ï¼š</p>
<ol>
<li>å¦‚æœindexedä¸º0ï¼Œæ²¡æœ‰ç»“æ„ä½“éƒ¨åˆ†ï¼Œç›´æ¥å°†å¯¹è±¡æ‰€å±çš„ç±»çš„åœ°å€èµ‹äºˆclså˜é‡</li>
<li>å¦‚æœindexedä¸º1ï¼Œæœ‰ç»“æ„ä½“éƒ¨åˆ†ï¼Œå…ˆä½¿ç”¨<code>ISA_MAGIC_VALUE</code> ç»™isaè¿™ä¸ª64ä½unionåˆå§‹åŒ–ï¼Œç„¶ååœ¨å¯¹64ä½ä¸Šçš„æ¯ä¸€ä½å•ç‹¬è®¾ç½®ã€‚æ¯”å¦‚è®¾ç½®æ˜¯å¦å«æœ‰ææ„å‡½æ•°(<em>has_cxx_dtor</em>)ï¼Œè®¾ç½®å¯¹è±¡æ‰€å±ç±»çš„åœ°å€(<em>shiftcls</em>)ã€‚æ³¨æ„è¿™é‡Œè®¾ç½®ç±»åœ°å€çš„æ—¶å€™æ˜¯å°†clså³ç§»3ä½ï¼Œå†èµ‹å€¼ç»™shiftclsçš„ï¼ŒåŸå› å°±æ˜¯ç±»åœ°å€çš„æœ€å3bitæ²¡æœ‰å®é™…ä½œç”¨</li>
</ol>
<h4 id="isa-æ–¹æ³•"><a href="#isa-æ–¹æ³•" class="headerlink" title="isa()æ–¹æ³•"></a>isa()æ–¹æ³•</h4><p>è¯¥æ–¹æ³•ç”¨æ¥è·å–å¯¹è±¡æ‰€å±çš„ç±»çš„æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤ºè¯¥å¯¹è±¡æ˜¯ä¸€ä¸ªä»€ä¹ˆç±»</p>
<pre><code class="c++">inline Class 
objc_object::ISA() 
{
    return (Class)(isa.bits &amp; ISA_MASK);
}
// #define ISA_MASK 0x00007ffffffffff8ULL
</code></pre>
<p>è¿”å›çš„æ˜¯ä¸€ä¸ª64ä½çš„æŒ‡å‘objc_classç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå…¶ä¸­çš„4-47bitä¸ºshiftclsçš„å€¼ï¼Œå…¶ä»–bitéƒ½æ˜¯0</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>OCçš„å¯¹è±¡å’Œç±»åœ¨å†…å­˜ä¸­éƒ½æ˜¯ä»¥ç»“æ„ä½“çš„å½¢å¼å­˜åœ¨çš„ï¼Œç±»å¯¹åº”objc_classç»“æ„ä½“ï¼Œå¯¹è±¡å¯¹åº”objc_objectç»“æ„ä½“ã€‚</p>
<p>åœ¨åˆ›å»ºè¿™ä¸¤ç§ç»“æ„ä½“çš„è¿‡ç¨‹ä¸­éƒ½ä¼šåˆå§‹åŒ–isaå˜é‡ã€‚isaå˜é‡å­˜æ”¾ç€å¯¹è±¡æ‰€å±çš„ç±»çš„ä¿¡æ¯ï¼Œæˆ–è€…ç±»æ‰€å±çš„å…ƒç±»çš„ä¿¡æ¯ã€‚å…³äºå…ƒç±»çš„ç›¸å…³å†…å®¹ï¼Œå¯è‡ªè¡Œgoogleã€‚</p>
<p>å¦å¤–ï¼Œåœ¨åˆ›å»ºobjc_classçš„ç»“æ„ä½“çš„æ—¶å€™è¿˜ä¼šåˆå§‹åŒ–ç›¸åº”çš„cacheå’Œbitså˜é‡ï¼Œåœ¨åç»­çš„ç« èŠ‚ä¸­å°†ä¼šè¯´é“</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://draveness.me/isa.html" target="_blank" rel="external">ä» NSObject çš„åˆå§‹åŒ–äº†è§£ isa</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Objective-C runtime - ç³»åˆ—å¼€å§‹]]></title>
      <url>/2017/06/03/objective-c-runtime-summarize/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å­¦ä¹ OCçš„runtimeä¹Ÿæœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæ˜¯æ—¶å€™å†™ä¸ªruntimeçš„ç³»åˆ—æ¥åšä¸ªæ€»ç»“äº†ã€‚å¤§ä½“æŒ‰ç…§ä»¥ä¸‹å‡ ä¸ªä¸»é¢˜ï¼š</p>
<ol>
<li><a href="http://vanney9.com/2017/06/03/objective-c-runtime-class-object/" target="_blank" rel="external">Class &amp;&amp; Object</a></li>
<li><a href="http://vanney9.com/2017/06/05/objective-c-runtime-property-method/" target="_blank" rel="external">Property &amp;&amp; Method</a></li>
<li><a href="http://vanney9.com/2017/06/07/objective-c-runtime-category/" target="_blank" rel="external">Category &amp;&amp; Association Object</a></li>
<li><a href="http://vanney9.com/2017/06/08/objective-c-runtime-message/" target="_blank" rel="external">Message</a></li>
<li><a href="http://vanney9.com/2017/06/09/objective-c-runtime-api/" target="_blank" rel="external">ä¸Šå±‚API</a></li>
<li><a href="http://vanney9.com/2017/06/10/objective-c-runtime-example/" target="_blank" rel="external">runtimeåº”ç”¨ç¤ºä¾‹ &amp;&amp; å¥‡å¥‡æ€ªæ€ªçš„ä¾‹å­</a></li>
<li><a href="http://vanney9.com/2017/06/10/objective-c-runtime-other/" target="_blank" rel="external">å¦‚æœè¿˜æœ‰å…¶ä»–çš„è¯</a></li>
</ol>
<a id="more"></a>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>è¯´æ˜¯æ¦‚è¿°ï¼Œå…¶å®æ˜¯æˆ‘å­¦ä¹ runtimeçš„è¿‡ç¨‹ã€‚</p>
<ol>
<li><p>è‹¹æœå®˜æ–¹çš„<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008048-CH1-SW1" target="_blank" rel="external">runtimeæ–‡æ¡£</a>ï¼Œå¯¹runtimeæ˜¯ä»€ä¹ˆï¼Œç”¨æ¥åšä»€ä¹ˆäº†è§£ä¸ªå¤§æ¦‚</p>
</li>
<li><p>æ‹¿åˆ°äº†runtimeçš„æºç ï¼Œ<a href="http://blog.csdn.net/wotors/article/details/54426316" target="_blank" rel="external">æ®è¯´èƒ½ç¼–è¯‘æˆobjcçš„åŠ¨æ€åº“</a>ï¼Œå¹¶ä¸”æ–°å»ºä¸€ä¸ªä½¿ç”¨è‡ªå·±ç¼–è¯‘çš„runtimeçš„macçš„å·¥ç¨‹</p>
</li>
<li><p>æŒ‰åŸè®¡åˆ’ï¼Œåˆ°äº†è¿™ä¸€æ­¥å°±è¯¥è‡ªå·±å¯¹ç€runtimeçš„æºç ï¼Œä¿®ä¿®æ”¹æ”¹ï¼Œçœ‹çœ‹èƒ½å¼„å‡ºä»€ä¹ˆå¥‡æ€ªçš„æ•ˆæœã€‚ä½†æ˜¯è¿™æ‰å‘ç°ï¼Œè¦æ˜¯é‡å¤´å¼€å§‹ä¸€è¡Œä¸€è¡Œçš„çœ‹runtimeæºç ï¼Œæ˜¯å¤šä¹ˆæµ©å¤§çš„ä¸€é¡¹å·¥ç¨‹ã€‚ã€‚</p>
</li>
<li><p>æ”¹å˜ç­–ç•¥ï¼ŒæŠ“ä½runtimeçš„é‡ç‚¹ï¼Œä»åšå®¢çœ‹èµ·ï¼Œé€ä¸ªå¼„æ‡‚ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­å‘ç°äº†2ä¸ªäººçš„åšå®¢</p>
<ol>
<li><a href="http://www.jianshu.com/u/43bb8b1a9d39" target="_blank" rel="external">Haven_ZN</a></li>
<li><a href="http://draveness.me/" target="_blank" rel="external">Draveness</a></li>
</ol>
<p>è¿™ä¸¤ä½å¤§ç¥çš„åšå®¢é‡Œé¢éƒ½æœ‰ä¸€ç³»åˆ—çš„å…³äºruntimeçš„æºç çš„è¯¦è§£ï¼Œå—ç›ŠåŒªæµ…ã€‚</p>
</li>
<li><p>åœ¨ç ”ç©¶runtimeæºç çš„æ—¶å€™è¿˜éœ€è¦ä½¿ç”¨lldbè¿›è¡Œdebugï¼Œ<a href="https://objccn.io/issue-19-2/" target="_blank" rel="external">ä¸è°ƒè¯•å™¨å…±èˆ - LLDB çš„åå°”å…¹</a> è¿™ç¯‡æ–‡ç« ä»‹ç»äº†lldbçš„debugæ–¹æ³•</p>
</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008048-CH1-SW1" target="_blank" rel="external">runtimeå®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="http://blog.csdn.net/wotors/article/details/54426316" target="_blank" rel="external">objc - ç¼–è¯‘Runtimeæºç objc4-706</a></li>
<li><a href="http://draveness.me/" target="_blank" rel="external">Dravenessçš„ä¸»é¡µ</a></li>
<li><a href="http://www.jianshu.com/u/43bb8b1a9d39" target="_blank" rel="external">Haven_ZNçš„ä¸»é¡µ</a></li>
<li><a href="https://objccn.io/issue-19-2/" target="_blank" rel="external">ä¸è°ƒè¯•å™¨å…±èˆ - LLDB çš„åå°”å…¹</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Effective Objective-C - å¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ]]></title>
      <url>/2017/04/13/effective-objective-c-reading-note-six/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><strong>Effective Objective-C 2.0</strong> ç³»åˆ—è¯»ä¹¦ç¬”è®°æœ€åä¸€ç¯‡</p>
<a id="more"></a>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="ç†è§£â€œå±æ€§â€è¿™ä¸€æ¦‚å¿µ"><a href="#ç†è§£â€œå±æ€§â€è¿™ä¸€æ¦‚å¿µ" class="headerlink" title="ç†è§£â€œå±æ€§â€è¿™ä¸€æ¦‚å¿µ"></a>ç†è§£â€œå±æ€§â€è¿™ä¸€æ¦‚å¿µ</h3><ol>
<li><p>ä¸‹é¢ä¸¤éƒ¨åˆ†ä»£ç ç­‰æ•ˆ</p>
<pre><code class="objective-c">@interface EOCPerson : NSObject
@property NSString *firstName;
@end

@interface EOCPerson : NSObject {
      NSString *_firstName;
}
- (NSString *)firstName;
- (void)setFirstName:(NSString *)firstName;
@end
</code></pre>
<p>å¯ä»¥ç†è§£æˆï¼šå±æ€§ = å®ä¾‹å˜é‡ + å­˜å–æ–¹æ³•</p>
</li>
<li><p>å¯ä»¥æ”¹å˜å±æ€§ç”Ÿæˆçš„å®ä¾‹å˜é‡çš„åå­—ï¼š</p>
<pre><code class="objective-c">@implementation EOCPerson
@synthesize firstName = _myFirstName;
@end
</code></pre>
<p>å°†å®ä¾‹å˜é‡å‘½åæˆ<code>_myFirstName</code> ï¼Œä¸å†ä½¿ç”¨é»˜è®¤çš„åå­—</p>
</li>
<li><p>å½“ç„¶è¿˜å¯ä»¥ä¸è®©ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆå­˜å–æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨dynamic</p>
<pre><code class="objective-c">@implementation EOCPerson
@dynamic firstName;
@end
</code></pre>
<p>æ­¤æ—¶ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆå­˜å–æ–¹æ³•ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨åˆ›å»ºå®ä¾‹å˜é‡ã€‚åœ¨ç¼–è¯‘è®¿é—®å±æ€§çš„ä»£ç æ—¶ï¼Œä¹Ÿä¸ä¼šå‡ºé”™ï¼Œå› ä¸ºç¼–è¯‘å™¨ç›¸ä¿¡èƒ½åœ¨è¿è¡ŒæœŸæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•</p>
</li>
<li><p>å…·å¤‡<strong>readonly</strong>ç‰¹æ€§çš„å±æ€§ä»…æ‹¥æœ‰è·å–æ–¹æ³•ï¼Œåªæœ‰å½“è¯¥å±æ€§ç”±<code>@synthesize</code>å®ç°æ—¶ï¼Œç¼–è¯‘å™¨æ‰ä¼šä¸ºå…¶åˆæˆè·å–æ–¹æ³•</p>
</li>
<li><p><strong>æ‹¥æœ‰ä¸éæ‹¥æœ‰</strong> æ˜¯é’ˆå¯¹æŒ‡é’ˆä¸å†…å­˜ç©ºé—´æ¥è¯´çš„ï¼š</p>
<pre><code class="objective-c">@property (nonatomic, strong) NSString *strPointer;
</code></pre>
<p>ä¸Šé¢çš„è¯­å¥è¯´æ˜ï¼šæœ‰ä¸€ä¸ªNSStringæŒ‡é’ˆï¼Œå¦‚æœä»–æŒ‡å‘ä¸€å—å­˜æ”¾NSStringçš„å†…å­˜ï¼Œé‚£ä¹ˆstrPointeræŒ‡é’ˆæ‹¥æœ‰è¯¥å†…å­˜ã€‚è¯¥å†…å­˜çš„reference countåŠ 1</p>
</li>
<li><p><strong>copy</strong> å¯¹äºNSStringæ¥è¯´ç‰¹åˆ«æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨NSStringå’ŒNSMutableStringä¹‹é—´è½¬æ¢çš„æ—¶å€™ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œåˆå§‹åŒ–è¯¥å±æ€§ä¹Ÿè¦ä½¿ç”¨copyæ–¹æ³•</p>
<pre><code class="objective-c">- (id)initWithFirstName:(NSString *)firstName {
      if (self = [super init]) {
          _firstName = [firstName copy];
      }
      return self;
}
</code></pre>
</li>
<li><p>ä¸åº”è¯¥åœ¨initæ–¹æ³•ä¸­è°ƒç”¨å­˜å–æ–¹æ³•ã€‚</p>
</li>
<li><p>iOSä¸­çš„åŒæ­¥é”æ€§èƒ½å¼€é”€è¾ƒä¸¥é‡ï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨çš„<strong>nonatomic</strong>å±æ€§</p>
</li>
</ol>
<h3 id="åœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡"><a href="#åœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡" class="headerlink" title="åœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡"></a>åœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡</h3><ol>
<li>ç›´æ¥è®¿é—®å®ä¾‹å˜é‡å’Œé€šè¿‡å­˜å–æ–¹æ³•æ¥è®¿é—®çš„åŒºåˆ«<ol>
<li>ç›´æ¥è®¿é—®ä¸ç»è¿‡æ–¹æ³•æ´¾å‘ï¼Œé€Ÿåº¦æ›´å¿«</li>
<li>ç›´æ¥è®¿é—®æ—¶ä¸ä¼šç»è¿‡è®¾ç½®æ–¹æ³•ï¼Œç»•è¿‡äº†å†…å­˜ç®¡ç†è¯­ä¹‰ã€‚ä¾‹å¦‚ï¼šåœ¨ARCä¸‹ç›´æ¥æ–¹æ³•ä¸€ä¸ªcopyå±æ€§ï¼Œé‚£ä¹ˆä¸ä¼šæ‹·è´è¯¥å€¼ï¼Œåªä¼šretain</li>
<li>ç›´æ¥è®¿é—®ä¸ä¼šè§¦å‘KVO</li>
</ol>
</li>
<li>æŠ˜ä¸­çš„æ–¹æ¡ˆï¼šè®¾ç½®æ—¶ä½¿ç”¨è®¾ç½®æ–¹æ³•ï¼Œè¯»å–æ—¶ç›´æ¥è®¿é—®</li>
</ol>
<h3 id="ç†è§£â€œå¯¹è±¡ç­‰åŒæ€§â€è¿™ä¸€æ¦‚å¿µ"><a href="#ç†è§£â€œå¯¹è±¡ç­‰åŒæ€§â€è¿™ä¸€æ¦‚å¿µ" class="headerlink" title="ç†è§£â€œå¯¹è±¡ç­‰åŒæ€§â€è¿™ä¸€æ¦‚å¿µ"></a>ç†è§£â€œå¯¹è±¡ç­‰åŒæ€§â€è¿™ä¸€æ¦‚å¿µ</h3><ol>
<li>åº”è¯¥ä½¿ç”¨NSObjectåè®®ä¸­çš„<code>isEqual</code>æ–¹æ³•æ¥åˆ¤æ–­å¯¹è±¡çš„ç­‰åŒæ€§ã€‚å¯ä»¥å¯¹è±¡è‡ªå·±å®ç°<code>isEqual</code>æ¥ç²¾ç¡®åˆ¤æ–­</li>
<li>å½“ç„¶å¯¹äºç‰¹æ®Šçš„å¯¹è±¡å¯ä»¥ä½¿ç”¨æ›´ç²¾ç¡®çš„æ–¹æ³•</li>
</ol>
<h3 id="ä»¥â€œç±»æ—æ¨¡å¼â€éšè—å®ç°ç»†èŠ‚"><a href="#ä»¥â€œç±»æ—æ¨¡å¼â€éšè—å®ç°ç»†èŠ‚" class="headerlink" title="ä»¥â€œç±»æ—æ¨¡å¼â€éšè—å®ç°ç»†èŠ‚"></a>ä»¥â€œç±»æ—æ¨¡å¼â€éšè—å®ç°ç»†èŠ‚</h3><ol>
<li>UIButtonæœ‰ä¸€ä¸ªç±»æ–¹æ³•ï¼š<code>+ (UIButton *)buttonWithType:(UIButtonType)type;</code> è¯¥æ–¹æ³•è¿”å›çš„å¯¹è±¡ç±»å‹æ ¹æ®typeä¸åŒè€Œä¸åŒï¼Œä½†æ˜¯åŸºç±»éƒ½æ˜¯UIButton</li>
<li>ç±»æ—çš„åŸºç±»ä¸€èˆ¬æ²¡æœ‰ init æ–¹æ³•ï¼Œæç¤ºç”¨æˆ·ï¼šè¿™ç§ç±»ä¸éœ€è¦ç”¨æˆ·è‡ªå·±å»åˆ›å»ºã€‚</li>
<li>è°ƒç”¨<code>isMemberOfClass:</code>çš„æ—¶å€™ä¸ä¼šè¿”å›YESï¼Œå› ä¸ºä¸æ˜¯UIButtonï¼Œåªæ˜¯å®ƒçš„å­ç±»</li>
<li>NSArrayå°±æ˜¯ç±»æ—</li>
</ol>
<h3 id="åœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®"><a href="#åœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®" class="headerlink" title="åœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®"></a>åœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®</h3>]]></content>
      
        <categories>
            
            <category> è¯»ä¹¦ç¬”è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Effective Objective-C - ç³»ç»Ÿæ¡†æ¶]]></title>
      <url>/2017/04/11/effective-objective-c-reading-note-five/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><strong>NSObject</strong> å±äº <strong>Foundation</strong> æ¡†æ¶ï¼Œæˆ‘ä»¬å†™çš„OCä»£ç å…¨éƒ¨éƒ½æ˜¯åŸºäºè¿™äº›åŸºæœ¬ç³»ç»Ÿæ¡†æ¶ä¹‹ä¸Šçš„</p>
<a id="more"></a>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="ç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶"><a href="#ç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶" class="headerlink" title="ç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶"></a>ç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶</h3><ol>
<li>å°†ä¸€ç³»åˆ—ä»£ç å°è£…ä¸ºåŠ¨æ€åº“ï¼Œå¹¶åœ¨å…¶ä¸­æ”¾å…¥æè¿°å…¶æ¥å£çš„å¤´æ–‡ä»¶ï¼Œè¿™æ ·åšå‡ºæ¥çš„ä¸œè¥¿å°±å«æ¡†æ¶ã€‚æ‰€æœ‰iOSå¹³å°çš„ç³»ç»Ÿæ¡†æ¶éƒ½æ˜¯åŠ¨æ€åº“</li>
<li>NSå¼€å¤´çš„åŸºæœ¬éƒ½æ˜¯Foundationæ¡†æ¶ï¼Œä¸Foundationæ¡†æ¶å¯¹åº”çš„ä¸€ä¸ªCoreFoundationæ¡†æ¶ï¼Œä»–æ˜¯Cè¯­è¨€çš„API</li>
<li>ä½¿ç”¨toll-free bridgingå¯ä»¥å®ç°Foundationçš„OCå¯¹è±¡å’ŒCoreFoundationçš„Cæ•°æ®ç»“æ„äº’ç›¸è½¬æ¢</li>
<li>ä½¿ç”¨Cè¯­è¨€çš„APIå¯ä»¥ç»•è¿‡OCçš„runtimeæœºåˆ¶ï¼ŒåŠ å¿«è¿è¡Œé€Ÿåº¦ï¼›ä½†æ˜¯ä½¿ç”¨Cè¯­è¨€çš„APIæ—¶ï¼Œéœ€è¦æ³¨æ„å†…å­˜ç®¡ç†çš„é—®é¢˜</li>
</ol>
<h3 id="å¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨forå¾ªç¯"><a href="#å¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨forå¾ªç¯" class="headerlink" title="å¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨forå¾ªç¯"></a>å¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨forå¾ªç¯</h3><ol>
<li><p>ä½¿ç”¨OC1.0çš„ <strong>NSEnumerator</strong> æ¥éå†</p>
<pre><code class="objective-c">NSArray *array = /*...*/;
NSEnumerator *enumerator = [array objectEnumerator];
id object;
while ((object = [enumerator nextObject]) != nil) {
      // do something
}

NSDictionary *dict = /*...*/;
NSEnumerator *enum = [dict keyEnumerator];
id key;
while ((key = [enum nextObject]) != nil) {
      id value = dict[key];
      // do something
}
</code></pre>
</li>
<li><p>æ¡†æ¶è¿˜æä¾›åå‘éå†çš„enumæ¥å£</p>
</li>
<li><p>ä½¿ç”¨OC2.0çš„ <strong>å¿«é€Ÿéå†</strong> ï¼Œä¹Ÿå°±æ˜¯<strong>for in</strong></p>
</li>
<li><p>åŸºäºå—çš„éå†æ–¹å¼ï¼Œå¯¹äºNSArrayæœ‰<code>-(void)enumerateObjectsUsingBlock:(void(^)(id object, NSUinteger idx, BOOL *stop))block;</code> ï¼›å…¶ä»–çš„collectionä¹Ÿæœ‰ç›¸å¯¹åº”çš„æ–¹æ³•ã€‚ä½¿ç”¨blockæ–¹æ³•ï¼Œå¯ä»¥è·å–æ›´å¤šçš„ä¿¡æ¯</p>
</li>
</ol>
<h3 id="å¯¹è‡ªå®šä¹‰å…¶å†…å­˜ç®¡ç†è¯­ä¹‰çš„collectionä½¿ç”¨æ— ç¼æ¡¥æ¥"><a href="#å¯¹è‡ªå®šä¹‰å…¶å†…å­˜ç®¡ç†è¯­ä¹‰çš„collectionä½¿ç”¨æ— ç¼æ¡¥æ¥" class="headerlink" title="å¯¹è‡ªå®šä¹‰å…¶å†…å­˜ç®¡ç†è¯­ä¹‰çš„collectionä½¿ç”¨æ— ç¼æ¡¥æ¥"></a>å¯¹è‡ªå®šä¹‰å…¶å†…å­˜ç®¡ç†è¯­ä¹‰çš„collectionä½¿ç”¨æ— ç¼æ¡¥æ¥</h3><ol>
<li><p>ä½¿ç”¨æ— ç¼æ¡¥æ¥æ¥è½¬æ¢Foundationå’ŒCoreFoundation</p>
<pre><code class="objective-c">NSArray *array = @[@1ï¼Œ @2ï¼Œ @3]ï¼›
CFArrayRef aCFArray = (__bridge CFArrayRef)array;
</code></pre>
</li>
<li><p>__bridge è¿˜æœ‰ç–‘é—®</p>
</li>
<li><p>NSDictionary å¯¹äºkeyæ˜¯copyï¼Œå¯¹äºvalueåˆ™æ˜¯retainã€‚è¦æƒ³æ”¹å˜æœŸå†…å­˜è¯­ä¹‰çš„è¯å‘¢ï¼Œåªèƒ½ä½¿ç”¨CoreFoundationäº†ï¼Œå…·ä½“çš„çœ‹ä¹¦~</p>
</li>
</ol>
<h3 id="æ„å»ºç¼“å­˜æ—¶é€‰ç”¨NSCacheè€ŒéNSDictionary"><a href="#æ„å»ºç¼“å­˜æ—¶é€‰ç”¨NSCacheè€ŒéNSDictionary" class="headerlink" title="æ„å»ºç¼“å­˜æ—¶é€‰ç”¨NSCacheè€ŒéNSDictionary"></a>æ„å»ºç¼“å­˜æ—¶é€‰ç”¨NSCacheè€ŒéNSDictionary</h3><ol>
<li>NSCacheåœ¨ç³»ç»Ÿä½å†…å­˜æ—¶ä¼šè‡ªåŠ¨åˆ å‡ç¼“å­˜ï¼Œè€Œä¸”ä¼˜å…ˆåˆ å‡çš„æ˜¯æœ€é•¿æ—¶é—´æ²¡æœ‰ä½¿ç”¨è¿‡çš„ç¼“å­˜</li>
<li>NSCacheçš„keyæ˜¯retainçš„ï¼Œä¸æ˜¯copyçš„ã€‚å› ä¸ºå¾ˆå¤šæ—¶å€™ï¼Œè¿™ä¸ªkeyçš„å¯¹è±¡ä¸æ”¯æŒcopy</li>
<li>çº¿ç¨‹å®‰å…¨ï¼Œè¿™ç‚¹å¯¹äºç¼“å­˜æ¥è¯´å¾ˆå…³é”®</li>
</ol>
<h3 id="ç²¾ç®€initializeä¸loadçš„å®ç°ä»£ç "><a href="#ç²¾ç®€initializeä¸loadçš„å®ç°ä»£ç " class="headerlink" title="ç²¾ç®€initializeä¸loadçš„å®ç°ä»£ç "></a>ç²¾ç®€initializeä¸loadçš„å®ç°ä»£ç </h3><ol>
<li><code>+ (void)load;</code> æ¯ä¸ªç±»å¿…å®šä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œè€Œä¸”ä»…è°ƒç”¨ä¸€æ¬¡ã€‚å½“åŒ…å«ç±»çš„ç¨‹åºåº“è½½å…¥ç³»ç»Ÿæ—¶ï¼Œå°±ä¼šæ‰§è¡Œæ­¤æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯<strong>ç¨‹åºå¯åŠ¨</strong>çš„æ—¶å€™</li>
<li>å¦‚æœåˆ†ç±»å’Œç±»éƒ½å®šä¹‰äº†loadæ–¹æ³•ï¼Œé‚£ä¹ˆå…ˆè°ƒç”¨ç±»çš„ï¼Œå†è°ƒç”¨åˆ†ç±»çš„</li>
<li>åœ¨æ‰§è¡Œç±»çš„çš„loadä¹‹å‰ï¼Œä¼šå…ˆæ‰§è¡Œå¤šæœ‰è¶…ç±»çš„loadæ–¹æ³•</li>
<li>loadæ–¹æ³•å’Œå…¶ä»–ä¸ä¸€æ ·ï¼Œå¦‚æœå­ç±»æ²¡æœ‰å®ç°çš„è¯ï¼Œä¸ç®¡è¶…ç±»æœ‰æ²¡æœ‰ï¼Œä»–éƒ½ä¸ä¼šç»§æ‰¿è¯¥æ–¹æ³•</li>
<li>loadæ–¹æ³•è¦ç²¾ç®€ï¼Œç¨‹åºåœ¨æ‰§è¡Œæ²¡æœ‰loadæ–¹æ³•çš„æ—¶å€™éƒ½ä¼šé˜»å¡</li>
<li>å°½é‡ä¸è¦ä½¿ç”¨loadæ–¹æ³•</li>
<li><code>+ (void)initialize;</code> åœ¨ç¨‹åºç¬¬ä¸€æ¬¡ä½¿ç”¨è¿™ä¸ªç±»çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚å®ƒä¹Ÿåªä¼šè¿è¡Œä¸€æ¬¡ã€‚ä¸åº”è¯¥ç”±ä»£ç æ¥æ˜¾å¼è°ƒç”¨ã€‚</li>
<li>initializeåªæœ‰åœ¨ç¨‹åºç”¨åˆ°è¯¥ç±»çš„æ—¶å€™æ‰ä¼šè°ƒç”¨ï¼Œå±äºæƒ°æ€§è°ƒç”¨ï¼›å®ƒç”±è¿è¡ŒæœŸç³»ç»Ÿæ¥è°ƒç”¨ã€‚è°ƒç”¨å®ƒçš„æ—¶å€™ï¼Œç³»ç»Ÿä¸­çš„ä¸ªå„ç±»éƒ½æ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„ï¼Œè¿™ä¸€ç‚¹å’Œloadæ–¹æ³•ä¸åŒ</li>
</ol>
<h3 id="åˆ«å¿˜äº†NSTimerä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡"><a href="#åˆ«å¿˜äº†NSTimerä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡" class="headerlink" title="åˆ«å¿˜äº†NSTimerä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡"></a>åˆ«å¿˜äº†NSTimerä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡</h3>]]></content>
      
        <categories>
            
            <category> è¯»ä¹¦ç¬”è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Effective Objective-C - å—ä¸å¤§ä¸­æ¢æ´¾å‘]]></title>
      <url>/2017/04/04/effective-objective-c-reading-note-four/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><strong>Effective Objective C</strong> è¯»ä¹¦ç¬”è®° - å—ä¸å¤§ä¸­æ¢æ´¾å‘</p>
<p><strong>å¤šçº¿ç¨‹çš„ä¸¤å¤§æ ¸å¿ƒï¼šblockï¼ŒGCD</strong></p>
<a id="more"></a>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="ç†è§£â€œå—â€è¿™ä»¥æ¦‚å¿µ"><a href="#ç†è§£â€œå—â€è¿™ä»¥æ¦‚å¿µ" class="headerlink" title="ç†è§£â€œå—â€è¿™ä»¥æ¦‚å¿µ"></a>ç†è§£â€œå—â€è¿™ä»¥æ¦‚å¿µ</h3><ol>
<li><p>blockå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œå—ä¹Ÿæ˜¯å¯¹è±¡ç±»å‹</p>
<pre><code class="objective-c">void (^someBlock)() = ^{
      // do something here
}
</code></pre>
</li>
<li><p>å—çš„å¼ºå¤§ä¹‹å¤„åœ¨äºï¼šåœ¨å£°æ˜å—çš„èŒƒå›´é‡Œé¢ï¼Œæ‰€æœ‰çš„å˜é‡éƒ½å¯ä»¥ä¸ºå…¶æ‰€æ•è·ï¼Œåœ¨å¿«å†…å¯ä»¥ä½¿ç”¨è¿™äº›å˜é‡</p>
</li>
<li><p>åœ¨Blockä¹‹å‰ï¼Œåªèƒ½ä½¿ç”¨å‡½æ•°æŒ‡é’ˆæˆ–è€…æ˜¯selector</p>
</li>
<li><p>æ¯ä¸ªOCå¯¹è±¡éƒ½å æœ‰ä¸€ä¸ªå†…å­˜åŒºåŸŸï¼Œå—ä¹Ÿæ˜¯å¯¹è±¡ï¼Œä¸‹å›¾å°±æ˜¯å—çš„å†…å­˜åŒºåŸŸï¼š</p>
<p><img src="/lionheart/1704/blockmemory.JPG" alt="block memory"></p>
<ol>
<li><strong>invoke</strong> æ˜¯å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘å—çš„å®ç°ä»£ç </li>
<li><strong>descriptor</strong> æ˜¯ä¸€ä¸ªç»“æ„ä½“æŒ‡é’ˆï¼Œæ¯ä¸ªblockéƒ½æœ‰è¿™ä¹ˆä¸€ä¸ªå˜é‡ï¼Œè¯¥ç»“æ„ä½“åŒ…å«äº†å—çš„è¯¦ç»†ä¿¡æ¯ï¼šå¤§å°ç­‰ç­‰</li>
<li>å—è¿˜ä¼šæŠŠ <strong>æ•è·åˆ°çš„å˜é‡</strong> æ‹·è´ä¸€ä»½ï¼Œæ³¨æ„è¿™é‡Œæ‹·è´çš„æ˜¯æŒ‡é’ˆ</li>
</ol>
</li>
<li><p>å®šä¹‰å—çš„æ—¶å€™ï¼Œå—æ‰€å çš„å†…å­˜æ˜¯åˆ†é…åœ¨æ ˆä¸­çš„ï¼Œæ¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­</p>
<pre><code class="objective-c">void (^block)(); // å£°æ˜ä¸€ä¸ªblockï¼Œæ˜¯ä¸€ä¸ªæŒ‡é’ˆ
if (/* some condition */) {
      block = ^{
          // do something
      }
} else {
      block = ^{
          // do something
      }
}
block();
</code></pre>
<p>æ³¨é‡Šï¼šåœ¨ifå’Œelseä¸­ï¼Œåˆ†åˆ«åˆ›å»ºäº†blockï¼Œè¿™ä¸ªblockæ˜¯ä¸€ä¸ªæ ˆå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä»–ä»¬çš„å†…å­˜æ˜¯åœ¨æ ˆä¸Šé¢çš„ï¼›ç„¶å<strong>å°†è¯¥æ ˆå†…å­˜çš„é¦–åœ°å€èµ‹äºˆblock</strong>ã€‚ä½†æ˜¯è¿™ä¸ªå¯¹è±¡å‡ºäº†<code>{}</code> ï¼Œå…¶å†…å­˜å¯èƒ½è¢«è¦†å†™ï¼Œé‚£ä¹ˆblockå˜é‡æŒ‡å‘çš„å°±ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„å—äº†</p>
<p><strong>æ³¨æ„ï¼Œè¿™é‡Œçš„blockæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼›å’Œä¸€èˆ¬çš„intç†è§£ä¸Šæœ‰æ‰€ä¸åŒ</strong></p>
<pre><code class="objective-c">int a;
if (/* some condition */) {
      int tmp = 2;
      a = tmp;
} else {
      int tmp = 3;
      a = tmp;
}
</code></pre>
<p>è¿™é‡Œtmpçš„å†…å­˜åœ¨å‡ºäº†<code>{}</code>ä¹‹åä¹Ÿæ˜¯ä¼šè¢«è¦†å†™çš„ï¼Œä½†æ˜¯åœ¨<code>{}</code>é‡Œé¢ï¼Œç›´æ¥å°†tmpçš„å†…å­˜ä¸­çš„å€¼å†™åˆ°äº†açš„å†…å­˜ä¸­ï¼Œæ‰€ä»¥aè¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚<strong>ä½†æ˜¯ï¼Œå†™åˆ°blockå†…å­˜ä¸­çš„æ˜¯è¿™ä¸ªæ ˆå¯¹è±¡çš„åœ°å€ï¼Œåœ°å€è¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œä½†æ˜¯åœ°å€é‡Œé¢çš„å†…å®¹å°±ä¸ä¸€å®šæ˜¯åŸæ¥çš„å—å¯¹è±¡äº†</strong></p>
<p>è‡³äºï¼Œæ ˆå’Œå †çš„åŒºåˆ«å¯ä»¥çœ‹çœ‹ <a href="http://ios.jobbole.com/81900/" target="_blank" rel="external">Objective-C æ‹¾é—ï¼šä»Heap and Stackåˆ°Block</a> è¿™ç¯‡æ–‡ç« </p>
</li>
<li><p>æ‰€ä»¥ä¸ºäº†é¿å…åœ¨æ ˆä¸Šçš„å—å¯¹è±¡è¢«é”€æ¯ï¼Œå°±å¾—ä½¿ç”¨<code>copy</code>æ–¹æ³•äº†ã€‚blockçš„<code>copy</code>æ–¹æ³•å°†blockä»æ ˆæ‹·è´åˆ°å †ä¸Šé¢ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™çš„blockå°±å’Œæ­£å¸¸çš„OCå¯¹è±¡ä¸€æ ·äº†ï¼Œå…·å¤‡å¼•ç”¨è®¡æ•°ï¼Œå¯ä»¥ä½¿ç”¨ARCæ¥ç®¡ç†äº†</p>
</li>
<li><p>5å’Œ6åˆ†åˆ«è®²è¿°äº† <strong>æ ˆå—</strong> å’Œ <strong>å †å—</strong> çš„åŒºåˆ«ï¼Œè¿˜æœ‰ä¸€ç§å—ï¼Œå«åš <strong>å…¨å±€å—</strong> ã€‚è¿™ç§blockä¸ä¼šæ•æ‰å¤–éƒ¨å˜é‡ï¼Œå®ƒçš„å†…å­˜åœ¨å…¨å±€å†…å­˜ä¸­ï¼Œè€Œä¸”å¯¹ä»–æ‰§è¡Œcopyæ“ä½œä¹Ÿåªæ˜¯ç©ºæ“ä½œï¼Œç±»ä¼¼ä¸€ä¸ªå‡½æ•°</p>
</li>
</ol>
<h3 id="ä¸ºå¸¸ç”¨çš„å—ç±»å‹åˆ›å»ºtypedef"><a href="#ä¸ºå¸¸ç”¨çš„å—ç±»å‹åˆ›å»ºtypedef" class="headerlink" title="ä¸ºå¸¸ç”¨çš„å—ç±»å‹åˆ›å»ºtypedef"></a>ä¸ºå¸¸ç”¨çš„å—ç±»å‹åˆ›å»ºtypedef</h3><ol>
<li><p>å®šä¹‰å—å˜é‡æ˜¯éå¸¸ä¸ç¬¦åˆå¸¸ç†ï¼Œä¸å¥½è®°ä½ï¼Œæ‰€ä»¥è¦ä½¿ç”¨ <strong>typedef</strong></p>
<pre><code class="objective-c">typedef int (^EOCSomeBlock)(BOOL flag, int value);
EOCSomeBlock block = ^(BOOL flag, int value) {
      // block implememtation
};
</code></pre>
<p>ä¸Šé¢çš„EOCSomeBlockè¡¨ç¤º <strong>æ¥å—2ä¸ªå‚æ•°ï¼Œå¹¶è¿”å›intçš„blockç±»å‹</strong></p>
</li>
</ol>
<h3 id="ç”¨handlerå—é™ä½ä»£ç åˆ†æ•£ç¨‹åº¦"><a href="#ç”¨handlerå—é™ä½ä»£ç åˆ†æ•£ç¨‹åº¦" class="headerlink" title="ç”¨handlerå—é™ä½ä»£ç åˆ†æ•£ç¨‹åº¦"></a>ç”¨handlerå—é™ä½ä»£ç åˆ†æ•£ç¨‹åº¦</h3><ol>
<li>ä¹Ÿå°±æ˜¯ä½¿ç”¨blockæ¥ä»£æ›¿delegate</li>
<li>è¿˜å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªblockï¼Œæ¥å¤„ç†successæˆ–è€…failçš„æƒ…å†µ</li>
</ol>
<h3 id="ç”¨å—å¼•ç”¨å…¶æ‰€å±å¯¹è±¡æ—¶ä¸è¦å‡ºç°ä¿ç•™ç¯"><a href="#ç”¨å—å¼•ç”¨å…¶æ‰€å±å¯¹è±¡æ—¶ä¸è¦å‡ºç°ä¿ç•™ç¯" class="headerlink" title="ç”¨å—å¼•ç”¨å…¶æ‰€å±å¯¹è±¡æ—¶ä¸è¦å‡ºç°ä¿ç•™ç¯"></a>ç”¨å—å¼•ç”¨å…¶æ‰€å±å¯¹è±¡æ—¶ä¸è¦å‡ºç°ä¿ç•™ç¯</h3><h3 id="å¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é”"><a href="#å¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é”" class="headerlink" title="å¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é”"></a>å¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é”</h3><ol>
<li><p><code>dispatch_sync(queue, block);</code> ç­‰å¾…blockæ‰§è¡Œå®Œï¼Œå†æ‰§è¡Œåé¢çš„è¯­å¥ï¼›<code>dispatch_async(queue, block);</code> ä¸ç­‰å¾…blockæ‰§è¡Œå®Œï¼Œç«‹åˆ»æ‰§è¡Œåç»­è¯­å¥ã€‚å…·ä½“å‚è€ƒ<a href="http://blog.csdn.net/zhangping871/article/details/44098773" target="_blank" rel="external">dispatch_async å’Œ dispatch_sync çš„åŒºåˆ«</a></p>
</li>
<li><p>æ¥ä¸ªä¾‹å­è¯´æ˜ä¸€ä¸‹ï¼š</p>
<pre><code class="objective-c">_syncQueue = dispatch_queue_create(&quot;com.vanney9.queue&quot;, NULL);

- (NSString *)someString {
      __block NSString *localSomeString;
      dispatch_sync(_syncQueue, ^{      // 1
          localSomeThing = _someString;
      });
      return localSomeString;   // 2
}

- (void)setSomeString:(NSString *)someString {
      dispatch_async(_syncQueue, ^{    // 3
          _someString = someString;
      });
      return;    // 4
}
</code></pre>
<ol>
<li>getæ–¹æ³•ä½¿ç”¨åŒæ­¥æ´¾å‘(<strong>dispatch_sync</strong>)ï¼šå› ä¸ºå¿…é¡»ç­‰å¾…blockæ‰§è¡Œå®Œï¼Œæ‰èƒ½è¿”å›localStringï¼Œå¦‚æœä½¿ç”¨å¼‚æ­¥æ´¾å‘(<strong>dispatch_async</strong>)çš„è¯ï¼Œblockè¿˜æ²¡æœ‰æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯localStringè¿˜æ²¡æœ‰è®¾ç½®ï¼Œå°±è¿”å›äº†ï¼Œé‚£ä¹ˆå°±è¿”å›ç©ºå€¼äº†ã€‚ã€‚</li>
<li>setæ–¹æ³•ä½¿ç”¨å¼‚æ­¥æ´¾å‘ï¼Œå› ä¸ºä¸éœ€è¦ç­‰å¾…blockæ‰§è¡Œå®Œ</li>
</ol>
</li>
<li><p>ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨çš„queueéƒ½æ˜¯ä¸²è¡Œé˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»ç­‰å¾…æ³¨å†Œåˆ°è¯¥åºåˆ—ä¸­çš„å‰é¢çš„blockæ‰§è¡Œå®Œäº†ï¼Œæ‰èƒ½æ‰§è¡Œè‡ªå·±çš„blocï¼›ä½†æ˜¯å¯¹äºè¯»æ“ä½œæ¥è¯´æ˜¯å¯ä»¥å¹¶è¡Œçš„ï¼Œåªè¦å†™æ“ä½œå’Œå…¶ä»–çš„æ“ä½œä¸²è¡ŒåŒ–å°±å¯ä»¥äº†ã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨ <strong>å¹¶è¡Œåºåˆ—+æ …æ </strong> æ¥å®ç°</p>
<pre><code class="objective-c">_syncQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); // 1
- (NSString *)someString {
      __block NSString *localSomeString;
      dispatch_sync(_syncQueue, ^{  // 2
          localSomeString = _someString;
      });
      return localSomeString;
}

- (void)setSomeString:(NSString *)someString {
      dispatch_barrier_async(_syncQueue, ^{  // 3
          _someString = somString;
      });
}
</code></pre>
<p>æ³¨é‡Š1ï¼šåˆ›å»ºäº†ä¸€ä¸ªå¹¶å‘é˜Ÿåˆ—</p>
<p>æ³¨é‡Š2ï¼šä½¿ç”¨å¹¶å‘é˜Ÿåˆ—ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œgetæ–¹æ³•</p>
<p>æ³¨é‡Š3ï¼šä½¿ç”¨æ …æ æŠ€æœ¯ï¼Œè®©å†™æ“ä½œæ‰§è¡Œçš„æ—¶å€™ï¼Œé˜Ÿåˆ—ä¸­çš„å…¶ä»–æ“ä½œæ— æ³•æ‰§è¡Œ</p>
</li>
</ol>
<h3 id="å¤šç”¨GCDï¼Œå°‘ç”¨performSelectorç³»åˆ—æ–¹æ³•"><a href="#å¤šç”¨GCDï¼Œå°‘ç”¨performSelectorç³»åˆ—æ–¹æ³•" class="headerlink" title="å¤šç”¨GCDï¼Œå°‘ç”¨performSelectorç³»åˆ—æ–¹æ³•"></a>å¤šç”¨GCDï¼Œå°‘ç”¨performSelectorç³»åˆ—æ–¹æ³•</h3><ol>
<li><p>å…ˆæ¥è¯´è¯´<code>performSelector</code>æ–¹æ³•</p>
<pre><code class="objective-c">SEL selector;
if (/* some condition*/) {
      selector = @selector(foo);
}  else {
      selector = @selector(bar);
}
[object performSelector:selector];
</code></pre>
<p>åŠ¨æ€ç»‘å®šä¹‹ä¸Šå†åŠ¨æ€ç»‘å®š</p>
</li>
<li><p>ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨å‘¢ï¼Ÿå› ä¸ºè¯¥æ–¹æ³•è¿”å›çš„æ˜¯idç±»å‹ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæŒ‡å‘ä»»æ„OCå¯¹è±¡çš„æŒ‡é’ˆï¼ˆåœ¨32ä½æ¶æ„ä¸Šå 32ä½ï¼Œ4å­—èŠ‚ï¼›åœ¨64ä½æ¶æ„ä¸Šå 64ä½ï¼Œ8å­—èŠ‚ï¼‰ã€‚ä½†æ˜¯å¦‚æœselectoræ–¹æ³•è¿”å›intï¼Œfloatç­‰ç±»å‹æ—¶å°±ä¸å¥½è½¬æ¢äº†</p>
</li>
<li><p>ä½¿ç”¨GCDå¯ä»¥å®ç°ï¼šå»¶è¿Ÿæ‰§è¡Œï¼Œé€‰æ‹©ç‰¹å®šçº¿ç¨‹æ‰§è¡Œ</p>
</li>
</ol>
<h3 id="æŒæ¡GCDåŠæ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ—¶æœº"><a href="#æŒæ¡GCDåŠæ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ—¶æœº" class="headerlink" title="æŒæ¡GCDåŠæ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ—¶æœº"></a>æŒæ¡GCDåŠæ“ä½œé˜Ÿåˆ—çš„ä½¿ç”¨æ—¶æœº</h3><ol>
<li>è¿˜æœ‰ä¸€æ•´å¤šçº¿ç¨‹æœºåˆ¶ï¼š<strong>NSOperationQueue + NSOperation</strong> ä¹Ÿå°±æ˜¯<strong>æ“ä½œé˜Ÿåˆ—</strong>ï¼Œ å®ƒä¹Ÿå¯ä»¥å®ç°å’ŒGCDç›¸åŒçš„åŠŸèƒ½ã€‚å…¶ä¸­NSOperationQueueç±»ä¼¼GCDï¼›è€ŒNSOperationç±»ä¼¼block</li>
<li>æ“ä½œé˜Ÿåˆ—å¯¹æ¯”GCDçš„ä¼˜ç‚¹ï¼š<ol>
<li>å¯ä»¥å–æ¶ˆå°šæœªå¼€å§‹æ‰§è¡Œçš„NSOperation</li>
<li>å¯ä»¥æŒ‡å®šæ“ä½œé—´çš„ä¾èµ–å…³ç³»ï¼šå¯ä»¥æŒ‡å®šå½“å‰çš„NSOperationåœ¨æŸä¸ªNSOperationæ‰§è¡Œç»“æŸåï¼Œæ‰å¼€å§‹æ‰§è¡Œ</li>
<li>NSOperationçš„è®¸å¤šå±æ€§é€‚åˆKVOï¼Œé€šè¿‡ç›‘å¬å¯ä»¥æ›´ç²’å­åŒ–çš„ç›‘æ§NSOperation</li>
<li>å¯ä»¥æŒ‡å®šNSOperationçš„ä¼˜å…ˆçº§ï¼šGCDçš„ä¼˜å…ˆçº§æ˜¯é’ˆå¯¹é˜Ÿåˆ—ä¹‹é—´çš„ï¼›ä½†æ˜¯æ“ä½œé˜Ÿåˆ—çš„ä¼˜å…ˆçº§æ˜¯é’ˆå¯¹NSOperationçš„ï¼Œä¹Ÿå°±æ˜¯åŒä¸€é˜Ÿåˆ—é‡Œé¢çš„blockçš„ä¼˜å…ˆçº§ã€‚å½“ç„¶ï¼Œæ“ä½œé˜Ÿåˆ—ä¹Ÿæœ‰çº¿ç¨‹é—´çš„ä¼˜å…ˆçº§</li>
</ol>
</li>
</ol>
<h3 id="é€šè¿‡Dispatch-Groupæœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡"><a href="#é€šè¿‡Dispatch-Groupæœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡" class="headerlink" title="é€šè¿‡Dispatch Groupæœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡"></a>é€šè¿‡Dispatch Groupæœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡</h3><ol>
<li>ä½¿ç”¨ <strong>dispatch group</strong> æœºåˆ¶å¯ä»¥å°†ä»»åŠ¡åˆ†ç»„ã€‚è°ƒç”¨è€…å¯ä»¥ç­‰å¾…è¿™ç»„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼›ä¹Ÿå¯ä»¥ç»™ç›´æ¥æä¾›å›è°ƒå‡½æ•°ï¼Œç«‹åˆ»è¿›è¡Œä¸‹é¢çš„æ­¥éª¤</li>
<li>è¿™ä¸ªç‰¹æ€§æœ€é‡è¦çš„ä¸€ç‚¹ç”¨é€”å°±æ˜¯ï¼šæŠŠå°†è¦å¹¶å‘æ‰§è¡Œçš„å¤šä¸ªä»»åŠ¡åˆå¹¶ä¸ºä¸€ç»„ï¼Œé‚£ä¹ˆå°±å¯ä»¥çŸ¥é“è¿™äº›ä»»åŠ¡ä»€ä¹ˆæ—¶å€™å…¨éƒ¨æ‰§è¡Œå®Œæ¯•</li>
<li><code>dispatch_group_wait</code> å’Œ <code>dispatch_group_notify</code> ä¸¤ä¸ªå‡½æ•°å¯ä»¥ç”¨æ¥æ‰§è¡Œç»“æŸåè¯¥åšä»€ä¹ˆï¼Œå…·ä½“å‚è§ <a href="http://vanney9.com/2016/08/02/OC-ARC-GCD-reading-note-three/" target="_blank" rel="external">iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç† - GCD</a></li>
<li>ä½¿ç”¨å¹¶å‘é˜Ÿåˆ—è¿›è¡Œå¤šçº¿ç¨‹ä»»åŠ¡æ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ®å½“æ—¶çš„æƒ…å†µè‡ªåŠ¨åˆ†é…çº¿ç¨‹ï¼Œæ— é¡»ç å†œè‡ªå·±æ¥è°ƒåº¦</li>
</ol>
<h3 id="ä½¿ç”¨dispatch-onceæ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç "><a href="#ä½¿ç”¨dispatch-onceæ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç " class="headerlink" title="ä½¿ç”¨dispatch_onceæ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç "></a>ä½¿ç”¨dispatch_onceæ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç </h3><ol>
<li><p>è¿™ä¸ªå¸¸ç”¨äºå•ä¾‹æ¨¡å¼</p>
</li>
<li><p>exampleï¼š</p>
<pre><code class="objective-c">+ (id)sharedInstance {
      static ECOClass *sharedInstanced = nil;
      static dispatch_once_t onceToken;
      dispatch_once(&amp;onceToken, ^{
          sharedInstance = [[self alloc] init];
      });
      return sharedInstance;
}
</code></pre>
<p>åœ¨å‡½æ•°ä¸­çš„staticå˜é‡ï¼šåªåœ¨å‡½æ•°ä¸­å¯è§ï¼Œä½†æ˜¯å…¶ç”Ÿå‘½æœŸä¸ºæ•´ä¸ªç¨‹åºã€‚å…·ä½“è§ <a href="http://stackoverflow.com/questions/5033627/static-variable-inside-of-a-function-in-c" target="_blank" rel="external">Static variable inside of a function in C</a></p>
</li>
</ol>
<h3 id="ä¸è¦ä½¿ç”¨-dispatch-get-current-queue"><a href="#ä¸è¦ä½¿ç”¨-dispatch-get-current-queue" class="headerlink" title="ä¸è¦ä½¿ç”¨ dispatch_get_current_queue"></a>ä¸è¦ä½¿ç”¨ dispatch_get_current_queue</h3><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://ios.jobbole.com/81900/" target="_blank" rel="external">Objective-C æ‹¾é—ï¼šä»Heap and Stackåˆ°Block</a></li>
<li><a href="http://blog.csdn.net/zhangping871/article/details/44098773" target="_blank" rel="external">dispatch_async å’Œ dispatch_sync çš„åŒºåˆ«</a></li>
<li><a href="http://vanney9.com/2016/08/02/OC-ARC-GCD-reading-note-three/" target="_blank" rel="external">iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç† - GCD</a></li>
<li><a href="http://stackoverflow.com/questions/5033627/static-variable-inside-of-a-function-in-c" target="_blank" rel="external">Static variable inside of a function in C</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> è¯»ä¹¦ç¬”è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Auto Layout ä¸ CAKeyframeAnimation]]></title>
      <url>/2017/03/30/iOS-Auto-Layout-CAKeyframeAnimation/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘å®ç°äº†ä¸€ä¸ªåŸºäºAuto Layoutçš„CAKeyframeAnimationã€‚å…ˆæ¥çœ‹ä¸€ä¸‹æ•ˆæœğŸ‘‡</p>
<p><img src="/lionheart/1703/animate.gif" alt="animate.gif"></p>
<a id="more"></a>
<h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>çœ‹äº†æ•ˆæœå›¾ï¼Œç¬¬ä¸€ååº”åº”è¯¥æ˜¯ä½¿ç”¨ <strong>CAKeyframeAnimation</strong>ï¼Œè®©ä¸¤ä¸ªåœ†å‹viewçš„positionéšç€å›¾ä¸­çš„è´å¡å°”æ›²çº¿(<strong>CGPath</strong>)è¿åŠ¨ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šæ•´ä¸ªè§†å›¾æ˜¯ä½¿ç”¨ <strong>Auto Layout</strong> æ¥å®ç°çš„ï¼Œå¹¶æ²¡æœ‰æŒ‡å®šæ¯ä¸ªè§†å›¾çš„frameï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥ä½¿ç”¨CAKeyframeAnimationå‘¢ï¼Ÿè¿™å°±å¼•å‡ºäº†ä¸‹é¢è¦è®²çš„å‡ ç‚¹ğŸ‘‡</p>
<ol>
<li><strong>Auto Layout</strong>çš„æœ¬è´¨</li>
<li>æ™®é€šçš„åŸºäº<strong>Auto Layout</strong> çš„åŠ¨ç”»</li>
<li>åœ¨<strong>Auto Layout</strong>è§†å›¾ä¸­è·å–<strong>frame</strong></li>
<li><strong>CATransaction</strong> ä¸ <strong>CAKeyframeAnimation</strong></li>
<li><strong>Auto Layout</strong> ç™¾åˆ†æ¯”å¸ƒå±€</li>
</ol>
<h2 id="Auto-Layout-çš„æœ¬è´¨"><a href="#Auto-Layout-çš„æœ¬è´¨" class="headerlink" title="Auto Layout çš„æœ¬è´¨"></a>Auto Layout çš„æœ¬è´¨</h2><p><a href="http://vanney9.com/2017/03/24/something-about-iOS-drawing/" target="_blank" rel="external">å…³äºiOS Drawing</a> è¿™ç¯‡æ–‡ç« é‡Œé¢è®²è¿°äº† <strong>iOSç³»ç»Ÿå°†Viewæ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„6ä¸ªè¯¦ç»†æ­¥éª¤</strong>ã€‚è¿™é‡Œè¯´ä¸€ä¸‹å‰é¢3ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><strong>Layout</strong>ï¼šå°†ä¸€ä¸ªæˆ–è€…å¤šä¸ªUIViewï¼ˆä¹Ÿå°±æ˜¯<strong>UIView hierarchy</strong>ï¼‰æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„ç¬¬ä¸€æ­¥å°±æ˜¯ <strong>è®¡ç®—æ¯ä¸ªlayerçš„frame</strong>ã€‚æ— è®ºä»£ç ä½¿ç”¨<strong>Auto Layout</strong> è¿˜æ˜¯ <strong>Auto Resizing</strong> è¿˜æ˜¯ç›´æ¥æŒ‡å®šäº†Viewçš„frameï¼ŒiOSéƒ½ä¼šè®¡ç®—å‡ºæ¯ä¸ªlayerçš„frameã€‚</li>
<li><strong>Display</strong>ï¼šæ­¤æ—¶å·²ç»çŸ¥é“æ¯ä¸ªLayerçš„frameï¼Œè¿™ä¸€æ­¥ä¼šæ‰§è¡Œ<code>-drawRect:</code>æ–¹æ³•ï¼Œæ‰§è¡Œcustomçš„ç»˜åˆ¶ï¼Œç”Ÿæˆlayerçš„backing imageã€‚</li>
<li><strong>Prepare</strong>ï¼šè¿™ä¸€æ­¥å¼€å§‹å‡†å¤‡æ¯ä¸ª<strong>Animation</strong>çš„å±æ€§ï¼Œæ¯”å¦‚è¦åŠ¨ç”»çš„layerå±æ€§ï¼Œä»¥åŠç»ˆæ­¢å€¼ç­‰ç­‰ã€‚</li>
</ol>
<p><strong>åˆ’é‡ç‚¹å•¦ï¼š</strong></p>
<ol>
<li><strong>Auto Layoutè™½ç„¶æ²¡æœ‰æŒ‡å®šframeï¼Œä½†æ˜¯iOSä¼šæ ¹æ®è¿™äº›çº¦æŸï¼Œåœ¨å†…éƒ¨ç®—å‡ºlayerçš„frameã€‚æ‰€ä»¥Auto Layoutçš„æœ¬è´¨ä¹Ÿå°±æ˜¯æŒ‡å®šæ¯ä¸ªViewçš„frame</strong></li>
<li><strong>åœ¨è®¡ç®—å‡ºæ¯ä¸ªlayerçš„frameå±æ€§æ—¶ï¼Œæ‰å¼€å§‹å‡†å¤‡Animationçš„å‚æ•°ã€‚æ‰€ä»¥ä¸å­˜åœ¨åŸºäºAuto Layoutçš„åŠ¨ç”»ï¼›æŒ‡å®šåŠ¨ç”»å±æ€§æ—¶ï¼Œè¿˜æ˜¯æŒ‡å®šä¸viewçš„frameç›¸å…³çš„å±æ€§</strong></li>
</ol>
<h2 id="æ™®é€šçš„åŸºäº-Auto-Layout-çš„åŠ¨ç”»"><a href="#æ™®é€šçš„åŸºäº-Auto-Layout-çš„åŠ¨ç”»" class="headerlink" title="æ™®é€šçš„åŸºäº Auto Layout çš„åŠ¨ç”»"></a>æ™®é€šçš„åŸºäº Auto Layout çš„åŠ¨ç”»</h2><p><a href="http://stackoverflow.com/questions/12622424/how-do-i-animate-constraint-changes" target="_blank" rel="external">How do I animate constraint changes?</a> è¿™ä¸ªstackoverflowçš„é—®é¢˜æ¢è®¨äº†å¦‚ä½•é€šè¿‡æ”¹å˜çº¦æŸæ¥ä½¿è§†å›¾åŠ¨ç”»</p>
<pre><code class="objective-c">- (void)moveBannerOffScreen {
      [self.view layoutIfNeeded]; // 0
    _addBannerDistanceFromBottomConstraint.constant = -32;  // 1
      // [sel.view layoutIfNeeded]; // æ³¨é‡Š3
    [UIView animateWithDuration:5
        animations:^{
            [self.view layoutIfNeeded]; // 2
        }];
}
</code></pre>
<p>æ³¨é‡Š0ï¼š<strong>å…ˆå¼ºè¡Œè®¡ç®—å‡ºæ¯ä¸ªviewçš„åŠ¨ç”»å¼€å§‹å‰çš„frame</strong></p>
<p>æ³¨é‡Š1ï¼šå…ˆæ›´æ”¹çº¦æŸæ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯æŒ‡å®šåŠ¨ç”»ç»“æŸä¹‹åï¼ŒUIViewè¯¥æ˜¾ç¤ºçš„ä½ç½®ã€‚<strong>ä½†æ˜¯æ­¤æ—¶å¹¶æ²¡æœ‰è®¡ç®—å‡ºviewçš„æœ€ç»ˆçš„frame</strong></p>
<p>æ³¨é‡Š2ï¼š<strong>å…ˆè®°å½•åŠ¨ç”»åˆå§‹ä½ç½®</strong>ï¼›ç„¶ååœ¨åŠ¨ç”»ä¸­æ‰§è¡Œ<strong>layoutIfNeeded</strong>ï¼Œå¼ºè¡Œæ‰§è¡ŒLayoutæ­¥éª¤ï¼Œè®¡ç®—å‡ºæ¯ä¸ªviewçš„ç»“æŸä½ç½®çš„frameï¼Œä¹Ÿå°±æ˜¯åŠ¨ç”»çš„ç»ˆæ­¢çš„frame</p>
<p>æ³¨é‡Š3ï¼šå¦‚æœåœ¨è¿™é‡Œæ‰§è¡Œ<code>layoutIfNeeded</code>çš„è¯ï¼Œå°±ä¼šå¼ºè¡Œè®¡ç®—å‡ºæ¯ä¸ªviewçš„æœ€ç»ˆçš„frameï¼Œé‚£ä¹ˆåŠ¨ç”»ä¼šå°†è¯¥frameè®°ä¸ºåˆå§‹ä½ç½®ã€‚é‚£ä¹ˆ<strong>åˆå§‹ä½ç½®å’Œç»“æŸä½ç½®ç›¸åŒï¼Œç›´æ¥è·³åˆ°æœ€ç»ˆçš„ä½ç½®</strong></p>
<p>å¯ä»¥è¿™ä¹ˆç†è§£ï¼šæ‰§è¡Œå®Œè¿™ä¸€ä¸ªå‡½æ•°åï¼Œå¼€å§‹ä¸‹ä¸€å¸§çš„ç»˜åˆ¶ï¼›è¿™ä¸ªæ—¶å€™çœŸå®çš„viewå·²ç»ç»˜åˆ¶åœ¨æœ€ç»ˆè¯¥æ˜¾ç¤ºçš„ä½ç½®äº†ï¼Œä½†æ˜¯è¢«å±å¹•æœ€ä¸Šæ–¹çš„Animationçš„viewç»™é®æŒ¡äº†ï¼›è¿™ä¸ªAnimation Viewä»ä¸Šä¸€å¸§çš„çŠ¶æ€å¼€å§‹ï¼ŒåŠ¨ç”»åˆ°æœ€ç»ˆçš„ä½ç½®ï¼ˆæœ‰å¾…å•†æ¦·ï¼‰</p>
<pre><code class="objective-c">// ç›¸å¯¹æ¯”çš„UIView animate
{
      view.center = pointA; // æ­¤æ—¶å·²ç»æ”¹å˜äº†viewçš„frameï¼Œ**è®¡ç®—åŠ¨ç”»çš„åˆå§‹ä½ç½®**
      [UIView animateWithDuration:0.5 animations:^{
          view.center = pointB; // è®¡ç®—viewçš„æœ€ç»ˆframeï¼Œ **è®¡ç®—åŠ¨ç”»çš„ç»“æŸä½ç½®**
      }];
}
</code></pre>
<h2 id="åœ¨Auto-Layout-è§†å›¾ä¸­è·å–bound"><a href="#åœ¨Auto-Layout-è§†å›¾ä¸­è·å–bound" class="headerlink" title="åœ¨Auto Layout è§†å›¾ä¸­è·å–bound"></a>åœ¨Auto Layout è§†å›¾ä¸­è·å–bound</h2><p>è¯´è¯´æ–¹æ³•ï¼š</p>
<ol>
<li>è®¾è¦è·å–frameçš„è§†å›¾ä¸ºaï¼Œæ–°å»ºä¸€ä¸ªaçš„å­è§†å›¾bï¼Œä½¿ç”¨Auto Layoutå°†bçš„å››è¾¹ä¸aå¯¹é½</li>
<li>é‡å†™bçš„<code>-drawRect:</code>æ–¹æ³•ï¼Œè·å–rectçš„å®½é«˜ï¼Œä¹Ÿå°±æ˜¯bçš„bound</li>
<li>è°ƒç”¨bçš„<code>setNeedsDisplay</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨<code>-drawRect:</code>æ–¹æ³•ï¼Œä»è€Œè·å–bçš„bound</li>
</ol>
<p><strong>å› ä¸ºåœ¨è°ƒç”¨<code>-drawRect:</code>çš„æ—¶å€™ï¼Œæ¯ä¸ªè§†å›¾çš„frameå·²ç»ç¡®å®šäº†ï¼Œé‚£ä¹ˆæ–¹æ³•ä¸­çš„rectä¹Ÿå°±æ˜¯è¯¥è§†å›¾çš„bound</strong></p>
<p><strong>è¿˜æœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•ï¼šè°ƒç”¨Viewçš„<code>layoutIfNeeded</code>æ–¹æ³•ï¼Œä¼šç«‹å³é‡æ–°è®¡ç®—æ¯ä¸ªviewçš„frame</strong></p>
<h2 id="CATransaction-ä¸-CAKeyframeAnimation"><a href="#CATransaction-ä¸-CAKeyframeAnimation" class="headerlink" title="CATransaction ä¸ CAKeyframeAnimation"></a>CATransaction ä¸ CAKeyframeAnimation</h2><p><strong>åœ¨è¿™é‡Œè¯¦ç»†è¯´ä¸€ä¸‹æ•ˆæœå›¾çš„å®ç°</strong>ï¼š</p>
<ol>
<li><p>å›¾ä¸­çš„æ›²çº¿ä½¿ç”¨UIBezieræ¥ç”»ï¼Œé‚£ä¹ˆå°±éœ€è¦ç¡®å®šçš„åæ ‡ç‚¹ï¼Œä¹Ÿå°±æ˜¯éœ€è¦çŸ¥é“æ›²çº¿æ‰€åœ¨çš„è§†å›¾çš„Viewã€‚é‚£ä¹ˆåœ¨<code>-drawRect:</code> ä¸­ç”»UIBezierPathï¼Œåˆšå¥½å¯ä»¥çŸ¥é“viewçš„bound</p>
</li>
<li><p>å·²ç»å¾—åˆ°pathä¹‹åï¼Œä½¿ç”¨CAKeyframeAnimationæ¥åŠ¨ç”»</p>
<pre><code class="objective-c">// å…ˆè®¾å®š2ä¸ªCAKeyframeAnimation
CAKeyframeAnimation *animation1 = [CAKeyframeAnimation animation];
animation1.keyPath = @&quot;position&quot;;
animation1.path = animation1Path.CGPath;
animation1.duration = 0.5f;
animation1.removedOnCompletion = NO;

CAKeyframeAnimation *animation2 = [CAKeyframeAnimation animation];
animation2.keyPath = @&quot;position&quot;;
animation2.path = animation2Path.CGPath;
animation2.duration = 0.5f;
animation2.removedOnCompletion = NO;

// æ›´æ–°ä¸¤ä¸ªcircleçš„çº¦æŸ
[self.circle1 updateConstraint]ï¼›
[self.circle2 updateConstraint]ï¼›

// æ‰§è¡ŒåŠ¨ç”»
[CATransaction begin];
[self.circle1.layer addAnimation:consultationKeyAnimation forKey:@&quot;circle1&quot;];
[self.circle2.layer addAnimation:followupKeyAnimation forKey:@&quot;circle2&quot;];
[CATransaction commit];
</code></pre>
<p>å…³äºCATransactionï¼šåœ¨ç¬¬ä¸€æ¬¡åŠ¨ç”»æ²¡æ‰§è¡Œå®Œçš„æ—¶å€™ï¼Œç«‹åˆ»å¼€å§‹åŒä¸€ä¸ªtransactionï¼Œä¼šå¼ºåˆ¶è®©ç¬¬ä¸€ä¸ªtransactionçš„åŠ¨ç”»ç«‹åˆ»ç»“æŸåˆ°ç»ˆç‚¹ï¼ˆä¹Ÿå°±æ˜¯å»æ‰Animation Viewçš„é®æŒ¡ï¼‰ï¼Œå†ç«‹åˆ»å¼€å§‹ç¬¬äºŒä¸ªtransactionçš„åŠ¨ç”»</p>
<h2 id="Auto-Layout-ç™¾åˆ†æ¯”å¸ƒå±€"><a href="#Auto-Layout-ç™¾åˆ†æ¯”å¸ƒå±€" class="headerlink" title="Auto Layout ç™¾åˆ†æ¯”å¸ƒå±€"></a>Auto Layout ç™¾åˆ†æ¯”å¸ƒå±€</h2><p>è¿™é‡Œæ— ä¸»é¢˜æ— å…³ã€‚</p>
<p><a href="http://liumh.com/2015/09/27/ios-autolayout-multiplier/" target="_blank" rel="external">iOS AutoLayout ç™¾åˆ†æ¯”å¸ƒå±€</a> è¿™è¾¹æ–‡ç« è°ˆåˆ°äº†Auto Layoutç™¾åˆ†æ¯”å¸ƒå±€çš„é—®é¢˜ï¼Œè®²çš„å¾ˆå¥½ã€‚è¯´ä¸€ä¸ªé‡Œé¢çš„ä¾‹å­ï¼šå­è§†å›¾bçš„leadingè¦ä¸çˆ¶è§†å›¾açš„leadingä¹‹é—´éš”20%çš„å®½åº¦</p>
<pre><code class="objective-c">b.leading = a.trailing * 0.2
</code></pre>
<p>ä½¿ç”¨Masonry</p>
<pre><code class="objective-c">[b mas_makeConstraints:^(MASConstraintMaker *make) {
    make.leading.equalTo(a.mas_trailing).multipliedBy(0.2);
}];
</code></pre>
<p>å¯ä»¥è¿™ä¹ˆç†è§£ï¼š</p>
<pre><code class="objective-c">a.leading = 0;
a.trailing = a.width;
a.trailing * 0.2 = a.width * 0.2;
b.leading - a.leading = 0.2 * a.width - 0 = 0.2 * a.width
</code></pre>
</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://liumh.com/2015/09/27/ios-autolayout-multiplier/" target="_blank" rel="external">iOS AutoLayout ç™¾åˆ†æ¯”å¸ƒå±€</a></li>
<li><a href="http://stackoverflow.com/questions/12622424/how-do-i-animate-constraint-changes" target="_blank" rel="external">How do I animate constraint changes?</a></li>
<li><a href="http://vanney9.com/2017/03/24/something-about-iOS-drawing/" target="_blank" rel="external">å…³äºiOS Drawing</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Effective Objective-C - å†…å­˜ç®¡ç†]]></title>
      <url>/2017/03/25/effective-objective-c-reading-note-three/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><strong>Effective Objective C</strong> è¯»ä¹¦ç¬”è®° - å†…å­˜ç®¡ç†</p>
<a id="more"></a>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="ç†è§£å¼•ç”¨è®¡æ•°"><a href="#ç†è§£å¼•ç”¨è®¡æ•°" class="headerlink" title="ç†è§£å¼•ç”¨è®¡æ•°"></a>ç†è§£å¼•ç”¨è®¡æ•°</h3><ol>
<li><p>å¼•ç”¨å…³ç³»æœ‰ä¸€ä¸ªå¼•ç”¨æ ‘ï¼Œåœ¨iOSä¸­ï¼Œè¿™ä¸ªæ ¹å¼•ç”¨å¯¹è±¡æ˜¯UIApplication</p>
</li>
<li><p>è°ƒç”¨allocï¼Œå¼•ç”¨è®¡æ•°åŠ 1ï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡æƒ³å­˜æ´»ä¸‹å»</p>
</li>
<li><p>å³ä½¿å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0ï¼Œå…¶å ç”¨çš„å†…å­˜å·²ç»è¢«deallocäº†ï¼Œä½†æ˜¯æ³¨æ„ï¼šè¿™ä¸ªæ—¶å€™å®ƒçš„å†…å­˜åªæ˜¯æ”¾å›äº†â€œå¯ç”¨å†…å­˜æ± â€ï¼Œé‡Œé¢çš„æ•°æ®ä¸ä¼šç«‹å³è¢«è¦†ç›–</p>
</li>
<li><p>è®°ä½ä¸€ç‚¹ï¼šåœ¨MRCä¸­ï¼Œå°†æŒ‡é’ˆæŒ‡å‘å¯¹è±¡æ˜¯ä¸ä¼šå¢åŠ reference countçš„ï¼Œå¿…é¡»æ‰‹åŠ¨åŠ 1</p>
</li>
<li><p>çœ‹çœ‹ä¸‹é¢çš„MRCä»£ç ï¼š</p>
<pre><code class="objective-c">- (NSString *)stringValue {
      NSString *str = [[NSString alloc]] initWithFormat:@&quot;vanney&quot;; // 1
      return str;
}

NSString *str = [self stringValue];
[str retain]; // 2
</code></pre>
<p>ä¸Šé¢çš„ä»£ç åœ¨æ³¨é‡Š1ï¼Œå’Œæ³¨é‡Š2å¤„åˆ†åˆ«å¢åŠ äº†ä¸€æ¬¡reference countï¼Œä½†æ˜¯è®²é“ç†è¿™ä¸ªæ—¶å€™åªéœ€è¦ä¸€ä¸ªreference countå°±å¯ä»¥äº†ï¼Œæ‰€ä»¥ä¼šå‡ºç°ä¸€äº›äº›å°é—®é¢˜ã€‚è¿™å°±éœ€è¦<strong>Auto Release Pool</strong>äº†</p>
<pre><code class="objective-c">- (NSString *)stringValue {
      NSString *str = [[NSString alloc]] initWithFormat:@&quot;vanney&quot;;
      return [str autorelease];
}

NSString *str = [self stringValue];
[str retain];
</code></pre>
</li>
<li><p>æ³¨æ„retain cycleï¼Œä¹Ÿå°±æ˜¯ç›¸äº’å¼•ç”¨</p>
</li>
</ol>
<h3 id="ä»¥ARCç®€åŒ–å¼•ç”¨è®¡æ•°"><a href="#ä»¥ARCç®€åŒ–å¼•ç”¨è®¡æ•°" class="headerlink" title="ä»¥ARCç®€åŒ–å¼•ç”¨è®¡æ•°"></a>ä»¥ARCç®€åŒ–å¼•ç”¨è®¡æ•°</h3><ol>
<li>ä»£ç ä¸­ä¸å†éœ€è¦å†™ï¼š<code>retain</code> å’Œ <code>release</code>æ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ–¹æ³•å®é™…ä¸Šè¿˜æ˜¯æ‰§è¡Œäº†çš„ï¼Œä»–ä»¬ç”±ARCå¸®ä½ æ‰§è¡Œ</li>
<li>ARCä¸­è°ƒç”¨è¿™äº›æ–¹æ³•ç»•è¿‡äº†æ¶ˆæ¯è½¬å‘ï¼Œç›´æ¥è°ƒç”¨åº•å±‚çš„Cå‡½æ•°ï¼Œæ›´åŠ å¿«é€Ÿ</li>
<li>å¦‚æœautoreleaseåé¢è·Ÿä¸Šçš„æ˜¯retainï¼Œé‚£ä¹ˆARCå¯ä»¥ä¼˜åŒ–è¿™ä¸¤ä¸ªæ“ä½œï¼ˆå› ä¸ºè¿™ä¸¤ä¸ªæ“ä½œåŠ åœ¨ä¸€èµ·ï¼Œä»€ä¹ˆä¹Ÿæ²¡åšâ€¦ï¼‰ã€‚è¿™ç§ä¼˜åŒ–é€šè¿‡è®¾ç½®æ ‡å¿—ä½æ¥å®ç°ï¼Œå…·ä½“çš„çœ‹ä¹¦~</li>
<li>CoreFoundationçš„å†…å®¹ä¸é€‚åˆARC</li>
</ol>
<h3 id="åœ¨deallocæ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬"><a href="#åœ¨deallocæ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬" class="headerlink" title="åœ¨deallocæ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬"></a>åœ¨deallocæ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬</h3><ol>
<li>dellocæ–¹æ³•åœ¨å¯¹è±¡reference counté™åˆ°0æ—¶ï¼Œä¼šè¢«è°ƒç”¨</li>
<li>å› ä¸ºARCä¼šå¸®ä½ ç”Ÿæˆé‡Šæ”¾å¯¹è±¡æ‰€æ‹¥æœ‰çš„å¼•ç”¨ï¼Œé‚£ä¹ˆä½ éœ€è¦åšçš„ä¸»è¦æœ‰ä¸¤ç‚¹<ol>
<li>é‡Šæ”¾CoreFoundationå¯¹è±¡</li>
<li>è§£é™¤ç›‘å¬è¡Œä¸º</li>
</ol>
</li>
</ol>
<h3 id="ä»¥å¼±å¼•ç”¨é¿å…ä¿ç•™ç¯"><a href="#ä»¥å¼±å¼•ç”¨é¿å…ä¿ç•™ç¯" class="headerlink" title="ä»¥å¼±å¼•ç”¨é¿å…ä¿ç•™ç¯"></a>ä»¥å¼±å¼•ç”¨é¿å…ä¿ç•™ç¯</h3><h3 id="ä»¥â€œè‡ªåŠ¨é‡Šæ”¾æ± å—â€é™ä½å†…å­˜å³°å€¼"><a href="#ä»¥â€œè‡ªåŠ¨é‡Šæ”¾æ± å—â€é™ä½å†…å­˜å³°å€¼" class="headerlink" title="ä»¥â€œè‡ªåŠ¨é‡Šæ”¾æ± å—â€é™ä½å†…å­˜å³°å€¼"></a>ä»¥â€œè‡ªåŠ¨é‡Šæ”¾æ± å—â€é™ä½å†…å­˜å³°å€¼</h3><ol>
<li><p>è‡ªåŠ¨é‡Šæ”¾æ± è¿˜æœ‰å˜é‡å¯è§èŒƒå›´çš„é™åˆ¶</p>
<pre><code class="objective-c">@autoreleasepool {
      id object = [self createObject];
}
[self useObject:object]; // æŠ¥é”™ï¼Œå› ä¸ºobjectå˜é‡å·²ç»ä¸å¯è§äº†
</code></pre>
</li>
</ol>
<h3 id="ç”¨â€œåƒµå°¸å¯¹è±¡â€è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜"><a href="#ç”¨â€œåƒµå°¸å¯¹è±¡â€è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜" class="headerlink" title="ç”¨â€œåƒµå°¸å¯¹è±¡â€è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜"></a>ç”¨â€œåƒµå°¸å¯¹è±¡â€è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜</h3><ol>
<li><p>å‘å·²ç»å›æ”¶çš„å¯¹è±¡å‘é€æ¶ˆæ¯æ˜¯éå¸¸ä¸å®‰å…¨çš„ã€‚å¦‚æœè¯¥å†…å­˜å·²ç»è¢«è¦†å†™äº†ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šå´©æºƒï¼›å¦‚æœæš‚æ—¶æ²¡æœ‰è¢«è¦†å†™ï¼Œé‚£ä¹ˆä¾¥å¹¸å¯ä»¥è¿è¡Œã€‚æ‰€ä»¥è¿™æ—¶å€™<strong>ç¨‹åºä¼šå¶å°”æŠ¥é”™ï¼Œéš¾ä»¥è°ƒè¯•</strong></p>
</li>
<li><p>è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨Cocoaæä¾›çš„ <strong>åƒµå°¸å¯¹è±¡</strong> çš„è°ƒè¯•æ–¹æ³•</p>
</li>
<li><p>å¯ç”¨è¿™ä¸€é¡¹è°ƒè¯•åŠŸèƒ½ä¹‹åï¼šæ‰€æœ‰çš„æœ¬è¦è¢«å›æ”¶çš„å¯¹è±¡ä¼šè¢«è½¬åŒ–æˆç‰¹æ®Šçš„åƒµå°¸å¯¹è±¡ï¼Œè¿™äº›å†…å­˜ä¸ä¼šè¢«è¦†å†™ï¼›å½“åƒµå°¸å¯¹è±¡æ”¶åˆ°æ¶ˆæ¯åï¼Œä»–ä¼šå°†åŸæœ¬çš„å¯¹è±¡ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œå¹¶æç¤ºè¯´ï¼Œä½ ç»™ä¸€ä¸ªå·²ç»å›æ”¶çš„å¯¹è±¡å‘é€äº†ä¿¡æ¯</p>
<p><img src="/lionheart/1703/zombiefix.png" alt="enable zombie"></p>
</li>
<li><p>è‡³äºåƒµå°¸å¯¹è±¡çš„å·¥ä½œåŸç†ï¼Œå…·ä½“çš„çœ‹ä¹¦~</p>
</li>
</ol>
<h3 id="ä¸è¦ä½¿ç”¨retainCount"><a href="#ä¸è¦ä½¿ç”¨retainCount" class="headerlink" title="ä¸è¦ä½¿ç”¨retainCount"></a>ä¸è¦ä½¿ç”¨retainCount</h3><ol>
<li>ARCå·²ç»åºŸå¼ƒ<code>retainCount</code>æ–¹æ³•</li>
</ol>
]]></content>
      
        <categories>
            
            <category> è¯»ä¹¦ç¬”è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[å…³äºiOS Drawing]]></title>
      <url>/2017/03/24/something-about-iOS-drawing/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å­¦äº†ä¸€æ®µæ—¶é—´çš„OpenGLï¼Œè¿™æ¬¡åˆé‡æ–°çœ‹äº†ä¸€é <strong>iOS Core Animation</strong> è¿™æœ¬ä¹¦ï¼ŒæŸ¥çœ‹äº†è®¸å¤šèµ„æ–™ã€‚å¯¹è¿™ä¸ªiOSçš„drawingç¨æœ‰é¡¿æ‚Ÿ=ã€‚=</p>
<p>è¿™ç¯‡æ–‡ç« é‡Œé¢ï¼Œæˆ‘ä¼šé’ˆå¯¹ä¸‹é¢å‡ ä¸ªæ–¹é¢è¯´è¯´æˆ‘è‡ªå·±çš„è§è§£ï¼š</p>
<ol>
<li>Core Animationï¼ŒCore Graphic å’Œ OpenGL ES</li>
<li>Renderingä»¥åŠAnimationçš„æ­¥éª¤</li>
<li>iOS Drawingä¸­çš„CPUï¼ŒGPU</li>
<li>drawRectæ–¹æ³•çš„å¼Šç«¯</li>
<li>å½±å“GPUä¸CPUç»˜åˆ¶çš„å› ç´ </li>
</ol>
<a id="more"></a>
<h2 id="Core-Animationï¼ŒCore-Graphics-å’Œ-OpenGL-ES"><a href="#Core-Animationï¼ŒCore-Graphics-å’Œ-OpenGL-ES" class="headerlink" title="Core Animationï¼ŒCore Graphics å’Œ OpenGL ES"></a>Core Animationï¼ŒCore Graphics å’Œ OpenGL ES</h2><p>Core Animationï¼ŒCore Graphics å’Œ OpenGL ES ä¸‰è€…éƒ½æ˜¯å’ŒiOSç”»å›¾ï¼Œå‘ˆç°å†…å®¹ç›¸å…³çš„iOSæ¡†æ¶ã€‚æ€»ä½“æ¥è¯´ï¼ŒCore Animationå’ŒUIKitæ˜¯ä¸€ä¸ªå±‚çº§çš„ï¼Œè€Œä»–ä»¬åº•å±‚ç”»å›¾çš„æ¡†æ¶å°±æ˜¯Core Graphics å’Œ OpenGL ESã€‚</p>
<ol>
<li><strong>Core Animation</strong> æ˜¯iOSç”¨æ¥æ§åˆ¶å†…å®¹çš„æ˜¾ç¤ºå’ŒåŠ¨ç”»çš„ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½å°±æ˜¯ç®¡ç†<strong>CALayer</strong>ã€‚</li>
<li><strong>UIView</strong> å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰ã€‚é‚£ä¹ˆUIViewåº•å±‚è´Ÿè´£æ˜¾ç¤ºå†…å®¹å’ŒåŠ¨ç”»çš„å°±æ˜¯ <strong>CALayer</strong> ã€‚UIViewä¸Šå’Œæ˜¾ç¤ºä»¥åŠåŠ¨ç”»ç›¸å…³çš„æ¥å£ï¼Œå…¶å®ä¹Ÿæ˜¯å¯¹CALayerçš„æ¥å£çš„åŒ…è£…</li>
<li>CALayerçš„contentsæœ€ç»ˆä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚è€Œ<strong>Core Graphics</strong> å’Œ <strong>OpenGL ES</strong>å°±è´Ÿè´£åœ¨CALayerä¸Šé¢ä½œç”»ï¼Œå¹¶å°†å…¶å†…å®¹æ˜¾ç¤ºåˆ°å±å¹•ä¸Š</li>
<li><strong>Core Graphics</strong>æ˜¯ä¸ª2Då›¾å½¢åº“ï¼Œä¸€èˆ¬ç”¨æ¥ç”»çŸ¢é‡å›¾ï¼Œæ¯”å¦‚UIBezierPathç­‰ç­‰ã€‚å®ƒä¸»è¦ä½¿ç”¨CPUæ¥ç»˜åˆ¶ã€‚ä»¥ç»˜åˆ¶ä¸€æ¡UIBezierPathä¸ºä¾‹ï¼šé€šè¿‡CPUçš„è®¡ç®—ï¼Œç”ŸæˆåŒ…å«è¯¥pathè·¯å¾„çš„bitmapï¼Œç„¶åå°†è¯¥bitmapä¼ é€’ç»™GPUï¼Œç»˜åˆ¶å‡ºæ¥ã€‚æ‰€ä»¥Core Graphicsçš„ä¸»è¦è®¡ç®—å‹åŠ›åœ¨CPUä¸Šé¢ï¼Œè€Œä¸”ä½¿ç”¨CPUæ¥ç”Ÿæˆbitmapæ˜¯å¾ˆè€—æ—¶çš„ä¸€ä¸ªæ­¥éª¤</li>
<li><strong>OpenGL ES</strong> è®²é“ç†æ˜¯å¯ä»¥ç”»ä»»ä½•çš„2Dã€3Då›¾å½¢çš„ã€‚ä»¥ç»˜åˆ¶ä¸€ä¸ªä¸‰è§’å½¢ä¸ºä¾‹ï¼Œåªéœ€è¦å°†3ä¸ªé¡¶ç‚¹ä¼ é€’ç»™GPUï¼Œç„¶åGPUä¼šè®¡ç®—ç”ŸæˆåŒ…å«è¯¥ä¸‰è§’å½¢çš„bitmapï¼Œæœ€ç»ˆä½¿ç”¨GPUå°†è¯¥bitmapç»˜åˆ¶å‡ºæ¥ã€‚</li>
<li>æ‰€ä»¥æˆ‘ç†è§£çš„Core Graphicså’ŒOpenGL ESçš„ä¸»è¦åŒºåˆ«å°±æ˜¯ç”Ÿæˆæœ€ç»ˆçš„ <strong>bitmap</strong> çš„ä½ç½®ã€‚Core Graphicsç”±CPUæ¥ç”Ÿæˆbitmapï¼›OpenGL ESç”±GPUæ¥ç”Ÿæˆbitmapã€‚ æœ€ç»ˆè¿™ä¸ªbitmapéƒ½è¦äº¤ç»™GPUæ¥æ¸²æŸ“åˆ°å±å¹•ä¸Šé¢ã€‚</li>
<li>ç”±äºCPUç”Ÿæˆbitmapè¾ƒä¸ºè€—æ—¶ï¼ˆè¿™ä¹Ÿæ˜¯Core Graphicsæ€§èƒ½å·®çš„åŸå› ï¼‰ï¼Œè€Œä¸”CPUè¿˜è¦æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡ï¼Œæ‰€ä»¥ä¸æ¨èä½¿ç”¨Core Graphicsæ¥ç»˜åˆ¶ã€‚</li>
<li>Core Animationå¯¹ç»˜åˆ¶è¿‡ç¨‹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¤§å¤šæ•°çš„UIKité‡Œé¢çš„åŸä»¶(UIView)çš„åº•å±‚layeréƒ½æ˜¯ç¡¬ä»¶åŠ é€Ÿçš„ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨GPUæ¥ç”Ÿæˆbitmapå¹¶ç»˜åˆ¶ã€‚</li>
</ol>
<h2 id="Renderingå’ŒAnimationçš„æ­¥éª¤"><a href="#Renderingå’ŒAnimationçš„æ­¥éª¤" class="headerlink" title="Renderingå’ŒAnimationçš„æ­¥éª¤"></a>Renderingå’ŒAnimationçš„æ­¥éª¤</h2><p>å‚è€ƒ<strong>iOS Core Animation</strong> ä¸€ä¹¦çš„ç¬¬12ç« </p>
<ol>
<li><strong>Layout</strong>ï¼š è®¾ç½®view/layeræ ‘ç§æ¯ä¸ªlayerçš„å±æ€§(frame, background color, borderç­‰ç­‰)</li>
<li><strong>Display</strong>ï¼š ç”Ÿæˆlayerçš„backing imageï¼Œåœ¨è¿™ä¸€æ­¥æ¶‰åŠåˆ°<code>-drawRect:</code>å’Œ<code>-drawLayer:inContext:</code>çš„è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨CPUç”Ÿæˆbitmapï¼Œæ¥å¡«å……backing imageã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨UIImageæ¥å¡«å……backing imageã€‚</li>
<li><strong>Prepare</strong>ï¼š Core Animationå‡†å¤‡å¥½Animationçš„æ•°æ®ï¼Œæ¯”å¦‚åŠ¨ç”»çš„å±æ€§ï¼Œç»ˆæ­¢å€¼ç­‰ç­‰</li>
<li><strong>Commit</strong>ï¼š Core Animationå°†æ‰€æœ‰layeræ•°æ®å’ŒåŠ¨ç”»æ•°æ®æ‰“åŒ…å°†ä»–ä»¬å‘é€ç»™<strong>render server</strong> è¿›è¡Œæ˜¾ç¤º</li>
<li>å°†layerçš„å±æ€§è®¡ç®—ï¼Œè½¬åŒ–æˆOpenGLçš„é¡¶ç‚¹ç­‰å±æ€§ï¼ˆæä¾›æ•°æ®ç»™GPUï¼Œè®¡ç®—bitmapï¼Œä¹Ÿå°±æ˜¯OpenGLä¸­çš„å„ä¸ªä¸‰è§’å½¢ï¼‰</li>
<li>GPUç»„åˆå„ä¸ªlayerçš„bitmapï¼Œå°†å…¶æ¸²æŸ“åœ¨å±å¹•ä¸Š</li>
</ol>
<h2 id="iOS-Drawingä¸­çš„CPUå’ŒGPU"><a href="#iOS-Drawingä¸­çš„CPUå’ŒGPU" class="headerlink" title="iOS Drawingä¸­çš„CPUå’ŒGPU"></a>iOS Drawingä¸­çš„CPUå’ŒGPU</h2><ol>
<li>Core Graphicsä½¿ç”¨CPUè®¡ç®—bitmap</li>
<li>OpenGL ESä½¿ç”¨GPUè®¡ç®—bitmap</li>
<li>ä½¿ç”¨GPUå°†æ‰€æœ‰çš„layerçš„bitmapç»„åˆåœ¨ä¸€èµ·</li>
</ol>
<h2 id="drawRectæ–¹æ³•çš„å¼Šç«¯"><a href="#drawRectæ–¹æ³•çš„å¼Šç«¯" class="headerlink" title="drawRectæ–¹æ³•çš„å¼Šç«¯"></a>drawRectæ–¹æ³•çš„å¼Šç«¯</h2><p>drawRectæ–¹æ³•æ˜¯å¯¹drawLayer:inContext:çš„åŒ…è£…ã€‚ä¸¤ä¸ªæ–¹æ³•å¦‚æœæœ‰å®ç°çš„è¯ï¼Œåœ¨é‡ç»˜layerçš„æ—¶å€™ä¼šè°ƒç”¨ã€‚ä»–ä»¬é€‚åˆè‡ªå®šä¹‰layerå†…å®¹ã€‚ä½†æ˜¯ä¼šå½±å“æ€§èƒ½</p>
<p>åœ¨æ¯æ¬¡è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œéƒ½ä¼šæ–°å»ºä¸€ä¸ªä¸å½“å‰çš„layerçš„å¤§å°ç›¸ç­‰çš„ç©ºçš„contextï¼ˆbitmapï¼‰ï¼Œç„¶åä½¿ç”¨Core Graphicsæˆ–è€…ç›´æ¥UIImageç­‰ç­‰å°†è¯¥contextå¡«å……ã€‚è¿™ç›¸å½“ä¸ç¦»å±æ¸²æŸ“ã€‚ç„¶åå°†ç”Ÿæˆçš„contextå†èµ‹ç»™layerçš„contentï¼Œå†äº¤ç»™GPUæ¸²æŸ“å‡ºæ¥ã€‚</p>
<p>æ³¨æ„ï¼šCALayerä¼šcacheè‡ªå·±çš„bitmapï¼Œé‚£ä¹ˆæ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™å°±ä¸éœ€è¦é‡æ–°ç”ŸæˆCALayerçš„bitmapã€‚åªéœ€è¦å°†bitmapäº¤ç»™GPUï¼Œè®©GPUæ‰§è¡Œç»„åˆå·¥ä½œå°±å¯ä»¥äº†ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç”Ÿæˆbitmapï¼ˆæ— è®ºåœ¨CPUç«¯è¿˜æ˜¯GPUç«¯ï¼‰éƒ½æ˜¯æ¯”ç»„åˆbitmapè€—æ—¶çš„</p>
<h2 id="å½±å“GPUä¸CPUç»˜åˆ¶çš„å› ç´ "><a href="#å½±å“GPUä¸CPUç»˜åˆ¶çš„å› ç´ " class="headerlink" title="å½±å“GPUä¸CPUç»˜åˆ¶çš„å› ç´ "></a>å½±å“GPUä¸CPUç»˜åˆ¶çš„å› ç´ </h2><h3 id="GPUç«¯"><a href="#GPUç«¯" class="headerlink" title="GPUç«¯"></a>GPUç«¯</h3><ol>
<li>å¤ªå¤šçš„é‡å¤ç»˜åˆ¶ï¼šä¸€æ¬¡ç»˜åˆ¶è¿‡ç¨‹ä¸­ï¼Œåœ¨åŒä¸€ä¸ªåƒç´ ç‚¹ï¼Œç»˜åˆ¶å¤šé</li>
<li>ç¦»å±æ¸²æŸ“ï¼šCPUå’ŒGPUéƒ½ä¼šå‡ºç°ç¦»å±æ¸²æŸ“çš„æƒ…å†µï¼Œè¿™éœ€è¦é¢å¤–çš„å†…å­˜æ¥å­˜æ”¾æ¸²æŸ“çš„ç»“æœ</li>
<li>å¤ªå¤šçš„geometryï¼šä¹Ÿå°±æ˜¯OpenGLä¸­ï¼Œå¤ªå¤šçš„ä¸‰è§’å½¢</li>
<li>æ¸²æŸ“å¤ªå¤§çš„å›¾ç‰‡ï¼šGPUæ”¯æŒçš„æœ€å¤§çš„æ¸²æŸ“textureæ˜¯æœ‰é™çš„ï¼ˆé€šå¸¸2048*2048ï¼Œæˆ–è€…retinaçš„4096*4096ï¼‰ï¼Œå›¾ç‰‡åƒç´ è¿‡å¤§çš„è¯ï¼Œè¦å…ˆåœ¨CPUç«¯å¤„ç†ä¹‹åï¼Œæ‰èƒ½äº¤ç»™GPUæ˜¾ç¤º</li>
</ol>
<h3 id="CPUç«¯"><a href="#CPUç«¯" class="headerlink" title="CPUç«¯"></a>CPUç«¯</h3><ol>
<li>Layoutè®¡ç®—ï¼šä¹Ÿå°±æ˜¯è®¡ç®—æ¯ä¸ªlayerçš„frameç­‰ç­‰å±æ€§ï¼Œè¿™ä¸ªåœ¨ä½¿ç”¨autolayoutçš„ç³»ç»Ÿä¸Šé¢æ›´åŠ çš„è´¹æ—¶</li>
<li>Lazy View Loadingï¼šåªæœ‰åœ¨viewç¬¬ä¸€æ¬¡å‡ºç°åœ¨å±å¹•ä¸Šæ—¶ï¼Œæ‰ä¼šå»åŠ è½½viewç›¸å…³çš„èµ„æºï¼ˆå›¾ç‰‡ç­‰ç­‰ï¼‰ï¼Œæ‰€ä»¥å¦‚æœè¿™ä¸ªèµ„æºå¾ˆå¤§ï¼Œæˆ–è€…å»¶è¿Ÿå¾ˆå¤§ï¼ˆç½‘ç»œè·å–ï¼‰çš„æ—¶å€™ï¼Œä¼šå»¶ç¼“CPUçš„æ“ä½œã€‚è¿™ä¸€æ­¥çš„æ“ä½œåŒ…æ‹¬Layoutï¼ŒDisplayç­‰æ­¥éª¤</li>
<li>Core Graphics drawing</li>
<li>å›¾ç‰‡è§£å‹ï¼šå› ä¸ºå­˜æ”¾çš„åŸºæœ¬éƒ½æ˜¯å‹ç¼©çš„å›¾ç‰‡ï¼Œä½†æ˜¯æ˜¾ç¤ºçš„æ—¶å€™éœ€è¦å…¨sizeçš„å›¾ç‰‡ï¼Œæ‰€ä»¥éœ€è¦CPUæ‰§è¡Œå›¾ç‰‡è§£å‹çš„å·¥ä½œ</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://stackoverflow.com/questions/14659563/to-drawrect-or-not-to-drawrect-when-should-one-use-drawrect-core-graphics-vs-su" target="_blank" rel="external">to drawRect or not to drawRect (when should one use drawRect/Core Graphics vs subviews/images and why?)</a></li>
<li><a href="http://stackoverflow.com/questions/7287254/calayer-vs-cgcontext-which-is-a-better-design-approach" target="_blank" rel="external">CALayer vs CGContext, which is a better design approach?</a></li>
<li><a href="http://floriankugler.com/2013/05/24/layer-trees-vs-flat-drawing-graphics-performance-across-ios-device-generations/" target="_blank" rel="external">Layer Trees vs. Flat Drawing â€“ Graphics Performance Across iOS Device Generations</a></li>
<li><a href="http://vanney9.com/2016/07/01/iOS-Core-Animation-reading-note-one/" target="_blank" rel="external">iOS Core Animation - The Layer Beneath</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Effective Objective-C - åè®®ä¸åˆ†ç±»]]></title>
      <url>/2017/03/23/effective-objective-c-reading-note-two/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><strong>Effective Objective-C</strong> è¯»ä¹¦ç¬”è®° - åè®®ä¸åˆ†ç±»</p>
<p>åè®®ï¼ˆ<strong>protocol</strong>ï¼‰ä¸Javaçš„æ¥å£ï¼ˆ<strong>interface</strong>ï¼‰ç±»ä¼¼ï¼Œç”±äºOCä¸æ”¯æŒ<strong>å¤šé‡ç»§æ‰¿</strong>ã€‚é€šè¿‡åè®®ï¼Œå¯ä»¥å®ç°ç±»ä¼¼å¤šé‡ç»§æ‰¿çš„æ•ˆæœã€‚è‹¥æŒ‡å®šæŸä¸ªç±»å®ç°äº†æŸä¸ªåè®®ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºï¼Œè¯¥ç±»å®ç°äº†åè®®ä¸­è§„å®šäº†ä¸€äº›æ–¹æ³•ã€‚</p>
<p>åˆ†ç±»ï¼ˆ<strong>category</strong>ï¼‰æ˜¯OCçš„é‡è¦çš„ä¸€ä¸ªè¯­è¨€ç‰¹æ€§ã€‚åˆ©ç”¨åˆ†ç±»æœºåˆ¶ï¼Œæ— é¡»ç»§æ‰¿å­ç±»å³å¯ä¸ºå½“å‰ç±»æ·»åŠ æ–¹æ³•ã€‚è¿™ä¹Ÿæ˜¯ç”±äºåŠ¨æ€runtimeç³»ç»Ÿï¼Œæ‰å¾—ä»¥å®ç°ã€‚</p>
<a id="more"></a>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="é€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡"><a href="#é€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡" class="headerlink" title="é€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡"></a>é€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡</h3><ol>
<li><p>æ³¨æ„ä¸€ç‚¹ï¼Œå£°æ˜delegateçš„æ—¶å€™ï¼Œè¦å£°æ˜æˆweakç±»å‹çš„ã€‚é¿å…å¾ªç¯å¼•ç”¨ã€‚</p>
</li>
<li><p>é€šå¸¸å°†ï¼šå§”æ‰˜å¯¹è±¡æ˜¯å¦å¯ä»¥å“åº”åè®®ä¸­çš„æŸä¸ªæ–¹æ³• è¿™ä¸€ä¿¡æ¯ç¼“å­˜èµ·æ¥ã€‚ä¹‹åå°±ä¸éœ€è¦ä¸€ç›´æŸ¥è¯¢è¯¥å¯¹è±¡æ˜¯å¦å“åº”è¯¥æ–¹æ³•äº†ã€‚ç¼“å­˜å¯ä»¥ä½¿ç”¨<strong>ä½æ®µ</strong>æ¥å®ç°ã€‚</p>
<pre><code class="objective-c">@interface Example() {
      struct {
          unsigned int didReceiveData : 1;
          unsigned int didFailWithError : 1;
      } _delegateFlags;
}
@end

@implementation Example
- (void)setDelegate:(id&lt;ExampleDelegate&gt;)delegate {
      _delegate = delegate;
      _delegateFlags.didReceiveData = [delegate respondsToSelector:@selector(didReceiveData:)];
      _delegateFlags.didFailWithError = [delegate respondsToSelector:@selector(didFailWithError:)];
}
@end
</code></pre>
<p>åœ¨è°ƒç”¨delegateæ—¶ï¼Œå°±ä¸éœ€è¦åˆ¤æ–­delegateæ˜¯å¦å“åº”æŸæ–¹æ³•äº†ï¼Œåªéœ€è¦çœ‹_delegateFlagsé‡Œé¢çš„å­—æ®µå°±å¯ä»¥äº†</p>
</li>
</ol>
<h3 id="å°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¹‹ä¸­"><a href="#å°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¹‹ä¸­" class="headerlink" title="å°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¹‹ä¸­"></a>å°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¹‹ä¸­</h3><ol>
<li>å°†ç±»çš„æ–¹æ³•åˆ†æ•£åˆ°å‡ ä¸ªåˆ†ç±»ä¸­<ol>
<li>EOCPerson+Friendship(.h/.m)</li>
<li>EOCPerson+Work(.h/.m)</li>
<li>EOCPerson+Play(.h/.m)</li>
</ol>
</li>
<li>å¯ä»¥åˆ›å»ºä¸€ä¸ªPrivateçš„åˆ†ç±»ï¼Œå°†æ‰€æœ‰çš„â€˜ç§æœ‰æ–¹æ³•â€™å†™åœ¨é‡Œé¢ï¼Œè¿™ä¸ªprivateçš„å¤´æ–‡ä»¶å¯ä»¥è¢«å…¶ä»–æ–‡ä»¶æ‰€å¼•ç”¨ï¼Œä½†æ˜¯å‘å¸ƒçš„æ—¶å€™ï¼Œä¸ä¼šå…¬å¸ƒå‡ºå»ã€‚æ‰€ä»¥åªèƒ½åœ¨ç¨‹åºå†…éƒ¨ä½¿ç”¨ï¼Œç¬¬ä¸‰æ–¹ä½¿ç”¨è€…æ— æ³•ä½¿ç”¨privateåˆ†ç±»ä¸­çš„æ–¹æ³•ã€‚</li>
</ol>
<h3 id="æ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹ç±»çš„åˆ†ç±»åç§°åŠ å‰ç¼€"><a href="#æ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹ç±»çš„åˆ†ç±»åç§°åŠ å‰ç¼€" class="headerlink" title="æ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹ç±»çš„åˆ†ç±»åç§°åŠ å‰ç¼€"></a>æ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹ç±»çš„åˆ†ç±»åç§°åŠ å‰ç¼€</h3><ol>
<li><p>åˆ†ç±»æœºåˆ¶é€šå¸¸ç”¨äºå‘äº”å…ƒå—çš„æ—¢æœ‰ç±»ä¸­æ–°å¢åŠŸèƒ½ã€‚</p>
</li>
<li><p>åˆ†ç±»çš„æ–¹æ³•ç›¸å½“äºç›´æ¥æ·»åŠ åœ¨æ—¢æœ‰ç±»ä¸­çš„ï¼Œä»–ä»¬å¥½æ¯”è¿™ä¸ªç±»çš„å›ºæœ‰æ–¹æ³•</p>
</li>
<li><p>å°†åˆ†ç±»ä¸­çš„æ–¹æ³•åŠ å…¥æ—¢æœ‰ç±»çš„æ–¹æ³•åˆ—è¡¨æ˜¯åœ¨runtimeåŠ è½½åˆ†ç±»çš„æ—¶å€™ã€‚è¿™å°±æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œå¦‚æœåˆ†ç±»ä¸­çš„æ–¹æ³•åå’Œæ—¢æœ‰ç±»åŸå§‹æ–¹æ³•åŒåï¼Œé‚£ä¹ˆä¼šè¦†ç›–åŸå§‹æ–¹æ³•çš„å®ç°</p>
</li>
<li><p>åŸºäºä¸Šè¿°é—®é¢˜ï¼Œå°±è¦åŠ å‰ç¼€</p>
<pre><code class="objective-c">@interface NSString (ABC_HTTP)
- (NSString *)abc_method;
@end
</code></pre>
</li>
</ol>
<h3 id="å‹¿åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§"><a href="#å‹¿åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§" class="headerlink" title="å‹¿åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§"></a>å‹¿åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§</h3><ol>
<li>å±æ€§åŒ…å«å®ä¾‹å˜é‡ï¼Œåˆ†ç±»æ— æ³•è‡ªåŠ¨åˆæˆå±æ€§çš„å®ä¾‹å˜é‡ã€‚</li>
<li>è¦æƒ³ç¡¬æ·»åŠ å±æ€§ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚æ‰‹åŠ¨æ·»åŠ åˆæˆå®ä¾‹å˜é‡çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å®ç°è¯¥å±æ€§çš„å­˜å–æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ <code>objc_getAssociatedObject</code>å’Œ<code>objc_setAssociatedObject</code> æ–¹æ³•</li>
</ol>
<h3 id="ä½¿ç”¨class-continuationåˆ†ç±»éšè—å®ç°ç»†èŠ‚"><a href="#ä½¿ç”¨class-continuationåˆ†ç±»éšè—å®ç°ç»†èŠ‚" class="headerlink" title="ä½¿ç”¨class-continuationåˆ†ç±»éšè—å®ç°ç»†èŠ‚"></a>ä½¿ç”¨class-continuationåˆ†ç±»éšè—å®ç°ç»†èŠ‚</h3><ol>
<li><p>è¿™ç§åˆ†ç±»ä¸æ™®é€šçš„åˆ†ç±»ä¸åŒã€‚å…¶å®æˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨è¿™ä¸ªåˆ†ç±»ã€‚ã€‚ã€‚</p>
</li>
<li><p>è¿™ä¸ªåˆ†ç±»æ˜¯å”¯ä¸€èƒ½æ­£å¸¸çš„å£°æ˜å®ä¾‹å˜é‡çš„åˆ†ç±»ï¼Œä»–å¿…é¡»å†™åœ¨å®ç°æ–‡ä»¶ä¸­</p>
<pre><code class="objective-c">@interface EOCPerson() {
      NSString *_instanceVariable; // å®ä¾‹å˜é‡
}
@property (nonatomic, strong) NSString *pro; // å±æ€§
- (void)p_someMethod; // å£°æ˜ç§æœ‰æ–¹æ³•
@end
</code></pre>
</li>
<li><p>è™½ç„¶ä¸è¦æ±‚å£°æ˜ç§æœ‰æ–¹æ³•ï¼Œä½†æ˜¯æœ€å¥½è¿™æ ·åš</p>
</li>
<li><p>å¦‚æœåªæ˜¯ç§æœ‰çš„éµå¾ªæŸåè®®çš„è¯ï¼Œä¹Ÿéœ€æ”¾åœ¨è¯¥åˆ†ç±»ä¸­</p>
<pre><code class="objective-c">@interface EOCPerson () &lt;EOCSecretDelegate&gt;
@end
</code></pre>
</li>
</ol>
<h3 id="é€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡"><a href="#é€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡" class="headerlink" title="é€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡"></a>é€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡</h3><ol>
<li><p><code>id&lt;EOCPersonDelegate&gt; delegate;</code> è¿™ä¸ªdelegateå°±æ˜¯åŒ¿åå¯¹è±¡ï¼Œä¸éœ€è¦å…³å¿ƒå¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹ï¼Œåªè¦ä»–éµå¾ªè¯¥åè®®å°±å¯ä»¥äº†</p>
</li>
<li><p>ä½¿ç”¨è¿™ä¸ªè¿˜å¯ä»¥è¿”å›å¤šä¸ªåŸºç±»ä¸æ˜¯ç›¸åŒçš„ç±»ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">@protocal EOCDBConnection
- (void)connect;
- (void)disconnect;
- (BOOL)isConnect;
- (NSArray *)performQuery:(NSString *)query;
@end

@interface EOCManager : NSObject
+ (id)sharedInstance;
- (id&lt;EOCDBConnection&gt;)connectionWithIdentifier:(NSString *)identifier;
@end
</code></pre>
<p>ä¸Šé¢è¿™ä¸ªä¾‹å­ç”¨æ¥å®ç°æ•°æ®åº“çš„è¿æ¥ï¼Œä¸ç®¡æ˜¯è¿æ¥ä½•ç§ç±»å‹çš„æ•°æ®åº“ï¼ˆMysqlï¼ŒSQLiteï¼ŒPostreSQLï¼‰ç­‰ç­‰ï¼Œéƒ½å¯ä»¥ä½¿ç”¨<code>connectionWithIdentifier:</code>æ–¹æ³•ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•åº•å±‚çš„å®ç°ï¼šæ ¹æ®ä¸åŒçš„identifierï¼Œé€‰æ‹©æ€§çš„è¿”å›ä¸è¿æ¥ Mysqlæˆ–æ˜¯SQLiteæˆ–æ˜¯PostreSQL ç›¸å…³çš„å¯¹è±¡ï¼Œå¯èƒ½è¿”å›çš„å¯¹è±¡å«åš MySQLManager, SQLiteManager, PostreSQLManagerã€‚ è¿™äº›å¯¹è±¡å› ä¸ºå¯èƒ½æ˜¯æ¥è‡ª3ç§ç¬¬ä¸‰æ–¹åº“çš„ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ç›¸åŒçš„åŸºç±»ï¼Œä½†æ˜¯åªè¦ä»–ä»¬å®ç°äº†delegateçš„æ–¹æ³•ï¼Œéƒ½å¯ä»¥è¿™æ ·è¿”å›ã€‚</p>
<p>è¿™æ ·åšï¼šæ—¢ä¿è¯äº†æ¥å£çš„ç®€ä»‹ï¼Œåˆéšè—äº†åº•å±‚çš„å®ç°</p>
</li>
</ol>
]]></content>
      
        <categories>
            
            <category> è¯»ä¹¦ç¬”è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Effective Objective-C - æ¥å£ä¸APIè®¾è®¡]]></title>
      <url>/2017/03/21/effective-objective-c-reading-note-one/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><strong>Effective Objective-C</strong> è¯»ä¹¦ç¬”è®° - æ¥å£ä¸APIè®¾è®¡</p>
<a id="more"></a>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="ç”¨å‰ç¼€é¿å…å‘½åç©ºé—´å†²çª"><a href="#ç”¨å‰ç¼€é¿å…å‘½åç©ºé—´å†²çª" class="headerlink" title="ç”¨å‰ç¼€é¿å…å‘½åç©ºé—´å†²çª"></a>ç”¨å‰ç¼€é¿å…å‘½åç©ºé—´å†²çª</h3><ol>
<li>å‰ç¼€å­—æ¯è‡³å°‘3ä¸ªï¼Œä¸¤å­—æ¯çš„å‰ç¼€è¢«Appleä¿ç•™</li>
<li>æ³¨æ„ï¼šå®ç°æ–‡ä»¶ä¸­çš„çº¯Cå‡½æ•°ä»¥åŠå…¨å±€å˜é‡ä¹Ÿæœ€å¥½è¦åŠ å‰ç¼€ï¼Œå› ä¸ºä»–ä»¬ä¹Ÿæ˜¯å…¨å±€å¯è§çš„ã€‚çº¯Cå‡½æ•°ï¼Œé»˜è®¤æ˜¯externçš„ã€‚ï¼ˆ<strong>PS</strong> è§å‚è€ƒ1ï¼‰</li>
</ol>
<h3 id="æä¾›å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•"><a href="#æä¾›å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•" class="headerlink" title="æä¾›å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•"></a>æä¾›å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•</h3><ol>
<li><p>åˆå§‹åŒ–æ–¹æ³•ä»¥ <strong>init</strong> å¼€å¤´ã€‚</p>
</li>
<li><p>å¦‚æœä¸€ä¸ªç±»æœ‰å¤šä¸ªåˆå§‹åŒ–æ–¹æ³•çš„è¯ï¼Œæœ€å¥½è¦é€‰å®šä¸€ä¸ªæ–¹æ³•ä¸ºå…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ï¼Œè®©å…¶ä»–çš„åˆå§‹åŒ–æ–¹æ³•éƒ½æ¥è°ƒç”¨è¿™ä¸ªå…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ã€‚</p>
</li>
<li><p>åœ¨å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œæ‰æ‰§è¡Œæ•°æ®çš„å­˜å‚¨ç­‰ç­‰æ“ä½œï¼›å…¶ä»–æ–¹æ³•åªæ˜¯æ”¹å˜è°ƒç”¨å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•çš„å‚æ•°è€Œå·²ã€‚è¿™æ ·ç®€å•åœ°ä¿è¯äº†æ‰€æœ‰çš„åˆå§‹åŒ–æ–¹æ³•éƒ½èƒ½æ­£ç¡®æ‰§è¡Œã€‚</p>
</li>
<li><p>å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•è¦é“¾å¼è°ƒç”¨ï¼šä¹Ÿå°±æ˜¯è¯´ï¼Œå­ç±»çš„å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•è¦è°ƒç”¨è¶…ç±»çš„å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ã€‚</p>
</li>
<li><p>è¿˜æœ‰å­ç±»çš„å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•å¦‚æœä¸è¶…ç±»çš„å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ä¸é‡åçš„è¯ï¼Œè¦è¦†å†™è¯¥æ–¹æ³•</p>
<pre><code class="objective-c">// è¶…ç±»å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•(çŸ©å½¢ç±»)
- (id)initWithWidth:(float)width andHeight:(float)height {
      if (self = [super init]) {
          _width = width;
          _height = height;
      }
      return self;
}

// å­ç±»å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•(æ­£æ–¹å½¢ç±»)
- (id)initWithDimension:(float)dimension {
      if (self = [super initWithWidth:dimension andHeight:dimension]) { // å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•é“¾å¼è°ƒç”¨

      }
      return self;
}

// è¦†å†™è¶…ç±»æ–¹æ³•
- (id)initWithWidth:(float)width andHeight:(float)height {
      float dimension = MAX(width, height);
      return [self initWithDimension:dimension];
}
</code></pre>
<p>è¿™æ ·ä¿è¯äº†ï¼š</p>
<ol>
<li>å­ç±»è°ƒç”¨è‡ªå·±çš„ä»»ä½•åˆå§‹åŒ–æ–¹æ³•ï¼Œéƒ½æœ€ç»ˆä¼šè°ƒç”¨è‡ªå·±çš„å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•</li>
<li>å­ç±»è°ƒç”¨è¶…ç±»çš„ä»»ä½•åˆå§‹åŒ–æ–¹æ³•ï¼Œæœ€ç»ˆä¼šè°ƒç”¨è¶…ç±»çš„å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ï¼›ä½†æ˜¯è¯¥æ–¹æ³•è¢«è¦†å†™ï¼Œè€Œä¸”è¦†å†™æ—¶è°ƒç”¨äº†å­ç±»è‡ªå·±çš„å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ã€‚æ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨äº†å­ç±»è‡ªå·±çš„å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•~~</li>
</ol>
</li>
</ol>
<h3 id="å®ç°descriptionæ–¹æ³•"><a href="#å®ç°descriptionæ–¹æ³•" class="headerlink" title="å®ç°descriptionæ–¹æ³•"></a>å®ç°descriptionæ–¹æ³•</h3><ol>
<li>æ–¹ä¾¿è°ƒè¯•</li>
<li>é™¤äº†ä½ æƒ³çœ‹åˆ°çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æ˜¯è¦å°†é»˜è®¤çš„descriptionçš„ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼šä¹Ÿå°±æ˜¯ç±»åå­—å’ŒæŒ‡é’ˆåœ°å€</li>
<li>æ³¨æ„NSObjectåè®®ä¸­çš„<code>debugDescription</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åªåœ¨ å¼€å‘è€…åœ¨æ§åˆ¶å°ä¸­æ‰“å°å¯¹è±¡æ—¶ æ‰ä¼šè¢«è°ƒç”¨ã€‚å®ƒçš„é»˜è®¤å®ç°æ˜¯ç›´æ¥è°ƒç”¨ description æ–¹æ³•ã€‚åœ¨LLDBæ§åˆ¶å°è¾“å…¥ <code>po object</code> å¯ä»¥æ‰“å°objectå¯¹è±¡</li>
</ol>
<h3 id="å°½é‡ä½¿ç”¨ä¸å¯å˜å¯¹è±¡"><a href="#å°½é‡ä½¿ç”¨ä¸å¯å˜å¯¹è±¡" class="headerlink" title="å°½é‡ä½¿ç”¨ä¸å¯å˜å¯¹è±¡"></a>å°½é‡ä½¿ç”¨ä¸å¯å˜å¯¹è±¡</h3><ol>
<li>å°½é‡å°†å¯¹å¤–çš„å±æ€§è®¾ç½®ä¸ºreadonly</li>
<li>å¯ä»¥åœ¨å®ç°æ–‡ä»¶é‡Œé¢ï¼Œå°†å±æ€§é‡æ–°å®šä¹‰æˆreadwrite</li>
</ol>
<h3 id="ä½¿ç”¨æ¸…æ™°è€Œåè°ƒçš„å‘½åæ–¹å¼"><a href="#ä½¿ç”¨æ¸…æ™°è€Œåè°ƒçš„å‘½åæ–¹å¼" class="headerlink" title="ä½¿ç”¨æ¸…æ™°è€Œåè°ƒçš„å‘½åæ–¹å¼"></a>ä½¿ç”¨æ¸…æ™°è€Œåè°ƒçš„å‘½åæ–¹å¼</h3><h3 id="ä¸ºç§æœ‰æ–¹æ³•åŠ å‰ç¼€"><a href="#ä¸ºç§æœ‰æ–¹æ³•åŠ å‰ç¼€" class="headerlink" title="ä¸ºç§æœ‰æ–¹æ³•åŠ å‰ç¼€"></a>ä¸ºç§æœ‰æ–¹æ³•åŠ å‰ç¼€</h3><ol>
<li>ä¾‹å¦‚ <code>- (void)p_privateMethod;</code></li>
</ol>
<h3 id="ç†è§£Objective-Cé”™è¯¯æ¨¡å‹"><a href="#ç†è§£Objective-Cé”™è¯¯æ¨¡å‹" class="headerlink" title="ç†è§£Objective-Cé”™è¯¯æ¨¡å‹"></a>ç†è§£Objective-Cé”™è¯¯æ¨¡å‹</h3><ol>
<li><p>ARCä¸æ˜¯<code>å¼‚å¸¸å®‰å…¨</code>çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šå¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆæœ¬åº”åœ¨ä½œç”¨åŸŸæœ«å°¾é‡Šæ”¾çš„å¯¹è±¡ç°åœ¨å´ä¸ä¼šè‡ªåŠ¨é‡Šæ”¾äº†ã€‚</p>
</li>
<li><p>åŸºäºä¸Šè¿°åŸå› ï¼ŒOCä»£ç åªä¼šåœ¨æå…¶ä¸¥é‡çš„é”™è¯¯å‘ç”Ÿæ—¶ï¼Œæ‰æŠ›å‡ºå¼‚å¸¸ï¼›è€Œä¸”æ­¤æ—¶åº”è¯¥ç»“æŸappè¿è¡Œã€‚</p>
</li>
<li><p>é™¤äº†æŠ›å‡ºå¼‚å¸¸ï¼ˆ<strong>NSException</strong>ï¼‰ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç¨å¾®ç¼“å’Œçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯<strong>NSError</strong> ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error;
</code></pre>
<p>ä¼šå°†é”™è¯¯ä¼ åˆ°å›è°ƒdelegateä¸­</p>
</li>
</ol>
<h3 id="ç†è§£NSCopyingåè®®"><a href="#ç†è§£NSCopyingåè®®" class="headerlink" title="ç†è§£NSCopyingåè®®"></a>ç†è§£NSCopyingåè®®</h3><ol>
<li><p>è¦è®©è‡ªå®šä¹‰çš„ç±»çš„å¯¹è±¡ï¼Œå…·æœ‰æ‹·è´åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯å…·æœ‰æ­£ç¡®çš„<code>[object copy];</code> æ–¹æ³•ï¼Œè¯¥ç±»å°±å¿…é¡»å®ç°NSCopyingåè®®çš„ <code>- (id)copyWithZone:(NSZone *)zone</code> æ–¹æ³•ã€‚ï¼ˆ<strong>PS</strong> ä¸éœ€è¦ç®¡zoneå‚æ•°ï¼‰</p>
</li>
<li><p>copyæ–¹æ³•å®šä¹‰åœ¨NSObjecté‡Œé¢ï¼Œæ‰€ä»¥æ‰€æœ‰ç±»éƒ½ç»§æ‰¿äº†è¯¥æ–¹æ³•ã€‚è¯¥æ–¹æ³•çš„é»˜è®¤å®ç°æ˜¯ç®€å•çš„è°ƒç”¨ <code>copyWithZone:</code> æ–¹æ³•</p>
</li>
<li><p>æˆ‘ä»¬åªéœ€è¦å®ç°ç±»çš„copyWithZone: æ–¹æ³•ï¼Œç„¶åè°ƒç”¨å¯¹è±¡çš„copyæ–¹æ³•ï¼Œå°±å¯ä»¥å®ç°å¯¹è±¡çš„æ‹·è´ã€‚ï¼ˆ<strong>PS</strong> è¦å…ˆå£°æ˜è¯¥ç±»éµå¾ªNSCopyingåè®®ï¼‰</p>
</li>
<li><p>å¯ä»¥ä½¿ç”¨ -&gt; è®¿é—®å®ä¾‹å˜é‡ï¼Œè€Œä¸æ˜¯å±æ€§ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="objective-c">@implementation EOCPerson {
      NSMutableSet *_friends; // å®ä¾‹å˜é‡ï¼Œä¸æ˜¯å±æ€§
}

- (id)copyWithZone:(NSZone *)zone {
      EOCPerson *copy = [[self class] allocWithZone:zone] init];
      copy-&gt;_friends = [_friends mutableCopy]; // -&gt; è®¿é—®å®ä¾‹å˜é‡
      return copy;
}

@end
</code></pre>
</li>
<li><p>æ·±æ‹·è´å’Œæµ…æ‹·è´</p>
<ol>
<li>æ·±æ‹·è´ï¼šå¯¹è±¡é‡Œé¢çš„åº•å±‚æ•°æ®ä¹Ÿä¸€å¹¶æ‹·è´</li>
<li>æµ…æ‹·è´ï¼šåªæ‹·è´å¯¹è±¡ï¼Œå¯¹è±¡é‡Œé¢çš„åº•å±‚æ•°æ®å…¬ç”¨ä¸€ä»½</li>
<li>Foundationæ¡†æ¶çš„collectionç±»ï¼ˆNSArrayï¼Œ NSSetâ€¦ï¼‰çš„é»˜è®¤æ‹·è´æ–¹æ³•éƒ½æ˜¯<strong>æµ…æ‹·è´</strong></li>
</ol>
</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://stackoverflow.com/questions/856636/effects-of-the-extern-keyword-on-c-functions" target="_blank" rel="external">Effects of the extern keyword on C functions</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> è¯»ä¹¦ç¬”è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[OpenGL ES å…¥é—¨]]></title>
      <url>/2016/10/29/opengl-es-start-up/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åœ¨å­¦ä¹ OpenGL ESï¼Œè·Ÿç€æ•™ç¨‹åšäº†ä¸€ä¸ªDemoï¼Œåœ¨æ¨¡æ‹Ÿå™¨ä¸‹çš„è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="/lionheart/1610/openglesstartup.gif" alt="demo"></p>
<a id="more"></a>
<p>Demoä»£ç åœ¨<a href="https://github.com/vanney9/blogDemo/tree/master/blogOpenGLESStartup" target="_blank" rel="external">è¿™é‡Œ</a></p>
<h2 id="OpenGLå’ŒOpenGL-ES"><a href="#OpenGLå’ŒOpenGL-ES" class="headerlink" title="OpenGLå’ŒOpenGL ES"></a>OpenGLå’ŒOpenGL ES</h2><p>OpenGL ESæ˜¯OpenGLçš„å­é›†ï¼Œå®ƒä¸»è¦è¿è¡Œåœ¨æ‰‹æœºä¸Šã€‚æ¨èä¸€ä¸ªè¶…æ£’çš„OpenGLå…¥é—¨æ•™ç¨‹ï¼š<a href="http://learnopengl.com/" target="_blank" rel="external">Learn OpenGL</a> ï¼›å½“ç„¶ä¹Ÿæœ‰çƒ­å¿ƒçš„å›½äººå°†ä»–ç¿»è¯‘è¿‡æ¥äº†ï¼Œåœ¨ <a href="https://learnopengl-cn.github.io/" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚é€šè¿‡è¿™äº›æ•™ç¨‹çš„å­¦ä¹ ï¼Œæˆ‘ä¹Ÿç®—æ˜¯å…¥äº†OpenGLçš„é—¨ã€‚</p>
<p>å…³äºå°†OpenGLè¿ç”¨äºiOSä¸Šé¢ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨OpenGL ESï¼Œå¯ä»¥çœ‹çœ‹Appleçš„å®˜æ–¹æ–‡æ¡£ <a href="https://developer.apple.com/library/content/documentation/3DDrawing/Conceptual/OpenGLES_ProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008793-CH1-SW1" target="_blank" rel="external">OpenGL ES Programming Guide for iOS</a></p>
<h2 id="Demoå®ç°"><a href="#Demoå®ç°" class="headerlink" title="Demoå®ç°"></a>Demoå®ç°</h2><p>demoçš„å®ç°å¯ä»¥åˆ†æˆ2ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>è¿ç”¨OpenGL ESæ˜¾ç¤ºé™æ€çš„åœºæ™¯</li>
<li>æ·»åŠ æ‰‹åŠ¿æ“ä½œï¼Œè®©åœºæ™¯åŠ¨èµ·æ¥</li>
</ol>
<h3 id="OpenGL-ES-æ¸²æŸ“"><a href="#OpenGL-ES-æ¸²æŸ“" class="headerlink" title="OpenGL ES æ¸²æŸ“"></a>OpenGL ES æ¸²æŸ“</h3><p>å…³äºåœ¨iOSä¸Šä½¿ç”¨OpenGL ESæ¸²æŸ“ï¼Œå¯ä»¥å€ŸåŠ©iOSçš„GLKitæ¡†æ¶ã€‚ä»–å¤§å¤§ç®€åŒ–äº†OpenGL ESçš„ä½¿ç”¨éš¾åº¦ã€‚è€Œæ¸²æŸ“çš„ä¸»è¦æ­¥éª¤åˆ†æˆä»¥ä¸‹å‡ æ­¥ï¼š</p>
<h4 id="ä½¿ç”¨GLKitåˆå§‹åŒ–"><a href="#ä½¿ç”¨GLKitåˆå§‹åŒ–" class="headerlink" title="ä½¿ç”¨GLKitåˆå§‹åŒ–"></a>ä½¿ç”¨GLKitåˆå§‹åŒ–</h4><p>åˆ›å»ºGLKViewControllerå’ŒGLKViewï¼ŒOpenGL ESæ¸²æŸ“çš„ç»“æœå°†ä¼šæ˜¾ç¤ºåœ¨GLKViewçš„layerä¸Šé¢ã€‚è€Œå°†GLKViewControllerè®¾ç½®æˆGLKViewçš„delegateï¼Œä»–ä¼šæ§åˆ¶æ•´ä¸ªçš„æ¸²æŸ“æµç¨‹ï¼Œæ¯”å¦‚æ¯ç§’æ¸²æŸ“å¤šå°‘æ¬¡ï¼Œä½•æ—¶å¼€å§‹æ¸²æŸ“ç­‰ç­‰</p>
<h4 id="è®¾ç½®GLKViewçš„contextå±æ€§"><a href="#è®¾ç½®GLKViewçš„contextå±æ€§" class="headerlink" title="è®¾ç½®GLKViewçš„contextå±æ€§"></a>è®¾ç½®GLKViewçš„contextå±æ€§</h4><p>OpenGL ESæ¸²æŸ“çš„æ—¶å€™éœ€è¦ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œä¹Ÿå°±æ˜¯GLKViewçš„contextï¼Œå¯¹äºä»–çš„è®¾ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">view.context = [[EAGLContext alloc]initWithAPI:kEAGLRenderingAPIOpenGLES3];
[EAGLContext setCurrentContext:view.context];
</code></pre>
<p>è¿™é‡Œåˆ›å»ºcontextæ˜¯ä½¿ç”¨OpenGL ESçš„åŸºçŸ³ï¼Œå°±ç›¸å½“äºä½ ä½¿ç”¨GLFWå’ŒGLEWå¯¹æ•´ä¸ªç¯å¢ƒè¿›è¡Œåˆå§‹åŒ–ï¼Œå®šä¹‰viewportä¹‹ç±»çš„</p>
<h4 id="è®¾ç½®OpenGL-ES"><a href="#è®¾ç½®OpenGL-ES" class="headerlink" title="è®¾ç½®OpenGL ES"></a>è®¾ç½®OpenGL ES</h4><p>è®¾ç½®OpenGL ESçš„ä»£ç å’ŒOpenGLçš„åŸºæœ¬ç›¸ä¼¼ã€‚</p>
<h5 id="åˆ›å»ºshaderç¨‹åº"><a href="#åˆ›å»ºshaderç¨‹åº" class="headerlink" title="åˆ›å»ºshaderç¨‹åº"></a>åˆ›å»ºshaderç¨‹åº</h5><p>ä¹Ÿå°±æ˜¯å¯¹ä½ å†™çš„glslæ–‡ä»¶è¿›è¡Œç¼–è¯‘é“¾æ¥ï¼Œæœ€ç»ˆæŒæœ‰ä¸€ä¸ªShader programeã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">// load glsl file
NSString *vertexFile = [[NSBundle mainBundle] pathForResource:vertexPath ofType:@&quot;glsl&quot;];
NSString *fragmentFile = [[NSBundle mainBundle] pathForResource:fragmentPath ofType:@&quot;glsl&quot;];

NSError *error;

NSString *vertexString = [NSString stringWithContentsOfFile:vertexFile encoding:NSUTF8StringEncoding error:&amp;error];
if (!vertexString) {
  NSLog(@&quot;vanney code log : error loading vertex shader : %@&quot;, error.localizedDescription);
  exit(1);
}

NSString *fragmentString = [NSString stringWithContentsOfFile:fragmentFile encoding:NSUTF8StringEncoding error:&amp;error];
if (!fragmentString) {
  NSLog(@&quot;vanney code log : error loading fragment shader : %@&quot;, error.localizedDescription);
  exit(1);
}

// compiler
GLuint vertexShader, fragmentShader;
GLint compilerSuccess, linkSuccess;
GLchar messages[512];

vertexShader = glCreateShader(GL_VERTEX_SHADER);
const GLchar *vertexStringUTF8 = [vertexString UTF8String];
glShaderSource(vertexShader, 1, &amp;vertexStringUTF8, NULL);
glCompileShader(vertexShader);
glGetShaderiv(vertexShader, GL_COMPILE_STATUS, &amp;compilerSuccess);
if (compilerSuccess == GL_FALSE) {
  glGetShaderInfoLog(vertexShader, sizeof(messages), NULL, messages);
  NSLog(@&quot;vanney code log : compile vertex shader error : %@&quot;, [NSString     stringWithUTF8String:messages]);
  exit(1);
}

fragmentShader = glCreateShader(GL_FRAGMENT_SHADER);
const GLchar *fragmentStringUTF8 = [fragmentString UTF8String];
glShaderSource(fragmentShader, 1, &amp;fragmentStringUTF8, NULL);
glCompileShader(fragmentShader);
glGetShaderiv(fragmentShader, GL_COMPILE_STATUS, &amp;compilerSuccess);
if (compilerSuccess == GL_FALSE) {
  glGetShaderInfoLog(fragmentShader, sizeof(messages), NULL, messages);
  NSLog(@&quot;vanney code log : compile fragment shader error : %@&quot;, [NSString stringWithUTF8String:messages]);
  exit(1);
}

// link
self.program = glCreateProgram();
glAttachShader(self.program, vertexShader);
glAttachShader(self.program, fragmentShader);
glLinkProgram(self.program);
glGetProgramiv(self.program, GL_LINK_STATUS, &amp;linkSuccess);
if (linkSuccess == GL_FALSE) {
  glGetProgramInfoLog(self.program, sizeof(messages), NULL, messages);
  NSLog(@&quot;vanney code log : link shader error : %@&quot;, [NSString stringWithUTF8String:messages]);
  exit(1);
}

glDeleteShader(vertexShader);
glDeleteShader(fragmentShader);
</code></pre>
<h5 id="è®¾ç½®å„ç§å’Œé¡¶ç‚¹ç›¸å…³çš„ç¼“å†²"><a href="#è®¾ç½®å„ç§å’Œé¡¶ç‚¹ç›¸å…³çš„ç¼“å†²" class="headerlink" title="è®¾ç½®å„ç§å’Œé¡¶ç‚¹ç›¸å…³çš„ç¼“å†²"></a>è®¾ç½®å„ç§å’Œé¡¶ç‚¹ç›¸å…³çš„ç¼“å†²</h5><p>åœ¨ç¼“å†²ä¸­å†™å…¥é¡¶ç‚¹æ•°æ®ï¼Œä»¥åŠå®šä¹‰å¥½GPUå¦‚ä½•å¯¹è¿™äº›é¡¶ç‚¹æ•°æ®è¿›è¡Œè¯»å–ç­‰ç­‰ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">// initialize vertex data
glGenVertexArrays(1, &amp;VAO);
glGenBuffers(1, &amp;VBO);
//glGenBuffers(1, &amp;VEO);

glBindVertexArray(VAO);
glBindBuffer(GL_ARRAY_BUFFER, VBO);
glBufferData(GL_ARRAY_BUFFER, sizeof(vertices), vertices, GL_STATIC_DRAW);
//glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, self.VEO);
//glBufferData(GL_ELEMENT_ARRAY_BUFFER, sizeof(indices), indices, GL_STATIC_DRAW);
glVertexAttribPointer(GLKVertexAttribPosition, 3, GL_FLOAT, GL_FALSE, 5 * sizeof(GLfloat), (GLvoid *) 0);
glEnableVertexAttribArray(GLKVertexAttribPosition);
glVertexAttribPointer(GLKVertexAttribTexCoord0, 2, GL_FLOAT, GL_FALSE, 5 * sizeof(GLfloat), (GLvoid *) (3 * sizeof(GLfloat)));
glEnableVertexAttribArray(GLKVertexAttribTexCoord0);
glBindVertexArray(0);
</code></pre>
<h5 id="è®¾ç½®å„ç§çº¹ç†ç¼“å†²"><a href="#è®¾ç½®å„ç§çº¹ç†ç¼“å†²" class="headerlink" title="è®¾ç½®å„ç§çº¹ç†ç¼“å†²"></a>è®¾ç½®å„ç§çº¹ç†ç¼“å†²</h5><p>æ³¨æ„è¿™é‡Œè¦ä½¿ç”¨ <code>GLKitçš„GLKTextureLoader</code> å’Œ <code>GLKTextureInfo</code> ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">NSError *error;
NSString *containerPath = [[NSBundle mainBundle] pathForResource:@&quot;container&quot; ofType:@&quot;jpg&quot;];
self.containerTexture = [GLKTextureLoader textureWithContentsOfFile:containerPath options:nil error:&amp;error];
glActiveTexture(GL_TEXTURE0);
glBindTexture(self.containerTexture.target, self.containerTexture.name);
</code></pre>
<h5 id="å¼€å§‹æ¸²æŸ“"><a href="#å¼€å§‹æ¸²æŸ“" class="headerlink" title="å¼€å§‹æ¸²æŸ“"></a>å¼€å§‹æ¸²æŸ“</h5><p>åªéœ€å®ç°GLKViewçš„delegate <code>(void)glkView:(GLKView *)view drawInRect:(CGRect)rect;</code> å°±å¯ï¼š</p>
<pre><code class="objective-c">- (void)glkView:(GLKView *)view drawInRect:(CGRect)rect {
  glEnable(GL_DEPTH_TEST);
  glClearColor(0.2f, 0.3f, 0.3f, 1.0f);
  glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
  //glClear(GL_COLOR_BUFFER_BIT);

  [self.shader use];

  GLKMatrix4 projectionMatrix = GLKMatrix4MakePerspective(M_PI_4, self.view.bounds.size.width / self.view.bounds.size.height, 0.1f, 100.0f);
  glUniformMatrix4fv(glGetUniformLocation(self.shader.program, &quot;projection&quot;), 1, GL_FALSE, projectionMatrix.m);
  GLKMatrix4 viewMatrix = GLKMatrix4MakeLookAt(0.0f, 0.0f, 3.0f, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f, 0.0f);
  glUniformMatrix4fv(glGetUniformLocation(self.shader.program, &quot;view&quot;), 1, GL_FALSE, viewMatrix.m);

  // bind texture
  glActiveTexture(GL_TEXTURE0);
  glBindTexture(self.containerTexture.target, self.containerTexture.name);
  glUniform1i(glGetUniformLocation(self.shader.program, &quot;ourTexture1&quot;), 0);
  glActiveTexture(GL_TEXTURE1);
  glBindTexture(self.faceTexture.target, self.faceTexture.name);
  glUniform1i(glGetUniformLocation(self.shader.program, &quot;ourTexture2&quot;), 1);

  glBindVertexArray(VAO);
  GLKMatrix4 transModel = [self.transformation getModelViewMatrix];
  for (int i = 0; i &lt; 10; ++i) {
    //GLKMatrix4 modelMatrix = GLKMatrix4TranslateWithVector3(GLKMatrix4Identity, cubePositions[i]);
    GLKMatrix4 modelMatrix = GLKMatrix4TranslateWithVector3(transModel, cubePositions[i]);
    GLfloat radian = (GLfloat) (20.0f * i / 180 * M_PI);
    modelMatrix = GLKMatrix4RotateWithVector3(modelMatrix, radian, GLKVector3Make(1.0f, 0.3f, 0.5f));
    glUniformMatrix4fv(glGetUniformLocation(self.shader.program, &quot;model&quot;), 1, GL_FALSE, modelMatrix.m);
    glDrawArrays(GL_TRIANGLES, 0, 36);
  }
  glBindVertexArray(0);
}
</code></pre>
<h3 id="æ·»åŠ æ‰‹åŠ¿"><a href="#æ·»åŠ æ‰‹åŠ¿" class="headerlink" title="æ·»åŠ æ‰‹åŠ¿"></a>æ·»åŠ æ‰‹åŠ¿</h3><p>å‚çœ‹è¿™ç¯‡æ•™ç¨‹ <a href="https://www.raywenderlich.com/50398/opengl-es-transformations-gestures" target="_blank" rel="external">OpenGL ES Transformations with Gestures</a></p>
<p>ä»–çš„ä¸­å¿ƒæ€æƒ³å°±æ˜¯ï¼šå‘æ•´ä¸ªGLKViewæ·»åŠ å„ç§æ‰‹åŠ¿ï¼Œé€šè¿‡æ‰‹åŠ¿ä¼ é€’çš„ä¿¡æ¯æ¥è°ƒæ•´ç‰©ä½“çš„modelçš„matrixï¼Œä¹Ÿå°±æ˜¯ä»å±€éƒ¨åæ ‡åˆ°ä¸–ç•Œåæ ‡è½¬æ¢çš„matrixã€‚</p>
<p>å…·ä½“çš„ä»£ç å¯ä»¥å‚è€ƒGithubä¸Šçš„Transformationç±»</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://learnopengl.com/" target="_blank" rel="external">Learn OpenGL</a></li>
<li><a href="https://learnopengl-cn.github.io/" target="_blank" rel="external">Learn OpenGLä¸­æ–‡ç¿»è¯‘</a></li>
<li><a href="OpenGL ES Programming Guide for iOS">OpenGL ESè‹¹æœå®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://www.raywenderlich.com/50398/opengl-es-transformations-gestures" target="_blank" rel="external">OpenGL ES Transformations with Gestures</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[è®°ä¸€æ¬¡aws-ec2æ€æ¯’ç»å†]]></title>
      <url>/2016/10/29/aws-minered-virus/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰å‡ å¤©awsçš„ec2æœåŠ¡å™¨è¢«æ”»å‡»äº†ï¼Œè¢«è«åäººå£«æ¤å…¥äº†ä¸€ä¸ªminerdçš„æ¶æ„ç¨‹åºï¼Œä¸‹é¢ç®€å•è®°å½•ä¸€ä¸‹å¯¹è¿™ä¸ªæ¶æ„ç¨‹åºçš„å¤„ç†è¿‡ç¨‹</p>
<a id="more"></a>
<h2 id="é—®é¢˜å‘ç°"><a href="#é—®é¢˜å‘ç°" class="headerlink" title="é—®é¢˜å‘ç°"></a>é—®é¢˜å‘ç°</h2><p>æˆ‘ä»¬ä½¿ç”¨ä¸€å°awsçš„ec2æœåŠ¡å™¨æ¥æ‰˜ç®¡ç½‘ç«™ï¼Œå‰å‡ å¤©ç™»å½•ç½‘ç«™ç•Œé¢çš„æ—¶å€™ä¸€ç›´åœ¨loadingç•Œé¢ï¼Œæ­»æ´»æ— æ³•ç™»å½•ã€‚å½“æˆ‘æƒ³ç»ˆç«¯ç™»å½•ec2çš„æ—¶å€™ä¹Ÿæ˜¯æ­»æ´»ç™»ä¸ä¸Šå»ã€‚å½“æ—¶å°±æœ‰ç§ä¸ç¿”çš„é¢„æ„Ÿï¼Œè¦GGã€‚ç¨³ä¸‹æ¥åï¼ŒæŸ¥çœ‹awsçš„CloudWatchç›‘æ§è®°å½•ï¼Œå‘ç°è¿‘æ®µæ—¶é—´çš„ec2çš„CPUåˆ©ç”¨ç‡ä¸€ç›´å¾ˆç¨³å®šçš„ä¿æŒåœ¨100%ã€‚ã€‚ã€‚åŸæ¥CPUè¢«ç”¨å®Œäº†ï¼Œéš¾æ€ªæ€ä¹ˆéƒ½ç™»ä¸ä¸Šå»ï¼Œç½‘ç«™ä¹Ÿæ— æ³•è¿ä½œã€‚</p>
<h2 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h2><h3 id="ç™»å½•ec2"><a href="#ç™»å½•ec2" class="headerlink" title="ç™»å½•ec2"></a>ç™»å½•ec2</h3><p>å…ˆå¾—æƒ³åŠæ³•ç™»å½•ec2ï¼Œçœ‹çœ‹åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚æ³¨æ„ï¼šç™»å½•ä¸ä¸Šec2çš„æ—¶å€™ï¼Œåƒä¸‡ä¸èƒ½éšæ„çš„é‡å¯æˆ–è€…åœæ­¢ec2ï¼›å› ä¸ºè¿™æ ·çš„è¯ï¼Œå­˜å‚¨åœ¨ä¸Šé¢çš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ã€‚</p>
<p>ä½†æ˜¯cpuå ç”¨ç‡å§‹ç»ˆä¿æŒåœ¨100%ï¼Œæ€ä¹ˆä¹Ÿç™»ä¸ä¸Šec2ã€‚åªèƒ½ä½¿ç”¨å¤§æ‹›äº†ã€‚ä½¿ç”¨ä¸€ä¸‹æ­¥éª¤æ›²çº¿æ•‘å›½ï¼š</p>
<ol>
<li>ç™»å½•awsæ§åˆ¶å°ã€‚å¯¹ç°åœ¨çš„è¿™å°ec2ï¼ˆè®°ä¸ºec2oneï¼‰çš„ç³»ç»Ÿç›˜ï¼Œä¹Ÿå°±æ˜¯æ ¹å·åˆ›å»ºä¸€ä»½å¿«ç…§</li>
<li>æ ¹æ®åˆšåˆ›å»ºçš„å¿«ç…§åˆ›å»ºä¸€ä¸ªå·ï¼ˆä¹Ÿå°±æ˜¯ï¼šç£ç›˜ï¼‰ï¼Œè¿™æ ·å°±å¤åˆ¶äº†ec2oneçš„ç³»ç»Ÿç›˜</li>
<li>å¯ç”¨ä¸€å°å…¨æ–°çš„ec2ï¼ˆè®°ä¸ºec2twoï¼‰ï¼Œæ³¨æ„ç™»å½•å¯†é’¥å’Œec2oneçš„ç›¸åŒ</li>
<li>åœç”¨ec2twoï¼Œå¸è½½ec2twoçš„æ ¹å·ï¼›å°†2ä¸­åˆ›å»ºçš„ç³»ç»Ÿç›˜ç»‘å®šåˆ°ec2twoä¸Šï¼Œä½œä¸ºå®ƒçš„ç³»ç»Ÿç›˜ï¼ˆæ³¨æ„ï¼šæŒ‡å®šä¸º/dev/xvdaï¼Œä¸ç„¶å°±è¢«è®¤å®šæ˜¯ä¸€èˆ¬ç£ç›˜ï¼›è¿™æ—¶ec2twoæ²¡æœ‰ç³»ç»Ÿç›˜ï¼Œæ— æ³•å¯åŠ¨ï¼‰</li>
<li>å¯åŠ¨ec2twoï¼Œå¹¶ç»ˆç«¯ç™»å½•</li>
</ol>
<p>é€šè¿‡è¿™æ ·çš„æ–¹å¼å°±åˆ›å»ºäº†ä¸€å°å’Œec2oneç›¸åŒçš„æœºå™¨ ec2twoï¼Œå¹¶ä¸”ç™»å½•ä¸Šå»äº†ã€‚</p>
<h3 id="å‘ç°é—®é¢˜"><a href="#å‘ç°é—®é¢˜" class="headerlink" title="å‘ç°é—®é¢˜"></a>å‘ç°é—®é¢˜</h3><p>ç™»å½•ec2twoä¹‹åï¼Œä½¿ç”¨topæŒ‡ä»¤æŸ¥çœ‹cpuçš„å ç”¨æƒ…å†µã€‚è¿‡ä¸€æ®µæ—¶é—´åï¼Œå‘ç°ä¸€ä¸ªminerdçš„è¿›ç¨‹å ç”¨äº†90å¤šçš„cpuï¼Œå¹¶ä¸”å±…é«˜ä¸ä¸‹ã€‚</p>
<p><img src="/lionheart/1610/minerd.png" alt="minerd virus"></p>
<p>googleäº†ä¸€ä¸‹ï¼Œè¿™æ˜¯ä¸ªâ€™æŒ–çŸ¿â€˜çš„ç¨‹åºï¼Œä¼°è®¡æ˜¯æˆ‘è¿™å°æœåŠ¡å™¨è¢«è«åäººå£«æ‹¿æ¥æŒ–æ¯”ç‰¹å¸äº†ã€‚æ‰€ä»¥æœç„¶æ˜¯æœåŠ¡å™¨ä¸­æ¯’äº†</p>
<h3 id="è§£å†³ç»è¿‡"><a href="#è§£å†³ç»è¿‡" class="headerlink" title="è§£å†³ç»è¿‡"></a>è§£å†³ç»è¿‡</h3><ol>
<li>å…ˆkillè¿™ä¸ªè¿›ç¨‹ï¼Œæ²¡ç”¨ï¼Œè¿‡ä¸€ä¼šè¿™ä¸ªè¿›ç¨‹åˆå‡ºæ¥äº†</li>
<li>ä½¿ç”¨ <code>ps aux | grep minerd</code> æŸ¥çœ‹ä»€ä¹ˆç¨‹åºåœ¨è¿è¡Œè¿™ä¸ªè¿›ç¨‹ï¼Œå‘ç°äº†ä¸€ä¸ª <code>/opt/minerd</code>çš„åœ¨è¿è¡Œè¿™ä¸ªè¿›ç¨‹ï¼›è¿›å…¥/optåˆ æ‰minerdï¼Œæ²¡ç”¨ï¼Œå¤šä¸€ä¼šï¼Œè¿™ä¸ªminerdçš„å¯æ‰§è¡Œæ–‡ä»¶åˆå‡ºæ¥äº†ã€‚ã€‚ã€‚</li>
<li>googleï¼Œç»™å‡ºçš„ç­”æ¡ˆå±…ç„¶æ˜¯å®‰è£…æ€æ¯’è½¯ä»¶ã€‚è¿˜çœŸæ˜¯å¤´ä¸€æ¬¡åœ¨linuxä¸Šé¢è£…æ€æ¯’è½¯ä»¶ã€‚ã€‚</li>
<li>ä¸‹äº†ä¸€ä¸ªå…è´¹çš„linuxæ€æ¯’è½¯ä»¶ï¼šshoposï¼Œå®˜ç½‘çœ‹ä¸Šå»é«˜å¤§ä¸Šï¼Œæ•´ä¸ªè½¯ä»¶ä¹Ÿæœ‰ä¸ª500Må·¦å³ï¼Œåº”è¯¥æ¯”è¾ƒé è°±ã€‚</li>
<li>å®‰è£…ï¼ŒæŒ‰ç…§è¯´æ˜æ‰«ææ€æ¯’ï¼Œç»“æœ<code>minerd</code>è¿›ç¨‹è¿˜åœ¨ä¸è¯´ï¼Œè¿˜æŠŠpsç­‰æŒ‡ä»¤ç»™åˆ é™¤äº†ã€‚ã€‚ã€‚ä¼°è®¡æ˜¯æˆ‘çš„æ‰“å¼€æ–¹å¼ä¸å¯¹ï¼Œè¿™æ—¶å€™è¿˜æ˜¯å¾ˆæƒ³å¿µ360çš„ã€‚ä½ è¯´ä»–æ€ä¹ˆå°±ä¸å‡ºä¸€ä¸ªlinuxçš„360å®‰å…¨å«å£«å‘¢ï¼Ÿ</li>
<li>å†googleï¼Œå‘ç°ä¸€ä½å›½å†…ç å†œé‡åˆ°çš„æƒ…å†µå’Œæˆ‘ç›¸åŒï¼Œæœ€åå®è·µä¸‹æ¥è€Œç¡®å®é è°±ï¼Œé™„ä¸Šé“¾æ¥ï¼š<a href="http://www.cnblogs.com/zhouto/p/5680594.html" target="_blank" rel="external">é˜¿é‡Œäº‘æœåŠ¡å™¨è¢«æŒ–çŸ¿minerdå…¥ä¾µçš„è§£å†³åŠæ³•</a></li>
<li>è¯´ä¸€ä¸‹è¿™ä¸ªæœ€ç»ˆè§£å†³æ–¹æ³•<ol>
<li>å…³é—­è®¿é—®æŒ–çŸ¿æœåŠ¡å™¨çš„è®¿é—® <code>iptables -A INPUT -s xmr.crypto-pool.fr -j DROP</code>  å’Œ  <code>iptables -A OUTPUT -d xmr.crypto-pool.fr -j DROP</code></li>
<li><code>chmod -x minerd</code>  ,å–æ¶ˆæ‰æ‰§è¡Œæƒé™ï¼Œ åœ¨æ²¡æœ‰æ‰¾åˆ°æ ¹æºå‰ï¼Œåƒä¸‡ä¸è¦åˆ é™¤ minerdï¼Œå› ä¸ºåˆ é™¤äº†ï¼Œè¿‡ä¸€å›ä¼šè‡ªåŠ¨æœ‰ç”Ÿæˆä¸€ä¸ª</li>
<li><code>pkill minerd</code> æ€æ‰è¿›ç¨‹</li>
</ol>
</li>
<li>æ ¹æ®è¿™ä½é«˜äººæ‰€è¯´ï¼Œä¹‹è¯´ä»¥ä¼šè¢«å…¥ä¾µï¼Œæ˜¯å› ä¸ºredisæœåŠ¡å™¨çš„æ¼æ´ã€‚åœ¨ec2ä¸Šé¢å®‰è£…äº†redisï¼Œä½†æ˜¯æ²¡æœ‰é™åˆ¶ipè®¿é—®ï¼Œå¼€æ”¾çš„è¿˜æ˜¯é»˜è®¤çš„6379ç«¯å£ï¼Œè€Œä¸”è¿˜ä¸è®¾ç½®è®¿é—®redisçš„å¯†ç çš„è¯ï¼Œè«åäººå£«å°±å¯ä»¥é€šè¿‡redisæ¥è¿›å…¥è¿™å°æœåŠ¡å™¨ã€‚æ˜¾ç„¶æˆ‘ä»¬ä¹‹å‰çš„redisçš„è®¿é—®æ¡ä»¶å°±æ˜¯è¿™ä¹ˆçš„å®½æ¾ã€‚ã€‚ã€‚ çœ‹çœ‹å¦‚ä½•é™åˆ¶redisçš„è®¿é—®<ol>
<li>å› ä¸ºæˆ‘ä»¬ç½‘ç«™éœ€è¦ä½¿ç”¨redisï¼Œæ‰å®‰è£…çš„ã€‚ä½†æ˜¯è¿™ä¸ªredisåªä¼šç”±è·‘åœ¨nginxæœåŠ¡å™¨ä¸Šçš„phpä»£ç æ¥è®¿é—®ï¼Œæ‰€ä»¥è¯´åªæœ‰ec2è‡ªå·±æ‰ä¼šè®¿é—®redisã€‚</li>
<li>æ‰€ä»¥ç™»å½•awsçš„æ§åˆ¶å°ï¼Œåœ¨å®‰å…¨ç»„ä¸­ï¼Œå°†ä¹‹å‰å¼€æ”¾çš„6379ç«¯å£å…³é—­</li>
<li>åœ¨redisçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé™åˆ¶è®¿é—®ipåªèƒ½æ˜¯ 127.0.0.1ï¼›å¹¶ä¸”æ”¹å˜redisçš„é»˜è®¤çš„6379çš„ç«¯å£å·</li>
<li>åœ¨redisçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œè®¾ç½®redisçš„è®¿é—®å¯†ç ï¼ˆAUTHï¼‰</li>
<li>é‡å¯redis</li>
</ol>
</li>
<li>ä¸ºäº†éªŒè¯æ˜¯ä¸æ˜¯ç”±rediså¼•èµ·çš„è¿™æ¬¡äº‹æ•…ï¼Œè¿›å…¥/optï¼Œrootä¸‹çš„~/.sshæ–‡ä»¶å¤¹ä¸­çœ‹çœ‹ï¼Œæœç„¶åœ¨authorized_keysé‡Œé¢å‘ç°äº†redisçš„ä¸€äº›ç›¸å…³çš„ä¸œè¥¿ï¼›è€Œä¸”ä»–çš„å¯†é’¥å±…ç„¶è·Ÿec2-userçš„~/.sshä¸­çš„ä¸€æ ·ã€‚çœ‹æ¥æœç„¶æ˜¯é€šè¿‡redisè¿›åˆ°äº†ec2ï¼Œå¹¶ä¸”æ‹¿åˆ°äº†ç™»å½•ec2çš„å¯†é’¥ã€‚åˆ é™¤è¿™äº›ç›¸å…³çš„æ–‡ä»¶</li>
</ol>
<h3 id="ä¸€æ³¢ä¸‰æŠ˜"><a href="#ä¸€æ³¢ä¸‰æŠ˜" class="headerlink" title="ä¸€æ³¢ä¸‰æŠ˜"></a>ä¸€æ³¢ä¸‰æŠ˜</h3><p>æœ¬ä»¥ä¸ºäº‹ä»¶å°±è¿™ä¹ˆé¡ºåˆ©çš„è§£å†³äº†ï¼Œæ²¡æƒ³åˆ°ç¬¬äºŒå¤©awsåˆå‘æ¥è­¦å‘Šï¼Œç½‘ç»œè¾“å‡ºè¶…è¿‡äº†é˜ˆå€¼ã€‚ã€‚ã€‚è®¤çœŸæƒ³æƒ³ï¼Œè¿™æ¬¡çš„cpuæ²¡æœ‰æŠ¥è­¦ï¼Œä½†æ˜¯ç½‘ç»œè¾“å‡ºæŠ¥è­¦äº†ã€‚é‚£ä¹ˆåº”è¯¥æ˜¯æŒ–çŸ¿ç¨‹åºæ²¡æœ‰å†è·‘äº†ï¼Œä½†æ˜¯è¿˜æœ‰å…¶ä»–çš„ç¨‹åºå°†æŒ–åˆ°çš„æ•°æ®ä¼ è¾“å‡ºå»ã€‚</p>
<p>å…¶å®ä¹‹å‰çš„é‚£ä½é«˜äººæ‰€è¯´çš„æ­¥éª¤ä¸­çš„æœ€åä¸€æ­¥ï¼Œæˆ‘æ²¡æœ‰å»æ‰§è¡Œï¼Œå°±å¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ã€‚è¿™ä¸€æ­¥å°±æ˜¯ä½¿ç”¨ <code>service stop crond</code> æˆ–è€… <code>crontab -r</code> åˆ é™¤æ‰€æœ‰çš„æ‰§è¡Œè®¡åˆ’ï¼Œä¹Ÿå°±æ˜¯å®šæ—¶è®¡åˆ’ã€‚</p>
<p>æˆ‘è¿›å…¥ec2åï¼Œåˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œä½¿ç”¨ <code>crontab -l</code>æŸ¥çœ‹æ‰€æœ‰çš„æ‰§è¡Œè®¡åˆ’ï¼Œæœç„¶æœ‰ä¸€ä¸ªæ˜¯å®šæ—¶æ‰§è¡Œä¸€ä¸ª /tmpæ–‡ä»¶å¤¹ä¸‹é¢çš„ chongfu.sh è„šæœ¬ã€‚æŸ¥çœ‹è¿™ä¸ªè„šæœ¬ï¼Œä»–ä¼šå®šæ—¶å°†æ‰€æœ‰tmpæ–‡ä»¶å¤¹é‡Œçš„æ•°æ®é€šè¿‡wgetçš„æ–¹æ³•ä¼ è¾“åˆ°ä¸€ä¸ªæŒ‡å®šipçš„æœºå™¨ä¸Šé¢ã€‚é‚£ä¹ˆåº”è¯¥å°±æ˜¯è¿™ä¸ªé—®é¢˜äº†ã€‚</p>
<p>å…ˆä½¿ç”¨ <code>crontab -r</code> åˆ é™¤è¿™ä¸ªå®šæ—¶æ‰§è¡Œ chongfu.sh è„šæœ¬çš„è®¡åˆ’ï¼Œå† <code>pkill chongfu.sh</code> æ€æ‰æ‰€æœ‰å·²ç»åœ¨æ‰§è¡Œçš„è¿™ä¸ªè„šæœ¬ã€‚è¿™ä¸ªæ•°æ®ä¼ è¾“ä¹Ÿå°±è§£å†³äº†ã€‚</p>
<p>æŸ¥æŸ¥çœ‹è¿™ä¸ªipï¼Œæœç„¶æ˜¯ä¸€ä¸ªä¸­å›½çš„ipï¼Œä¹Ÿå°±ä¸éš¾è§£é‡Šè¿™ä¸ªè„šæœ¬ä¸ºä»€ä¹ˆå« chongfu.sh è€Œä¸æ˜¯ repeat.shã€‚å“ï¼Œå›½äººä½•è‹¦ä¸ºéš¾å›½äººå•Š</p>
<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>ç»è¿‡è¿™æ¬¡çš„äº‹ä»¶åï¼ŒæŒ‰å¸¸ç†æ˜¯å¾—æ€»ç»“ç‚¹ä»€ä¹ˆä¸œè¥¿ï¼š</p>
<ol>
<li>è¦å¯¹awsè¿›è¡Œè®¿é—®é™åˆ¶ï¼Œä¹‹å‰å°±æ˜¯å¤ªå®½æ¾æ‰è¢«æœ‰æœºå¯ä¹˜ã€‚å…³æ‰æ²¡å¿…è¦çš„è®¿é—®ç«¯å£ï¼Œå°†sshçš„ç«¯å£è®¾ç½®æˆæœ¬æœºçš„ipç­‰ç­‰</li>
<li>å¯¹awsè¦åšå¥½å¤‡ä»½ï¼Œä¸ç„¶é‚£ä¸€å¤©awsåˆç™»ä¸ä¸Šå»äº†ã€‚å®šæœŸå¯¹awsçš„ç³»ç»Ÿç›˜ä»¥åŠæ•°æ®ç›˜è¿›è¡Œå¿«ç…§å¤‡ä»½</li>
<li>å¯¹äºawsç£ç›˜çš„é€‰æ‹©ï¼Œä¹Ÿå°±æ˜¯å·çš„é€‰æ‹©ï¼Œæœ€å¥½æ˜¯ebsã€‚å› ä¸ºå…¶ä»–ç±»å‹çš„å·å¯èƒ½åœ¨åœæ­¢æˆ–é‡å¯ec2æ—¶ï¼Œä¼šä¸¢å¤±æ•°æ®</li>
<li>ä½¿ç”¨å¥½awsçš„CloudWatchï¼Œå¯ä»¥å®æ—¶ç›‘æ§awsï¼Œå‘ç”Ÿé—®é¢˜æ—¶å¯ä»¥åŠæ—¶æ”¶åˆ°é€šçŸ¥</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://www.cnblogs.com/zhouto/p/5680594.html" target="_blank" rel="external">é˜¿é‡Œäº‘æœåŠ¡å™¨è¢«æŒ–çŸ¿minerdå…¥ä¾µçš„è§£å†³åŠæ³•</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> server </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Cå’ŒæŒ‡é’ˆè¯»ä¹¦ç¬”è®°]]></title>
      <url>/2016/09/14/Pointers-on-c-reading-note-one/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ã€ŠCå’ŒæŒ‡é’ˆã€‹è¯»ä¹¦ç¬”è®°ï¼Œä¼šæŒ‰ç« èŠ‚æ’åº</p>
<a id="more"></a>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="å¿«é€Ÿä¸Šæ‰‹"><a href="#å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="å¿«é€Ÿä¸Šæ‰‹"></a>å¿«é€Ÿä¸Šæ‰‹</h3><ol>
<li>å‡½æ•°å‚æ•°è‹¥æŒ‡å®šä¸º <strong>const</strong> ,è¡¨ç¤ºå‡½æ•°ä¸ä¼šä¿®æ”¹è¿™ä¸ªå‚æ•°ã€‚</li>
<li>å­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸²ä»¥ <strong>NUL</strong> å­—èŠ‚ç»“å°¾çš„å­—ç¬¦ï¼ŒNULä½œä¸ºå­—ç¬¦ä¸²ç»ˆæ­¢ç¬¦ï¼Œä¸å±äºå­—ç¬¦ä¸²ã€‚ NULä¹Ÿå°±æ˜¯ â€˜\0â€™ </li>
<li>å­—ç¬¦ä¸²å¸¸é‡ä»¥åŒå¼•å·èµ·æ­¢ã€‚æ¯”å¦‚ â€œHelloâ€ ï¼Œåœ¨å†…å­˜ä¸­å æ®6ä¸ªå­—èŠ‚ï¼Œåˆ†åˆ«æ˜¯ï¼šH e l l o å’Œ NUL</li>
</ol>
<h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><ol>
<li>ä»£ç çš„ç¿»è¯‘é˜¶æ®µï¼š<ol>
<li>ç¨‹åºçš„å„ä¸ªæºä»£ç å…ˆè¢«è½¬æ¢æˆç›®æ ‡ä»£ç ï¼Œä¹Ÿå°±æ˜¯ <strong>.o</strong> æ–‡ä»¶ã€‚ç¼–è¯‘é˜¶æ®µ</li>
<li>ç„¶åå„ä¸ªç›®æ ‡ä»£ç ä¼šè¢«é“¾æ¥å™¨æ†ç»‘åˆ°ä¸€èµ·ï¼Œå¹¶ä¸”é“¾æ¥å™¨è¿˜ä¼šå°†æ‰€éœ€çš„å„ç§åº“é“¾æ¥åˆ°ç¨‹åºä¸­ï¼›è¿™äº›ç›®æ ‡ä»£ç å’Œå„ç§åº“æ†ç»‘åˆ°ä¸€èµ·ï¼Œå½¢æˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ <strong>.out</strong> æ–‡ä»¶ã€‚å¯»æ‰¾å„ç§åº“ï¼Œä¼šåœ¨ç³»ç»Ÿåº“å’Œç”¨æˆ·æŒ‡å®šçš„å‡½æ•°åº“ä¸­å¯»æ‰¾ã€‚é“¾æ¥é˜¶æ®µ</li>
</ol>
</li>
<li>ç¼–è¯‘é˜¶æ®µï¼šå…ˆè§£æ(parse)ï¼›è‹¥æœ‰ä¼˜åŒ–é€‰é¡¹çš„è¯ï¼Œè¿˜è¦è¿›è¡Œä¼˜åŒ–(optimizer)</li>
<li>å¯¹äºå­—ç¬¦æ³¨æ„ä¸€ä¸‹ <strong>ä¸‰å­—æ¯è¯</strong> ã€‚è¿™äº›éƒ½ä»¥??å¼€å¤´ï¼Œæ¯”å¦‚è¯´ <code>??)</code>è¡¨ç¤ºçš„æ˜¯<code>]</code>ã€‚æ‰€ä»¥å½“ä½ æ‰“å‡º <code>??):</code> çš„æ—¶å€™ï¼Œåœ¨æ§åˆ¶å°çš„è¾“å‡ºä¼šæ˜¯ <code>]:</code> </li>
<li><code>&#39;\100&#39;</code>ï¼šè¿™é‡Œçš„100æ˜¯å…«è¿›åˆ¶ï¼Œè¡¨ç¤º64ã€‚ä¹Ÿå°±æ˜¯ASCIIç å€¼ä¸º64çš„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯<code>@</code></li>
<li>åŒ4æ‰€è®²ï¼Œ<code>&#39;\x40&#39;</code>ï¼šæ˜¯ç”¨16è¿›åˆ¶æ¥è®¡ç®—ï¼Œä¹Ÿè¡¨ç¤ºçš„æ˜¯<code>@</code></li>
</ol>
<h3 id="æ•°æ®"><a href="#æ•°æ®" class="headerlink" title="æ•°æ®"></a>æ•°æ®</h3><ol>
<li><p>Cè¯­è¨€ä¸­ä»…æœ‰4ç§åŸºæœ¬ç±»å‹ï¼šæ•´å½¢ã€æµ®ç‚¹å‹ã€æŒ‡é’ˆå’Œèšåˆç±»å‹ï¼ˆæ•°ç»„å’Œç»“æ„ä½“ç­‰ï¼‰</p>
</li>
<li><p><strong>æ•´å½¢å®¶æ—</strong> åŒ…æ‹¬å­—ç¬¦ã€çŸ­æ•´å‹ã€æ•´å½¢å’Œé•¿æ•´å‹ï¼Œä»–ä»¬éƒ½æœ‰ <strong>æœ‰ç¬¦å·</strong> å’Œ <strong>æ— ç¬¦å·</strong> ä¸¤ç§ç‰ˆæœ¬</p>
</li>
<li><p><strong>æŒ‡é’ˆå˜é‡</strong> ä¹Ÿæ˜¯ä¸€ä¸ªå˜é‡ï¼Œä»–å­˜å‚¨çš„å€¼æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€</p>
</li>
<li><p>å­—ç¬¦ä¸²å¸¸é‡ï¼Œæ¯”å¦‚â€Helloâ€ï¼Œè¿™ä¸ªå¸¸é‡çš„å€¼æ˜¯ä¸€ä¸ª <strong>æŒ‡å‘å­—ç¬¦çš„æŒ‡é’ˆ</strong> ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªåœ°å€ï¼Œæ‰€ä»¥ä¸èƒ½å°†â€Helloâ€èµ‹å€¼ç»™ä¸€ä¸ªå­—ç¬¦æ•°ç»„ã€‚</p>
</li>
<li><p><code>int *a;</code> è¯´æ˜äº† <em>a æ˜¯ä¸€ä¸ªintå‹å˜é‡ï¼Œè¿™æ ·æ‰è¿›è€Œè¯´æ˜äº†aæ˜¯æŒ‡å‘ä¸€ä¸ªintå˜é‡çš„æŒ‡é’ˆã€‚ </em>å·è¡¨ç¤ºå–åœ°å€</p>
</li>
<li><p>çœ‹ä¸ªç­‰ä»·çš„ä»£ç </p>
<pre><code class="c">char *message = &quot;Hallo&quot;;
/* ç­‰ä»·äº */
char *message;
message = &quot;Hallo&quot;; // PS è¿™é‡Œæ˜¯messageï¼Œè€Œä¸æ˜¯*message
</code></pre>
</li>
<li><p><strong>typeof</strong> ï¼š</p>
<pre><code class="c">typeof char *ptr_to_char; // è¿™é‡Œptr_to_charå°±æ˜¯æŒ‡å‘charçš„æŒ‡é’ˆç±»å‹
ptr_to_char a; // å£°æ˜äº†ä¸€ä¸ªæŒ‡å‘charçš„æŒ‡é’ˆå˜é‡a
</code></pre>
</li>
<li><p><strong>å¸¸é‡</strong> : è¢«å£°æ˜ä¸ºå¸¸é‡ä¹‹åï¼Œæ˜¯æ— æ³•è¢«ä¿®æ”¹çš„ã€‚æ¯”å¦‚<code>int const a = 9;</code> ä¹‹åæ— æ³•å¯¹è¿™ä¸ªaå†èµ‹æ–°å€¼ã€‚</p>
</li>
<li><p>çœ‹çœ‹å¸¸é‡å’ŒæŒ‡é’ˆçš„ç»“åˆ</p>
<pre><code class="c">int const *pci; // æŒ‡å‘æ•´å½¢å¸¸é‡çš„æŒ‡é’ˆï¼Œå¯ä»¥ä¿®æ”¹æŒ‡é’ˆçš„å€¼ï¼Œä½†æ˜¯ä¸èƒ½ä¿®æ”¹æŒ‡å‘çš„intçš„å€¼
int * const cpi; // æŒ‡å‘æ•´å½¢çš„å¸¸é‡æŒ‡é’ˆï¼Œå¯ä»¥ä¿®æ”¹æŒ‡å‘çš„intçš„å€¼ï¼Œä½†æ˜¯ä¸èƒ½æ”¹å˜æŒ‡é’ˆè®©ä»–æŒ‡å‘å¦å¤–çš„åœ°å€
int const * const cpci; // éƒ½ä¸èƒ½ä¿®æ”¹
</code></pre>
</li>
<li><p>ç¼–è¯‘å™¨å¯ä»¥ç¡®è®¤4ç§ä¸åŒç±»å‹çš„ <strong>ä½œç”¨åŸŸ</strong> ï¼šæ–‡ä»¶ä½œç”¨åŸŸã€å‡½æ•°ä½œç”¨åŸŸã€ä»£ç å—ä½œç”¨åŸŸå’ŒåŸå‹ä½œç”¨åŸŸ</p>
</li>
<li><p>æ ‡è¯†ç¬¦ï¼ˆå˜é‡ã€å‡½æ•°ç­‰ç­‰ï¼‰éƒ½æœ‰é“¾æ¥å±æ€§ï¼Œä¸‰ç§ï¼š<strong>none</strong> ã€<strong>internal</strong> å’Œ <strong>external</strong> PS ä¸æ˜¯å¾ˆæ‡‚ã€‚ã€‚</p>
</li>
<li><p>æœ‰3ä¸ªåœ°æ–¹ç”¨æ¥å­˜å‚¨å˜é‡ï¼ˆ <strong>å­˜å‚¨ç±»å‹</strong> ï¼‰ï¼š <strong>æ™®é€šå†…å­˜</strong> ã€ <strong>è¿è¡Œæ—¶å †æ ˆ</strong> ã€ <strong>ç¡¬ä»¶å¯„å­˜å™¨</strong>ã€‚åœ¨ä»£ç å—ä¹‹å¤–å£°æ˜çš„å˜é‡ç§°ä¹‹ä¸ºé™æ€å˜é‡ï¼ˆstaticï¼‰ï¼Œå­˜æ”¾åœ¨é™æ€å†…å­˜ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸å±äºå †æ ˆçš„å†…å­˜ï¼Œè¿™ç§å˜é‡åœ¨æ•´ä¸ªç¨‹åºæ‰§è¡Œæ—¶éƒ½ç”Ÿå­˜ç€ï¼›åœ¨ä»£ç å—å†…éƒ¨å£°æ˜çš„å˜é‡ç§°ä¹‹ä¸ºè‡ªåŠ¨å˜é‡ï¼ˆautoï¼‰ï¼Œå­˜æ”¾åœ¨å †æ ˆä¸­ï¼Œå½“å¼€å§‹æ‰§è¡Œä»£ç å—æ—¶ç”Ÿæˆè¿™ç§å˜é‡ï¼Œä»£ç å—æ‰§è¡Œç»“æŸï¼Œå˜é‡è¢«é”€æ¯ã€‚</p>
</li>
<li><p>å¯¹äºä»£ç å—å†…çš„å˜é‡å¯ä»¥åŠ ä¸Š<code>static</code>ä¿®é¥°ç¬¦ï¼Œå¼ºè¡Œå°†å®ƒå˜æˆé™æ€å˜é‡ï¼Œå­˜æ”¾åœ¨é™æ€å†…å­˜ä¸­ï¼Œæ•´ä¸ªç¨‹åºè¿è¡Œæ—¶é—´éƒ½ç”Ÿå­˜ã€‚ä½†æ˜¯å³ä½¿è¿™æ ·ï¼Œå®ƒçš„ä½œç”¨åŸŸè¿˜æ˜¯åªèƒ½åœ¨ä»£ç å—ä¸­ï¼Œåœ¨ä»£ç å—å¤–ï¼Œå®ƒè¿˜æ˜¯æ— æ³•è¢«ä½¿ç”¨ã€‚</p>
</li>
<li><p>æ³¨æ„ï¼šå½¢å‚ä¸èƒ½å£°æ˜ä¸ºé™æ€å˜é‡</p>
</li>
<li><p>ç»™è‡ªåŠ¨å˜é‡åŠ <code>register</code>ä¿®é¥°ç¬¦ï¼Œè¯´æ˜è¯¥å˜é‡å­˜æ”¾åœ¨å¯„å­˜å™¨ä¸­ï¼Œå¯„å­˜å™¨ä¸­çš„è®¿é—®é€Ÿåº¦æ¯”å†…å­˜æ›´å¿«ã€‚æ³¨æ„ï¼šå­˜æ”¾åœ¨å¯„å­˜å™¨ä¸­çš„æ•°é‡æ˜¯æœ‰é™çš„ï¼Œå¦‚æœå¤ªå¤šçš„å˜é‡å£°æ˜ä¸ºregisterï¼Œåªæœ‰ä¸€éƒ¨åˆ†ä¼šå­˜æ”¾åœ¨å¯„å­˜å™¨ä¸­ï¼Œé‚£ä¹ˆå…¶ä»–çš„åªèƒ½æŒ‰ç…§æ­£å¸¸çš„å˜é‡æ¥å¤„ç†ï¼Œå°†å…¶å­˜æ”¾åœ¨å†…å­˜ä¸­ã€‚</p>
</li>
<li><p>å…³äº <strong>static</strong> å…³é”®å­—</p>
</li>
<li><p>ç”¨äºå‡½æ•°å®šä¹‰æˆ–ç”¨äºä»£ç å—ä¹‹å¤–çš„å˜é‡å£°æ˜æ—¶ï¼šstaticç”¨äºä¿®æ”¹æ ‡è¯†ç¬¦çš„é“¾æ¥å±æ€§ï¼Œä»externalæ”¹ä¸ºinternalï¼›ä½†æ˜¯æ ‡è¯†ç¬¦çš„å­˜å‚¨ç±»å‹å’Œä½œç”¨åŸŸä¸å—å½±å“ï¼›è¯´æ˜äº†è¯¥æ ‡è¯†ç¬¦åªèƒ½åœ¨æ–‡ä»¶å†…éƒ¨ä½¿ç”¨</p>
</li>
<li><p>åœ¨ä»£ç å—å†…éƒ¨ä½¿ç”¨staticæ¥å£°æ˜å˜é‡æ—¶ï¼šstaticç”¨æ¥ä¿®æ”¹å˜é‡çš„å­˜å‚¨ç±»å‹ï¼Œå˜æˆäº†é™æ€å˜é‡ï¼›ä½†æ˜¯é“¾æ¥å±æ€§å’Œä½œç”¨åŸŸæ˜¯ä¸å˜çš„</p>
</li>
<li><p>æ³¨æ„ï¼šå‡½æ•°çš„ä»£ç æ€»æ˜¯å­˜æ”¾åœ¨é™æ€å†…å­˜ä¸­ã€‚</p>
</li>
<li><p>åœ¨ä»£ç å—ä¸­çš„å˜é‡å£°æ˜æˆexternalçš„è¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªåœ¨å¤–éƒ¨è¢«å®šä¹‰çš„é™æ€å˜é‡ï¼Œå­˜æ”¾åœ¨é™æ€å†…å­˜ä¸­ï¼Œä¸å†æ˜¯ä¸€ä¸ªè‡ªåŠ¨å˜é‡</p>
</li>
</ol>
<h3 id="æ“ä½œç¬¦å’Œè¡¨è¾¾å¼"><a href="#æ“ä½œç¬¦å’Œè¡¨è¾¾å¼" class="headerlink" title="æ“ä½œç¬¦å’Œè¡¨è¾¾å¼"></a>æ“ä½œç¬¦å’Œè¡¨è¾¾å¼</h3><ol>
<li><p>ç§»ä½æ“ä½œç¬¦åˆ†ä¸ºé€»è¾‘ç§»ä½å’Œç®—æœ¯ç§»ä½ã€‚é€»è¾‘ç§»ä½æ’å…¥0ï¼Œç®—æœ¯ç§»ä½æ’å…¥1</p>
</li>
<li><p>ä½æ“ä½œç¬¦ï¼š<strong>AND(&amp;)</strong> ã€ <strong>OR(|)</strong> ã€ <strong>XOR(^)</strong> å¯¹ä»–ä»¬çš„æ“ä½œæ•°çš„å„ä¸ªä½åˆ†åˆ«æ‰§è¡Œä¸ã€æˆ–ã€å¼‚æˆ–æ“ä½œ</p>
</li>
<li><p><strong>~</strong> æ“ä½œç¬¦æŒ‰ä½å–å</p>
</li>
<li><p><strong>&amp;</strong> æ“ä½œç¬¦è·å¾—å˜é‡çš„åœ°å€</p>
</li>
<li><p>åœ¨macä¸Š <code>sizeof(int)</code> æ˜¯4ï¼Œ<code>sizeof(char)</code>æ˜¯1ï¼Œæ³¨æ„<code>getchar()</code>è¿”å›çš„æ˜¯intï¼Œ <strong>EOF</strong> ä¹Ÿæ˜¯intå‹</p>
</li>
<li><p><code>sizeof(a = b + 1);</code>æ˜¯å¯¹è¡¨è¾¾å¼æ±‚å­—èŠ‚æ•°ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å¯¹aèµ‹å€¼</p>
</li>
<li><p>æ³¨æ„ï¼šè¡¨è¾¾å¼ä¸­çš„å­—ç¬¦å‹( <strong>char</strong> ) å’ŒçŸ­æ•´å‹( <strong>short int</strong> ) åœ¨ä½¿ç”¨ä¹‹å‰ä¼šå…ˆè¢«è½¬æ¢æˆä¸ºæ•´å½¢ï¼Œå¦‚ä¸‹</p>
<pre><code class="c">char a, b, c; // abcéƒ½æ˜¯1ä¸ªå­—èŠ‚
a = b + c; // bå’Œcå…ˆè¢«è½¬åŒ–æˆæ•´å½¢ï¼Œä¹Ÿå°±æ˜¯4ä¸ªå­—èŠ‚ï¼Œåœ¨ç›¸åŠ ï¼›å¾—åˆ°ç»“æœåå†æˆªæ–­æˆä¸€ä¸ªå­—èŠ‚å­˜å‚¨è¿›aä¸­
</code></pre>
<p>è¿™æ ·åšæ˜¯ä¸ºäº†æé«˜ç²¾åº¦ï¼Œå› ä¸ºå¦‚æœæ¶‰åŠåˆ°ä½è¿ç®—çš„è¯ï¼Œå¾ˆå®¹æ˜“å°†8ä½çš„å…¶ä¸­æŸäº›ä½æ•°ç»™åˆ é™¤æ‰ï¼Œå¢åŠ åˆ°32ä½å°±ä¼šå‡å°è¿™ç§é”™è¯¯çš„æ¦‚ç‡</p>
</li>
<li><p>å¦‚æœæ“ä½œç¬¦çš„å„ä¸ªæ“ä½œæ•°ä¸æ˜¯åŒæ ·çš„ç±»å‹ï¼ˆä½æ•°ä¸åŒï¼‰ï¼Œé‚£ä¹ˆä½æ•°å°‘çš„ç±»å‹ä¼šå…ˆè½¬åŒ–æˆä½æ•°å¤šçš„ç±»å‹ï¼Œå†è¿›è¡Œè¿ç®—</p>
</li>
</ol>
<h3 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h3><ol>
<li><p>å†…å­˜çš„åœ°å€ä»¥å­—èŠ‚( <strong>byte</strong> )ä¸ºå•ä½ï¼Œæ¯ä¸ªåœ°å€å°±æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œ8ä½ã€‚</p>
</li>
<li><p>ä¸ºäº†å­˜å‚¨æ›´å¤§çš„å€¼ï¼Œç»å¸¸æŠŠ2ä¸ªæˆ–æ›´å¤šçš„å­—èŠ‚åˆå¹¶åœ¨ä¸€èµ·æ¥ç»„æˆæ›´å¤§çš„å†…å­˜å•ä½ï¼Œä¹Ÿå°±æ˜¯ <strong>å­—</strong> ã€‚å­—ç»å¸¸ç”±2ä¸ªæˆ–æ˜¯4ä¸ªå­—èŠ‚ç»„æˆã€‚æ‰€ä»¥ç¬¬ä¸€ä¸ªå­—çš„åœ°å€ä¸º100çš„è¯ï¼Œç¬¬äºŒä¸ªå­—çš„åœ°å€å¯èƒ½æ˜¯102æˆ–æ˜¯104</p>
</li>
<li><p>æ³¨æ„ï¼šä»¥4å­—èŠ‚çš„å­—ä¸ºä¾‹ã€‚è™½ç„¶ä¸€ä¸ªå­—åŒ…å«4ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯è¿™ä¸ªå­—è¿˜æ˜¯åªæœ‰ä¸€ä¸ªåœ°å€ï¼Œè‡³äºå®ƒçš„åœ°å€æ˜¯æœ€å·¦è¾¹å­—èŠ‚çš„åœ°å€è¿˜æ˜¯æœ€å³è¾¹çš„å­—èŠ‚çš„åœ°å€ï¼Œè¿™ç”±æœºå™¨æ¥å†³å®šã€‚ï¼ˆé«˜ä½åœ°å€å’Œä½ä½åœ°å€ï¼‰</p>
</li>
<li><p>æ³¨æ„ä¸€ä¸‹ * çš„ä½¿ç”¨</p>
<pre><code class="c">int a = 112; // açš„å€¼æ˜¯112ï¼Œå‡è®¾açš„åœ°å€æ˜¯100
int *b = &amp;a; // è¿™é‡Œæ˜¯å°†açš„åœ°å€100ï¼Œèµ‹ç»™æŒ‡é’ˆb
printf(&quot;%d&quot;, *b); // è¿™é‡Œæ˜¯å–å¾—bæŒ‡é’ˆæŒ‡å‘çš„åœ°å€å†…çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ 112
</code></pre>
</li>
<li><p>æŒ‡é’ˆå˜é‡ä¸æ˜¯æ•´å½¢å˜é‡ï¼Œæ‰€ä»¥<code>d = 10 - *d;</code> è¿™æ ·æ˜¯é”™çš„ã€‚ä¸èƒ½å°†ä¸€ä¸ªintå‹èµ‹å€¼ç»™ä¸€ä¸ªæŒ‡é’ˆå˜é‡</p>
</li>
<li><p>è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå€¼ï¼Œè‹¥è¿™ä¸ªå€¼çš„å­˜å‚¨ä½ç½®æ²¡æœ‰æ¸…æ™°å®šä¹‰çš„è¯ï¼Œè¿™ä¸ªè¡¨è¾¾å¼åªèƒ½æ˜¯å³å€¼ï¼Œä¸èƒ½æ˜¯å·¦å€¼</p>
</li>
<li><p><code>*cp++</code> è¿™ä¸ªè¡¨è¾¾å¼ä¸­ ++ ä¼˜å…ˆçº§é«˜äº * ã€‚æ‰§è¡Œæ­¥éª¤</p>
<ol>
<li>++æ“ä½œç¬¦å…ˆç”Ÿæˆä¸€ä»½cpçš„æ‹·è´</li>
<li>å¯¹cpæ‰§è¡ŒåŠ ä¸€çš„æ“ä½œ</li>
<li>ç°åœ¨cp++æ‰§è¡Œå®Œæˆï¼Œä»–æ˜¯ç¬¬ä¸€æ­¥ä¸­cpçš„æ‹·è´ï¼›å†æ‰§è¡Œ*æ“ä½œï¼Œå–è¿™ä¸ªæ‹·è´æŒ‡å‘çš„åœ°å€çš„å€¼</li>
</ol>
</li>
<li><p><code>NULL</code> <code>&#39;\0&#39;</code> çš„intå€¼éƒ½æ˜¯ 0</p>
</li>
<li><p>æŒ‡é’ˆè¿ç®—å¾ˆæ™ºèƒ½ã€‚å°±ä»¥æŒ‡é’ˆåŠ ä¸€çš„è¿ç®—ä¸ºä¾‹ã€‚</p>
<ol>
<li>charç±»å‹å æ®ä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æŒ‡å‘charçš„æŒ‡é’ˆåŠ ä¸€ï¼Œä¹Ÿå°±æ˜¯åœ°å€åŠ ä¸€ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªchar</li>
<li>floatç±»å‹å¯èƒ½å æ®4ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæŒ‡å‘floatçš„æŒ‡é’ˆåŠ ä¸€ï¼Œå…¶å®æ˜¯åœ°å€åŠ 4ï¼Œç»“æœä¹Ÿæ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªfloat</li>
</ol>
</li>
<li><p>ä¸¤ä¸ªæŒ‡é’ˆå¯ä»¥ç›¸å‡ï¼ˆè¿™ä¸¤ä¸ªæŒ‡é’ˆå¿…é¡»æŒ‡å‘åŒä¸€ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ ï¼‰ï¼Œç›¸å‡çš„ç»“æœçš„ç±»å‹æ˜¯ <strong>ptrdiff_t</strong> ï¼Œä¸€ç§æœ‰ç¬¦å·æ•´æ•°ç±»å‹ã€‚ç»“æœæ˜¯ä¸¤æŒ‡é’ˆåœ¨å†…è®­ä¸­çš„è·ç¦»ï¼Œæ³¨æ„è¿˜æ˜¯ä»¥æ•°ç»„å…ƒç´ çš„é•¿åº¦ä¸ºå•ä½ï¼Œä¸æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½ã€‚</p>
</li>
<li><p>å¯¹æŒ‡é’ˆæ‰§è¡Œ<code>&lt; &lt;= &gt; &gt;=</code>æ“ä½œä¹Ÿæ˜¯å¯ä»¥çš„ï¼ŒåŒæ ·ï¼Œä¸¤æŒ‡é’ˆå¿…é¡»æŒ‡å‘åŒä¸€æ•°ç»„çš„å…ƒç´ </p>
</li>
<li><p>å¯ä»¥å¯¹ä»»æ„ä¸¤æŒ‡é’ˆæ‰§è¡Œç›¸ç­‰æˆ–ä¸ç›¸ç­‰çš„æµ‹è¯•ï¼ŒæŒ‡å‘åŒä¸€åœ°å€çš„ä¸¤æŒ‡é’ˆç›¸ç­‰</p>
</li>
</ol>
<h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><ol>
<li>å‡½æ•°åŸå‹å¾ˆé‡è¦ï¼Œå¦‚æœæ²¡æœ‰å‡½æ•°åŸå‹ï¼Œå°±è°ƒç”¨å‡½æ•°ï¼ˆpsï¼šå‡½æ•°è°ƒç”¨å‘ç”Ÿåœ¨å‡½æ•°å®šä¹‰ä¹‹å‰ï¼‰ï¼Œé‚£ä¹ˆé»˜è®¤çš„æ˜¯è¿”å›æ•´å½¢ã€‚è¿™æ—¶ä¸¾ä¸ªä¾‹å­ï¼Œè°ƒç”¨çš„å‡½æ•°è¿”å›çš„æ˜¯floatï¼Œfloatå­˜æ”¾åœ¨å†…å­˜ä¸­çš„æ˜¯äºŒè¿›åˆ¶ï¼Œä½†æ˜¯ç¼–è¯‘å™¨ä¼šå°†ä»–è§£é‡Šæˆintï¼›å¦‚æœå°†è¿™ä¸ªå‡½æ•°è¿”å›å€¼èµ‹ç»™floatï¼Œè¿™ä¸ªå€¼ä¹Ÿæ˜¯intå‹è½¬åŒ–çš„floatï¼Œä¸æ˜¯åŸæ¥çš„floatã€‚</li>
<li>Cå‡½æ•°çš„å‚æ•°éƒ½æ˜¯ä¼ å€¼è°ƒç”¨ï¼Œå°±æ˜¯ä¼ é€’æ‹·è´ï¼Œä¸æ”¹å˜åŸå€¼ï¼›ä¼ æŒ‡é’ˆçš„è¯ï¼Œå¯ä»¥æ”¹å˜æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¼ å€¼è°ƒç”¨ï¼Œå› ä¸ºä¼ é€’çš„æ˜¯æŒ‡é’ˆçš„æ‹·è´</li>
<li><strong>ADT</strong> æŠ½è±¡æ•°æ®ç±»å‹</li>
<li>å¯å˜å‚æ•°åˆ—è¡¨æ˜¯é€šè¿‡å®æ¥å®ç°çš„ï¼Œè¿™äº›å®ä½äº stdrag.h å¤´æ–‡ä»¶ä¸­ã€‚PS æœ‰ç‚¹ä¸æ‡‚</li>
</ol>
<h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><ol>
<li><p>æ•°ç»„åæ˜¯ä¸€ä¸ªæŒ‡å‘å…¶ä»–ç±»å‹çš„æŒ‡é’ˆå¸¸é‡ï¼ˆæ¯”å¦‚æŒ‡å‘intå‹çš„ï¼‰ï¼Œä¸èƒ½ä¿®æ”¹å®ƒçš„æŒ‡å‘ã€‚ä¹Ÿå°±æ˜¯è¯´æ•°ç»„åæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œä½†æ˜¯ä¸èƒ½è¢«èµ‹å€¼ã€‚</p>
</li>
<li><p>æ³¨æ„ï¼Œ<code>int a[10]; sizeof(a);</code> ä½¿ç”¨sizeofæ—¶ï¼Œå¹¶ä¸æ˜¯æ±‚æŒ‡é’ˆçš„é•¿åº¦ï¼Œè€Œæ˜¯æ•°ç»„çš„é•¿åº¦</p>
<pre><code class="c">int a = 10;
int *b = &amp;aï¼›
int c[10];
sizeof(b); // bçš„å¤§å°æ˜¯8å­—èŠ‚ï¼Œå› ä¸ºä»–æ˜¯æŒ‡é’ˆ
sizeof(c); // cçš„å¤§å°æ˜¯40å­—èŠ‚ï¼Œå› ä¸ºä»–æ˜¯intå‹æ•°ç»„ï¼Œæœ‰10ä¸ª4å­—èŠ‚çš„int
</code></pre>
</li>
<li><p>æ•°ç»„çš„ä¸‹æ ‡å¼•ç”¨å’ŒæŒ‡é’ˆæ“ä½œæ˜¯ä¸€æ ·çš„ã€‚ä¸€ä¸‹å‡ ç§å†™æ³•ç­‰ä»·</p>
<pre><code class="c">array[2]; 
*(array + 2);
*(2 + array);
2[array];
</code></pre>
</li>
<li><p>æŒ‡é’ˆæœ‰æ—¶æ•ˆç‡æ¯”ä¸‹æ ‡å¼•ç”¨å¿«</p>
</li>
<li><p>æ³¨æ„ï¼Œæ•°ç»„å’ŒæŒ‡é’ˆè¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œ</p>
<pre><code class="c">int a[5]; // åˆ†é…äº†5ä¸ªintçš„å†…å­˜ç©ºé—´ï¼ŒaæŒ‡å‘ç¬¬ä¸€ä¸ªintå†…å­˜ç©ºé—´ï¼Œå¹¶æ²¡æœ‰è¯´æ˜aæŒ‡é’ˆå­˜æ”¾åœ¨å“ªé‡Œ
int *b; // åˆ†é…äº†ä¸€ä¸ªæŒ‡é’ˆå˜é‡çš„å†…å­˜ç©ºé—´ï¼Œç”¨æ¥å­˜æ”¾bæŒ‡é’ˆï¼Œä½†æ˜¯æ²¡æœ‰åˆ†é…intå†…å­˜ç©ºé—´ï¼Œä¹Ÿæ²¡æœ‰è¯´æ˜bæŒ‡å‘å“ªé‡Œ
</code></pre>
</li>
<li><p>æ³¨æ„ï¼Œæ•°ç»„åæ˜¯ä¸ªæŒ‡é’ˆå¸¸é‡ï¼Œä¸èƒ½è¢«ä¿®æ”¹å®ƒçš„æŒ‡å‘ã€‚ä½†æ˜¯ï¼Œå½“å®ƒè¢«å½“æˆå‚æ•°ä¼ é€’ç»™å‡½æ•°æ—¶ï¼Œå‡½æ•°æ¥æ”¶åˆ°çš„æ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆå˜é‡ï¼Œå¯ä»¥ä¿®æ”¹å®ƒçš„æŒ‡å‘ã€‚</p>
<pre><code class="c">int strlen(char *string); // ä½¿ç”¨è¿™æ ·çš„å‡½æ•°å£°æ˜æ¥ä¼ é€’æ•°ç»„å
</code></pre>
</li>
<li><p>å†çœ‹çœ‹æ•°ç»„å’ŒæŒ‡é’ˆçš„åŒºåˆ«</p>
<pre><code class="c">char message1[] = &quot;Hello&quot;;
char *message2 = &quot;Hello&quot;;
</code></pre>
<p><img src="/lionheart/1603/array.JPG" alt="array"></p>
</li>
<li><p>äºŒç»´æ•°ç»„çš„æ•°ç»„åæ˜¯ä¸€ä¸ªæŒ‡å‘ä¸€ç»´æ•°ç»„çš„æŒ‡é’ˆï¼Œå¤šç»´ä¾æ¬¡ç…§æ¨</p>
</li>
<li><p>å£°æ˜ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆ</p>
<pre><code class="c">int matrix[3][10];
int (*p)[10] = matrix; // pæŒ‡å‘ä¸‰ç»´æ•°ç»„çš„ç¬¬ä¸€è¡Œ
// ps è¦é¿å…ä¸‹é¢çš„å£°æ˜
int (*p)[]; // æœ€å¥½è¦å£°æ˜é•¿åº¦ï¼Œå› ä¸ºæ–¹ä¾¿æŒ‡é’ˆçš„è¿ç®—
</code></pre>
</li>
<li><p>å‡½æ•°ä¼ é€’å¤šç»´æ•°ç»„æ—¶çš„å£°æ˜å½¢å¼å¦‚ä¸‹ï¼š</p>
</li>
</ol>
<pre><code class="c">   int matrix[3][10];
   func(matrix);
   // ä¸€ä¸‹ä¸¤ç§åŸå‹å£°æ˜éƒ½å¯ä»¥,è®°å¾—å£°æ˜ä½ç»´çš„é•¿åº¦
   void func(int (*mat)[10]);
   void func(int mat[][10]);
   // ps ä¸‹é¢è¿™æ ·çš„å£°æ˜æ˜¯ä¸å¯¹çš„
   void func(int **mat); // è¿™ä¼ é€’çš„æ˜¯æŒ‡å‘æ•´å½¢æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œè€Œä¸æ˜¯æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆ
</code></pre>
<p>1.1111111111111112e+3211111111111111121111111111111111. æŒ‡é’ˆæ•°ç»„ï¼šå…ƒç´ éƒ½æ˜¯æŒ‡é’ˆçš„æ•°ç»„ï¼š<code>int *p[10];</code> pæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé•¿åº¦ä¸º10ï¼Œå…ƒç´ æ˜¯intå‹æŒ‡é’ˆ</p>
<p>1.1111111111111112e+3211111111111111121111111111111111. çœ‹çœ‹è¿™æ®µä»£ç </p>
<pre><code class="c">   /* size of char is 1, size of char * is 8*/
          char a = &#39;a&#39;;
          char *b = &amp;a;
          printf(&quot;size of char is %ld, and size of char * is %ld\n&quot;, sizeof(a), sizeof(b)); 

          /* size of keyword 36 ,å› ä¸ºæœ‰36ä¸ªcharï¼›size of keyp 32ï¼Œå› ä¸ºæœ‰4ä¸ªcharå‹æŒ‡é’ˆï¼›
             size of keyword[0] 9,å› ä¸ºä¸€ç»´æ•°ç»„æœ‰9ä¸ªcharï¼› size of keyp[0] 8,å› ä¸ºæ˜¯ä¸€ä¸ªcharå‹æŒ‡é’ˆ */
          char const keyword[][9] = {
                  &quot;do&quot;,
                  &quot;haha&quot;,
                  &quot;hehe&quot;,
                  &quot;yeah&quot;
          };

          char const *keyp[] = {
                  &quot;do&quot;,
                  &quot;haha&quot;,
                  &quot;hehe&quot;,
                  &quot;yeah&quot;
          };
          printf(&quot;size of keyword is %ld, and size of keyp is %ld&quot;, sizeof(keyword[0]), sizeof(keyp[0]));
          printf(&quot;size of keyword is %ld, and size of keyp is %ld&quot;, sizeof(keyword[0]), sizeof(keyp[0]));
</code></pre>
<h3 id="å­—ç¬¦ä¸²ã€å­—ç¬¦å’Œå­—èŠ‚"><a href="#å­—ç¬¦ä¸²ã€å­—ç¬¦å’Œå­—èŠ‚" class="headerlink" title="å­—ç¬¦ä¸²ã€å­—ç¬¦å’Œå­—èŠ‚"></a>å­—ç¬¦ä¸²ã€å­—ç¬¦å’Œå­—èŠ‚</h3><ol>
<li><p>å­—ç¬¦ä¸²ä»¥ä¸€ä¸ªä½å…¨ä¸º0çš„NULå­—èŠ‚ç»“å°¾ï¼Œæ³¨æ„æ˜¯å­—èŠ‚ï¼Œä½†æ˜¯è¿™ä¸ªå­—èŠ‚ä¸å±äºå­—ç¬¦ä¸²</p>
</li>
<li><p>å­—ç¬¦ä¸²é•¿åº¦ï¼Œå°±æ˜¯åŒ…å«çš„å­—ç¬¦æ•°ï¼Œä¸åŒ…æ‹¬NULç»“å°¾å­—èŠ‚ï¼Œä½¿ç”¨<code>strlen</code>å‡½æ•°å–å¾—</p>
<pre><code class="c">size_t strlen(char const *string); //è¿™é‡Œè¿”å›çš„æ˜¯size_t,æ— ç¬¦å·æ•´å½¢
</code></pre>
<p>å› ä¸ºæ— ç¬¦å·æ•´å½¢æ˜¯ä¸ä¼šä¸ºè´Ÿæ•°çš„ï¼Œæ‰€ä»¥æ³¨æ„è¿™ä¸¤ç§å†™æ³•</p>
<pre><code class="c">if (strlen(x) &gt;= strlen(y)) ...  // right
if (strlen(x) - strlen(y) &gt;= 0) ... // wrong
</code></pre>
<p>ç¬¬ä¸€ç§æ˜¯å¯¹çš„ï¼Œä½†æ˜¯ç¬¬äºŒç§æ˜¯é”™çš„ã€‚å› ä¸ºä¸¤ä¸ªæ— ç¬¦å·æ•´å½¢ç›¸å‡è¿˜æ˜¯æ— ç¬¦å·æ•´å½¢ï¼Œä¸å¯èƒ½æ˜¯è´Ÿæ•°ï¼Œæ‰€ä»¥ifé‡Œé¢çš„åˆ¤æ–­å§‹ç»ˆæ­£ç¡®ã€‚æ— ç¬¦å·æ•´å½¢è¦å’Œæœ‰ç¬¦å·çš„è®¡ç®—æ—¶ï¼Œæœ€å¥½å…ˆå¼ºåˆ¶è½¬åŒ–æˆintå‹</p>
</li>
<li><p><code>strcpy</code>ç”¨æ‹·è´å­—ç¬¦ä¸²ï¼Œ<code>strcat</code>ç”¨äºè¿æ¥å­—ç¬¦ä¸²ï¼›ä»–ä»¬è¿”å›å€¼éƒ½æ˜¯æ–°çš„å­—ç¬¦ä¸²çš„é¦–åœ°å€ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘é¦–å­—ç¬¦çš„æŒ‡é’ˆ</p>
</li>
<li><p><code>strcmp</code>ç”¨äºä¸¤å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œaå°äºbï¼Œè¿”å›è´Ÿå€¼ï¼›aç­‰äºbï¼Œè¿”å›0ï¼›aå¤§äºbï¼Œè¿”å›æ­£å€¼</p>
</li>
<li><p>æŸ¥æ‰¾ä¸€ä¸ªå­—ç¬¦ï¼šåŒºåˆ†å¤§å°å†™</p>
<pre><code class="c">char *strchr(char const *str, int ch); // åœ¨strä¸­æ‰¾ç¬¬ä¸€ä¸ªchå­—ç¬¦ï¼Œè¿”å›æŒ‡å‘chçš„æŒ‡é’ˆï¼Œè‹¥æ²¡æœ‰è¿”å›NULLæŒ‡é’ˆ
char *strrchr(char const *str, int ch); // åŒä¸Šï¼Œæ‰¾çš„æ˜¯æœ€åä¸€ä¸ªchå­—ç¬¦
</code></pre>
</li>
<li><p>æŸ¥æ‰¾ä»»æ„å‡ ä¸ªå­—ç¬¦ï¼šåŒºåˆ†å¤§å°å†™</p>
<pre><code class="c">char *strpbrk(char const *str, char const *group); // åœ¨strä¸­æŸ¥æ‰¾groupä¸­çš„å­—ç¬¦ï¼Œè¿”å›ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„å­—ç¬¦çš„æŒ‡é’ˆ
</code></pre>
</li>
<li><p>æŸ¥æ‰¾ä¸€ä¸ªå­ä¸²</p>
<pre><code class="c">char *strstr(char const *s1, char const *s2); // è‹¥s2æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œå°±è¿”å›s1
</code></pre>
</li>
<li><p>è¿”å›é”™è¯¯ä¿¡æ¯ï¼š</p>
<pre><code class="c">char *strerror(int error_number);
</code></pre>
</li>
<li><p><code>memcpy()</code>å‡½æ•°å¯ä»¥å°†ä»»æ„å­—èŠ‚æ•°çš„å†…å®¹å¤åˆ¶åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œå’Œ<code>strcpy</code>ä¸åŒçš„æ˜¯ï¼Œä»–ç¢°åˆ°NULå­—èŠ‚ä¸ä¼šåœæ­¢å·¥ä½œ</p>
</li>
</ol>
<h3 id="ç»“æ„å’Œè”åˆ"><a href="#ç»“æ„å’Œè”åˆ" class="headerlink" title="ç»“æ„å’Œè”åˆ"></a>ç»“æ„å’Œè”åˆ</h3><ol>
<li><p>ä½¿ç”¨ç»“æ„å°†ä¸åŒç±»å‹çš„å€¼å­˜å‚¨åœ¨ä¸€èµ·ï¼Œæ˜¾ç„¶æ•°ç»„æ— æ³•å®Œæˆè¿™ä¸ªå·¥ä½œ</p>
</li>
<li><p>æ•°ç»„å…ƒç´ å¯ä»¥é€šè¿‡ä¸‹æ ‡æ¥è®¿é—®ï¼Œå› ä¸ºä»–ä»¬çš„é•¿åº¦ç›¸åŒï¼›ä½†æ˜¯ç»“æ„ä¸è¡Œï¼Œå› ä¸ºä»–çš„æˆå‘˜ç±»å‹ä¸åŒ</p>
</li>
<li><p>é€šè¿‡ <strong>.</strong> æ¥è®¿é—®æˆï¼Œä¹Ÿå°±æ˜¯ <code>ç»“æ„.æˆå‘˜</code></p>
</li>
<li><p>è¿˜å¯ä»¥é€šè¿‡ <strong>-&gt;</strong> æ¥è®¿é—®æˆå‘˜ï¼Œä½†æ˜¯é€‚ç”¨äºç»“æ„æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯ <code>ç»“æ„æŒ‡é’ˆ-&gt;æˆå‘˜</code></p>
</li>
<li><p>æ³¨æ„ç»“æ„çš„è‡ªå¼•ç”¨ï¼š</p>
<ol>
<li>ç»“æ„ä½“çš„æˆå‘˜æ˜¯ç»“æ„ä½“æœ¬èº«ï¼Œè¿™æ˜¯ä¸åˆæ³•çš„ã€‚ä¸èƒ½ç¡®å®šå†…å­˜å¤§å°ï¼Œæ— é™é€’å½’äº†</li>
<li>ç»“æ„ä½“çš„æˆå‘˜æ˜¯æŒ‡å‘ç»“æ„ä½“æœ¬èº«çš„æŒ‡é’ˆï¼Œè¿™æ˜¯åˆæ³•çš„ã€‚å¯ä»¥ç¡®å®šå†…å­˜å¤§å°ï¼Œå› ä¸ºæŒ‡é’ˆå¤§å°æ˜¯8å­—èŠ‚</li>
</ol>
</li>
<li><p>ä¸å®Œæ•´å£°æ˜ï¼Œç”¨äºå¤„ç†ä¸¤ä¸ªäº’ç›¸å¼•ç”¨çš„ç»“æ„ä½“ï¼š</p>
<pre><code class="c">struct B; // Bçš„ä¸å®Œæ•´å£°æ˜
struct A {
      struct B *partner;
}
struct B {
      struct A *partner;
}
</code></pre>
</li>
<li><p>å‡è®¾pxæ˜¯æŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œé‚£ä¹ˆ<code>px+1</code>æ˜¯éæ³•çš„ï¼›è¿™é‡Œä¸åƒæ•°ç»„</p>
</li>
<li><p><code>*px-&gt;c.b</code> å…ˆæ‰§è¡Œ-&gt;ï¼Œç„¶åæ‰§è¡Œ . æ“ä½œï¼Œæœ€åæ‰§è¡Œ * æ“ä½œ</p>
</li>
<li><p>å…³äºç»“æ„ä½“è¾¹ç•Œå¯¹é½çš„ä¸‰ä¸ªåŸºæœ¬åŸåˆ™</p>
<ol>
<li>æ™®é€šæ•°æ®æˆå‘˜å¯¹é½è§„åˆ™ï¼šç¬¬ä¸€ä¸ªæ•°æ®æˆå‘˜æ”¾åœ¨offsetä¸º0çš„åœ°æ–¹ï¼Œä»¥åæ¯ä¸ªæ•°æ®æˆå‘˜å­˜å‚¨çš„èµ·å§‹ä½ç½®è¦ä»è¯¥æˆå‘˜å¤§å°çš„æ•´æ•°å€å¼€å§‹ï¼ˆæ¯”å¦‚intåœ¨32ä½æœºä¸ºï¼”å­—èŠ‚ï¼Œåˆ™è¦ä»4çš„æ•´æ•°å€åœ°å€å¼€å§‹å­˜å‚¨ï¼‰ã€‚</li>
<li>ç»“æ„ä½“æˆå‘˜å¯¹é½è§„åˆ™ï¼šå¦‚æœä¸€ä¸ªç»“æ„é‡Œæœ‰æŸäº›ç»“æ„ä½“æˆå‘˜ï¼Œåˆ™è¯¥ç»“æ„ä½“æˆå‘˜è¦ä»å…¶å†…éƒ¨æœ€å¤§å…ƒç´ å¤§å°çš„æ•´æ•°å€åœ°å€å¼€å§‹å­˜å‚¨ã€‚ï¼ˆstruct aé‡Œå­˜æœ‰struct bï¼Œbé‡Œæœ‰charï¼Œintï¼Œdoubleç­‰å…ƒç´ ï¼Œé‚£båº”è¯¥ä»8çš„æ•´æ•°å€å¼€å§‹å­˜å‚¨ã€‚ï¼‰</li>
<li>ç»“æ„ä½“å¤§å°å¯¹é½è§„åˆ™ï¼šç»“æ„ä½“å¤§å°ä¹Ÿå°±æ˜¯sizeofçš„ç»“æœï¼Œå¿…é¡»æ˜¯å…¶å†…éƒ¨æˆå‘˜ä¸­æœ€å¤§çš„å¯¹é½å‚æ•°çš„æ•´æ•°å€ï¼Œä¸è¶³çš„è¦è¡¥é½ã€‚</li>
</ol>
</li>
<li><p><code>offsetof(struct, member);</code>å‡½æ•°å¯ä»¥æ±‚å‡ºmemberçš„å­˜å‚¨é¦–åœ°å€å’Œç»“æ„ä½“çš„å­˜å‚¨é¦–åœ°å€çš„åç§»é‡ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½</p>
</li>
<li><p>åœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼ é€’ç»“æ„ä½“ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä¼ å‚æ–¹æ˜¯</p>
</li>
</ol>
<pre><code class="c">   void func(register struct const *structP);
</code></pre>
<p>   ä¼ é€’æŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆå¯ä»¥æé«˜æ•ˆç‡ï¼Œå› ä¸ºæŒ‡é’ˆçš„sizeä¸º8ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯æ¯”ç»“æ„ä½“å°å¾ˆå¤šçš„ã€‚å¦å¤–æ·»åŠ constä¿®é¥°ï¼Œå¯ä»¥é˜²æ­¢ç»“æ„ä½“è¢«ä¿®æ”¹ï¼›å¦å¤–å¢åŠ registerä¿®é¥°ï¼Œå°†è¿™ä¸ªæŒ‡é’ˆå­˜æ”¾åœ¨å¯„å­˜å™¨ä¸Šé¢ï¼Œå¯ä»¥æé«˜æŒ‡é’ˆè®¿é—®æˆå‘˜ï¼ˆ-&gt;ï¼‰æ“ä½œçš„æ•ˆç‡ã€‚PSï¼Œå¦‚æœæƒ³å¯¹ç»“æ„ä½“è¿›è¡Œä¿®æ”¹çš„è¯ï¼Œå»æ‰constä¿®é¥°</p>
<p>1.222222222222222e+32. è”åˆçš„æ‰€æœ‰æˆå‘˜å¼•ç”¨çš„æ˜¯ <strong>å†…å­˜ä¸­çš„ç›¸åŒä½ç½®</strong> ï¼Œå½“ä½ æƒ³åœ¨ <strong>ä¸åŒæ—¶åˆ»</strong> å°† <strong>ä¸åŒçš„ä¸œè¥¿</strong> å­˜æ”¾åœ¨ <strong>ç›¸åŒçš„ä½ç½®</strong> æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨è”åˆ</p>
<pre><code class="c">   union {
         float f;
         int i;
   } fi;

   fi.f = 3.14159;
   printf(&quot;%d\n&quot;, fi.i);
</code></pre>
<p>   float å’Œ int éƒ½å æ®32ä½çš„æ•°æ®ï¼Œä¸Šé¢çš„ä»£ç å…ˆå°†3.14159è¿™ä¸€æµ®ç‚¹æ•°ä»¥äºŒè¿›åˆ¶çš„å­˜æ”¾åœ¨32ä½çš„å†…å­˜ä¸Šé¢ï¼›ç„¶åfi.iä¼šä»¥intçš„å½¢å¼è¯»å–ç›¸åŒå†…å­˜ä½ç½®ä¸Šçš„è¿™32ä½æ•°æ®</p>
<h3 id="åŠ¨æ€å†…å­˜åˆ†é…"><a href="#åŠ¨æ€å†…å­˜åˆ†é…" class="headerlink" title="åŠ¨æ€å†…å­˜åˆ†é…"></a>åŠ¨æ€å†…å­˜åˆ†é…</h3><ol>
<li><p>æ•°ç»„çš„é•¿åº¦åœ¨è¿è¡Œæ—¶æ‰å¯ä»¥çŸ¥é“ï¼Œä½†æ˜¯æˆ‘ä»¬å´ç»å¸¸ç»™ä»–ä¸€ä¸ªå¸¸é‡ï¼Œé‚£ä¹ˆåœ¨ç¼–è¯‘æ—¶å°±ä¼šåˆ†é…ç»™æ•°ç»„ä»¥é•¿åº¦å¤§å°çš„å†…å­˜ã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨åŠ¨æ€åˆ†é…å†…å­˜</p>
</li>
<li><p><code>malloc</code> å’Œ <code>free</code> å‡½æ•°ç”¨äºæ‰§è¡ŒåŠ¨æ€å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾ã€‚ä»–ä»¬ç»´æŠ¤ç€ä¸€å—å†…å­˜æ± </p>
</li>
<li><p><code>malloc</code>ä»å†…å­˜æ± ä¸­å–å‡ºä¸€å— <strong>è¿ç»­</strong> å†…å­˜ï¼Œå¹¶å°†æŒ‡å‘è¿™å—å†…å­˜çš„æŒ‡é’ˆè¿”å›ï¼›å½“ä¸éœ€è¦è¿™å—å†…å­˜æ—¶ï¼Œä½¿ç”¨<code>free</code>é‡Šæ”¾ï¼Œå¹¶å°†è¯¥å¿«å†…å­˜å½’è¿˜ç»™å†…å­˜æ± </p>
<pre><code class="c">void *malloc (size_t size); // å‚æ•°æ˜¯å­—èŠ‚æ•°
void free(void *pointer); // å‚æ•°æ˜¯mallocè¿”å›çš„æŒ‡é’ˆ
</code></pre>
</li>
<li><p>å¦‚æœ <code>malloc</code> æ— æ³•è¿”å›æŒ‡å®šå¤§å°çš„å†…å­˜ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªNULLæŒ‡é’ˆã€‚ä»–è¿”å›çš„å†…å­˜çš„èµ·å§‹ä½ç½®æ»¡è¶³è¾¹ç•Œå¯¹é½çš„è¦æ±‚</p>
</li>
<li><p><code>void *calloc(size_t num_elements, size_t element_size);</code> å‡½æ•°åœ¨è¿”å›å†…å­˜æ—¶ï¼Œä¼šå…ˆå°†è¿™å—å†…å­˜åˆå§‹åŒ–ï¼Œå…¨éƒ¨ç½®ä¸º0</p>
</li>
<li><p><code>void realloc(void *ptr, size_t new_size);</code> å‡½æ•°ç”¨äºæ‰©å¤§æˆ–ç¼©å°å·²ç»åˆ†é…å‡ºæ¥çš„å†…å­˜å—(ptr)</p>
</li>
<li><p>ä¼ é€’ç»™ <code>free</code> å‡½æ•°çš„æŒ‡é’ˆå¿…é¡»æ˜¯ <code>malloc</code> <code>calloc</code> <code>realloc</code> å‡½æ•°è¿”å›çš„æŒ‡é’ˆï¼Œä¸ç„¶ä¼šæŠ¥é”™</p>
</li>
<li><p>åŠ¨æ€å†…å­˜ä¸å†ä½¿ç”¨æ—¶ï¼Œå´æ²¡æœ‰é‡Šæ”¾ï¼Œä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚æœ‰äº›OSï¼Œæ‰€æœ‰çš„æ‰§è¡Œç¨‹åºå…±äº«ä¸€ä¸ªå†…å­˜æ± ï¼ŒæŒç»­çš„å†…å­˜æ³„æ¼ä¼šå¯¼è‡´å†…å­˜æ± è¢«æ¦¨å¹²ï¼Œå¯¼è‡´æ‰€æœ‰çš„ç¨‹åºç˜«ç—ªï¼Œè¿™æ—¶åªèƒ½é‡å¯OSï¼›å¯¹äºå…¶ä»–OSï¼Œå†…å­˜æ³„æ¼ä¹Ÿä¼šå¯¼è‡´è¯¥ç¨‹åºçš„å†…å­˜æ± è¢«æ¦¨å¹²ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒ</p>
</li>
</ol>
<h3 id="ä½¿ç”¨ç»“æ„å’ŒæŒ‡é’ˆ"><a href="#ä½¿ç”¨ç»“æ„å’ŒæŒ‡é’ˆ" class="headerlink" title="ä½¿ç”¨ç»“æ„å’ŒæŒ‡é’ˆ"></a>ä½¿ç”¨ç»“æ„å’ŒæŒ‡é’ˆ</h3><ol>
<li>é“¾è¡¨çš„å„ä¸ªèŠ‚ç‚¹ï¼Œåœ¨ç‰©ç†å†…å­˜ä¸Šå¹¶ä¸ç›¸é‚»</li>
<li>å…³äºå•é“¾è¡¨å’ŒåŒé“¾è¡¨çš„æ’å…¥æ“ä½œï¼Œæ²¡æœ‰ç»†çœ‹</li>
</ol>
<h3 id="é«˜çº§æŒ‡é’ˆè¯é¢˜"><a href="#é«˜çº§æŒ‡é’ˆè¯é¢˜" class="headerlink" title="é«˜çº§æŒ‡é’ˆè¯é¢˜"></a>é«˜çº§æŒ‡é’ˆè¯é¢˜</h3><ol>
<li><p>å‡½æ•°æŒ‡é’ˆï¼šæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œå†å–å€¼ä¹‹å‰ä¹Ÿè¦å…ˆåˆå§‹åŒ–</p>
<pre><code class="c">int f(int);
int (*pf)(int) = &amp;f; // åˆå§‹åŒ–å‡½æ•°æŒ‡é’ˆï¼Œæ³¨æ„è¿™é‡Œçš„ &amp; æ˜¯å¯é€‰çš„
</code></pre>
</li>
<li><p>å‡½æ•°æŒ‡é’ˆè¢«åˆå§‹åŒ–ä¹‹åï¼Œè°ƒç”¨å‡½æ•°æ–¹å¼æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p>
<pre><code class="c">int ans;
ans = f(25);
ans = (*pf)(25);
ans = pf(25);
</code></pre>
<ol>
<li>ç¬¬ä¸€ç§ï¼šç¼–è¯‘å™¨å…ˆå°†å‡½æ•°å <strong>éšå¼</strong> çš„è½¬åŒ–æˆå‡½æ•°æŒ‡é’ˆï¼Œç„¶åæ‰¾åˆ°å†…å­˜ä¸­å‡½æ•°çš„ä½ç½®ï¼Œå¼€å§‹æ‰§è¡Œ</li>
<li>ç¬¬äºŒç§ï¼šå…ˆå¯¹pfå‡½æ•°æŒ‡é’ˆå–åœ°å€ï¼Œè·å¾—å‡½æ•°å(f)ï¼›å†å°†å‡½æ•°åè½¬åŒ–æˆå‡½æ•°æŒ‡é’ˆã€‚ã€‚ã€‚å¤šæ­¤ä¸€ä¸¾ï¼›æœ€åæ‰¾åˆ°å†…å­˜ä¸­çš„ä½ç½®ï¼Œæ‰§è¡Œå‡½æ•°</li>
<li>ç¬¬ä¸‰ç§ï¼šè¿™å°±å¾ˆç›´æ¥äº†ï¼Œç›´æ¥åˆ°å¯¹åº”çš„åœ°å€æ‰§è¡Œå‡½æ•°</li>
</ol>
</li>
<li><p>å›è°ƒå‡½æ•°ï¼šå‡½æ•°æŒ‡é’ˆï¼›è½¬ç§»è¡¨ï¼šå‡½æ•°æŒ‡é’ˆæ•°ç»„</p>
</li>
<li><p>å‘½ä»¤è¡Œå‚æ•°ï¼š</p>
<pre><code class="c">int main(int argc, char **argv);
</code></pre>
<p>mainå‡½æ•°çš„2ä¸ªå‚æ•°ï¼Œargcè¡¨ç¤ºå‘½ä»¤è¡Œå‚æ•°çš„æ•°ç›®ï¼ŒargvæŒ‡å‘ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„çš„é¦–åœ°å€ã€‚è¿™ä¸ªargvå¯ä»¥è®¤ä¸ºæ˜¯æŒ‡å‘çš„ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„çš„ç¬¬ä¸€ä¸ªã€‚è¿™ä¸ªå­—ç¬¦ä¸²æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ç¨‹åºçš„åç§°</p>
<p><img src="/lionheart/1609/argv.png" alt="argv.png"></p>
</li>
<li><p>å­—ç¬¦ä¸²å¸¸é‡å‡ºç°åœ¨è¡¨è¾¾å¼ä¸­çš„æ—¶å€™ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆå¸¸é‡</p>
<pre><code class="c">&quot;xyz&quot; + 1; // å¯¹æŒ‡å‘xçš„æŒ‡é’ˆå¸¸é‡åŠ ä¸€ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªè¡¨è¾¾å¼çš„å€¼æ˜¯æŒ‡å‘yçš„æŒ‡é’ˆï¼Œå› ä¸º &quot;xyz&quot; è¡¨ç¤ºä¸€ä¸ªæŒ‡å‘charçš„æŒ‡é’ˆ
</code></pre>
</li>
</ol>
<h3 id="é¢„å¤„ç†å™¨"><a href="#é¢„å¤„ç†å™¨" class="headerlink" title="é¢„å¤„ç†å™¨"></a>é¢„å¤„ç†å™¨</h3><ol>
<li><p>ç¼–è¯‘Cç¨‹åºçš„ç¬¬ä¸€æ­¥ç§°ä¸º <strong>é¢„å¤„ç†é˜¶æ®µ</strong> ï¼Œä¸»è¦ä»»åŠ¡å°±æ˜¯ï¼šåˆ é™¤æ³¨é‡Šã€æ’å…¥è¢«#includeæŒ‡ä»¤åŒ…å«çš„æ–‡ä»¶çš„å†…å®¹ã€å®šä¹‰å’Œæ›¿æ¢#defineæŒ‡ä»¤å®šä¹‰çš„ç¬¦å·ä»¥åŠç¡®å®šä»£ç çš„éƒ¨åˆ†å†…å®¹æ˜¯å¦åº”è¯¥æ ¹æ®ä¸€äº›æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤è¿›è¡Œç¼–è¯‘</p>
</li>
<li><p><code>#define name stuff</code> æ¯å½“æœ‰ç¬¦å·nameå‡ºç°ï¼Œé¢„å¤„ç†å™¨å°±ç”¨stuffå°†å…¶æ›¿æ¢ã€‚æ¥å‡ ä¸ªä¾‹å­ï¼š</p>
<pre><code class="c">#define reg    register
#define do_forever for(;;)
#define CASE break;case
// ä¸€è¡Œå®šä¹‰ä¸å®Œï¼Œå°±åŠ åæ–œæ 
#define DEBUG_PRINT printf(&quot;File %s line %d:&quot; \
                    &quot; x=%d, y=%d, z=%d&quot;, \
                    __FILE__, __LINE__, \
                    x, y, z)  // æ³¨æ„è¿™é‡Œä½¿ç”¨äº† &quot;ç›¸é‚»çš„ä¸¤ä¸ªå­—ç¬¦ä¸²è‡ªåŠ¨ç»“åˆæˆä¸€ä¸ªå­—ç¬¦ä¸²çš„ç‰¹æ€§&quot;
</code></pre>
</li>
<li><p><code>#define name(paraneter_list) stuff</code>ï¼Œæˆ–ç§°ä¹‹ä¸ºå®ï¼Œæœ¬è´¨å°±æ˜¯æ–‡æœ¬çš„æ›¿æ¢</p>
<pre><code class="c">#define SQUARE(x) x * x
</code></pre>
<p>ä¹‹åä½¿ç”¨ <code>SQUARE(5)</code> å°±ç­‰åŒäº <code>5 * 5</code> ï¼›æ–‡æœ¬æ›¿æ¢</p>
</li>
<li><p>å®ç›¸æ¯”ä¸å‡½æ•°ï¼Œä¸å­˜åœ¨å‡½æ•°è°ƒç”¨/è¿”å›çš„é¢å¤–å¼€é”€ï¼Œæ‰€ä»¥æ›´å¿«</p>
</li>
<li><p>ä½¿ç”¨ <code>#undef</code> æ¥ç§»é™¤ä¸€ä¸ªå®å®šä¹‰</p>
</li>
<li><p>æ¡ä»¶ç¼–è¯‘ï¼šå¯ä»¥é€‰æ‹©ä»£ç çš„ä¸€éƒ¨åˆ†æ˜¯è¢«æ­£å¸¸ç¼–è¯‘è¿˜æ˜¯è¢«å®Œå…¨å¿½ç•¥ã€‚ç”¨äºæ”¯æŒæ¡ä»¶ç¼–è¯‘çš„åŸºæœ¬ç»“æ„æ˜¯ <code>#if</code> å’Œ <code>#endif</code> æŒ‡ä»¤</p>
<pre><code class="c">#if constant-expression
    statements
#endif
</code></pre>
<p>å…¶ä¸­çš„ constant-expression æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œç”±é¢„å¤„ç†å™¨è¿›è¡Œæ±‚å€¼ï¼Œå¦‚æœä¸ºçœŸï¼Œå°±ç¼–è¯‘statementsï¼Œå¦åˆ™å°±ä¸å¤„ç†ä»–ä»¬ã€‚çœ‹ä¸ªä¾‹å­ï¼š</p>
<pre><code class="c">#define DEBUG 1
#if DEBUG
    printf(&quot;x=%d, y=%d&quot;, x, y);
#endif
</code></pre>
</li>
<li><p>æ¡ä»¶ç¼–è¯‘è¿˜æœ‰ <code>#elif</code> <code>#else</code> è¿™ä¸¤æ¡æŒ‡ä»¤</p>
</li>
<li><p>æ¡ä»¶ç¼–è¯‘å¯ä»¥æµ‹è¯•ç¬¦å·æ˜¯å¦è¢«å®šä¹‰</p>
<pre><code class="c">// ä¸‹é¢ä¸¤å¥ç­‰ä»· ç”¨äºåˆ¤æ–­ä¸€ä¸ªå®æ˜¯å¦è¢«å®šä¹‰
#if defined(OS_UNIX)
#ifdef OS_UNIX

// ä¸‹é¢ä¸¤å¥ç­‰ä»· ç”¨äºåˆ¤æ–­ä¸€ä¸ªå®æ˜¯å¦æ²¡è¢«å®šä¹‰
#if !defined(OS_UNIX)
#ifndef OS_UNIX
</code></pre>
</li>
<li><p><code>#include</code> æŒ‡ä»¤æ›¿æ¢æ–‡ä»¶çš„å†…å®¹åˆ°è¿™æ¡æŒ‡ä»¤çš„ä½ç½®ï¼Œè¿™æ ·ä¸€ä¸ªå¤´æ–‡ä»¶è¢«åŒ…å«åˆ°10ä¸ªæºæ–‡ä»¶ä¸­ï¼Œä»–å°±è¢«ç¼–è¯‘10æ¬¡ï¼›è¿™ä¼šæ¶‰åŠä¸€äº›å¼€é”€ï¼Œä¸è¿‡æˆ‘ä»¬ä¸ç”¨åœ¨æ„</p>
</li>
<li><p><code>#include &lt;filename&gt;</code> åº“æ–‡ä»¶ã€‚ç¼–è¯‘å™¨ä¼šå®šä¹‰ä¸€ç³»åˆ—çš„æ ‡å‡†ä½ç½®ï¼Œè¿™æ¡æ–‡ä»¶åŒ…å«æŒ‡ä»¤ä¼šåœ¨è¿™äº›æ ‡å‡†ä½ç½®é‡Œå¯»æ‰¾åº“æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼ŒUNIX OSé‡Œï¼Œç¼–è¯‘å™¨ä¼šåœ¨ /usr/include ç›®å½•é‡Œé¢æŸ¥æ‰¾åº“æ–‡ä»¶ã€‚ç¼–è¯‘å™¨æœ‰ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå¯ä»¥è®©ä½ æ·»åŠ ç›®å½•ï¼Œé‚£ä¹ˆè¿™ä¸ªç›®å½•ä¹Ÿä¼šæ˜¯æœç´¢çš„ä¸€ä¸ªtarget</p>
</li>
<li><p><code>#include &quot;filename&quot;</code> ç°åœ¨æºæ–‡ä»¶çš„å½“å‰ç›®å½•ä¸‹é¢å¯»æ‰¾ï¼Œæ²¡æœ‰çš„è¯å†åˆ°åº“æ–‡ä»¶é‡Œé¢å¯»æ‰¾</p>
</li>
<li><p>ä¸€ä¸ªå¤´æ–‡ä»¶å¯èƒ½è¢«ä¸€ä¸ªæºæ–‡ä»¶åŒ…å«å‡ æ¬¡ï¼Œä¹Ÿå°±æ˜¯å¤šé‡åŒ…å«ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯åœ¨ç¼–å†™å¤´æ–‡ä»¶æ—¶ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</p>
</li>
</ol>
<pre><code class="c">   #ifndef _HEADERNAME_H
   #define _HEADERNAME_H 1
   /*
   ** all the statements
   */
   #endif
</code></pre>
<p>   è¿™æ ·ï¼Œå½“ç¬¬ä¸€æ¬¡åŒ…å«æ—¶ï¼Œæ­£å¸¸ç¼–è¯‘ï¼›ç¬¬äºŒæ¬¡åŒ…å«æ—¶ï¼Œç”±äºå·²ç»å®šä¹‰äº† _HEADERNAME_H å°±ä¸å†ç¼–è¯‘äº†</p>
<h3 id="è¾“å…¥-è¾“å‡ºå‡½æ•°"><a href="#è¾“å…¥-è¾“å‡ºå‡½æ•°" class="headerlink" title="è¾“å…¥/è¾“å‡ºå‡½æ•°"></a>è¾“å…¥/è¾“å‡ºå‡½æ•°</h3><ol>
<li><p>å¯¹Cç¨‹åºè€Œè¨€ï¼Œæ‰€æœ‰çš„I/Oæ“ä½œåªæ˜¯ç®€å•çš„ä»ç¨‹åº <strong>ç§»è¿›æˆ–ç§»å‡ºå­—èŠ‚çš„äº‹æƒ…</strong> ã€‚æ‰€æœ‰è¿™ç§å­—èŠ‚æµè¢«ç§°ä¸º <strong>æµ</strong> ã€‚ç¨‹åºåªéœ€å…³å¿ƒ <strong>åˆ›å»ºæ­£ç¡®çš„è¾“å‡ºå­—èŠ‚æ•°æ®å’Œæ­£ç¡®çš„è§£é‡Šä»è¾“å…¥è¯»å–çš„å­—èŠ‚æ•°æ®</strong> ã€‚ä¸éœ€è¦å…³å¿ƒç‰¹å®šçš„I/Oè®¾å¤‡</p>
</li>
<li><p>æœ‰2ç§ç¼“å†²åŒº(buffer)ï¼Œè¾“å…¥ç¼“å†²åŒºå’Œè¾“å‡ºç¼“å†²åŒºã€‚è¿™äº›ç¼“å†²åŒºéƒ½æ˜¯ä¸€å—å†…å­˜åŒºåŸŸã€‚ç¨‹åºè¾“å‡ºæ•°æ®ä¼šå…ˆå†™å…¥è¾“å‡ºç¼“å†²åŒºï¼Œç„¶åå†å†™å…¥æ–‡ä»¶æˆ–è¾“å‡ºç»™è®¾å¤‡ï¼›è¾“å…¥æ•°æ®ï¼ˆæ–‡ä»¶è¯»å–æ•°æ®ï¼Œé”®ç›˜è¾“å…¥æ•°æ®ï¼‰ä¹Ÿä¼šå…ˆå†™å…¥è¾“å…¥ç¼“å†²åŒºï¼Œç„¶åå†äº¤ç»™ç¨‹åºã€‚</p>
</li>
<li><p>ä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº›ç¼“å†²åŒºéƒ½æ˜¯è¦å…ˆå¡«æ»¡ï¼Œå†ç»™åˆ°è®¾å¤‡æˆ–æ˜¯ç¨‹åºçš„ã€‚æ‰€ä»¥ä½¿ç”¨printfæ—¶ï¼Œå…ˆå°†è¦printçš„æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œä¸ä¼šç«‹å³æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œå¦‚æœè¿™æ—¶å€™ç¨‹åºå´©æºƒäº†ï¼Œä»–å¯èƒ½å°±æ°¸è¿œæ— æ³•æ˜¾ç¤ºå‡ºæ¥äº†</p>
</li>
<li><p>æµåˆ†ä¸º <strong>æ–‡æœ¬æµ</strong> å’Œ <strong>äºŒè¿›åˆ¶æµ</strong> </p>
</li>
<li><p>æ–‡æœ¬æµåœ¨ä¸åŒOSä¸­æŸäº›ç‰¹æ€§ä¼šä¸åŒï¼šä¸€ç§æ˜¯æ–‡æœ¬è¡Œçš„æœ€å¤§é•¿åº¦ï¼›å¦ä¸€ç§æ˜¯æ–‡æœ¬è¡Œçš„ç»“æŸæ–¹å¼ï¼Œåœ¨MS-DOSç³»ç»Ÿä¸­ä½¿ç”¨å›è½¦ç¬¦å’Œæ¢è¡Œç¬¦è¡¨ç¤ºä¸€è¡Œç»“æŸï¼Œåœ¨UNIXä¸­ä½¿ç”¨æ¢è¡Œç¬¦è¡¨ç¤ºä¸€è¡Œç»“æŸã€‚</p>
</li>
<li><p>ä½†æ˜¯åœ¨ä»£ç ä¸­ä¸å¿…æ“å¿ƒï¼Œåº“å‡½æ•°ä¼šå¸®ä½ å¤„ç†è¿™äº›å·®å¼‚ã€‚æ¯”å¦‚åœ¨MS-DOSä¸Šæ‰§è¡Œcç¨‹åºï¼Œè¾“å‡ºæ—¶ä¼šå°†æ–‡æœ¬ä¸­çš„æ¢è¡Œç¬¦è½¬åŒ–æˆå›è½¦ç¬¦/æ¢è¡Œç¬¦çš„å½¢å¼å†™å…¥æ–‡ä»¶ï¼›è¾“å…¥æ—¶ï¼Œä»æ–‡æœ¬è¯»å–çš„å›è½¦ç¬¦/æ¢è¡Œç¬¦ä¹Ÿä¼šè½¬åŒ–æˆæ¢è¡Œç¬¦äº¤ç»™ç¨‹åº</p>
</li>
<li><p>ç³»ç»Ÿè¿è¡Œæ—¶è‡³å°‘æä¾›3ä¸ªæµï¼šæ ‡å‡†è¾“å…¥(stdin)ï¼Œæ ‡å‡†è¾“å‡º(stdout)å’Œæ ‡å‡†é”™è¯¯(stderr)ï¼›è¿™äº›æµçš„åå­—åˆ†åˆ«æ˜¯ <code>stdin</code> <code>stdout</code> <code>stderr</code>ï¼›ä»–ä»¬éƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘FILEç»“æ„ä½“çš„æŒ‡é’ˆã€‚FILEç»“æ„ä½“åœ¨stdio.hä¸­å®šä¹‰ï¼Œä¸ç‰©ç†ç£ç›˜ä¸Šé¢çš„æ–‡ä»¶æ²¡æœ‰å…³ç³»ã€‚</p>
</li>
<li><p>æ ‡å‡†è¾“å…¥é»˜è®¤æ˜¯é”®ç›˜ï¼Œæ ‡å‡†è¾“å‡ºé»˜è®¤æ˜¯å±å¹•ã€‚å¯ä»¥ä¿®æ”¹é»˜è®¤çš„è¾“å…¥å’Œè¾“å‡ºè®¾å¤‡ï¼Œä¹Ÿå°±æ˜¯é‡å®šå‘ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="shell">$ ./program &lt; data &gt; answer
</code></pre>
<p>ä¸Šé¢çš„å‘½ä»¤å°†ä»æ–‡ä»¶dataè¯»å–æ•°æ®ï¼Œå°†æ•°æ®è¾“å‡ºåˆ°answeræ–‡ä»¶</p>
</li>
<li><p>å…³äºæµçš„å¤„ç†æµç¨‹</p>
<ol>
<li>ä½¿ç”¨ <code>fopen</code> å‡½æ•°æ‰“å¼€ä¸€ä¸ªæµï¼Œè¿™é‡Œä½ å¿…é¡»æŒ‡å®šéœ€è¦è®¿é—®çš„æ–‡ä»¶æˆ–æ˜¯è®¾å¤‡ï¼Œä»¥åŠè®¿é—®æ–¹å¼ï¼šè¯»ã€å†™ã€è¯»å†™ï¼›è¯¥å‡½æ•°éªŒè¯æ–‡ä»¶æˆ–è®¾å¤‡çš„å­˜åœ¨æ€§ï¼Œå¹¶åˆå§‹åŒ–ä¸è¿™ä¸ªæµå¯¹åº”çš„FILEç»“æ„ä½“ã€‚ä¸€ä¸ªæµå¯¹åº”ä¸€ä¸ªFILEç»“æ„</li>
<li>æ ¹æ®éœ€è¦å¯¹è¯¥æ–‡ä»¶æˆ–è®¾å¤‡è¿›è¡Œè¯»å†™</li>
<li>æœ€åä½¿ç”¨ <code>fclose</code> å‡½æ•°å…³é—­æµï¼Œä¸å†å¯¹æ–‡ä»¶å’Œè®¾å¤‡è¿›è¡Œæ“ä½œ</li>
<li>æ³¨æ„ï¼šæ ‡å‡†æµçš„I/Oæ›´åŠ çš„ç®€å•ï¼Œå› ä¸ºä»–ä»¬ä¸éœ€è¦æ‰“å¼€å’Œå…³é—­ã€‚æ ‡å‡†æµå°±æ˜¯ stdin, stdout, stderr</li>
</ol>
</li>
<li><p><code>FILE *fopen(char const *name, char const *mode);</code> å‡½æ•°æ‰“å¼€æµï¼Œnameæ˜¯æ–‡ä»¶æˆ–è®¾å¤‡çš„åç§°ï¼Œmodeæ˜¯è¯»å†™æ¨¡å¼ã€‚æˆåŠŸè¿”å›ä¸€ä¸ªFILEç»“æ„æŒ‡é’ˆï¼Œè¿™ä¸ªç»“æ„ä½“ä»£è¡¨ä¸€ä¸ªæ–°å»ºçš„æµï¼›å¤±è´¥è¿”å›NULLæŒ‡é’ˆï¼Œerrnoä¼šæç¤ºé—®é¢˜çš„æ€§è´¨</p>
</li>
</ol>
<pre><code class="c">   FILE *input;
   input = fopen(&quot;data&quot;, &quot;r&quot;); // ä»¥åªè¯»æ‰“å¼€æ–‡ä»¶data
   if (input == NULL) { // æ‰“å¼€å¤±è´¥
         perror(&quot;data&quot;);
         exit(EXIT_FAILURE);
   }
</code></pre>
<p>   æ‰“å¼€å¤±è´¥çš„ç±»ä¼¼è¾“å‡ºï¼š <code>data : No such file or directory</code></p>
<ol>
<li><p><code>int fclose(FILE *f);</code> å‡½æ•°å…³é—­æµã€‚å¯¹äºè¾“å‡ºæµï¼Œåœ¨å…³é—­ä¹‹å‰ï¼Œå…ˆåˆ·æ–°ç¼“å†²åŒºã€‚æ‰§è¡ŒæˆåŠŸï¼Œè¿”å›0ï¼›æ‰§è¡Œå¤±è´¥ï¼Œè¿”å›EOF</p>
</li>
<li><p>å½“ä¸€ä¸ªæµè¢«æ‰“å¼€ä¹‹åå¯ä»¥ç”¨äºè¾“å…¥å’Œè¾“å‡ºï¼ŒåŒ…æ‹¬å­—ç¬¦ï¼Œæ–‡æœ¬è¡Œå’ŒäºŒè¿›åˆ¶çš„è¾“å…¥å’Œè¾“å‡º3ç§ç±»å‹</p>
</li>
<li><p>å­—ç¬¦I/O</p>
</li>
<li><p>ä»æµä¸­è¯»å–å­—ç¬¦</p>
<pre><code class="c">      int fgetc(FILE *stream);
      int getc(FILE *stream);
      int getchar(void);
</code></pre>
<pre><code>  getcharä»æ ‡å‡†è¾“å…¥æµä¸­è¯»å–ï¼Œæ‰€ä»¥ä¸éœ€è¦æŒ‡å®šæµã€‚æ³¨æ„ï¼šè¯»å–å­—ç¬¦ï¼Œä½†æ˜¯è¿”å›çš„è¿˜æ˜¯intå‹ï¼›æ²¡æœ‰æ›´å¤šå­—ç¬¦çš„è¯è¿”å›EOF
</code></pre><ol>
<li><p>å‘æµä¸­å†™å…¥å­—ç¬¦</p>
<pre><code class="c">int fputc(int character, FILE *stream);
int putc(int character, FILE *stream);
int putchar(int character);
</code></pre>
<p>å¤±è´¥è¿”å›EOF</p>
</li>
</ol>
</li>
<li><p>æœªæ ¼å¼åŒ–çš„è¡ŒI/Oï¼šç®€å•è¯»å–æˆ–å†™å…¥å­—ç¬¦ä¸²</p>
</li>
<li><p>ä»æµä¸­è¯»å–è¡Œ</p>
<pre><code class="c">      char *fgets(char *buffer, int buffer_size, FILE *stream);
      char *gets(char *buffer);
</code></pre>
<pre><code>  æœ€å¥½ä¸é€‚ç”¨getsã€‚ **è¿™é‡Œçš„bufferå°±æ˜¯ä¹‹å‰æ‰€è¯´çš„ç¼“å†²åŒºï¼ŒåŸæ¥è¿™ä¸ªç¼“å†²åŒºä½¿æˆ‘ä»¬è‡ªå·±å»ºçš„ï¼Œè¿˜æŒ‡æ˜äº†å¤§å°** ã€‚fgetså¯ä»¥è¿™æ ·ç†è§£ï¼šä»æµä¸­è¯»å–æœ€å¤š buffer_size - 1 ä¸ªå­—ç¬¦åˆ°å­˜å‚¨åˆ°ç¼“å†²åŒºï¼Œè‹¥åˆ°äº†è¡Œå°¾å°±ä¸è¯»äº†ï¼Œè¿”å›çš„æ˜¯æŒ‡å‘ç¼“å†²åŒºé¦–åœ°å€çš„æŒ‡é’ˆã€‚è¿™é‡Œçš„ **ä»æµä¸­è¯»å–** å¯ä»¥ç†è§£æˆ **ä»æ–‡ä»¶ä¸­è¯»å–** ï¼›è¯»å–å®Œæˆåï¼Œ**å­˜æ”¾åˆ°ç¨‹åºè‡ªå·±åˆ¶å®šçš„bufferç¼“å†²åŒºä¸­** 
</code></pre><ol>
<li><p>å‘æµä¸­å†™å…¥è¡Œ</p>
<pre><code class="c">int fputs(char const *buffer, FILE *stream);
int puts(char const *buffer);
</code></pre>
<p>æ³¨æ„ï¼šå¯ä»¥å†™å…¥å¤šè¡Œï¼Œå°±æ˜¯bufferé‡Œé¢æœ‰å¤šå°‘å†™å¤šå°‘ </p>
</li>
</ol>
</li>
<li><p>æ ¼å¼åŒ–çš„è¡ŒI/Oï¼šä¹Ÿå°±æ˜¯ <code>scanf</code> <code>printf</code> å®¶æ—å‡½æ•°</p>
</li>
<li><p>äºŒè¿›åˆ¶I/Oï¼šæ•ˆç‡æœ€é«˜ï¼Œä½¿ç”¨ <code>fread</code> <code>fwrite</code>å‡½æ•°</p>
</li>
</ol>
<pre><code class="c">   size_t fread(void *buffer, size_t size, size_t count, FILE *stream);
   size_t fwrite(void *buffer, size_t size, size_t count, FILE *stream);
</code></pre>
<p>   bufferè§£é‡Šä¸ºä¸€ä¸ªæˆ–å¤šä¸ªå€¼çš„æ•°ç»„ï¼›countè¡¨ç¤ºæ•°ç»„ä¸­æœ‰å¤šå°‘ä¸ªå€¼ï¼Œä¹Ÿå°±æ˜¯è¦è¯»å–æˆ–å†™å…¥çš„å…ƒç´ ä¸ªæ•°ï¼›sizeæ˜¯ç¼“å†²åŒºä¸­æ¯ä¸ªå…ƒç´ çš„å­—èŠ‚æ•°ï¼›è¿”å›çš„æ˜¯å®é™…è¯»å–æˆ–å†™å…¥çš„å…ƒç´ ä¸ªæ•°ï¼Œä¸ä¸€å®šå’Œcountç›¸ç­‰</p>
<pre><code class="c">   struct VALUE {
         long a;
         float b;
         char c[SIZE];
   } values[ARRAY_SIZE];
   n_values = fread(values, sizeof(struct VALUE), ARRAY_SIZE, input_stream);

   fwrite(values, sizeof(struct VALUE), ARRAY_SIZE, output_stream);
</code></pre>
<ol>
<li><p><code>int fflush(FILE *stream);</code> å‡½æ•°è¿«ä½¿è¾“å‡ºæµç¼“å†²åŒºå†…çš„æ•°æ®è¿›è¡Œç‰©ç†å†™å…¥ã€‚å¯ä»¥è¿™æ ·ç†è§£ï¼Œä¸Šé¢å‡ æ®µä»£ç ä¸­çš„bufferæ˜¯ä¸€ç§ç¼“å†²åŒºï¼Œå¯¹äºå†™å…¥æ“ä½œè€Œè¨€ï¼Œbufferç¼“å†²åŒºä¸­çš„å€¼å†™å…¥æµï¼›æµå†™å…¥ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„çœŸæ­£çš„ç¼“å†²åŒºï¼Œè¿™ä¸ªç¼“å†²åŒºå°±æ˜¯ç¬¬äºŒç‚¹é‡Œè¯´é“çš„ç¼“å†²åŒºï¼Œå½“è¯¥ç¼“å†²åŒºæ»¡æ—¶ï¼Œå°†ä»–å†™å…¥æ–‡ä»¶ã€‚</p>
</li>
<li><p><code>long ftell(FILE *stream);</code> è¿”å›æµå½“å‰çš„ä½ç½®ï¼Œä»–çš„è¿”å›å€¼è¡¨ç¤ºè·ç¦»æ–‡ä»¶èµ·å§‹çš„åç§»é‡ã€‚åœ¨äºŒè¿›åˆ¶ä¸­ï¼Œè¿™ä¸ªå€¼å°±æ˜¯è·ç¦»æ–‡ä»¶èµ·å§‹çš„å­—èŠ‚æ•°</p>
</li>
<li><p><code>int fseek(FILE *stream, long offset, int from);</code> å°†æµä¸­çš„å½“å‰çš„â€˜æŒ‡é’ˆâ€™ï¼Œä»fromåç§»offsetä¸ªä½ç½®ï¼Œä¹Ÿå°±æ˜¯æ”¹å˜ä¸‹ä¸€æ¬¡è¯»å†™çš„ä½ç½®ã€‚fromå‚æ•°å¯ä»¥æ˜¯ <code>SEEK_SET(èµ·å§‹ä½ç½®)</code> <code>SEEK_CUR(å½“å‰ä½ç½®)</code> <code>SEEK_END(ç»“å°¾ä½ç½®)</code></p>
<h3 id="æ ‡å‡†å‡½æ•°åº“"><a href="#æ ‡å‡†å‡½æ•°åº“" class="headerlink" title="æ ‡å‡†å‡½æ•°åº“"></a>æ ‡å‡†å‡½æ•°åº“</h3></li>
<li><p><code>int rand(void);</code> å‡½æ•°è¿”å›ä¸€ä¸ª0-RAND_MAX(è‡³å°‘æ˜¯32767)çš„æ•´å½¢ã€‚ä¸ºäº†é¿å…æ¯æ¬¡è¿è¡Œç¨‹åºæ—¶å¾—åˆ°ç›¸åŒçš„ç»“æœï¼Œå¯ä»¥ä½¿ç”¨ <code>void srand(unsigned int seed);</code>è®¾ç½®ä¸åŒçš„ç§å­ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="c">srand((unsigned int) time(0)); // ä½¿ç”¨ç°åœ¨çš„æ—¶é—´
</code></pre>
</li>
</ol>
<h3 id="ç»å…¸æŠ½è±¡æ•°æ®ç±»å‹"><a href="#ç»å…¸æŠ½è±¡æ•°æ®ç±»å‹" class="headerlink" title="ç»å…¸æŠ½è±¡æ•°æ®ç±»å‹"></a>ç»å…¸æŠ½è±¡æ•°æ®ç±»å‹</h3><ol>
<li>Cè¯­è¨€ä¸­åˆ›å»ºå †æ ˆ(stack)çš„æ–¹å¼æœ‰3ç§ï¼šé™æ€æ•°ç»„ï¼ŒåŠ¨æ€åˆ†é…å†…å­˜æ•°ç»„ï¼Œé“¾å¼å †æ ˆ</li>
<li>æ ‘çš„4ä¸­å¸¸è§éå†æ–¹å¼ï¼š<ol>
<li>å‰åºéå†ï¼šå…ˆæ£€æŸ¥å½“å‰èŠ‚ç‚¹ï¼Œåœ¨é€’å½’éå†å·¦å­æ ‘å’Œå³å­æ ‘</li>
<li>ä¸­åºéå†ï¼šå…ˆéå†å·¦å­æ ‘ï¼Œå†æ£€æŸ¥å½“å‰èŠ‚ç‚¹ï¼Œå†éå†å³å­æ ‘</li>
<li>ååºéå†ï¼šå…ˆéå†å³å­æ ‘ï¼Œå†æ£€æŸ¥å½“å‰èŠ‚ç‚¹ï¼Œå†éå†å·¦å­æ ‘</li>
<li>å±‚æ¬¡éå†ï¼šé€å±‚æ£€æŸ¥ï¼Œå…ˆæ ¹èŠ‚ç‚¹ï¼Œå†å®ƒçš„å­©å­ï¼Œå†å®ƒçš„å­™å­â€¦</li>
</ol>
</li>
</ol>
<h3 id="è¿è¡Œæ—¶ç¯å¢ƒ"><a href="#è¿è¡Œæ—¶ç¯å¢ƒ" class="headerlink" title="è¿è¡Œæ—¶ç¯å¢ƒ"></a>è¿è¡Œæ—¶ç¯å¢ƒ</h3><ol>
<li>ç¨‹åºåŒ…æ‹¬å‡ ä¸ªåŒºæ®µï¼šæ•°æ®åŒº(data)ã€ä»£ç æ®µ(text)</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://blog.csdn.net/b_h_l/article/details/7738217" target="_blank" rel="external">Cç»“æ„ä½“è¾¹ç•Œå¯¹é½</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> è¯»ä¹¦ç¬”è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[çœ‹YYKitçš„æºç ]]></title>
      <url>/2016/08/15/YYKit-source-code-analysis/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><strong>YYKit</strong> æºç åˆ†æ ä¹‹ <strong>YYCache</strong></p>
<a id="more"></a>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p><strong>YYCache</strong> æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ <strong>key-value</strong> çš„ç¼“å­˜æ¡†æ¶ã€‚ä½¿ç”¨ <strong>YYMemoryCache</strong> æ¥å°†å¯¹è±¡å­˜æ”¾åœ¨å°ä¸”å¿«çš„å†…å­˜ä¸­ï¼›ä½¿ç”¨ <strong>YYDiskCache</strong> æ¥å°†å¯¹è±¡å­˜æ”¾åœ¨è¾ƒæ…¢çš„ç£ç›˜ä¸Šã€‚</p>
<h2 id="YYCache"><a href="#YYCache" class="headerlink" title="YYCache"></a>YYCache</h2><p>å…ˆæ¥çœ‹çœ‹ <strong>YYCache</strong> çš„å·¥ä½œæµç¨‹ã€‚</p>
<h3 id="åˆ›å»ºCache-init"><a href="#åˆ›å»ºCache-init" class="headerlink" title="åˆ›å»ºCache(init)"></a>åˆ›å»ºCache(init)</h3><p>ä½¿ç”¨ä¸‹é¢ä»£ç å¯ä»¥åˆ›å»ºä¸€ä¸ªå«åšvanneyçš„æ–°çš„cacheã€‚</p>
<pre><code class="objective-c">YYCache *newCache = [YYCache alloc] initWithName:@&quot;vanney&quot;];
</code></pre>
<p>è¿™å¥è¯­å¥æ‰€åšçš„äº‹æƒ…å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç‰©ç†å±‚é¢<ol>
<li>åœ¨APPçš„ <strong>Caches</strong> ç›®å½•ä¸‹é¢æ–°å»ºä¸€ä¸ª <strong>vanney</strong> çš„å­ç›®å½•ï¼Œè¿™ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾æ‰€æœ‰å±äºvanneyçš„cache</li>
<li>åœ¨vanneyç›®å½•ä¸‹é¢æ–°å»ºä¸€ä¸ª <strong>manifest</strong> çš„sqliteæ•°æ®åº“ï¼Œè¿™ä¸ªæ•°æ®åº“ç”¨æ¥è®°å½•å±äºvanneyçš„æ‰€æœ‰cacheçš„ä¿¡æ¯ï¼Œæ•°æ®åº“çš„æ¯ä¸€è¡Œè®°å½•è¡¨ç¤ºä¸€ä¸ªcacheã€‚æ¯ä¸€è¡Œçš„ä¿¡æ¯åŒ…æ‹¬ï¼š<ol>
<li><strong>key</strong> : cacheçš„å”¯ä¸€æ ‡è¯†ã€‚manifesçš„ä¸»é”®</li>
<li><strong>filename</strong> : å¦‚æœcacheçš„æ•°æ®å¤§äºè®¾ç½®çš„å€¼çš„è¯ï¼ˆé»˜è®¤æ˜¯20KBï¼‰ï¼Œä¼šå°†cacheçš„äºŒè¿›åˆ¶æ•°æ®å­˜æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªfilenameå°±æ˜¯è¯¥cacheå¯¹åº”çš„æ–‡ä»¶å</li>
<li><strong>size</strong> : cacheçš„å¤§å°ï¼Œå•ä½æ˜¯byte</li>
<li><strong>inline_data</strong> : cacheçš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚æœcacheä»¥æ–‡ä»¶å½¢å¼å­˜æ”¾çš„è¯ï¼Œè¿™é‡Œå°±ä¸ºç©º</li>
<li><strong>modification_time</strong> : ä¸Šä¸€æ¬¡å¯¹è¯¥cacheçš„ä¿®æ”¹æ—¶é—´</li>
<li><strong>last_access_time</strong> : ä¸Šä¸€æ¬¡ä½¿ç”¨è¯¥cacheçš„æ—¶é—´</li>
<li><strong>extended_data</strong> : ä¸€äº›é¢å¤–çš„æ•°æ®</li>
</ol>
</li>
<li>åœ¨vanneyçš„ç›®å½•ä¸‹åˆ›å»º <strong>data</strong> çš„æ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾ä»¥æ–‡ä»¶å½¢å¼å­˜åœ¨çš„cache</li>
<li>åœ¨vanneyçš„ç›®å½•ä¸‹åˆ›å»º <strong>trash</strong> çš„æ–‡ä»¶å¤¹ï¼Œåˆ é™¤cacheæ—¶ä¼šå°†dataä¸­çš„æ–‡ä»¶å…ˆç§»åˆ°trashä¸­ï¼Œç„¶åå†å¼‚æ­¥çš„åˆ é™¤è¯¥æ–‡ä»¶å¤¹é‡Œé¢çš„æ–‡ä»¶</li>
</ol>
</li>
<li>ç¨‹åºå±‚é¢<ol>
<li>åˆ›å»ºäº†ä¸€ä¸ª <strong>YYDiskCache</strong> ã€‚åé¢ä¼šç»†è¯´</li>
<li>åˆ›å»ºäº†ä¸€ä¸ª <strong>YYMemoryCache</strong> ã€‚åé¢ä¼šç»†è¯´</li>
</ol>
</li>
</ol>
<h3 id="å¾€Cacheé‡Œé¢æ–°å¢è®°å½•-set"><a href="#å¾€Cacheé‡Œé¢æ–°å¢è®°å½•-set" class="headerlink" title="å¾€Cacheé‡Œé¢æ–°å¢è®°å½•(set)"></a>å¾€Cacheé‡Œé¢æ–°å¢è®°å½•(set)</h3><p>ä¹Ÿå°±æ˜¯æ‰€è°“çš„ <strong>set</strong> æ–¹æ³•ã€‚ä½¿ç”¨ä¸‹é¢ä»£ç å¯ä»¥æ–°å¢ä¸€æ¡cacheè®°å½•</p>
<pre><code class="objective-c">[newCache setObject:@&quot;New Record&quot; forKey:@&quot;New Key&quot;];
</code></pre>
<p>è¿™é‡ŒnewCacheåšäº†ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>å¾€YYMemoryCacheé‡Œé¢å†™å…¥è¿™æ¡æ•°æ®</li>
<li>å¾€YYDiskCacheé‡Œé¢å†™å…¥è¿™æ¡æ•°æ®</li>
</ol>
<h3 id="å‘Cacheä¸­è¯»å–ç¼“å­˜è®°å½•-get"><a href="#å‘Cacheä¸­è¯»å–ç¼“å­˜è®°å½•-get" class="headerlink" title="å‘Cacheä¸­è¯»å–ç¼“å­˜è®°å½•(get)"></a>å‘Cacheä¸­è¯»å–ç¼“å­˜è®°å½•(get)</h3><p>ä¹Ÿå°±æ˜¯æ‰€è°“çš„ <strong>get</strong>  æ–¹æ³•ã€‚ä½¿ç”¨ä¸‹é¢ä»£ç å¯ä»¥è¯»å–ä¸€æ¡cacheè®°å½•</p>
<pre><code class="objective-c">NSString *cacheValue = [newCache objectForKey:@&quot;New Key&quot;];
</code></pre>
<ol>
<li>ç°ä»memoryé‡Œé¢è·å–è¿™ä¸ªcacheï¼Œä¹Ÿå°±æ˜¯ä»YYMemoryCacheé‡Œé¢è·å–</li>
<li>å¦‚æœæ²¡æœ‰å‘ç°çš„è¯ï¼Œå°±ä»YYDiskCacheé‡Œé¢è·å–ï¼Œå†å°†å®ƒå­˜æ”¾åˆ°YYMemoryCacheä¸­</li>
</ol>
<h3 id="ä»Cacheä¸­åˆ é™¤è®°å½•-remove"><a href="#ä»Cacheä¸­åˆ é™¤è®°å½•-remove" class="headerlink" title="ä»Cacheä¸­åˆ é™¤è®°å½•(remove)"></a>ä»Cacheä¸­åˆ é™¤è®°å½•(remove)</h3><p>ä¹Ÿå°±æ˜¯ <strong>remove</strong> æ–¹æ³•ã€‚</p>
<pre><code class="objective-c">[newCache removeObjectForKey:@&quot;New Key&quot;];
</code></pre>
<ol>
<li>ä»YYMemoryCacheä¸­åˆ é™¤</li>
<li>ä»YYDiskCacheä¸­åˆ é™¤</li>
</ol>
<h2 id="YYDiskCache"><a href="#YYDiskCache" class="headerlink" title="YYDiskCache"></a>YYDiskCache</h2><p>YYDiskCacheè´Ÿè´£å°†cacheå­˜æ”¾åœ¨ç‰©ç†ç¡¬ç›˜ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æ‰€è¯´çš„ï¼Œå­˜æ”¾åœ¨ <strong>Cache</strong> ç›®å½•ä¸‹é¢çš„ç›¸åº”çš„cacheNameä¸‹é¢ï¼Œï¼ˆä¾‹å­ä¸­ä½¿ç”¨çš„æ˜¯ <strong>vanney</strong> ç›®å½•ï¼‰ã€‚å­˜æ”¾çš„æ–¹å¼æ˜¯ï¼š</p>
<ol>
<li>ä½¿ç”¨sqliteæ•°æ®åº“è®°å½•æ‰€æœ‰çš„cacheçš„ä¿¡æ¯</li>
<li>å¤§äºæŸä¸ªé™é¢çš„cacheä»¥æ–‡ä»¶å½¢å¼å­˜æ”¾ï¼Œåœ¨æ•°æ®åº“ä¸­è®°å½•ä¸‹è¯¥cacheå¯¹åº”çš„æ–‡ä»¶åï¼›è€Œå¯¹äºå°å‹çš„cacheå°±ç›´æ¥å°†äºŒè¿›åˆ¶çš„æ•°æ®å­˜æ”¾åœ¨æ•°æ®åº“é‡Œé¢å°±å¥½äº†</li>
</ol>
<h3 id="åˆå§‹åŒ–-init"><a href="#åˆå§‹åŒ–-init" class="headerlink" title="åˆå§‹åŒ–(init)"></a>åˆå§‹åŒ–(init)</h3><p>ä½¿ç”¨ä¸‹é¢çš„ä»£ç åˆå§‹åŒ–ä¸€ä¸ªYYDIskCacheï¼Œ</p>
<pre><code class="objective-c">YYDiskCache *diskCache = [YYDiskCache alloc] iniwtWithPath:path];
</code></pre>
<ol>
<li>æœ‰ä¸€ä¸ªå…¨å±€çš„å­˜æ”¾YYDiskCacheçš„ <strong>NSMapTable</strong> ï¼Œä»¥pathä¸º <strong>key</strong> ã€‚è¿™é‡Œçš„pathå°±æ˜¯ä¸Šé¢æ‰€è¯´çš„ <strong>vanney</strong> ç›®å½•ï¼Œä»¥YYDiskCacheä¸º <strong>value</strong> ã€‚</li>
<li>å…ˆä»è¿™ä¸ªNSMapTableä¸­æ‰¾çœ‹æ˜¯å¦æœ‰è¿™ä¸ªpathçš„YYDiskCacheï¼Œæœ‰å°±ç›´æ¥è¿”å›</li>
<li>æ²¡æœ‰çš„è¯ï¼Œå°±å¼€å§‹åˆ›å»ºã€‚è¿™ä¸ªåˆ›å»ºè¿‡ç¨‹å¦‚ä¸‹ï¼š<ol>
<li>åˆ›å»º <strong>vanney</strong> æ–‡ä»¶å¤¹</li>
<li>åˆ›å»º <strong>vanney</strong> æ–‡ä»¶å¤¹ä¸‹é¢çš„å„ä¸ªéƒ¨ä»¶ï¼š <strong>data</strong> ï¼Œ<strong>trash</strong> æ–‡ä»¶å¤¹å’Œ <strong>manifest</strong> æ•°æ®åº“</li>
<li>å°†åˆ›å»ºçš„YYDiskCacheä»¥ <strong>path</strong> ï¼š<strong>YYDiskCache</strong> çš„å½¢å¼å­˜æ”¾åœ¨å…¨å±€çš„NSMapTableä¸­</li>
</ol>
</li>
<li>æ·»åŠ ä¸€äº›è§‚æµ‹äº‹ä»¶</li>
</ol>
<h3 id="å†™å…¥ç¼“å­˜-set"><a href="#å†™å…¥ç¼“å­˜-set" class="headerlink" title="å†™å…¥ç¼“å­˜(set)"></a>å†™å…¥ç¼“å­˜(set)</h3><p>ä½¿ç”¨ä¸‹é¢çš„ä»£ç å†™å…¥Diskç¼“å­˜ï¼š</p>
<pre><code class="objective-c">[diskCache setObject:@&quot;DiskCache&quot; forKey:@&quot;DiskCacheKey&quot;];
</code></pre>
<ol>
<li>å…ˆå°†objectï¼Œè¿™é‡Œå°±æ˜¯ <em>DiskCache</em> å­—ç¬¦ä¸²å‹ç¼©ï¼Œä½¿ä»–å˜æˆä¸€ä¸ª <strong>NSData</strong></li>
<li>å¦‚æœNSDataå¤§å°æ²¡è¶…è¿‡é™åˆ¶ï¼Œé‚£ä¹ˆå°†è¿™æ¡cacheä»¥ <strong>key : DiskCacheKey</strong>  <strong>value:NSData</strong> <strong>filename:NULL</strong> çš„å½¢å¼å†™å…¥manifestæ•°æ®åº“</li>
<li>å¦‚æœNSDataçš„å¤§å°è¶…è¿‡é™åˆ¶çš„è¯ï¼Œå…ˆå°†NSDataå†™å…¥æ–‡ä»¶åä¸º <strong>md5(DiskCacheKey)</strong> çš„æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶å­˜æ”¾åœ¨ <strong>data</strong> æ–‡ä»¶å¤¹ï¼›ç„¶åå†å°†è¿™æ¡cacheä»¥ <strong>key:DiskCacheKey</strong> <strong>value:NULL</strong> <strong>filename:md5(DiskCacheKey)</strong> çš„å½¢å¼å†™å…¥manifestæ•°æ®åº“</li>
</ol>
<h3 id="è¯»å–ç¼“å­˜-get"><a href="#è¯»å–ç¼“å­˜-get" class="headerlink" title="è¯»å–ç¼“å­˜(get)"></a>è¯»å–ç¼“å­˜(get)</h3><p>ä½¿ç”¨ä¸‹é¢çš„ä»£ç è¯»å–Diskç¼“å­˜:</p>
<pre><code class="objective-c">NSString *diskCacheValue = [diskCache objectForKey:@&quot;DiskCacheKey&quot;];
</code></pre>
<ol>
<li>è¿›å…¥æ•°æ®åº“è·å–keyä¸ºDiskCacheKeyçš„è®°å½•ï¼Œå¹¶ä¸”ä¿®æ”¹è¿™æ¡è®°å½•çš„ <strong>last_access_time</strong> </li>
<li>å¦‚æœæ˜¯å°†cacheå­˜æ”¾åœ¨æ•°æ®åº“çš„è¯ï¼Œè·å–æ•°æ®åº“çš„valueå­—æ®µï¼›å¦‚æœæ˜¯ä»¥æ–‡ä»¶å½¢å¼å­˜åœ¨çš„è¯ï¼Œè¯»å–å­˜æ”¾NSDataçš„æ–‡ä»¶</li>
<li>å°†cacheçš„NSDataè§£å‹ï¼Œè¿˜åŸæˆæœ€åˆçš„å½¢å¼ï¼Œè¿”å›</li>
</ol>
<h3 id="åˆ é™¤ç¼“å­˜-remove"><a href="#åˆ é™¤ç¼“å­˜-remove" class="headerlink" title="åˆ é™¤ç¼“å­˜(remove)"></a>åˆ é™¤ç¼“å­˜(remove)</h3><p>ä½¿ç”¨ä¸‹é¢çš„ä»£ç åˆ é™¤Diskçš„ç¼“å­˜ï¼š</p>
<pre><code class="objective-c">[diskCache removeObjectForKey:@&quot;DiskCacheKey&quot;];
</code></pre>
<ol>
<li>åˆ é™¤æ•°æ®åº“ä¸­keyä¸ºDiskCacheKeyçš„è®°å½•</li>
<li>å¦‚æœå­˜åœ¨æ–‡ä»¶çš„è¯ï¼Œåˆ é™¤</li>
</ol>
<h2 id="YYMemoryCache"><a href="#YYMemoryCache" class="headerlink" title="YYMemoryCache"></a>YYMemoryCache</h2><p>YYMemoryCacheç»´æŠ¤ç€ä¸€ä¸ªåŒå‘é“¾è¡¨(<strong>YYLinkedMap</strong>)ï¼Œé“¾è¡¨é‡Œé¢çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªmemoryçš„ç¼“å­˜è®°å½•ï¼Œè¡¨å¤´çš„èŠ‚ç‚¹è¡¨ç¤ºæœ€è¿‘è®¿é—®è¿‡çš„ï¼Œè¡¨å°¾çš„èŠ‚ç‚¹å¾ˆä¹…æ²¡å»è®¿é—®äº†ã€‚æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ª <strong>YYLinkedMapNode</strong> å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œé¢æœ‰æŒ‡å‘å‰åèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå’ŒåŒ…å«ç¼“å­˜ä¿¡æ¯çš„ <strong>key</strong> å’Œ <strong>value</strong> å±ï¼Œä»¥åŠä¸€äº›ç¼“å­˜çš„å…¶ä»–å±æ€§ï¼š<strong>cost</strong> å’Œ <strong>time</strong> </p>
<h3 id="åˆå§‹åŒ–-init-1"><a href="#åˆå§‹åŒ–-init-1" class="headerlink" title="åˆå§‹åŒ–(init)"></a>åˆå§‹åŒ–(init)</h3><p>ä½¿ç”¨ä¸‹é¢çš„ä»£ç åˆå§‹åŒ–ä¸€ä¸ªYYMemoryCacheï¼š</p>
<pre><code class="objective-c">YYMemoryCache *memoryCache = [YYMemoryCache new];
</code></pre>
<ol>
<li>æ–°å»ºä¸€ä¸ªYYLinkedMap</li>
<li>æ·»åŠ ä¸€äº›ç›‘å¬äº‹ä»¶ï¼Œè®¾ç½®ä¸€äº›å±æ€§ç­‰ç­‰</li>
</ol>
<h3 id="å†™å…¥ç¼“å­˜-set-1"><a href="#å†™å…¥ç¼“å­˜-set-1" class="headerlink" title="å†™å…¥ç¼“å­˜(set)"></a>å†™å…¥ç¼“å­˜(set)</h3><p>ä½¿ç”¨ä¸‹é¢çš„ä»£ç å†™å…¥ç¼“å­˜ï¼š</p>
<pre><code class="objective-c">[memoryCache setObject:@&quot;Memory Cache&quot; forKey:@&quot;MemoryCacheKey&quot;];
</code></pre>
<ol>
<li>å…ˆåœ¨YYLinkedMapä¸­å¯»æ‰¾æ˜¯å¦æœ‰è¿™ä¸ªkeyï¼ŒYYLinkedMapå¯¹è±¡ä¸­æœ‰ä¸€ä¸ªdicå±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®å°±æ˜¯æ¯ä¸ªcacheçš„keyï¼Œå€¼å°±æ˜¯æ¯ä¸ªcacheå¯¹åº”çš„YYLinkedMapNode</li>
<li>å¦‚æœå­˜åœ¨çš„è¯ï¼Œé‚£å°±ä¿®æ”¹è¿™ä¸ªkeyå¯¹åº”çš„YYLinkedMapNodeçš„valueä¸º<code>@&quot;Memory Cache&quot;</code>ï¼Œå¹¶ä¸”ä¿®æ”¹å®ƒçš„å…¶ä»–å±æ€§ï¼Œå°†timeå±æ€§æ”¹ä¸ºç°åœ¨çš„æ—¶é—´ï¼Œå¹¶å°†è¿™ä¸ªNodeæ”¾åœ¨é“¾è¡¨çš„è¡¨å¤´ã€‚</li>
<li>å¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œå°±ç›´æ¥ç”Ÿæˆä¸€ä¸ªYYLinkedMapNodeï¼Œæ”¾åœ¨é“¾è¡¨çš„è¡¨å¤´</li>
</ol>
<h3 id="è¯»å–ç¼“å­˜-get-1"><a href="#è¯»å–ç¼“å­˜-get-1" class="headerlink" title="è¯»å–ç¼“å­˜(get)"></a>è¯»å–ç¼“å­˜(get)</h3><p>ä½¿ç”¨ä¸‹é¢çš„ä»£ç è¯»å–ç¼“å­˜ï¼š</p>
<pre><code class="objective-c">NSString *cacheValue = [memoryCache objectForKey:@&quot;MemoryCacheKey&quot;];
</code></pre>
<ol>
<li>ä»YYLinkedMapçš„dicä¸­è·å–keyä¸ºMemoryCacheKeyçš„YYLinkedMapNodeï¼Œä¿®æ”¹nodeçš„timeï¼Œå¹¶å°†è¿™ä¸ªnodeæ”¾åœ¨é“¾è¡¨çš„è¡¨å¤´</li>
<li>è¿”å›æ‰€éœ€çš„ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯nodeçš„valueå±æ€§</li>
</ol>
<h3 id="åˆ é™¤ç¼“å­˜-remove-1"><a href="#åˆ é™¤ç¼“å­˜-remove-1" class="headerlink" title="åˆ é™¤ç¼“å­˜(remove)"></a>åˆ é™¤ç¼“å­˜(remove)</h3><p>ä½¿ç”¨ä¸‹é¢çš„ä»£ç åˆ é™¤ç¼“å­˜ï¼š</p>
<pre><code class="objective-c">[memoryCache removeObjectForKey:@&quot;MemoryCacheKey&quot;];
</code></pre>
<ol>
<li>åˆ é™¤YYLinkedMapä¸­çš„dicé‡Œé¢çš„keyä¸ºMemoryCacheKeyçš„YYLinkedMapNode</li>
<li>è°ƒæ•´åŒå‘é“¾è¡¨</li>
</ol>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="å…³äºçº¿ç¨‹å®‰å…¨"><a href="#å…³äºçº¿ç¨‹å®‰å…¨" class="headerlink" title="å…³äºçº¿ç¨‹å®‰å…¨"></a>å…³äºçº¿ç¨‹å®‰å…¨</h3><h4 id="YYDiskCache-1"><a href="#YYDiskCache-1" class="headerlink" title="YYDiskCache"></a>YYDiskCache</h4><ol>
<li><p>æ¯ä¸ªYYDiskCacheæœ‰ä¸€ä¸ªä¿¡å·é‡ä¸º1çš„é” <em>_lock</em> ï¼Œä½¿ç”¨ <code>dispatch_semaphore_create(1);</code>æ¥åˆ›å»ºã€‚å½“å¯¹è¿™ä¸ªYYDiskCacheé‡Œé¢çš„æ•°æ®è¿›è¡Œæ“ä½œæ—¶ï¼Œæ¯”å¦‚æ·»åŠ æˆ–è€…è¯»å–ç¼“å­˜æ—¶ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªæ“ä½œåœ¨è¿›è¡Œã€‚</p>
</li>
<li><p>è¿˜æœ‰ä¸€ä¸ªä¿¡å·é‡ä¹Ÿä¸º1çš„å…¨å±€çš„é” <em>_globalInstancesLock</em> ï¼Œå®ƒç”¨æ¥å¯¹å­˜å‚¨æ¯ä¸ªYYDiskCacheçš„NSMapTableè¿›è¡ŒåŠ é”ï¼Œå¯¹è¿™ä¸ªNSMapTableè¿›è¡Œè¯»å†™çš„æ“ä½œåªèƒ½åŒæ—¶å­˜åœ¨ä¸€ä¸ªã€‚</p>
</li>
<li><p>æ¯ä¸€ä¸ªYYDiskCacheæœ‰ä¸€ä¸ªå¹¶è¡Œçš„queueï¼Œè¿™ä¸ªqueueç”¨æ¥æ‰§è¡Œè¯»å†™åˆ ä¹‹åçš„blockã€‚å› ä¸ºæœ‰è¿™æ ·çš„API:</p>
<pre><code class="objective-c">- (void)objectForKey:(NSString *)key withBlock:(void(^)(NSString *key, id&lt;NSCoding&gt; _Nullable object))block;
</code></pre>
<p>æ‰€ä»¥è¿™é‡Œçš„blockå°±åœ¨è¿™ä¸ªqueueé‡Œé¢æ‰§è¡Œï¼Œè¾¾åˆ°å¤šçº¿ç¨‹æ“ä½œçš„æ•ˆæœ</p>
</li>
</ol>
<h4 id="YYMemoryCache-1"><a href="#YYMemoryCache-1" class="headerlink" title="YYMemoryCache"></a>YYMemoryCache</h4><ol>
<li>æ¯ä¸€ä¸ªYYMemoryCacheéƒ½æœ‰ä¸€ä¸ª<code>pthread_mutex_t</code>é”ï¼ŒåŒç†ï¼Œå¯¹YYMemoryCacheçš„å†™å…¥å’Œè¯»å–ç¼“å­˜ç­‰æ“ä½œåªèƒ½åŒæ—¶å­˜åœ¨ä¸€ä¸ªã€‚</li>
<li>æœ‰ä¸€ä¸ªYYMemoryCacheGetReleaseQueueï¼Œ ç”¨æ¥é‡Šæ”¾åˆ é™¤çš„ç¼“å­˜ã€‚ è¿™é‡Œè¿˜éœ€è¦ç»†çœ‹ä»£ç ã€‚ã€‚ã€‚</li>
</ol>
<h3 id="å…³äºå„ç§é™åˆ¶"><a href="#å…³äºå„ç§é™åˆ¶" class="headerlink" title="å…³äºå„ç§é™åˆ¶"></a>å…³äºå„ç§é™åˆ¶</h3><p>YYCacheå¯ä»¥è®¾ç½®å„ç§é™åˆ¶ï¼Œæ¯”å¦‚ç¼“å­˜çš„æœ€å¤§æ•°é‡ï¼Œæœ€å¤§sizeä»¥åŠç¼“å­˜çš„ç”Ÿå­˜æ—¶é—´ç­‰ç­‰ã€‚å¯¹äºYYDiskCacheå’ŒYYMemoryCacheæœ‰ä¸¤å¥—ä¸åŒçš„å¤„ç†æ–¹æ³•ã€‚å½“ç„¶ä¹Ÿæœ‰ç›¸åŒçš„ä¸€ç‚¹å°±æ˜¯ï¼šä»–ä»¬éƒ½ä¼šå®šæ—¶æ¸…ç†ç¼“å­˜ï¼Œåœ¨æ–°å»ºä¸€ä¸ªYYDiskCacheæˆ–YYMemoryCacheæ—¶ï¼Œéƒ½ä¼šè®¾ä¸€ä¸ªå®šæ—¶äº‹ä»¶ï¼ŒæŒ‰æ—¶æ¸…ç†ç¼“å­˜ã€‚</p>
<h4 id="YYDiskCache-2"><a href="#YYDiskCache-2" class="headerlink" title="YYDiskCache"></a>YYDiskCache</h4><p>åœ¨YYDiskCacheé‡Œé¢ï¼Œæ¯ä¸€ä¸ªcacheçš„å¤§å°éƒ½åœ¨æ•°æ®åº“é‡Œé¢çš„sizeå­—æ®µé‡Œé¢æœ‰è®°å½•ï¼Œè€Œæœ€è¿‘çš„ç¼“å­˜æ“ä½œæ—¶é—´ä¹Ÿæœ‰è®°å½•ã€‚å¦‚æœæ“è¿‡æŸä¸ªé™åˆ¶çš„è¯ï¼Œæ¯”å¦‚æ€»å®¹é‡é™åˆ¶æˆ–æ€»æ•°é‡é™åˆ¶æˆ–è€…å­˜æ´»æ—¶é—´é™åˆ¶ï¼Œé‚£ä¹ˆä¼šåˆ æ‰æœ€é•¿æ—¶é—´æ²¡æœ‰å»ä½¿ç”¨çš„ç¼“å­˜ã€‚è¿™ä¸ªæ“ä½œå¾ˆç®€å•ï¼Œåªéœ€è¦å¯¹æ•°æ®åº“çš„å„ä¸ªç¼“å­˜æŒ‰æ—¶é—´æ’åºå°±è¡Œäº†ã€‚</p>
<h4 id="YYMemoryCache-2"><a href="#YYMemoryCache-2" class="headerlink" title="YYMemoryCache"></a>YYMemoryCache</h4><p>åœ¨YYMemoryCacheé‡Œé¢ï¼Œä½¿ç”¨åŒå‘é“¾è¡¨æ¥è®°å½•æ¯ä¸ªç¼“å­˜çš„ä½¿ç”¨æƒ…å†µã€‚è¡¨å¤´çš„è¡¨ç¤ºåˆšåˆšä½¿ç”¨è¿‡ï¼Œè€Œè¡¨å°¾çš„åˆ™å¾ˆä¹…æ²¡ä½¿ç”¨äº†ã€‚æ¯ä¸ªYYLinkedMapNodeéƒ½æœ‰è®°å½•è‡ªå·±çš„timeå’Œcostï¼Œè€ŒYYLinkedMapåˆ™æœ‰è®°å½•æ€»çš„costå’Œæ€»çš„ç¼“å­˜æ•°é‡ã€‚å½“è¶…è¿‡æŸä¸ªé™åˆ¶çš„è¯ï¼Œå°±ä¼šä»è¡¨å°¾å¼€å§‹åˆ é™¤ç¼“å­˜ï¼Œç›´åˆ°è¾¾åˆ°è¦æ±‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://github.com/ibireme/YYKit" target="_blank" rel="external">YYKit</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç† - GCD]]></title>
      <url>/2016/08/02/OC-ARC-GCD-reading-note-three/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç† è¯»ä¹¦ç¬”è®°ï¼ˆä¸‰ï¼‰ <strong>GCD</strong></p>
<a id="more"></a>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="GCDæ¦‚è¦"><a href="#GCDæ¦‚è¦" class="headerlink" title="GCDæ¦‚è¦"></a>GCDæ¦‚è¦</h3><ol>
<li><strong>GCD</strong>ï¼šGrand Central Dispatchï¼Œå¤§ä¸­æ¢æ´¾å‘ï¼Œå¾ˆç‰›é€¼çš„åå­—</li>
</ol>
<h3 id="GCDçš„API"><a href="#GCDçš„API" class="headerlink" title="GCDçš„API"></a>GCDçš„API</h3><ol>
<li><p><code>dispatch_async(queue, block);</code></p>
<p>å°†æƒ³è¦æ‰§è¡Œçš„ä»»åŠ¡å°è£…è¿›Blockï¼Œæ”¾ä»–åˆ°queueä¸­æ‰§è¡Œã€‚è¿™é‡Œçš„queueæœ‰ä¸¤ç§ï¼š</p>
<ol>
<li>ä¸€ç§æ˜¯<strong>Serial Dispatch Queue</strong>ï¼Œé¡ºåºé˜Ÿåˆ—ï¼Œæ”¾å…¥è¿™é‡Œé¢çš„blockä»»åŠ¡æ˜¯ä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œçš„ï¼Œå…ˆè¿›å…ˆå‡ºã€‚</li>
<li>å¦ä¸€ç§æ˜¯ <strong>Concurrent Dispatch Queue</strong>ï¼Œå¹¶è¡Œé˜Ÿåˆ—ï¼Œæ„æ€å°±æ˜¯ä¼šå¼€å¤šä¸ªé˜Ÿåˆ—ï¼Œblockä¸€æ¬¡è¿›å…¥å„ä¸ªé˜Ÿåˆ—åŒæ—¶æ‰§è¡Œï¼›ä½†æ˜¯é˜Ÿåˆ—çš„æ•°é‡ç”±ç³»ç»Ÿæ§åˆ¶ï¼Œé‚£äº›è¿˜æ¥ä¸åŠè¿›å…¥ä»»ä½•ä¸€ä¸ªé˜Ÿåˆ—æ‰§è¡Œçš„blockï¼Œåªèƒ½ç­‰æŸä¸ªé˜Ÿåˆ—çš„blockæ‰§è¡Œå®Œäº†ï¼Œå†è¿›å…¥é˜Ÿåˆ—æ‰§è¡Œäº†ï¼›æ‰€ä»¥è¯´è¿™é‡Œçš„æ¯ä¸ªblockçš„æ‰§è¡Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚</li>
</ol>
<p><strong>PS</strong>ï¼šå½“ç„¶ä½ ä¹Ÿå¯ä»¥åŒæ—¶å¼€å¤šä¸ªé¡ºåºé˜Ÿåˆ—ï¼Œä»¥è¾¾åˆ°å¹¶è¡Œé˜Ÿåˆ—çš„æ•ˆæœï¼›ä½†æ˜¯ä¸èƒ½å¤šå¼€ï¼Œå› ä¸ºç¨‹åºåœ¨å„ä¸ªé˜Ÿåˆ—ä¹‹é—´åˆ‡æ¢ï¼Œä¹Ÿå°±æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´åˆ‡æ¢ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œéœ€è¦è€—è´¹CPUç­‰èµ„æºã€‚å½“ç„¶å­˜æ”¾æ¯ä¸ªçº¿ç¨‹çš„çŠ¶æ€ç­‰ä¿¡æ¯ä¹Ÿéœ€è¦è€—è´¹èµ„æºã€‚</p>
</li>
<li><p><code>dispatch_queue_create;</code></p>
<p>è¿™ä¸ªAPIç”¨æ¥ç”ŸæˆDispatch Queueã€‚çœ‹çœ‹ä¸‹é¢ä»£ç ï¼š</p>
<pre><code class="objective-c">dispatch_queue_t mySerialDispatchQueue = dispatch_queue_create(&quot;com.vanney9.serialQueue&quot;, NULL);
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ç”¨æ¥ç”Ÿæˆä¸€ä¸ªSerial dispatch queueï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯queueçš„åå­—ï¼Œæœ€å¥½å”¯ä¸€ï¼›ç¬¬äºŒä¸ªæ˜¯ä»£è¡¨ç”Ÿæˆçš„queueçš„ç±»å‹ï¼Œè‹¥æŒ‡å®šä¸ºNULLï¼Œåˆ™ç”Ÿæˆserial dispatch queueï¼Œè‹¥æŒ‡å®šä¸º<code>DISPATCH_QUEUE_CONCURRENT</code>ï¼Œåˆ™ç”Ÿæˆconcurrent dispatch queueã€‚è¿”å›ç±»å‹æ˜¯<em>dispatch_queue_t</em>ã€‚</p>
<p><strong>PS</strong>ï¼šç”Ÿæˆçš„queueï¼Œè¦é€šè¿‡<code>dispatch_release</code>å‡½æ•°æ‰‹åŠ¨é‡Šæ”¾ã€‚</p>
</li>
<li><p><code>dispatch_get_main_queue();</code></p>
<p>è¿™ä¸ªå‡½æ•°ç”¨æ¥è·å–ç¨‹åºçš„ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œå½“ç„¶æ˜¯serial dispatch queueã€‚è¿½åŠ åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡ä¼šåœ¨ä¸»çº¿ç¨‹çš„Runloopä¸­æ‰§è¡Œã€‚</p>
</li>
<li><p><code>dispatch_get_global_queue(level, 0);</code></p>
<p>è¿™ä¸ªå‡½æ•°ç”¨æ¥è·å–Global dispatch queueã€‚å®ƒæ˜¯ä¸€ä¸ªConcurrent dispatch queueã€‚å®ƒæœ‰4ä¸ªäººä¼˜å…ˆçº§ï¼šHigh Priorityï¼ŒDefault Priorityï¼ŒLow Priorityå’ŒBackground Priorityã€‚</p>
</li>
<li><p><code>dispatch_set_target_queue</code> ï¼ˆæœ‰ç‚¹æ™•ï¼‰</p>
<p>è¯¥å‡½æ•°ç”¨æ¥è®¾ç½®queueçš„ä¼˜å…ˆçº§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>dispatch_queue_create</code>ç”Ÿæˆçš„queueéƒ½æ˜¯å’ŒGlobal dispatch queueçš„é»˜è®¤ä¼˜å…ˆçº§ç›¸åŒã€‚å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°æ¥æ”¹å˜ä¼˜å…ˆçº§ï¼š</p>
<pre><code class="objective-c">dispatch_queue_t mySerialQueue = dispatch_queue_create(&quot;com.vanney9.serialQueue&quot;, NULL); // ä¼˜å…ˆçº§ä¸ºDefault Priority
dispatch_queue_t globalBackgroundQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, 0); // è·å–Background Priorityçš„queue
dispatch_set_target_queue(mySerialQueue, globalBackgroundQueue); // è®¾ç½®mySerialQueueçš„ä¼˜å…ˆçº§å’ŒglobalBackgroundQueueçš„ç›¸åŒ
</code></pre>
</li>
<li><p><code>dispatch_after(time, queue, block);</code></p>
<p>è¯¥å‡½æ•°è¡¨ç¤ºåœ¨timeæ—¶é—´ä¹‹åï¼ˆæ¯”å¦‚3såï¼‰å°†blockåŠ åˆ°queueä¸­ã€‚</p>
</li>
<li><p>Dispatch Group</p>
<p>è¿½åŠ åˆ°dispatch queueä¸­çš„å¤šä¸ªå¤„ç†éƒ½ç»“æŸæ—¶ï¼Œæƒ³è¿›è¡Œä¸€äº›å¤„ç†è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿå¯¹äºserial dispatch queueï¼Œè¿™å¾ˆç®€å•ï¼›ä½†æ˜¯å¦‚æœæ˜¯concurrent dispatch queueï¼Œè¿™æ—¶å€™å°±éœ€è¦<strong>Dispatch Group</strong>ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); //å…ˆåˆ›å»ºä¸€ä¸ªconcurrent queue
dispatch_group_t group = dispatch_group_create(); // åˆ›å»ºä¸€ä¸ªgroup

/* å†å°†3ä¸ªBlockæ·»åŠ åˆ°è¿™ä¸ªqueueä¸­ï¼Œå¹¶ä¸”å±äºåŒä¸€ä¸ªgroup */
dispatch_group_async(group, queue, ^{NSLog(@&quot;blk1&quot;);});
dispatch_group_async(group, queue, ^{NSLog(@&quot;blk2&quot;);});
dispatch_group_async(group, queue, ^{NSLog(@&quot;blk3&quot;);});

dispatch_group_notify(group, dispatch_get_main_queue(), ^{NSLog(@&quot;Done&quot;);}); // å…¨éƒ¨ç»“æŸåé€šçŸ¥ä¸»çº¿ç¨‹ï¼Œå°†Blockè¿½åŠ åˆ°ä¸»çº¿ç¨‹ä¸­

dispatch_release(group); // é‡Šæ”¾groupã€‚å› ä¸ºGlobal dispatch queueä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨é‡Šæ”¾
</code></pre>
<p>ä¸Šé¢çš„<code>dispatch_group_notify</code>å‡½æ•°åœ¨groupä¸­çš„ä¸‰ä¸ªblockå…¨éƒ¨éƒ½æ‰§è¡Œå®Œä¹‹åï¼Œæ‰ä¼šå°†<code>^{NSLog(@&quot;Done&quot;);}</code>è¿™ä¸€ä¸ªBlockè¿½åŠ åˆ°ä¸»çº¿ç¨‹ä¸­å»ã€‚è¿˜å¯ä»¥ä½¿ç”¨<code>dispatch_group_wait</code>å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, 1ull *NSEC_PER_SEC); // 1sçš„æ—¶é—´
long result = dispatch_group_wait(group, time); // è¡¨ç¤ºgroupç»è¿‡1sä¹‹åï¼Œæ˜¯ä»€ä¹ˆç»“æœ
if (result == 0) {
      /* result == 0ï¼Œé‚£ä¹ˆgroupä¸­çš„Blockå·²ç»å…¨éƒ¨å¤„ç†å®Œ */
} else {
      /* result != 0ï¼Œ é‚£ä¹ˆè¿˜æ²¡å¤„ç†å®Œ */
}
</code></pre>
<p><strong>PS</strong>ï¼šæ³¨æ„ï¼Œæ‰§è¡Œ<code>dispatch_gropu_wait</code>çš„çº¿ç¨‹æ˜¯å¤„äºåœæ»çŠ¶æ€çš„ï¼Œåªæœ‰å½“è¯¥å‡½æ•°è¿”å›åï¼Œæ‰ä¼šæ‰§è¡Œä¹‹åçš„æ“ä½œï¼Œæ‰€ä»¥è¿˜æ˜¯æ¨èä½¿ç”¨<code>dispatch_group_notify;</code>ï¼Œå¼‚æ­¥ï¼Œæ— é˜»å¡ã€‚</p>
</li>
<li><p><code>dispatch_barrier_async</code></p>
<p>è¯¥å‡½æ•°å’Œconcurrent dispatch queueä¸€èµ·ä½¿ç”¨ï¼Œçœ‹çœ‹ä¾‹å­</p>
<pre><code class="objective-c">dispatch_async(queue, blk_reading1); // æ³¨æ„è¿™é‡Œqueueæ˜¯concurrent dispatch queue 
dispatch_async(queue, blk_reading2);
dispatch_async(queue, blk_reading3);
dispatch_barrier_async(queue, blk_writing);
dispatch_async(queue, blk_reading4);
dispatch_async(queue, blk_reading5);
dispatch_async(queue, blk_reading6);
dispatch_async(queue, blk_reading7);
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ä¼šåŒæ—¶å…ˆæ‰§è¡Œblk_reading1,blk_reading2å’Œblk_reading3è¿™ä¸‰ä¸ªè¯»å–æ“ä½œï¼Œç„¶åç­‰æ‰§è¡Œå®Œåå†å•ç‹¬æ‰§è¡Œblk_writingè¿™ä¸€å†™å…¥æ“ä½œï¼Œæœ€åç­‰å†™å…¥å®Œæˆåå†å¼€å§‹åŒæ—¶æ‰§è¡Œä¹‹åçš„4çš„è¯»å–æ“ä½œã€‚</p>
</li>
<li><p><code>dispatch_sync</code></p>
<p>è¯¥å‡½æ•°åŒæ­¥æ‰§è¡Œblockï¼Œä¹Ÿå°±æ˜¯è¯´blockä¸æ‰§è¡Œå®Œï¼Œå°±ä¸€ç›´åœç•™åœ¨è¿™ä¸ªå‡½æ•°è¿™é‡Œï¼Œå®¹æ˜“å¯¼è‡´æ­»é”ã€‚çœ‹çœ‹ä¾‹å­ï¼š</p>
<pre><code class="objective-c">dispatch_queue_t queue = dispatch_get_main_queue(); // æ³¨æ„ï¼Œè¿™æ®µä»£ç åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚è·å–ä¸»çº¿ç¨‹
dispatch_sync(queue, block); // æ­»é”
</code></pre>
<p><code>dispatch_sync</code>åœ¨ä¸»çº¿ç¨‹ä¸Šå°†blockè¿½åŠ åˆ°ä¸»çº¿ç¨‹å»å¤„ç†ï¼Œè¿™æ—¶å€™ç¨‹åºä¸€ç›´å¡åœ¨<code>dispatch_sync</code>è¿™é‡Œã€‚å› ä¸ºè¯¥å‡½æ•°ä¸€ç›´åœ¨ç­‰å¾…blockå¤„ç†ç»“æŸï¼›ä½†æ˜¯blockçš„å¤„ç†ä¹Ÿæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šï¼Œéœ€è¦ç­‰å½“å‰è¿™äº›æ“ä½œç»“æŸåï¼Œæ‰ä¼šå»æ‰§è¡Œblockã€‚è¿™æ ·å°±å¡ä½äº†ï¼Œæ­»é”ï¼ŒGGã€‚</p>
</li>
<li><p><code>dispatch_apply</code></p>
<p>è¯¥å‡½æ•°åŒæ ·è¦ç­‰å¾…blockæ‰§è¡Œå®Œï¼Œæ‰ç»“æŸã€‚å®ƒå¯ä»¥æŒ‡å®šblockçš„æ‰§è¡Œæ¬¡æ•°ã€‚</p>
</li>
<li><p><code>dispatch_suspend(queue)/dispatch_resume(queue)</code></p>
<ol>
<li><code>dispatch_suspend(queue);</code>ï¼šæŒ‚èµ·queueï¼Œæœªæ‰§è¡Œçš„blockæš‚åœ</li>
<li><code>dispatch_resume(queue);</code>ï¼šæ¢å¤queueï¼Œç»§ç»­æ‰§è¡Œä¹‹å‰æ²¡æœ‰æ‰§è¡Œçš„block</li>
</ol>
</li>
<li><p>ä¸€äº›å…¶ä»–API</p>
<ol>
<li>Dispatch Semaphoreï¼šæ›´ç»†ç²’åº¦çš„å¤šçº¿ç¨‹æ§åˆ¶ï¼Œç±»ä¼¼äºä¿¡å·é‡</li>
<li><code>dispatch_once</code>ï¼šæ•´ä¸ªåº”ç”¨ç¨‹åºä¸­åªæ‰§è¡Œä¸€æ¬¡ï¼Œå¤šçº¿ç¨‹å®‰å…¨ï¼Œå•ä¾‹æ¨¡å¼</li>
<li>Dispatch I/Oï¼šæ–‡ä»¶åˆ†å—è¯»å–ï¼Œæé«˜æ–‡ä»¶è¯»å–æ•ˆç‡</li>
</ol>
</li>
</ol>
]]></content>
      
        <categories>
            
            <category> è¯»ä¹¦ç¬”è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç† - Blocks]]></title>
      <url>/2016/07/29/OC-ARC-GCD-reading-note-two/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç† è¯»ä¹¦ç¬”è®°ï¼ˆäºŒï¼‰ <strong>Blocks</strong></p>
<a id="more"></a>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="Blocksæ¦‚è¦"><a href="#Blocksæ¦‚è¦" class="headerlink" title="Blocksæ¦‚è¦"></a>Blocksæ¦‚è¦</h3><ol>
<li><p>Blocksï¼šå¸¦æœ‰è‡ªåŠ¨å˜é‡ï¼ˆå±€éƒ¨å˜é‡ï¼‰çš„åŒ¿åå‡½æ•°</p>
</li>
<li><p>å®Œæ•´çš„Blockè¯­æ³•ä¸ä¸€èˆ¬çš„Cè¯­è¨€å‡½æ•°å®šä¹‰ç›¸æ¯”åªæœ‰2ç‚¹ä¸åŒï¼š</p>
<ol>
<li>å¼€å¤´å¤šäº†^ç¬¦å·</li>
<li>æ²¡æœ‰å‡½æ•°å</li>
</ol>
</li>
<li><p>çœ‹çœ‹å¦‚ä½•å£°æ˜Blockç±»å‹å˜é‡ï¼š<code>int (^blk)(int);</code>å£°æ˜äº†ä¸€ä¸ªå‚æ•°ç±»å‹ä¸ºintï¼Œè¿”å›ç±»å‹ä¸ºintçš„Blockå˜é‡blkã€‚</p>
</li>
<li><p><code>typedef int (^blk_t)(int);</code> é‚£ä¹ˆblk_tä»£è¡¨ä¸€ä¸ªBlockå˜é‡</p>
</li>
<li><p>Blockä¼šè‡ªåŠ¨æˆªè·å’Œä¿å­˜å˜é‡å€¼ã€‚ä½†æ˜¯ä¸èƒ½æ›´æ”¹ä¿å­˜çš„å˜é‡å€¼ï¼Œé™¤éä½ ä½¿ç”¨__blockã€‚å¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">int val = 0;
void (^blk)(void) = ^{val = 1}; // æ›´æ”¹è‡ªåŠ¨ä¿å­˜çš„å˜é‡å€¼ æŠ¥é”™
blk();

/* ä½¿ç”¨__blockä¹‹å */
__block int val = 0;
void (^blk)(void) = ^{val = 1}; // ä¸æŠ¥é”™
blk();
</code></pre>
<p><strong>PS</strong>ï¼šå¦‚æœæ˜¯æˆªè·çš„OCå¯¹è±¡ï¼Œæ¯”å¦‚æˆªè·äº†NSMutableArrayå¯¹è±¡arrayï¼Œå¯ä»¥ä½¿ç”¨arrayï¼š<code>[array addObject:obj];</code>ï¼›ä½†æ˜¯ä¸èƒ½ç»™arrayèµ‹å€¼ï¼š<code>array = [[NSMutableArray alloc] init];</code>ã€‚è‹¥è¦ç»™ä»–èµ‹å€¼ï¼Œè¿˜æ˜¯å¾—ä½¿ç”¨__blockä¿®é¥°ç¬¦ã€‚</p>
<p><strong>PS</strong>ï¼šä¸ä¼šè‡ªåŠ¨æˆªè·Cè¯­è¨€æ•°ç»„ï¼š<code>char text[] = &quot;hello&quot;;</code>ï¼›ä½†æ˜¯å¯ä»¥æˆªè·æŒ‡é’ˆï¼š<code>char *text = &quot;hallo&quot;;</code>ã€‚</p>
</li>
</ol>
<h3 id="Blocksçš„å®ç°"><a href="#Blocksçš„å®ç°" class="headerlink" title="Blocksçš„å®ç°"></a>Blocksçš„å®ç°</h3><ol>
<li><p>Blockå…¶å®å°±æ˜¯Objective-Cå¯¹è±¡ </p>
</li>
<li><p>æ¥çœ‹çœ‹å…·ä½“å®ç°</p>
<pre><code class="objective-c">int main() {
      void (^blk)(void) = ^{printf(&quot;Bolck.../n&quot;);};
      blk();
      return 0;
}

/* ç»è¿‡ç¼–è¯‘å™¨è½¬åŒ–ä¹‹å */

/* ä¸‹é¢çš„ç»“æ„ä½“è¡¨ç¤ºçš„æ˜¯Blockå¯¹è±¡ */
struct __main_block_impl_0 {
      void *isa; // OCå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªisaæŒ‡å‘å®ƒçš„ç±»ï¼Œè¡¨æ˜è¿™ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªä»€ä¹ˆç±»

      /* æ— å…³ç´§è¦çš„ä¸€äº›æˆå‘˜ */
      int Flags;
      int Reserved;
      struct __main_block_desc_0 *Desc; // ä¸€ä¸ªç»“æ„ä½“æŒ‡é’ˆï¼Œåé¢ä¼šæœ‰å®šä¹‰ï¼Œå¤§æ¦‚å’Œç³»ç»Ÿæœ‰å…³

      void *FuncPtr; // å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘è¿™ä¸ªBlockçš„åŒ¿åå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ {printf(&quot;Block.../n&quot;);}

      /* ç»“æ„ä½“çš„åˆå§‹åŒ–å‡½æ•° */
      __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int flags = 0) {
          // ä¼ å…¥çš„å‚æ•°æ˜¯åŒ¿åå‡½æ•°çš„å‡½æ•°æŒ‡é’ˆï¼Œ__main_block_desc_0ç»“æ„ä½“æŒ‡é’ˆå’Œflags
          isa = &amp;_NSConcreteStackBlock; // åˆå§‹åŒ–isa
          Flags = flags;
          FuncPtr = fp;
          Desc = desc;
      }
}

/* ä¸‹é¢ä»£ç çš„ç»“æ„ä½“ å°±æ˜¯ä¸Šé¢Blockç»“æ„ä½“ä¸­çš„é‚£ä¸ªæ— å…³ç†è§£çš„ç»“æ„ä½“æŒ‡é’ˆæˆå‘˜çš„å®šä¹‰ */
static struct __main_block_desc_0 {
      unsigned long reserved;
      unsigned long Block_size;
} __main_block_desc_0_DATA = {
      0,
      sizeof(struct __main_block_impl_0)
};

/* åŒ¿åå‡½æ•°çš„å®šä¹‰ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯Blockç»“æ„ä½“æŒ‡é’ˆ */
static void __main_block_func_0(struct __main_block_impl_0 *__cself) {
      printf(&quot;Block.../n&quot;);
}

/* mainå‡½æ•°çš„å®ç° */
int main {
      void (*blk)(void) = &amp;__main_block_impl_0(__main_block_func_0, &amp;__main_block_desc_0_DATA); // åˆå§‹åŒ–Blockï¼Œå…¶å®ä¹Ÿå°±æ˜¯åˆ›å»ºBlockç»“æ„ä½“
      blk-&gt;FuncPtr(blk); // æ‰§è¡ŒBlockï¼Œä¹Ÿå°±æ˜¯æ‰§è¡ŒBlockç»“æ„ä½“ä¸­çš„å‡½æ•°ï¼Œä¼ å…¥ç»“æ„ä½“æœ¬èº«
      return 0;
}
</code></pre>
<p>ä¸Šé¢è¿™ä¸ªç¼–è¯‘çš„è¿‡ç¨‹å°±æ˜¯ï¼š</p>
<ol>
<li>åœ¨mainå‡½æ•°å¤–é¢ï¼Œå…ˆå¯¹Blockåšå®šä¹‰ï¼šBlockæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œä»–æœ‰ä¸€ä¸ªæˆå‘˜æ˜¯åŒ¿åå‡½æ•°çš„å‡½æ•°æŒ‡é’ˆï¼›è¿™ä¸ªç»“æ„ä½“çš„æ„é€ å‡½æ•°éœ€è¦ä¼ å…¥åŒ¿åå‡½æ•°çš„å‡½æ•°æŒ‡é’ˆã€‚</li>
<li>åœ¨mainå‡½æ•°å¤–é¢å†å®šä¹‰åŒ¿åå‡½æ•°ï¼ŒåŒ¿åå‡½æ•°çš„å‚æ•°æ˜¯Blockç»“æ„ä½“ï¼Œè¯¥å‚æ•°åœ¨æˆªè·è‡ªåŠ¨å˜é‡æ—¶ä¼šæœ‰ç”¨ã€‚</li>
<li>å®šä¹‰mainå‡½æ•°ï¼Œå…ˆæ–°å»ºä¸€ä¸ªBlockç»“æ„ä½“å¹¶åˆå§‹åŒ–ï¼›åœ¨æ‰§è¡ŒBlockï¼Œä¹Ÿå°±æ˜¯æ‰§è¡ŒBlockç»“æ„ä½“é‡Œé¢çš„å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°ï¼›å†return 0ã€‚</li>
</ol>
<p><strong>PS</strong>ï¼šç»“æ„ä½“çš„åˆå§‹åŒ–é‡Œé¢çš„<code>isa = &amp;_NSConcreteStackBlock;</code>å°±æ˜¯åœ¨å°†ç»“æ„ä½“å½“åšOCå¯¹è±¡åœ¨å¤„ç†ï¼Œä»–å°†OCå¯¹è±¡çš„ä¿¡æ¯æ”¾åœ¨isaé‡Œé¢ã€‚</p>
</li>
<li><p>çœ‹çœ‹å¦‚ä½•æˆªè·è‡ªåŠ¨å˜é‡</p>
<pre><code class="objective-c">int main() {
      int dmy = 256; // ä¸ä¼šè¢«æˆªè·çš„å˜é‡
      int val = 10; // è¢«æˆªè·
      const chat *fmt = &quot;val = %d/n&quot;;
      void (^blk)(void) = ^{printf(fmt, val);};
      blk();
      return 0;
}

/* ç»è¿‡ç¼–è¯‘ä¹‹å */

/* Blockç»“æ„ä½“å®šä¹‰ */
struct __main_block_impl_0 {
      /* å¦‚å‰æ‰€è¯‰ */
      void *isa;
      int Flags;
      int Reserved;
      void *FuncPtr;
      struct __main_block_desc_0 *Desc;

      /* æˆªè·çš„è‡ªåŠ¨å˜é‡ï¼Œå˜æˆäº†ç»“æ„ä½“æˆå‘˜ */
      const char *fmt;
      int val;

      /* åˆå§‹åŒ–å‡½æ•°ï¼Œè¿™é‡Œä¼šä½¿ç”¨æˆªè·çš„è‡ªåŠ¨å˜é‡å¯¹æˆå‘˜è¿›è¡Œèµ‹å€¼ */
      __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, const char *_fmt, int _val, int flags = 0) :fmt(_fmt), val(_val) {
          /* å¦‚å‰æ‰€è¯‰,å°±çœç•¥äº† */
          //...
      }
}

/* __main_block_desc_0ç»“æ„ä½“å®šä¹‰ï¼ŒåŒä¸Šï¼Œçœç•¥ */

/* åŒ¿åå‡½æ•°å®šä¹‰ */
static void __main_block_func_0(struct __main_block_impl_0 *__cself) {
      const char *fmt = __cself-&gt;fmt;
      int val = __cself-&gt;val;

      printf(fmt, val);
}

/* mainå‡½æ•°å®ç° */
int main() {
      int dmy = 256;
      int val = 10;
      const char *fmt = &quot;val = %d/n&quot;;

      void (*blk)(void) = &amp;__main_block_impl_0(__main_block_func_0, &amp;main_block_desc_0_DATA, fmt, val); // è¿™é‡Œè¿›è¡ŒBlockçš„åˆå§‹åŒ–
       blk-&gt;FuncPtr(blk); // æ‰§è¡ŒBlock

      return 0;
}
</code></pre>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œåœ¨åˆå§‹åŒ–å¾—æ—¶å€™ï¼Œå°†è‡ªåŠ¨å˜é‡ä¼ å…¥äº†Blockç»“æ„ä½“çš„åˆå§‹åŒ–å‡½æ•°ï¼Œè¿›è¡Œä¿å­˜ã€‚æ‰€ä»¥ä¹‹åå¯¹è¿™äº›è‡ªåŠ¨å˜é‡è¿›è¡Œä¿®æ”¹ï¼ŒBlockç»“æ„ä½“é‡Œé¢çš„è¿™äº›ä¿å­˜åœ¨ç»“æ„ä½“æˆå‘˜é‡Œçš„å˜é‡æ˜¯ä¸å—å½±å“çš„ã€‚</p>
</li>
<li><p><strong>__block</strong>çš„å®ç°</p>
<p>__blockå˜é‡ä¹Ÿå®šä¹‰åœ¨mainå‡½æ•°ä¹‹å¤–ï¼Œä¸åœ¨åªæ˜¯ä¸€ä¸ªç®€å•çš„å˜é‡ï¼Œè€Œæ˜¯å˜æˆäº†ç»“æ„ä½“ï¼š</p>
<pre><code class="objective-c">struct __Block_byref_val_0 {
      void *isa;
      __Block_byref_val_0 *__forwarding; // æŒ‡å‘è‡ªå·±çš„æŒ‡é’ˆ
      int __flags;
      int __size;
      int val; // åŸæ¥çš„è‡ªåŠ¨å˜é‡
}

/* Blocké‡Œé¢å«æœ‰__blockå˜é‡çš„ç»“æ„ä½“æŒ‡é’ˆ */
struct __main_block_impl_0 {
      /* åŒä¸Šçš„æˆå‘˜çœç•¥ */
      __Block_byref_val_0 *val; // æŒ‡å‘valç»“æ„ä½“çš„æŒ‡é’ˆ

      /* ç»“æ„ä½“åˆå§‹åŒ–å‡½æ•°ï¼Œä½¿ç”¨valç»“æ„ä½“çš„__forwardingæˆå‘˜å˜é‡åˆå§‹åŒ–Blockç»“æ„ä½“çš„valæŒ‡é’ˆ */
      __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, __Block_byref_val_0 *_val, int flags = 0) : val(_val-&gt;forwarding) {
          /* åŒä¸Š çœç•¥ */
      }
}

/* åŒ¿åå‡½æ•° */
static void __main_block_func_0(struct __main_block_impl_0 *__cself) {
      __Block_byref_val_0 *val = __cself-&gt;val;
      val-&gt;forwarding-&gt;val = 1; // åœ¨è¿™é‡Œ valå’Œval-&gt;forwardingå…¶å®éƒ½æŒ‡çš„æ˜¯è‡ªå·±
}

/* mainå‡½æ•°é‡Œé¢ */
int main() {
      int val = 10;
      void (^blk)(void) = ^{val = 1;};
}

/* è½¬åŒ–ä¹‹å valå˜æˆç»“æ„ä½“ */
int main() {
      __Block_byref_val_0 val = {
          0,
          &amp;val, // æŒ‡å‘è‡ªèº«çš„æŒ‡é’ˆ
          0,
          sizeof(__Block_byref_val_0),
          10 // åˆå§‹åŒ–
      };

      blk = &amp;__main_block_impl_0(__main_block_func_0, &amp;__main_block_desc_0_DATA, &amp;val); // åˆå§‹åŒ–Blockç»“æ„ä½“æ—¶å°†valç»“æ„ä½“åœ°å€ä¼ è¿‡å»
}
</code></pre>
<p>å°†valå˜é‡å˜æˆå­˜æ”¾åœ¨æ ˆä¸Šçš„ç»“æ„ä½“ï¼Œè¿™ä¹Ÿå°±æ˜¯__blockå˜é‡</p>
</li>
<li><p>Blockå­˜å‚¨åŸŸ</p>
<ol>
<li>_NSConcreteStackBlockå°†Blockå­˜æ”¾åœ¨æ ˆä¸Š</li>
<li>_NSConcreteGlobalBlockå°†Blockå­˜æ”¾åœ¨æ•°æ®åŒºåŸŸ</li>
<li>_NSConcreteMallocBlockå°†Blockå­˜æ”¾åœ¨å †ä¸Š</li>
</ol>
<p>å­˜æ”¾åœ¨æ•°æ®åŒºåŸŸçš„Blockç›¸å½“äºå…¨å±€å˜é‡ï¼Œä¸èƒ½æˆªè·è‡ªåŠ¨å˜é‡ï¼Œå…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚æ‰€æœ‰ä¸éœ€è¦æˆªè·è‡ªåŠ¨å˜é‡çš„Blockéƒ½æ˜¯è¿™ç§ç±»å‹çš„ã€‚</p>
<p>å…¶ä»–çš„Blockéƒ½ç°åœ¨æ ˆä¸Šç”Ÿæˆï¼Œä½†æ˜¯å½“è¶…è¿‡è¿™ä¸ªBlockçš„ä½œç”¨åŸŸï¼Œä½†æ˜¯åˆè¦ä½¿ç”¨è¯¥Blockæ—¶ï¼Œå°±ä¼šå°†Blockä»æ ˆä¸Šå¤åˆ¶åˆ°å †ä¸Šã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<pre><code class="objective-c">typedef int (^blk_t)(int);
blk_t func(int rate) {
      return ^(int count)(return rate *count);
}
</code></pre>
<p>è¿™é‡ŒBlockåœ¨å‡½æ•°å†…ç”Ÿæˆåï¼Œè¿”å›æ—¶å°±å·²ç»ç¦»å¼€Blockçš„ä½œç”¨åŸŸäº†ã€‚è¿™æ—¶å€™å°±éœ€è¦å°†ä»–copyåˆ°å †ä¸Š</p>
<pre><code class="objective-c">blkt func(int rate) {
      blkt tmp = &amp;__func_block_impl_0(__func_block_func_0, &amp;__func_block_desc_0_DATA, rate);
      tmp = _Block_copy(tmp); // å°†æ ˆä¸Šçš„Blockå¤åˆ¶åˆ°å †ä¸Š
      return objc_autoreleaseReturnValue(tmp); // å°†tmpæ³¨å†Œåˆ°NSAutoreleasePoolï¼Œè¯´æ˜Blockä¹Ÿæ˜¯OCå¯¹è±¡
}
</code></pre>
<p>å‡ºäº†å‡½æ•°ä¹‹åï¼Œæ ˆä¸Šçš„Blockå°±ä¼šè¢«é‡Šæ”¾ï¼Œè¿™ä¸ªæ—¶å€™åªèƒ½ä½¿ç”¨åœ¨å †ä¸Šçš„Blockäº†ã€‚å¾ˆå¤šæƒ…å†µä¸‹ç¼–è¯‘å™¨ä¼šå¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨å¤åˆ¶çš„ï¼Œä½†æ˜¯NSArrayå¾—<code>initWithObjects</code>æ–¹æ³•å°±ä¸ä¼šè‡ªåŠ¨å¤åˆ¶ï¼š</p>
<pre><code class="objective-c">- (id)getBlockArray {
      int val = 10;
      return [[NSArray alloc] initWithObjects:
           ^{NSLog(@&quot;haha&quot;);},
           ^{NSLog(@&quot;yaya&quot;);}, nil];
}

// è¿™ç§æƒ…å†µä¸‹è¿”å›çš„NSArrayï¼Œå¦‚æœå»è·å–NSArrayä¸­çš„Blockå¯¹è±¡ï¼Œæ˜¯ä¼šå‡ºé”™çš„ï¼Œå› ä¸ºè¿™äº›Blockåœ¨å‡ºå‡½æ•°æ—¶è¢«åºŸå¼ƒäº†ï¼Œ è¿™æ—¶å°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å¤åˆ¶äº†ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨copyæ–¹æ³•

- (id)getBlockArray {
      int val = 10;
      return [[NSArray alloc] initWithObjects:
           [^{NSLog(@&quot;haha&quot;);} copy],
           [^{NSLog(@&quot;yaya&quot;);} copy], nil];
}
</code></pre>
<p><strong>PS</strong>ï¼šå½“Blockè¢«å¤åˆ¶åˆ°å †ä¸Šæ—¶ï¼Œå®ƒ <strong>ä½¿ç”¨</strong> çš„__blockå˜é‡ä¹Ÿä¼šä»æ ˆä¸Šè¢«å¤åˆ¶åˆ°å †ä¸Šï¼Œè¿™ä¸ªæ—¶å€™è¯¥å˜é‡ä¼šè¢«Block <strong>æŒæœ‰</strong>ã€‚å¦‚æœè¿˜æœ‰åœ¨æ ˆä¸Šçš„å…¶ä»–Blockä½¿ç”¨blockå˜é‡çš„è¯ï¼Œblockå˜é‡è¿˜ä¼šä¿ç•™åœ¨æ ˆä¸Šï¼Œä½†æ˜¯ä»–çš„ <strong>forwarding</strong>æŒ‡é’ˆå·²ç»æŒ‡å‘å †ä¸Šçš„blockå˜é‡äº†ï¼Œæ‰€ä»¥æ”¹å˜blockå˜é‡çš„è¯ï¼Œå§‹ç»ˆæ”¹å˜çš„éƒ½æ˜¯åŒä¸€ä¸ªç»“æ„ä½“ã€‚</p>
</li>
<li><p>çœ‹çœ‹å¦‚ä½•æˆªè·OCå¯¹è±¡</p>
<pre><code class="objective-c">{
      id array = [[NSMutableArray alloc] init];
      blk = [^(id obj) {
          [array addObject:obj];
      } copy];
}

/* æ³¨æ„ å¯ä»¥ç†è§£æˆ Blocké‡Œé¢çš„arrayç»“æ„ä½“æˆå‘˜å¼ºå¼•ç”¨NSMutableArrayå¯¹è±¡ */
struct __main_block_impl_0 {
      id __strong array; // å¼ºå¼•ç”¨
}
</code></pre>
<p>ä½†å®é™…ä¸Šç»“æ„ä½“å¯¹__strongæ˜¯æ²¡æœ‰æ¦‚å¿µçš„ï¼Œä¸è¿‡æ­¤æ—¶çš„ç»“æ„ä½“ä¼šæ‰‹åŠ¨åŠ ä¸ŠARCçš„æ¦‚å¿µä¸Šå»ã€‚å½“Blockä»æ ˆä¸Šå¤åˆ¶åˆ°å †ä¸Šæ—¶ï¼ŒOCå¯¹è±¡è¢«BlockæŒæœ‰ï¼›å½“Blockä»å †ä¸ŠåºŸå¼ƒæ—¶ï¼ŒOCå¯¹è±¡è¢«é‡Šæ”¾ã€‚æ‰€ä»¥ï¼Œ<strong>å¾ˆé‡è¦çš„ä¸€ç‚¹</strong>ï¼šåªæœ‰Blockè¢«å¤åˆ¶åˆ°å †ä¸Šæ—¶ï¼ŒOCå¯¹è±¡ï¼Œæ‰èƒ½è¢«BlockæŒæœ‰ï¼›ä¹Ÿå°±æ˜¯è¦è°ƒç”¨Blockçš„copyå‡½æ•°ã€‚</p>
</li>
<li><p>__blockç±»å‹çš„OCå¯¹è±¡</p>
<pre><code class="objective-c">__block id obj = [[NSObject alloc] init];

/* ç¼–è¯‘ä¹‹å */
struct __Block_byref_obj_0 {
      void *isa;
      __Block_byref_obj_0 *__forwarding;
      int __flags;
      int __size;

      void (*__Block_byref_id_object_copy)(void*, void*); // ç”¨æ¥ä½¿BlockæŒæœ‰å¯¹è±¡
      void (*__Block_byref_id_object_dispose)(void*); // ç”¨æ¥ä½¿Blocké‡Šæ”¾å¯¹è±¡

      __strong id obj;
}
</code></pre>
<p>æ‰€ä»¥__blockç±»å‹çš„OCå¯¹è±¡ä¹Ÿæ˜¯è®²OCå¯¹è±¡å°è£…æˆä¸€ä¸ªç»“æ„ä½“ï¼Œå’Œä¹‹å‰çš„blockç±»å‹çš„è‡ªåŠ¨å˜é‡ä¸€æ ·ï¼Œåªä¸è¿‡æ·»åŠ äº†retainå’Œreleaseçš„æ¦‚å¿µè€Œå·²ã€‚</p>
<p><strong>PS</strong>ï¼šå¦‚æœå¯¹è±¡æ˜¯weakç±»å‹çš„ï¼Œå’Œä¸Šä¸€ç¯‡é‡Œé¢åˆ†æweakå’Œstrongçš„ä¸€æ ·ã€‚Blockä¹Ÿåªæ˜¯å«æœ‰ä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆè€Œå·²ï¼Œå¦‚æœè¯¥æŒ‡é’ˆä¸ºweakï¼Œé‚£ä¹ˆè¯¥ç½®æˆnilï¼Œè¿˜æ˜¯è¦ç½®æˆnilã€‚</p>
</li>
<li><p>çœ‹çœ‹ä½¿ç”¨Blockçš„ä¸€ä¸ªå¸¸è§é—®é¢˜ï¼š<strong>å¾ªç¯å¼•ç”¨</strong></p>
<p>æœ€å¸¸è§çš„å°±æ˜¯åœ¨Blockä¸­ä½¿ç”¨selfï¼Œè€Œè¿™ä¸ªBlockè¿˜æ˜¯selfå¯¹è±¡çš„ä¸€ä¸ªå˜é‡ã€‚é‚£ä¹ˆå¯¹è±¡æŒæœ‰Blockï¼ŒBlockåˆæŒæœ‰å¯¹è±¡ã€‚å¾ªç¯å¼•ç”¨ã€‚æ‰€ä»¥åœ¨Blockä¸­ä½¿ç”¨selfç»å¸¸éœ€è¦ä½¿ç”¨weakselfã€‚</p>
</li>
</ol>
]]></content>
      
        <categories>
            
            <category> è¯»ä¹¦ç¬”è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç† - è‡ªåŠ¨å¼•ç”¨è®¡æ•°]]></title>
      <url>/2016/07/19/OC-ARC-GCD-reading-note-one/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç† è¯»ä¹¦ç¬”è®°ï¼ˆä¸€ï¼‰ <strong>è‡ªåŠ¨å¼•ç”¨è®¡æ•°</strong></p>
<a id="more"></a>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="å†…å­˜ç®¡ç†-å¼•ç”¨è®¡æ•°"><a href="#å†…å­˜ç®¡ç†-å¼•ç”¨è®¡æ•°" class="headerlink" title="å†…å­˜ç®¡ç†/å¼•ç”¨è®¡æ•°"></a>å†…å­˜ç®¡ç†/å¼•ç”¨è®¡æ•°</h3><ol>
<li><p>ä½¿ç”¨åŠå…¬å®¤çš„ç…§æ˜ç¯æ¥åšæ¯”å–»ï¼Œå¯¹è±¡ç›¸å½“äºç…§æ˜ç¯ï¼Œä½†æ˜¯ä¼šæœ‰è®¸å¤šäººéœ€è¦è¿™ä¸ªç…§æ˜ç¯ï¼Œä¹Ÿå°±æ˜¯æŒæœ‰å¯¹è±¡ã€‚åªè¦æœ‰äººæŒæœ‰è¿™ä¸ªå¯¹è±¡ï¼Œå°±ä¸èƒ½é‡Šæ”¾å¯¹è±¡ï¼›è‹¥æ²¡äººåœ¨éœ€è¦å¯¹è±¡ï¼Œå°±é‡Šæ”¾å¯¹è±¡ã€‚</p>
</li>
<li><p>ä¾‹å¦‚ï¼ša = [class new];  b = a; é‚£ä¹ˆaç”Ÿæˆå¯¹è±¡æ—¶æŒæœ‰å¯¹è±¡ï¼Œbä¹ŸæŒæœ‰å¯¹è±¡ã€‚åªæœ‰å½“aå’Œbéƒ½ä¸æŒæœ‰å¯¹è±¡æ—¶ï¼Œæ‰èƒ½é‡Šæ”¾å¯¹è±¡ã€‚</p>
</li>
<li><p>å¯¹äºå¯¹è±¡ï¼Œæœ‰4ä¸ªå…³é”®è¯ã€‚<strong>ç”Ÿæˆ</strong>ï¼Œ<strong>æŒæœ‰</strong>ï¼Œ<strong>é‡Šæ”¾</strong>å’Œ<strong>åºŸå¼ƒ</strong>ã€‚</p>
</li>
<li><p>çœ‹çœ‹å¯¹åº”çš„æ“ä½œï¼šï¼ˆä»¥ä¸‹çš„æ–¹æ³•å‡æ˜¯<strong>NSObject</strong>ç±»çš„æ–¹æ³•ï¼‰</p>
<ol>
<li>ä½¿ç”¨<code>alloc/new/copy/mutableCopy</code>å¼€å¤´çš„æ–¹æ³•<strong>ç”Ÿæˆ</strong>å¹¶<strong>æŒæœ‰</strong>å¯¹è±¡</li>
<li><code>retain</code>æ–¹æ³•<strong>æŒæœ‰</strong>å¯¹è±¡</li>
<li><code>release</code>æ–¹æ³•<strong>é‡Šæ”¾</strong>å¯¹è±¡</li>
<li><code>dealloc</code>æ–¹æ³•<strong>åºŸå¼ƒ</strong>å¯¹è±¡</li>
</ol>
</li>
<li><p>è‡ªå·±ç”Ÿæˆçš„å¯¹è±¡è‡ªå·±æŒæœ‰</p>
<pre><code class="objective-c">id obj = [[NSObject alloc] new]; // allocæ–¹æ³•ç”Ÿæˆå¹¶æŒæœ‰å¯¹è±¡
// or
id obj = [NSObject new]; // new å’Œ alloc + init ä¸€æ ·
</code></pre>
<p>å¦å¤–<code>copy</code>å’Œ<code>mutableCopy</code>ä¹Ÿæ˜¯ç”Ÿæˆå¯¹è±¡çš„å‰¯æœ¬ï¼Œå¹¶æŒæœ‰ã€‚</p>
</li>
<li><p>éè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰</p>
<pre><code class="objective-c">id obj = [NSMutableArray array]; // å¯¹è±¡å­˜åœ¨äº†ï¼Œä½†æ˜¯objå¯¹è±¡ä¸æŒæœ‰å¯¹è±¡
[obj retain]; // ç°åœ¨objå·²ç»æŒæœ‰å¯¹è±¡äº†
</code></pre>
</li>
<li><p>ä¸åœ¨éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾</p>
<pre><code class="objective-c">id obj = [NSObject new]; // objæŒæœ‰å¯¹è±¡
[obj release]; // objä¸å†éœ€è¦å¯¹è±¡æ—¶ï¼Œé‡Šæ”¾å¯¹å¯¹è±¡ã€‚ å¯¹è±¡é‡Šæ”¾åå°±ä¸èƒ½è¢«è®¿é—®åˆ°äº†ã€‚
</code></pre>
<ol>
<li>ä¸æŒæœ‰å¯ä»¥è¿™æ ·ç†è§£ï¼šå¯ä»¥ä½¿ç”¨å¯¹è±¡ï¼Œä½†æ˜¯æ²¡æœ‰å¼ºè¡Œå ç”¨å¯¹è±¡ã€‚</li>
<li>æ— æ³•é‡Šæ”¾éè‡ªå·±æŒæœ‰çš„å¯¹è±¡</li>
</ol>
<pre><code class="objective-c">id obj = [NSMutableArray array]; // objè‡ªå·±ä¸æŒæœ‰å¯¹è±¡
[obj release]; // ç¨‹åºå´©æºƒï¼Œå› ä¸ºä¸èƒ½é‡Šæ”¾ä¸æ˜¯è‡ªå·±æŒæœ‰çš„å¯¹è±¡
</code></pre>
</li>
<li><p>æ¥çœ‹çœ‹å¦‚ä½•å®ç°alloc/retain/release/deallocæ–¹æ³• ï¼ˆ<strong>æ³¨æ„ï¼šè¿™éƒ¨åˆ†å¯¹äºç†è§£æœ€ä¸ºå…³é”®</strong>ï¼‰ã€‚</p>
<ol>
<li><p>allocçš„å®ç°</p>
<pre><code class="objective-c">   struct obj_layout {
         NSUInteger retained;
   }

+ (id)alloc {
      int size = sizeof(struct obj_layout) + å¯¹è±¡å¤§å°;
      struct obj_layout *p = (struct obj_layout *)calloc(1, size); // åˆ†é…ä¸€ä¸ªé•¿åº¦ä¸ºsizeçš„è¿ç»­å†…å­˜ç©ºé—´ pä¸ºè¯¥å†…å­˜ç©ºé—´çš„ç¬¬ä¸€ä¸ªåœ°å€ã€‚è¿™ä¸ªå†…å­˜ç©ºé—´çš„å†…å­˜è®¡é‡å•ä½ä¸ºä¸€ä¸ªobj_layout struct
      return (id)(p + 1); // è¯¥å†…å­˜ç©ºé—´çš„ç¬¬ä¸€ä¸ªå†…å­˜å•ä½æ”¾çš„æ˜¯obj_layoutè¿™ä¸ªç»“æ„ä½“ï¼Œä¹‹åæ˜¯å¯¹è±¡çš„å†…å­˜ç©ºé—´ï¼Œå·²ç»è¢«ç½®ä¸º0ã€‚è¿”å›çš„æ˜¯æŒ‡å‘å¯¹è±¡å†…å­˜ç©ºé—´çš„é¦–åœ°å€çš„æŒ‡é’ˆã€‚
}
</code></pre>
</li>
<li><p>çœ‹çœ‹retainCountçš„å®ç°ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥æŸ¥çœ‹å¯¹è±¡çš„å¼•ç”¨è®¡æ•°</p>
<pre><code class="objective-c">- (NSUInteger)retainCount {
      return ((struct obj_layout *) self)[-1].retained + 1;
}
// å› ä¸ºselfæŒ‡å‘çš„æ˜¯å¯¹è±¡å†…å­˜çš„é¦–åœ°å€ã€‚å°†è¿™ä¸ªåœ°å€çœ‹æˆobj_layout,ä¹Ÿå°±æ˜¯åœ°å€è®¡æ•°ä»¥obj_layoutç»“æ„ä½“çš„å†…å­˜å¤§å°ä¸ºå•ä½ã€‚-1å°±æŒ‡å‘äº†å¯¹è±¡ä¸Šæ–¹å­˜å‚¨obj_layoutç»“æ„ä½“çš„é¦–åœ°å€ã€‚è¿™æ ·å°±å¯ä»¥å–å‡ºretainedã€‚å› ä¸ºretainedé»˜è®¤æ˜¯0ï¼Œæ‰€ä»¥éœ€è¦åŠ 1ã€‚
</code></pre>
</li>
<li><p>æ ¹æ®2ï¼Œå¯ä»¥æ–¹ä¾¿æ¨å‡º<strong>retain</strong>æ–¹æ³•æ˜¯å°†retainedå€¼åŠ ä¸€ï¼›è€Œ<strong>release</strong>æ–¹æ³•æ˜¯å°†retainedå€¼å‡ä¸€ã€‚æ³¨æ„å½“releaseæ—¶å‘ç°retainedå€¼ç­‰äº0ï¼Œé‚£ä¹ˆå°±ä¸æ‰§è¡Œå‡ä¸€æ“ä½œäº†ï¼Œç›´æ¥æ‰§è¡Œdeallocæ–¹æ³•ï¼Œå› ä¸ºå·²ç»æ²¡æœ‰äººåªæœ‰è¯¥å¯¹è±¡äº†ã€‚</p>
</li>
<li><p>deallocçš„å®ç°</p>
<pre><code class="objective-c">- (void)dealloc {
      struct obj_layout *o = &amp;((struct obj_layout *) self)[-1];
      free(o); // é‡Šæ”¾ä¹‹å‰ç”±callocåˆ†é…çš„å†…å­˜ç©ºé—´
}
</code></pre>
</li>
</ol>
</li>
</ol>
<ol>
<li><p><strong>autorelease</strong>ï¼š</p>
<p>å½“å˜é‡è°ƒç”¨å¯¹è±¡çš„autoreleaseæ–¹æ³•æ—¶ï¼Œè¯´æ˜ä»–å·²ç»ä¸æŒæœ‰è¿™ä¸ªå¯¹è±¡äº†ã€‚ä½†æ˜¯è¿™ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰è¢«é‡Š        æ”¾ï¼Œè¿˜æ˜¯å¯ä»¥è¢«å–åˆ°ã€‚</p>
<p>autoreleaseçš„ä½¿ç”¨æ–¹æ³•ï¼š</p>
<ol>
<li>ç”Ÿæˆå¹¶æŒæœ‰NSAutoreleasePoolå¯¹è±¡</li>
<li>è°ƒç”¨å·²åˆ†é…å¯¹è±¡çš„autoreleaseæ–¹æ³•</li>
<li>åºŸå¼ƒNSAutoreleasePoolå¯¹è±¡</li>
</ol>
<p>NSAutoreleasePoolå¯¹è±¡ç”Ÿæˆå’ŒåºŸå¼ƒçš„è¿™ä¸ªæœŸé—´ï¼Œç›¸å½“äºå¯¹è±¡çš„ä½œç”¨åŸŸã€‚å½“åºŸå¼ƒNSAutoreleasePoolå¯¹è±¡æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨å¯¹è±¡çš„releaseæ–¹æ³•ã€‚æ¥çœ‹çœ‹ä»£ç ï¼š</p>
<pre><code class="objective-c">NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
id obj = [[NSObject alloc] init];
[obj autorelease];
[pool drain]; // è¿™ä¸ªæ—¶å€™æ‰ä¼šreleaseå¯¹è±¡
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šä½¿ç”¨autoreleaseæ—¶ï¼Œå¤ªå¤šçš„éœ€è¦autoreleaseçš„å¯¹è±¡å¯èƒ½ç”±äºæ²¡æœ‰åŠæ—¶çš„releaseï¼Œä¼šå¯¼è‡´å†…å­˜ä¸è¶³ã€‚<strong>PS</strong>ï¼šå…¶å®è¿˜æ˜¯åœ¨deallocçš„æ—¶å€™é‡Šæ”¾å†…å­˜ï¼Œä½†æ˜¯å› ä¸ºåœ¨releaseæ—¶ï¼Œè‹¥æ²¡æœ‰å˜é‡å¼•ç”¨å¯¹è±¡çš„è¯ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨å¯¹è±¡çš„deallocæ–¹æ³•ï¼Œæ‰€ä»¥releaseä¹Ÿå¯ä»¥è¯´æ˜¯é‡Šæ”¾å†…å­˜å§ã€‚</p>
<p>çœ‹çœ‹ä¸‹é¢ä»£ç ï¼š</p>
<pre><code class="objective-c">id array = [NSMutableArray arrayWithCapacity:1]; // arrayä¸æŒæœ‰å¯¹è±¡
id array = [[NSMutableArray alloc] initWithCapacity:1] autorelease]; // arrayä¹Ÿä¸æŒæœ‰å¯¹è±¡
</code></pre>
<p>ä¸Šé¢ä¸¤è¡Œä»£ç æ˜¯ç­‰ä»·çš„ã€‚</p>
</li>
<li><p>autoreleaseçš„å®ç°</p>
</li>
</ol>
<pre><code class="objective-c">   - (id)autorelease {
         [NSAutoreleasePool addObject:self];
   }

   + (void)addObject:(id)anObj {
         NSAutoreleasePool *pool = å–å¾—æ­£åœ¨ä½¿ç”¨çš„NSAutoreleasePoolå¯¹è±¡;
         if (pool != nil) {
             [pool addObject:anObj];
       } else {
             NSLog(@&quot;ä¸å­˜åœ¨NSAutoreleasePool&quot;);
       }
   }

   - (void)addObject:(id)anObj {
         [array addObject:anObj]; // NSAutoreleasePoolå¯¹è±¡é‡Œé¢æœ‰ä¸€ä¸ªarrayæ•°ç»„ï¼Œç”¨æ¥å­˜å‚¨éœ€è¦autoreleaseçš„å¯¹è±¡
   }

   - (void)drain {
         [self dealloc]; // åºŸå¼ƒNSAutoreleasePoolå¯¹è±¡
   }

   - (void)dealloc {
         for (id obj in array) {
             [obj release]; // é‡Šæ”¾ä¹‹å‰æ³¨å†Œåˆ°NSAutoreleasePoolçš„å¯¹è±¡
       }
       [array release]; // é‡Šæ”¾arrayæ•°ç»„
   }
</code></pre>
<ol>
<li>æ³¨æ„ä¸èƒ½autorelease NSAutoreleasePoolå¯¹è±¡</li>
</ol>
<h3 id="ARCè§„åˆ™"><a href="#ARCè§„åˆ™" class="headerlink" title="ARCè§„åˆ™"></a>ARCè§„åˆ™</h3><ol>
<li><p>å¼•ç”¨è®¡æ•°å¼å†…å­˜ç®¡ç†çš„æœ¬è´¨å¹¶æ²¡æœ‰æ”¹å˜ï¼Œåªæ˜¯ARCè‡ªåŠ¨å¸®æˆ‘ä»¬å¤„ç†â€œå¼•ç”¨è®¡æ•°â€çš„ç›¸å…³éƒ¨åˆ†ã€‚</p>
</li>
<li><p>ç¼–è¯‘å•ä½å¯ä»¥é€‰æ‹©ARCæ˜¯å¦æœ‰æ•ˆã€‚ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥ä»¥æ··åˆARCå’ŒéARCçš„æ–¹å¼è¿›è¡Œç¼–è¯‘ã€‚</p>
</li>
<li><p><strong>NSObject *</strong>æ˜¯æŒ‡å‘NSObjectç±»çš„æŒ‡é’ˆã€‚<strong>id</strong>ç›¸å½“äºCè¯­è¨€ä¸­çš„<strong>void *</strong>ã€‚</p>
</li>
<li><p>åœ¨ARCä¸‹ï¼Œç±»å‹å¿…é¡»é™„ä¸Šæ‰€æœ‰æƒä¿®é¥°ç¬¦ï¼Œæœ‰ä¸€ä¸‹å‡ ç§ç±»å‹</p>
<ol>
<li>__strong</li>
<li>__weak</li>
<li>__unsafe_unretained</li>
<li>__autoreleasing</li>
</ol>
</li>
<li><p><strong>__strong</strong>ä¿®é¥°ç¬¦ï¼šæ˜¯idç±»å‹å’Œæ‰€æœ‰å¯¹è±¡ç±»å‹é»˜è®¤çš„æ‰€æœ‰æƒä¿®é¥°ç¬¦ã€‚</p>
<pre><code class="objective-c">id obj = [[NSObject alloc] init]; 
// ä¸Šé¢å®é™…çš„ä»£ç å¦‚ä¸‹
id __strong obj = [[NSObject alloc] init];
</code></pre>
<p>å†æ¥çœ‹çœ‹ä¸€ä¸‹ä»£ç ï¼š</p>
<pre><code class="objective-c">/* ARCä¸‹ */
{
      id __strong obj = [[NSObject alloc] init];
} // å‡ºäº†ä½œç”¨åŸŸï¼Œobjå¯¹è±¡è‡ªåŠ¨è¢«é‡Šæ”¾

/* éARCä¸‹çš„ç­‰ä»·ä»£ç  */
{
      id obj = [[NSObject alloc] init];
      [obj release]; // å‡ºä½œç”¨åŸŸä¹‹å‰è¦è®°å¾—é‡Šæ”¾objå¯¹è±¡ï¼Œä¸ç„¶ä¼šå¯¼è‡´å†…å­˜æ³„æ¼
}
</code></pre>
<p>__strongä¿®é¥°ç¬¦è¡¨ç¤ºå¯¹å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚åœ¨è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œå¼ºå¼•ç”¨å˜é‡è¢«åºŸå¼ƒ(<strong>objæŒ‡é’ˆè¢«åºŸå¼ƒ</strong>)ï¼Œä¸æ­¤åŒæ—¶å®ƒå¼•ç”¨çš„å¯¹è±¡ä¹Ÿä¼šè¢«é‡Šæ”¾(<strong>å¯¹è±¡è¢«é‡Šæ”¾</strong>)ã€‚</p>
<p>çœ‹çœ‹å¯¹äºéè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼š</p>
<pre><code class="objective-c">/* ARCä¸‹ */
{
      id __strong obj = [NSMutableArray array]; // è¿™é‡Œçš„objæ˜¯æŒæœ‰å¯¹è±¡çš„
      // do something here
}

/* éARCä¸‹çš„ç­‰ä»·ä»£ç  */
{
      id obj = [NSMutableArray array];
      [obj retain];  // objè¦æ‰‹åŠ¨æŒæœ‰
      // do something here

      [obj release];  // å‡ºä½œç”¨åŸŸæ—¶è¦æ‰‹åŠ¨é‡Šæ”¾
}
</code></pre>
</li>
<li><p><strong>__weak</strong>ä¿®é¥°ç¬¦ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢ç›¸äº’å¼•ç”¨ã€‚__weakæŒ‡çš„æ˜¯å¼±å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯å˜é‡ä¸èƒ½æŒæœ‰å¯¹è±¡ã€‚</p>
<pre><code class="objective-c">{
      id __strong obj0 = [[NSObject alloc] init]; // obj0å¼ºå¼•ç”¨å¯¹è±¡ï¼ŒæŒæœ‰
      id __weak obj1 = obj0; // obj1å¼±å¼•ç”¨å¯¹è±¡ï¼Œä¸æŒæœ‰
}
</code></pre>
<p>æ‰€ä»¥åœ¨å‡ºä½œç”¨åŸŸæ—¶obj0åºŸå¼ƒï¼Œä¸åœ¨æœ‰å˜é‡æŒæœ‰å¯¹è±¡ï¼Œå¯¹è±¡è¢«é‡Šæ”¾ã€‚å¯ä»¥é€šè¿‡æ£€æŸ¥é™„æœ‰__weakä¿®é¥°ç¬¦çš„å˜é‡æ˜¯å¦ä¸ºnilï¼Œæ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»è¢«é‡Šæ”¾ã€‚</p>
</li>
<li><p><strong>__unsafe_unretained</strong>ä½œç”¨å’Œ__weakä¸€æ ·ï¼Œä½†æ˜¯å¦‚åå­—æ‰€è¨€ï¼Œå®ƒæ˜¯ä¸å®‰å…¨çš„ã€‚å½“è¿™ç§å˜é‡æŒ‡å‘çš„å¯¹è±¡è¢«é‡Šæ”¾æ—¶ï¼Œweakå‹çš„å˜é‡å°±è¢«ç½®æˆnil(æ­£ç¡®çš„åšæ³•)ï¼Œä½†æ˜¯unsafeçš„å˜é‡å¯èƒ½è¿˜æŒ‡å‘æŸä¸ªåœ°å€(ä¸å®‰å…¨çš„ï¼Œå› ä¸ºé‚£ä¸ªåœ°å€çš„å¯¹è±¡å·²ç»è¢«é‡Šæ”¾äº†)ã€‚</p>
</li>
<li><p>æ¥çœ‹çœ‹autoreleaseï¼Œå…ˆçœ‹æ®µä»£ç ï¼šï¼ˆ<strong>PS</strong>ï¼šæœ‰ç‚¹è¿·ç³Šï¼‰</p>
<pre><code class="objective-c">/* ARCæ— æ•ˆ */
NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
id obj = [[NSObject alloc] init];
[obj autorelease];
[pool drain];

/* ARCæœ‰æ•ˆ */
@autoreleasepool {
      id __autoreleasing obj = [[NSObject alloc] init];
}
</code></pre>
<p>ä½†æ˜¯é€šå¸¸ä¸éœ€è¦å†@autoreleaseé‡Œé¢æ˜¾å¼çš„ä½¿ç”¨__autoreleasingä¿®é¥°ç¬¦ã€‚</p>
</li>
<li><p>åœ¨ARCæœ‰æ•ˆæ—¶æœ‰ä»¥ä¸‹è§„å®šï¼š</p>
<ol>
<li>ä¸èƒ½ä½¿ç”¨retain/release/retainCount/autoreleaseæ–¹æ³•</li>
<li>ä¸èƒ½ä½¿ç”¨NSAllocateObject/NSDeallocateObject</li>
<li>è¦éµå¾ªæ–¹æ³•çš„å‘½åè§„åˆ™ã€‚alloc/new/copy/mutableCopyå¼€å¤´çš„æ–¹æ³•ï¼Œè¦è¿”å›è‡ªå·±ç”Ÿæˆå¹¶æŒæœ‰çš„å¯¹è±¡ã€‚initå¼€å¤´çš„æ–¹æ³•ï¼ŒåŸºæœ¬åªæ˜¯å¯¹allocæ–¹æ³•è¿”å›çš„å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–å¹¶è¿”å›è¯¥å¯¹è±¡ã€‚</li>
<li>ä¸è¦æ˜¾å¼è°ƒç”¨deallocæ–¹æ³•ã€‚å› ä¸ºåœ¨å¯¹è±¡éœ€è¦åºŸå¼ƒæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ã€‚åœ¨ARCæ— æ•ˆæ—¶ï¼Œè¦åœ¨deallocæ–¹æ³•é‡Œé¢è°ƒç”¨<code>[super dealloc];</code>ã€‚ä½†æ˜¯åœ¨ARCæœ‰æ•ˆæ—¶ï¼Œä¸éœ€è¦è¿™æ ·è°ƒç”¨ï¼ŒARCä¼šè‡ªåŠ¨å¸®ä½ å¤„ç†ã€‚</li>
<li>ä½¿ç”¨@autoreleasepoolè€Œä¸æ˜¯NSAutoreleasePool</li>
<li>ç»“æ„ä½“ä¸­çš„æˆå‘˜å˜é‡ä¸èƒ½æ˜¯Objective-Cå¯¹è±¡</li>
<li>id å’Œ void* ä¸æ‡‚ï¼Œä»€ä¹ˆä¸œè¥¿ï¼Ÿè¿™é‡Œè¿˜å’Œ__bridgeæœ‰ç‚¹å…³ç³»</li>
</ol>
</li>
<li><p>åœ¨ARCæœ‰æ•ˆæ—¶ï¼Œå˜é‡æœ‰å„ç§ä¿®é¥°ç¬¦ã€‚å½“ç„¶å±æ€§ä¹Ÿä¼šæœ‰å„ç§ä¿®é¥°ç¬¦ã€‚ </p>
<ol>
<li>assign  == __unsafe_unretained</li>
<li>copy == __strong ï¼ˆä½†æ˜¯èµ‹å€¼çš„æ˜¯è¢«å¤åˆ¶çš„å¯¹è±¡ï¼‰</li>
<li>retain == __strong</li>
<li>strong == __strong</li>
<li>unsafe_unretained == __unsafe_unretained</li>
<li>weak == __weak</li>
</ol>
</li>
<li><p>æ•°ç»„1.3.6 ä¸æ‡‚</p>
</li>
</ol>
<h3 id="ARCçš„å®ç°"><a href="#ARCçš„å®ç°" class="headerlink" title="ARCçš„å®ç°"></a>ARCçš„å®ç°</h3><ol>
<li><p>ARCç”±ä¸‹é¢ä¸¤è€…æ¥å®ç°</p>
<ol>
<li>clangï¼ˆLLVMç¼–è¯‘å™¨ï¼‰3.0ä»¥ä¸Š</li>
<li>objc4 Objective-Cè¿è¡Œæ—¶åº“ 493.9ä»¥ä¸Š ï¼ˆä¸»è¦æ˜¯ runtime/objc-arr.mm)</li>
</ol>
</li>
<li><p><strong>__strong</strong>çš„å®ç°</p>
<pre><code class="objective-c">{
      id __strong obj = [[NSObject alloc] init];
      // do something
}

/* ç»è¿‡ç¼–è¯‘ä¹‹å */
id obj = objc_msgSend(NSObject, @selector(alloc)); // æ‰§è¡Œallocæ–¹æ³•ï¼Œobjå˜é‡æŒæœ‰å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å¼ºå¼•ç”¨
objc_msgSend(obj, @selector(init)); // æ‰§è¡Œinitæ–¹æ³•ï¼Œè¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæ— å…³ARC
// do something
objc_release(obj); // åœ¨å˜é‡å‡ºä½œç”¨åŸŸæ—¶ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡
</code></pre>
<pre><code class="objective-c">{
      id __strong obj = [NSMutableArray array];  // objæ˜¯æŒæœ‰å¯¹è±¡çš„
      // do something
}

/* ç»è¿‡ç¼–è¯‘ä¹‹å */
id obj objc_msgSend(NSMutableArray, @selector(array)); // æ‰§è¡Œarrayæ–¹æ³•ï¼Œæ­¤æ—¶å¯¹è±¡â€œç…§ç†æ¥è¯´â€æ˜¯å·²ç»è¢«æ³¨å†Œåˆ°NSAutoreleasePoolé‡Œé¢ï¼Œobjå˜é‡æ­¤æ—¶æ˜¯ä¸æŒæœ‰å¯¹è±¡çš„
objc_retainAutoreleasedReturnValue(obj); // ç¼–è¯‘å™¨å¸®objæŒæœ‰æ³¨å†Œåˆ°NSAutoreleasePoolä¸­çš„å˜é‡
// do something
objc_release(obj); // å˜é‡è¦å‡ºä½œç”¨åŸŸäº†ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡

/* arrayå‡½æ•°å®è´¨ */
+ (id)array {
      return [[NSMutableArray alloc] init];
}

/* ç»è¿‡ç¼–è¯‘ä¹‹å */
+ (id)array {
      id obj = objc_msgSend(NSMutableArray, @selector(alloc)); // ç”Ÿæˆå¯¹è±¡ï¼ŒobjæŒæœ‰
      objc_msgSend(obj, @selector(init)); // åˆå§‹åŒ–ï¼Œæ— å…³ARC
      return objc_autoreleaseReturnValue(obj); // è®²é“ç†ï¼Œè¿™ä¸€æ­¥æ˜¯è¦å°†å¯¹è±¡æ³¨å†Œåˆ°NSAutoreleasePoolä¸­ï¼Œobjä¸å†æŒæœ‰å¯¹è±¡(å¯ä»¥è¯´æ˜¯objå°†å¯¹è±¡æŒæœ‰æƒè½¬äº¤ç»™äº†NSAutoreleasePool)
}
</code></pre>
<p>æŒ‰ä¸Šé¢çš„è¯´æ³•æ¥çœ‹ï¼Œæœ€ç»ˆæŒæœ‰arrayå¯¹è±¡çš„æœ‰2ä¸ªï¼šä¸€ä¸ªæ˜¯NSAutoreleasePoolï¼Œä¸€ä¸ªæ˜¯objã€‚ä½†æ˜¯å…¶å®æ˜¯åšäº†ä¼˜åŒ–çš„ã€‚<code>objc_autoreleaseReturnValue(obj);</code>è¿™ä¸ªå‡½æ•°è§‚å¯Ÿåˆ°ç´§æ¥ç€å®ƒè‡ªå·±è°ƒç”¨çš„å‡½æ•°å¦‚æœæ˜¯<code>objc_retainAutoreleasedReturnValue(obj);</code>çš„è¯ï¼Œå°±ä¸ä¼šå°†å¯¹è±¡æ³¨å†Œåˆ°NSAutoreleasePoolï¼Œç›´æ¥å°†å¯¹è±¡ç»™objè®©å®ƒæŒæœ‰å°±è¡Œäº†ã€‚è¿™ä¸ªä¼˜åŒ–å°±æ˜¯å› ä¸º__strongä¿®é¥°ç¬¦è¦æŒæœ‰å¯¹è±¡ï¼Œä¸å…¶å…ˆå°†å¯¹è±¡æ³¨å†Œåˆ°NSAutoreleasePoolï¼Œå†ä»NSAutoreleasePoolä¸­æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡ç»™objæŒæœ‰ä¸€éï¼›è¿˜ä¸å¦‚ç›´æ¥è·³è¿‡æ³¨å†Œï¼Œç›´æ¥è®©objæŒæœ‰å¯¹è±¡ã€‚è¯´åˆ°åº•ï¼Œä½¿ç”¨NSAutoreleasePoolçš„åŸå› å°±æ˜¯æ€•æ²¡æœ‰å˜é‡æŒæœ‰å¯¹è±¡ï¼Œé‚£ä¹ˆå°±å–ä¸åˆ°è¿™ä¸ªå¯¹è±¡äº†ï¼Œæ‰€ä»¥è®©NSAutoreleasePoolæš‚æ—¶æŒæœ‰å¯¹è±¡ã€‚</p>
<p><strong>PS</strong>ï¼šè®©NSAutoreleasePoolæš‚æ—¶æŒæœ‰å¯¹è±¡è¿™ä¸ªè¯´æ³•ä¸çŸ¥é“é ä¸é è°±</p>
<p>todo add a picture</p>
</li>
<li><p><strong>__weak</strong>çš„å®ç°</p>
<pre><code class="objective-c">{
      id __weak obj1 = obj; // è¿™é‡Œobjæ˜¯å¼ºå¼•ç”¨
      // do something
}

/* ç¼–è¯‘ä¹‹å */
id = obj1;
obj1 = 0;
objc_storeWeak(&amp;obj1, obj);
// do something
objc_storeWeak(&amp;obj1, 0);
</code></pre>
<p><code>objc_storeWeak(&amp;obj1, obj);</code>å‡½æ•°å°†objæŒ‡å‘å¯¹è±¡çš„åœ°å€ä½œä¸ºkeyï¼Œå°†obj1å˜é‡çš„åœ°å€ä½œä¸ºvalueï¼Œæ³¨å†Œåˆ°weakè¡¨ä¸­ï¼Œå¹¶å°†obj1æŒ‡å‘å¯¹è±¡ã€‚å› ä¸ºä¸€ä¸ªå¯¹è±¡å¯ä»¥èµ‹ç»™å¤šä¸ªå€¼ï¼Œæ‰€ä»¥ä¸€ä¸ªkeyå¯ä»¥å¯¹åº”å¤šä¸ªå€¼ã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°æ˜¯0çš„è¯ï¼Œå°±å°†obj1è¿™ä¸ªå˜é‡çš„åœ°å€ä»weakè¡¨ä¸­åˆ é™¤ï¼ˆåˆ é™¤valueä¸ºobj1åœ°å€çš„é‚£æ¡è®°å½•ï¼ŒåºŸå¼ƒobj1å¯¹è±¡ï¼‰ã€‚<strong>PS</strong>ï¼šè¿™ä¹ˆè¯´çš„è¯ï¼Œå…¶å®å°†obj1å˜é‡çš„åœ°å€å½“æˆkeyï¼Œæ›´æ–¹ä¾¿ç†è§£ã€‚</p>
<p><strong>PS</strong>ï¼šæˆ‘ä»¬æ¥çœ‹çœ‹å¦å¤–ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯é‡Šæ”¾å¯¹è±¡æ—¶ï¼Œä½†æ˜¯weakå˜é‡è¿˜å­˜åœ¨ã€‚è¿™ä¸ªæ—¶å€™ä¼šå°†weakå˜é‡ç½®ä¸ºnilã€‚è¿™æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>
<ol>
<li>å…ˆå°†weakè¡¨ä¸­keyä¸ºè¿™ä¸ªå¯¹è±¡çš„åœ°å€çš„è®°å½•æ‰¾å‡ºæ¥</li>
<li>å°†è¯¥åœ°å€å¯¹åº”çš„æ‰€æœ‰çš„weakå˜é‡æ‰¾å‡ºæ¥ï¼Œå°†ä»–ä»¬ç½®ä¸ºnil</li>
<li>åˆ é™¤è¿™æ¡keyä¸ºå¯¹è±¡åœ°å€çš„è®°å½•</li>
</ol>
<p>ç”±ä¸Šé¢è¯´æ˜å¯ä»¥çŸ¥é“ï¼Œå¤§é‡ä½¿ç”¨weakå˜é‡ä¹Ÿä¼šæ¶ˆè€—ç›¸åº”çš„CPUèµ„æºï¼Œæ‰€ä»¥åªåœ¨éœ€è¦é¿å…å¾ªç¯å¼•ç”¨æ—¶ä½¿ç”¨ã€‚</p>
</li>
<li><p>çœ‹çœ‹weakå’Œunsafe_unretainedçš„åŒºåˆ«</p>
<pre><code class="objective-c">{
      id __weak obj = [[NSObject alloc] init];
      // do something
}
/* ç¼–è¯‘ä¹‹å */
id = obj;
id tmp = objc_msgSend(NSObject, @selector(alloc));
objc_msgSend(tmp, @selector(init));
objc_initWeak(&amp;obj, tmp);  // åœ¨weakè¡¨ä¸­æ’å…¥å¯¹è±¡ï¼Œå°†objæŒ‡å‘å¯¹è±¡
objc_release(tmp); // é‡Šæ”¾å¯¹è±¡åï¼Œä¸åœ¨æœ‰å˜é‡æŒæœ‰å¯¹è±¡ï¼Œè¿™æ—¶å€™ä¼šå°†objç½®ä¸ºnilã€‚å®‰å…¨
// do something
objc_destroyWeak(&amp;obj); // åˆ é™¤è®°å½•ï¼ˆä¸Šä¸€æ­¥å·²ç»åšäº†ï¼Œè¿™é‡Œå°±ä¸åšäº†ï¼‰ï¼ŒåºŸå¼ƒobjå˜é‡
</code></pre>
<pre><code class="objective-c">{
      id __unsafe_unretained obj = [[NSObject alloc] init];
      // do something
}

/* ç¼–è¯‘ä¹‹å */
id obj = objc_msgSend(NSObject, @selector(alloc));
objc_msgSend(obj, @selector(init));
objc_release(obj); // å› ä¸ºæ²¡æœ‰å˜é‡æŒæœ‰å¯¹è±¡ï¼Œæ‰€ä»¥é‡Šæ”¾å¯¹è±¡ï¼Œä½†æ˜¯objå˜é‡è¿˜æŒ‡å‘äº†åŸå¯¹è±¡ã€‚å±é™©
// do something
</code></pre>
</li>
<li><p>è¿˜æœ‰å°±æ˜¯è¦æ³¨æ„ä½¿ç”¨__weakå˜é‡æ—¶</p>
<pre><code class="objective-c">NSLog(@&quot;%@&quot;, obj); // å‡è®¾è¿™é‡Œçš„objæ˜¯weakå˜é‡
/* ç¼–è¯‘ä¹‹å */
id tmp = objc_loadWeakRetained(&amp;obj);
objc_autorelease(tmp);  // è¿™ä¸¤å¥è¯´çš„æ˜¯å°†objå¼±å¼•ç”¨çš„å¯¹è±¡äº¤ç»™NSAutoreleasePoolæŒæœ‰ï¼Œä»¥ä¿è¯è¿™ä¸ªå¯¹è±¡å¯ä»¥è¢«å–åˆ°ã€‚
NSLog(@&quot;%@&quot;, tmp); // åšæ­£äº‹
</code></pre>
<p>ä¸Šé¢è¯´çš„è¿™ä¸ªæ˜¯ï¼Œå½“ä½¿ç”¨weakå˜é‡çš„æ—¶å€™ï¼Œä¼šå…ˆå°†weakå˜é‡æŒ‡å‘çš„å¯¹è±¡äº¤ç»™NSAutoreleasePoolæŒæœ‰ï¼Œä»¥ä¿è¯è¿™ä¸ªå¯¹è±¡ä¸‡ä¸€è¢«å¼ºå¼•ç”¨å®ƒçš„å˜é‡é‡Šæ”¾çš„æ—¶å€™ï¼Œè¿˜æ˜¯å¯ä»¥å–åˆ°ã€‚ä½†æ˜¯å½“å¤šæ¬¡ä½¿ç”¨weakå˜é‡çš„è¯ï¼Œæœ€å¥½å…ˆå°†weakå˜é‡çš„å¯¹è±¡ç»™ä¸€ä¸ªå˜é‡ï¼Œè®©å®ƒå¼ºå¼•ç”¨ï¼Œè¿™æ ·å°±ä¸ç”¨å¤šæ¬¡å»å’ŒNSAutoreleasePoolæ‰“äº¤é“ï¼Œè€—æ—¶é—´äº†ã€‚</p>
<pre><code class="objective-c">id tmp = obj; // è®©tmpå¼ºå¼•ç”¨å¯¹è±¡ï¼Œè¿™é‡Œä¼šå‘ç”Ÿä¸€æ¬¡å’ŒNSAutoreleasePoolçš„äº¤äº’ï¼Œå› ä¸ºä½¿ç”¨åˆ°äº†objè¿™ä¸ªweakå˜é‡ã€‚è¿™ä¸€æ­¥è¿‡åtmpå’ŒNSAutoreleasePooléƒ½æŒæœ‰å¯¹è±¡
// ä½¿ç”¨tmpåšæ­£äº‹ï¼Œè€Œä¸æ˜¯é¢‘ç¹ä½¿ç”¨obj
</code></pre>
</li>
<li><p><strong>__autoreleasing</strong>çš„å®ç°</p>
<pre><code class="objective-c">@autoreleasepool {
      id __autoreleasing obj = [[NSObject alloc] init];
}

/* ç¼–è¯‘ä¹‹å */
id pool = objc_autoreleasePoolPush();
id obj = objc_msgSend(NSObject, @selector(alloc));
objc_msgSend(obj, @selector(init));
objc_autorelease(obj); // äº¤ç»™NSAutoreleasePoolæŒæœ‰
objc_autoreleasePoolPop(pool); // åºŸé™¤NSAutoreleasePoolï¼Œé‡Šæ”¾å¯¹è±¡
</code></pre>
<p>çœ‹çœ‹å¯¹äºéè‡ªå·±ç”Ÿæˆå¹¶æŒæœ‰çš„å¯¹è±¡</p>
<pre><code class="objective-c">@autoreleasepool {
      id __autoreleasing obj = [NSMutableArray array];
}

/* ç¼–è¯‘ä¹‹å */
id pool = objc_autoreleasePoolPush();
id obj = objc_msgSend(NSMutableAttay, @selector(array)); // ä¸æŒæœ‰
objc_retainAutoreleasedReturnValue(obj); // åˆé‡æ–°æŒæœ‰å¯¹è±¡ã€‚ã€‚ã€‚
objc_autorelease(obj); // åˆäº¤ç»™NSAutoreleasePoolæŒæœ‰
objc_autoreleasePoolPop(pool); // åºŸé™¤NSAutoreleasePoolï¼Œé‡Šæ”¾å¯¹è±¡
</code></pre>
</li>
<li><p><code>uintptr_t _objc_rootRetainCount(id obj);</code>å‡½æ•°å¯ä»¥è·å¾—objå¯¹è±¡å½“å‰çš„å¼•ç”¨è®¡æ•°ï¼Œä¹Ÿå°±æ˜¯æœ‰å¤šå°‘ä¸ªå˜é‡å¼ºå¼•ç”¨è¯¥å¯¹è±¡ã€‚æ³¨æ„æ³¨å†Œåˆ°NSAutoreleasePoolä¸­çš„å¯¹è±¡ä¹Ÿç®—ä¸€æ¬¡å¼•ç”¨è®¡æ•°ã€‚ä¹Ÿå°±æ˜¯å¦‚åŒä¸Šé¢ä¸€ç›´è¯´çš„ï¼Œå¯ä»¥è¯´æ˜¯NSAutoreleasePoolæŒæœ‰å¯¹è±¡ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå‡½æ•°ä¸ä¸€å®šå¯ä¿¡ã€‚ã€‚ã€‚</p>
</li>
</ol>
<h2 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h2><p>å‘•å¿ƒæ²¥è¡€å•Šã€‚çœ‹å¾—è¦åäº†ã€‚ã€‚ã€‚</p>
]]></content>
      
        <categories>
            
            <category> è¯»ä¹¦ç¬”è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS Core Animation - The Performance of a Lifetime]]></title>
      <url>/2016/07/14/iOS-Core-Animation-reading-note-three/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><strong>iOS Core Animation</strong> è¯»ä¹¦ç¬”è®°ï¼ˆä¸‰ï¼‰<strong>The Performance of a Lifetime</strong></p>
<a id="more"></a>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="Tuning-for-Speed"><a href="#Tuning-for-Speed" class="headerlink" title="Tuning for Speed"></a>Tuning for Speed</h3><h4 id="CPU-Vs-GPU"><a href="#CPU-Vs-GPU" class="headerlink" title="CPU Vs GPU"></a>CPU Vs GPU</h4><ol>
<li>å°†å„ä¸ªlayerä»¥åŠlayerçš„åŠ¨ç”»æ¸²æŸ“åˆ°å±å¹•ä¸Šç”±ç³»ç»Ÿæ¥æ§åˆ¶ï¼Œè¿™ä¸ªæ§åˆ¶å™¨ç§°ä¸º<em>render server</em>ã€‚</li>
<li>ç»˜åˆ¶çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š<ol>
<li><strong>Layout</strong>ï¼šè¿™ä¸ªé˜¶æ®µå»ºç«‹å¥½ä½ çš„viewæ ‘å’Œlayeræ ‘ï¼Œå¹¶ç»™layerè®¾å®šå¥½å„ç§å±æ€§ï¼ˆframeï¼Œbackground colorç­‰ç­‰ï¼‰ã€‚</li>
<li><strong>Display</strong>ï¼šè¿™ä¸ªé˜¶æ®µåœ¨æ¯ä¸ªlayerä¸Šé¢ç”»ä»–ä»¬çš„backing imageã€‚è¿™ä¸ªé˜¶æ®µå¯èƒ½ä¼šè°ƒç”¨<code>-drawRect:</code>æˆ–è€…<code>-drawLayer:inContext:</code>æ–¹æ³•ã€‚</li>
<li><strong>Prepare</strong>ï¼šè¿™ä¸ªé˜¶æ®µCore Animationå‡†å¤‡å¥½è¦ä¼ é€’ç»™render serverçš„åŠ¨ç”»çš„ç›¸å…³å‚æ•°ã€‚</li>
<li><strong>Commit</strong>ï¼šè¿™ä¸ªé˜¶æ®µCore Animationå°†æ‰€æœ‰çš„layerå’ŒåŠ¨ç”»å±æ€§ä¸€èµ·æ‰“åŒ…ï¼Œä¼ é€’ç»™render serverï¼Œè®©å®ƒæ˜¾ç¤ºã€‚</li>
<li>render serverè®¡ç®—æ¯ä¸ªlayeræ¯ä¸ªå±æ€§ä»¥åŠåŠ¨ç”»è¿‡ç¨‹çš„ä¸­é—´å€¼ï¼Œç„¶åè®¾ç½®OpenGLçš„å„ä¸ªä¸‰è§’å½¢å±æ€§ç­‰ç­‰</li>
<li>åœ¨å±å¹•ä¸Šç»˜åˆ¶å¯è§†åŒ–çš„ä¸‰è§’å½¢ã€‚</li>
</ol>
</li>
<li>ä¸Šè¿°çš„6æ­Œæ­¥éª¤ï¼Œæˆ‘ä»¬åªèƒ½æ§åˆ¶å‰ä¸¤æ­¥ã€‚å‰5æ­¥ç”±CPUæ‰§è¡Œï¼Œæœ€åä¸€æ­¥ç”±GPUæ‰§è¡Œã€‚</li>
<li>GPUæ–¹é¢æœ‰å‡ ä¸ªå½±å“ç»˜åˆ¶çš„æ€§èƒ½çš„å› ç´ ï¼š<ol>
<li><strong>Too much geometry</strong>ï¼šGPUå…¶å®ä¸€æ¬¡å¯ä»¥handleç™¾ä¸‡ä¸ªä¸‰è§’å½¢ï¼Œä¸å¤ªå¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚ä½†æ˜¯å¤ªå¤šçš„layerï¼Œåœ¨æ¸²æŸ“å‰ï¼Œéœ€è¦éƒ½ä¼ é€’ç»™render serverï¼Œè¿™ä¸€ç‚¹ä¼šå½±å“CPUçš„é€Ÿåº¦ï¼Œæˆä¸ºå½±å“æ€§èƒ½çš„ä¸€ä¸ªåŸå› ã€‚</li>
<li><strong>Too much overdraw</strong>ï¼šGPUæœ‰è¿™æœ‰é™çš„åƒç´ å¡«å……é€Ÿç‡ã€‚åŠé€æ˜çš„layeräº’ç›¸å †å ï¼Œé‚£ä¹ˆå°±å¾—æ¸²æŸ“å¤šæ¬¡åœ¨åŒä¸€ä¸ªåƒç´ ç‚¹ã€‚</li>
<li><strong>Offscreen drawing</strong>ï¼š</li>
<li><strong>Too-large images</strong>ï¼šGPUçš„æœ€å¤§çš„texture sizeæ˜¯2048x2048/4096x4096ã€‚æ‰€ç”»çš„å›¾ç‰‡è¶…è¿‡è¿™ï¼ŒGPUåœ¨æ˜¾ç¤ºçš„æ—¶å€™ï¼Œå°±å¾—å…ˆé¢„å¤„ç†ä¸€éï¼Œè¿™æ ·ä¼šå‡æ…¢é€Ÿåº¦ã€‚</li>
</ol>
</li>
<li>CPUä¸Šçš„æ“ä½œä¸»è¦ä¼šå½±å“çš„æ˜¯åŠ¨ç”»çš„å¼€å§‹ï¼Œä»–ä¼šå»¶è¿ŸåŠ¨ç”»çš„å¼€å§‹ã€‚ä½“ç°åœ¨ä¸‹é¢å‡ ä¸ªæ–¹é¢ï¼š<ol>
<li><strong>Layout calculations</strong>ï¼šå¦‚æœlayerå¤ªå¤æ‚çš„è¯ï¼Œè®¡ç®—æ‰€æœ‰çš„layerçš„frameç­‰å±æ€§ä¼šèŠ±è¾ƒé•¿çš„æ—¶é—´ã€‚è¿™ä¸ªåœ¨ä½¿ç”¨autolayoutçš„viewä¸Šé¢ä½“ç°çš„æ›´æ˜æ˜¾ã€‚</li>
<li><strong>Lazy view loading</strong>ï¼šiOSåªä¼šåœ¨viewè¦æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„æ—¶å€™ï¼Œæ‰ä¼šå»åŠ è½½viewã€‚è¿™ä¸ªå¯¹å†…å­˜ä»¥åŠå¯åŠ¨æ—¶é—´éƒ½å¾ˆæœ‰å¸®åŠ©ã€‚ä½†æ˜¯å½“ä¸€ä¸ªviewæ˜¾ç¤ºæ—¶éœ€è¦å¤§é‡é¢„å…ˆè®¡ç®—æ—¶ï¼Œä¼šå¯¹å“åº”æœ‰å¾ˆå¤§çš„å½±å“ã€‚</li>
<li><strong>Core Graphics drawing</strong>ï¼šä¹Ÿå°±æ˜¯è‡ªå·±å®ç°çš„<code>-drawRect:</code>æ–¹æ³•å’Œ<code>-drawLayer:inContext:</code>æ–¹æ³•ä¼šå½±å“æ€§èƒ½ã€‚</li>
<li><strong>Image decompression</strong>ï¼šPNGæˆ–æ˜¯JPEGéƒ½æ˜¯å‹ç¼©è¿‡çš„å›¾ç‰‡ã€‚ä¸€å¼ å›¾ç‰‡åœ¨æ˜¾ç¤ºåœ¨iOSå±å¹•ä¹‹å‰ï¼Œéƒ½è¦å…ˆè§£å‹ç¼©åˆ°åŸæ¥çš„å¤§å°ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿä¼šæ¶ˆè€—CPUæ—¶é—´ã€‚</li>
</ol>
</li>
</ol>
<h3 id="Efficient-Drawing"><a href="#Efficient-Drawing" class="headerlink" title="Efficient Drawing"></a>Efficient Drawing</h3><ol>
<li>å°½é‡ä¸ä½¿ç”¨<code>-drawRect;</code>æ–¹æ³•ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨CAShapeLayerç­‰æ¥ä»£æ›¿<code>-drawRect;</code>æ–¹æ³•ã€‚</li>
<li>å¦‚æœéè¦ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œåœ¨é‡æ–°ç»˜åˆ¶çš„æ—¶å€™ï¼Œä¸è¦é‡æ–°ç»˜åˆ¶æ•´ä¸ªViewï¼Œè¦ç»˜åˆ¶é‚£äº›éœ€è¦ç»˜åˆ¶çš„åŒºåŸŸã€‚ä½¿ç”¨<code>-setNeedsDisplayInRect:</code>ç­‰æ–¹æ³•ã€‚</li>
<li>å¯ä»¥å°è¯•å¼‚æ­¥ç»˜å›¾ï¼Œå¦‚ä½¿ç”¨CATiledLayerä»¥åŠdrawsAsynchronouslyç­‰ç­‰ã€‚</li>
</ol>
<h3 id="Image-IO"><a href="#Image-IO" class="headerlink" title="Image IO"></a>Image IO</h3><ol>
<li><p>Imageçš„æœ¬åœ°åŠ è½½å’Œç½‘ç»œè¯·æ±‚éƒ½ä¼šé€ æˆå»¶è¿Ÿã€‚</p>
</li>
<li><p>å¯ä»¥å°è¯•å¼‚æ­¥åŠ è½½ã€‚</p>
</li>
<li><p>PNGç›¸æ¯”äºJPEGï¼ŒåŠ è½½æ—¶é—´è¾ƒé•¿ï¼Œä½†æ˜¯è§£å‹çš„æ—¶é—´çŸ­å¾—å¤šã€‚è¿™æ—¶å› ä¸ºJPEGçš„è§£å‹ç®—æ³•ç›¸æ¯”äºåŸºäºzipå‹ç¼©çš„PNGæ›´åŠ å¤æ‚ã€‚</p>
</li>
<li><p>UIImageçš„<code>+imageNamed;</code>æ–¹æ³•ä¸å…¶ä»–çš„æ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œå®ƒåœ¨åŠ è½½å®Œå›¾ç‰‡åå°±ç«‹é©¬å¼€å§‹è§£å‹ï¼Œä½†æ˜¯å…¶ä»–çš„æ–¹æ³•ä¼šåœ¨å¼€å§‹ç”»å›¾æ—¶æ‰å»è§£å‹å›¾ç‰‡ã€‚è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ç›´æ¥å°†imageåˆ¶å®šä¸ºUIImageViewçš„imageå±æ€§æˆ–æ˜¯layerçš„contentså±æ€§ï¼Œä½†æ˜¯è¿™æ ·çš„è¯åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</p>
</li>
<li><p>æ¥çœ‹æ®µä»£ç ï¼š</p>
<pre><code class="objective-c">- (UICollectionViewCell *)collectionView:(UICollectionView *)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath {
    //dequeue cell
    UICollectionViewCell *cell = [collectionView dequeueReusableCellWithReuseIdentifier:@&quot;Cell&quot; forIndexPath:indexPath];

    ...
    //switch to background thread
    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_LOW, 0), ^{
        //load image
        NSInteger index = indexPath.row;
        NSString *imagePath = self.imagePaths[index];
        UIImage *image = [UIImage imageWithContentsOfFile:imagePath];

        //redraw image using device context
        UIGraphicsBeginImageContextWithOptions(imageView.bounds.size, YES, 0); 
        [image drawInRect:imageView.bounds];
        image = UIGraphicsGetImageFromCurrentImageContext(); 
        UIGraphicsEndImageContext();
        //set image on main thread, but only if index still matches up
        dispatch_async(dispatch_get_main_queue(), ^{
            if (index == imageView.tag) {
                imageView.image = image; 
            }
        }); 
    });
    return cell; 
}
</code></pre>
</li>
<li><p><code>+imageNamed:</code>æ–¹æ³•è¿˜ä¼šç¼“å­˜è§£å‹ä¹‹åçš„å›¾ç‰‡ï¼Œä»¥ä¾›ä»¥åä½¿ç”¨ã€‚æ— è®ºä½ æ˜¯å¦è¿˜æœ‰æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªUIImageã€‚</p>
</li>
</ol>
<h3 id="Layer-Performance"><a href="#Layer-Performance" class="headerlink" title="Layer Performance"></a>Layer Performance</h3><ol>
<li>CATextLayerå’ŒUILabeléƒ½æ˜¯ä½¿ç”¨software drawingï¼Œæ‰€ä»¥ä¼šæ¯”é‚£äº›ä½¿ç”¨hardware-acceleratedçš„æ…¢ã€‚æ‰€ä»¥è¦å°½é‡é¿å…æ”¹å˜æœ‰å¾ˆå¤štextçš„CATextLayeræˆ–æ˜¯UILabelã€‚</li>
<li>å°†<strong>shouldRasterize</strong>å±æ€§è®¾ç½®æˆYESï¼Œä»–ä¼šå…ˆåœ¨å±å¹•å¤–é¢ç”»å¥½layerçš„imageã€‚ç„¶åè¿™ä¸ªimageä¼šè¢«cacheï¼Œä¹‹åä¼šè¢«ç”»åœ¨çœŸæ­£çš„layerçš„ä½ç½®ä¸Šé¢ã€‚å¤šæ¬¡åå¤è¢«ä½¿ç”¨ã€‚åˆ‡è®°ï¼šå¦‚æœä¸€ä¸ªlayerçš„contentsç»å¸¸å˜åŒ–ï¼Œä¸è¦ä½¿ç”¨è¿™ä¸ªã€‚</li>
</ol>
]]></content>
      
        <categories>
            
            <category> è¯»ä¹¦ç¬”è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS Core Animation - Setting Things in Motion]]></title>
      <url>/2016/07/08/iOS-Core-Animation-reading-note-two/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><strong>iOS Core Animation</strong> è¯»ä¹¦ç¬”è®°ï¼ˆäºŒï¼‰ <strong>Setting Things in Motion</strong></p>
<a id="more"></a>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="Implicit-Animations"><a href="#Implicit-Animations" class="headerlink" title="Implicit Animations"></a>Implicit Animations</h3><p>éšå¼çš„åŠ¨ç”»ç”±frameworkè‡ªåŠ¨æ‰§è¡Œï¼Œé™¤éä½ å«ä»–ä¸æ‰§è¡Œã€‚</p>
<h4 id="Transcations"><a href="#Transcations" class="headerlink" title="Transcations"></a>Transcations</h4><ol>
<li><p>Core Animationä¼šå»å‡è®¾ä½ æ‰€æœ‰åˆ›å»ºåœ¨å±å¹•ä¸Šçš„ä¸œè¥¿éƒ½ä¼šanimationã€‚æ‰€ä»¥animationå¹¶ä¸ç”¨ä½ åˆ»æ„çš„å»å¯åŠ¨ã€‚è¿™ä¹Ÿæ˜¯Core Animationæ¯”OpenGLæ…¢çš„ä¸€ç‚¹ï¼ŒOpenGLä¸ç”¨å»è€ƒè™‘è¿™äº›ä¸œè¥¿ï¼Œå°±ä¸éœ€è¦èŠ±è´¹é¢å¤–çš„æ€§èƒ½ä»£ä»·ã€‚</p>
</li>
<li><p>å½“ä½ æ”¹å˜ä¸€ä¸ªCALayerçš„å±æ€§æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å¹³æ»‘çš„æ‰§è¡ŒåŠ¨ç”»ä»å½“å‰å±æ€§åˆ°æ–°çš„å±æ€§ï¼Œè€Œä¸æ˜¯ç¬å˜ã€‚ä¸éœ€è¦ä½ é¢å¤–çš„åšäº›ä»€ä¹ˆã€‚è¿™ç§åŠ¨ç”»å°±å«åšéšå¼åŠ¨ç”»ã€‚</p>
</li>
<li><p><strong>Transcations</strong>æ˜¯Core Animationå°†ä¸€ç³»åˆ—åŠ¨ç”»æ±‡é›†æˆä¸€ä¸ªçš„æœºåˆ¶ã€‚ä¸€æ—¦transactionæäº¤(committed)ä¹‹åï¼Œè¿™äº›åŠ¨ç”»å°±ä¼šå¼€å§‹æ‰§è¡Œã€‚</p>
</li>
<li><p><strong>CATransaction</strong>ç±»æ§åˆ¶ç€transactionçš„è¡Œä¸ºã€‚è¯¥ç±»æ²¡æœ‰alloc initè¿™æ ·çš„åˆå§‹åŒ–ï¼Œä¹Ÿå¹¶ä¸æ˜¯å¦‚åå­—é‚£æ ·ä»£è¡¨ä¸€ä¸ªtransactionï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªtransactionçš„æ ˆã€‚å¯ä»¥ä½¿ç”¨<code>+begin</code> å’Œ <code>-commit</code>æ–¹æ³•æ¥å°†ä¸€ä¸ªtransactionè¿›æ ˆæˆ–è€…å‡ºæ ˆã€‚</p>
</li>
<li><p>ä½¿ç”¨<code>+setAnimationDuration:</code>æ–¹æ³•æ¥è®¾ç½®å½“å‰transactionçš„åŠ¨ç”»æ—¶é—´ã€‚æ²¡æœ‰æŒ‡å®šçš„è¯ï¼Œé»˜è®¤æ˜¯0.25sã€‚ä½¿ç”¨è¯¥æ–¹æ³•æ—¶ï¼Œæœ€å¥½æ˜¾ç¤ºçš„å¼€å§‹ä¸€ä¸ªæ–°çš„transactionï¼Œå°†å…¶å‹å…¥æ ˆä¸­ï¼Œè¡¨ç¤ºåªæ”¹å˜è¿™ä¸ªtransactionçš„durationï¼›ä¸ç„¶å¯èƒ½æ”¹å˜åŒæ—¶å‘ç”Ÿçš„ä¸€äº›animationï¼Œæ¯”å¦‚æ—‹è½¬å±å¹•ã€‚</p>
</li>
<li><p>çœ‹ä¸€ä¸‹ä»£ç ï¼š</p>
<pre><code class="objective-c">- (IBAction)changeColor {
    //begin a new transaction
    [CATransaction begin];

    //set the animation duration to 1 second
    [CATransaction setAnimationDuration:1.0];

    //randomize the layer background color
    CGFloat red = arc4random() / (CGFloat)INT_MAX;
    CGFloat green = arc4random() / (CGFloat)INT_MAX;
    CGFloat blue = arc4random() / (CGFloat)INT_MAX; 
    self.colorLayer.backgroundColor = [UIColor colorWithRed:red green:green blue:blue alpha:1.0].CGColor;

     //commit the transaction
    [CATransaction commit]; 
}
</code></pre>
<p>è¿™é‡Œä½¿ç”¨<code>+begin</code>æ–¹æ³•ï¼Œè¡¨ç¤ºæ˜¾å¼çš„å¼€å§‹ä¸€ä¸ªtransactionï¼Œtransactionå…¶å®å°±æ˜¯ä¸€ä¸ªå±æ€§æ”¹å˜çš„åŠ¨ç”»çš„é›†åˆï¼›æ˜¾å¼å¼€å§‹ä¸€ä¸ªtransactionå¯ä»¥ç²¾å‡†çš„æ§åˆ¶è¿™ä¸€ç³»åˆ—åŠ¨ç”»çš„æ‰§è¡Œæ—¶é—´ç­‰ç­‰ï¼Œè€Œä¸”ä¸äºˆå…¶ä»–çš„åŠ¨ç”»ææ··ã€‚å½“æ‰§è¡Œ<code>+commit</code>æ–¹æ³•æ—¶ï¼Œè¿™äº›åŠ¨ç”»å˜å¼€å§‹æ‰§è¡Œã€‚è€Œå¯¹äºä¸€äº›æ²¡æœ‰ä½¿ç”¨begin,commitçš„åŠ¨ç”»ï¼Œå…¶å®ä»–ä»¬ä¹Ÿæ˜¯å±äºä¸åŒçš„transactionï¼Œåªæ˜¯è¿™äº›transactionæ²¡æœ‰è¢«æ˜¾å¼çš„å‹å…¥(begin)æˆ–æ¨å‡º(commit)transactionçš„æ•°ç»„è€Œå·²ï¼›ä»–ä»¬è¢«éšå¼çš„æ‰§è¡Œç½¢äº†ã€‚</p>
</li>
<li><p>å…¶å®UIViewçš„<code>+animateWithDuration:animations:</code>æ–¹æ³•ï¼Œä¹Ÿæ˜¯åœ¨å†…éƒ¨è°ƒç”¨ä¸Šè¿°6ä¸­çš„æ–¹æ³•è€Œå·²ã€‚</p>
</li>
<li><p>UIViewçš„<code>+beginAnimations:context:</code>å’Œ<code>+commitAnimations</code>å’ŒCALayerçš„<code>+begin</code>ä»¥åŠ<code>+commit</code>ç›¸åŒã€‚</p>
</li>
</ol>
<h4 id="Completion-Blocks"><a href="#Completion-Blocks" class="headerlink" title="Completion Blocks"></a>Completion Blocks</h4><ol>
<li>UIViewä¸­çš„animationçš„completion blockå®é™…ä¸Šå°±æ˜¯è°ƒç”¨CATransactionçš„<code>+setCompletionBlock:</code>æ–¹æ³•ã€‚</li>
</ol>
<h4 id="Layer-Actions"><a href="#Layer-Actions" class="headerlink" title="Layer Actions"></a>Layer Actions</h4><p>CALayeråœ¨å±æ€§å˜åŒ–æ—¶æ‰§è¡Œçš„åŠ¨ç”»å«åš<strong>actions</strong>ï¼Œæ¥çœ‹çœ‹æ•´ä¸ªçš„æµç¨‹ã€‚</p>
<ol>
<li>å½“CALayerçš„ä¸€ä¸ªå±æ€§å˜åŒ–æ—¶ï¼Œè°ƒç”¨<code>-actionsForKey:</code>æ–¹æ³•ï¼Œè¿™é‡Œä¼ å…¥çš„keyå°±æ˜¯è¿™ä¸ªå±æ€§çš„åå­—ã€‚</li>
<li>è¿™æ—¶layerå…ˆæŸ¥çœ‹ä»–æ˜¯å¦æœ‰delegateï¼Œä¹Ÿå°±æ˜¯CALayerDelegateï¼›å†çœ‹çœ‹è¿™ä¸ªdelegateé‡Œé¢æ˜¯å¦å®ç°äº†<code>-actionForLayer:forKey:</code>æ–¹æ³•ã€‚å¦‚æœå®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•å¹¶ä¸”è¿”å›ã€‚</li>
<li>å¦‚æœæ²¡æœ‰è¿™ä¸ªdelegateæˆ–è€…delegateé‡Œé¢æ²¡æœ‰å®ç°ä¸Šè¿°çš„æ–¹æ³•ï¼Œé‚£ä¹ˆlayerå°±ä¼šå»æ£€æŸ¥ä»–çš„actionså±æ€§ã€‚è¿™ä¸ªå­—å…¸åŒ…å«äº†å±æ€§ååˆ°actionçš„æ˜ å°„ã€‚</li>
<li>å¦‚æœè¿˜æ˜¯æ²¡æ‰¾åˆ°è¿™ä¸ªè¦åŠ¨ç”»çš„å±æ€§åçš„è¯ï¼Œå°±å»styleå­—å…¸é‡Œé¢æ‰¾ã€‚</li>
<li>æœ€åçš„æœ€åï¼Œè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°çš„è¯ï¼Œå°±ä¼šè°ƒç”¨<code>-defaultActionForKey:</code>æ–¹æ³•ï¼›è¿™ä¸ªæ–¹æ³•å®šä¹‰äº†æ ‡å‡†çš„åŠ¨ç”»ä¸ºé‚£äº›å·²çŸ¥çš„å±æ€§ã€‚</li>
</ol>
<p>å¦‚æœä¸Šè¿°æ­¥éª¤çš„ç¬¬äºŒæ­¥ä¸­çš„<code>-actionForLayer:forKey:</code>æ–¹æ³•è¿”å›nilçš„è¯å°±ä¸ä¼šæœ‰åŠ¨ç”»å‘ç”Ÿäº†ï¼›å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªç¬¦åˆCAActionåè®®çš„å¯¹è±¡ï¼Œæ¯”å¦‚è¿”å›CABasicAnimationï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡ŒåŠ¨ç”»ã€‚</p>
<p>å› ä¸ºUIViewçš„backing layerçš„delegateæ˜¯UIViewæœ¬èº«ã€‚UIViewå®ç°<code>-actionForLayer:forKey:</code>æ–¹æ³•çš„æ–¹å¼å°±æ˜¯ï¼šå¦‚æœUIViewçš„å±æ€§æ”¹å˜ä¸å‘ç”Ÿåœ¨ä¸€ä¸ªæ˜¾å¼çš„åŠ¨ç”»å·¥ç¨‹ä¹‹ä¸­å°±è¿”å›nilï¼›å¦‚æœåœ¨åŠ¨ç”»è¿‡ç¨‹ä¹‹ä¸­ï¼Œå°±è¿”å›å¯åŠ¨ç”»çš„å¯¹è±¡ã€‚æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">@interface ViewController ()
@property (nonatomic, weak) IBOutlet UIView *layerView; 
@end

@implementation ViewController
- (void)viewDidLoad {
    [super viewDidLoad];

    //test layer action when outside of animation block
    NSLog(@&quot;Outside: %@&quot;, [self.layerView actionForLayer:self.layerView.layer forKey:@&quot;backgroundColor&quot;]);

    //begin animation block
    [UIView beginAnimations:nil context:nil];
    //test layer action when inside of animation block
    NSLog(@&quot;Inside: %@&quot;, [self.layerView actionForLayer:self.layerView.layer forKey:@&quot;backgroundColor&quot;]);
    //end animation block
    [UIView commitAnimations]; 
}
@end
</code></pre>
<p>æ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>$ LayerTest[21215:c07] Outside: &lt;null&gt;
$ LayerTest[21215:c07] Inside: &lt;CABasicAnimation: 0x757f090&gt;
</code></pre><p>æ‰€ä»¥è¯´UIViewæ˜¯disableéšå¼åŠ¨ç”»çš„ã€‚</p>
<p><code>[CATransaction setDisableActions:YES];</code>è¿™ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥ ç¦ç”¨åŠ¨ç”»ã€‚</p>
<p>åœ¨layerçš„<strong>actions</strong>å­—å…¸å±æ€§é‡Œé¢è®¾ç½®å¦‚ä¸‹ï¼š</p>
<pre><code>CATransition *transition = [CATransition animation]; 
transition.type = kCATransitionPush;
transition.subtype = kCATransitionFromLeft; 
self.colorLayer.actions = @{@&quot;backgroundColor&quot;: transition};
</code></pre><h4 id="Presentation-Versus-Model"><a href="#Presentation-Versus-Model" class="headerlink" title="Presentation Versus Model"></a>Presentation Versus Model</h4><ol>
<li>å½“ä½ æ›´æ”¹ä¸€ä¸ªCALayerçš„å±æ€§æ—¶ï¼Œè¿™ä¸ªå±æ€§æ˜¯ç«‹åˆ»å‘ç”Ÿæ”¹å˜çš„ï¼Œä½†æ˜¯å¹¶ä¸åœ¨å±å¹•ä¸Šç«‹å³æ˜¾ç¤ºå‡ºæ¥ã€‚</li>
<li>å½“æ”¹å˜CALayerçš„å±æ€§æ—¶ï¼ŒCALayerç›¸å½“äºä¸€ä¸ª<em>model</em>ï¼Œç”¨æ¥å­˜å‚¨åŠ¨ç”»ç»“æŸæ—¶è¯¥å‘ˆç°ä½•ç§çŠ¶æ€ï¼›è€ŒCore Animationåˆ™ç›¸å½“äº<em>controller</em>ï¼Œç”¨æ¥æ§åˆ¶<em>view</em>çš„å˜åŒ–ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªMVCç»“æ„å•Šã€‚æ‰€ä»¥æœ‰æ—¶å€™layer treeä¹Ÿå«ä½œmodel layer treeã€‚</li>
<li>iOSä¸­ï¼Œå±å¹•1ï¼60ç§’é‡æ–°ç»˜åˆ¶ä¸€æ¬¡ã€‚æ‰€ä»¥å¦‚æœåŠ¨ç”»æ—¶é—´è¶…è¿‡è¿™ä¸€æ—¶é•¿çš„è¯ï¼Œé‚£ä¹ˆCore  Animationå°±éœ€è¦ä»è®¾ç½®åŠ¨ç”»å¼€å§‹åˆ°åŠ¨ç”»ç»“æŸå†…æ¯1ï¼60ç§’æ›´æ–°ä¸€æ¬¡ç•Œé¢ã€‚æ‰€ä»¥è¿™ä¹Ÿéœ€è¦CALayerèƒ½å¤Ÿè®°ä½å½“å‰çš„å±æ€§å€¼å’Œæœ€ç»ˆçš„å±æ€§å€¼ã€‚</li>
<li>åŠ¨ç”»è¿‡ç¨‹ä¸­ï¼Œå½“å‰æ˜¾ç¤ºçš„layerçš„å±æ€§å€¼ï¼Œå­˜å‚¨åœ¨ä¸€ä¸ª<strong>presentation layer</strong>ä¸­ï¼Œå®ƒå¯ä»¥é€šè¿‡<code>-presentationLayer;</code>æ–¹æ³•å–å¾—ã€‚è¿™ä¸ªlayerå®é™…ä¸Šå°±æ˜¯<strong>model layer</strong>çš„å¤åˆ¶ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å½“å‰åŠ¨ç”»çš„å±æ€§å€¼ä¸åŒã€‚å½“åœ¨presentation layerä¸Šè°ƒç”¨<code>-modelLayer</code>æ–¹æ³•æ—¶ï¼Œè¿”å›çš„æ˜¯presentation layerçš„åŸå§‹çš„model layerã€‚</li>
</ol>
<h3 id="Explicit-Animations"><a href="#Explicit-Animations" class="headerlink" title="Explicit Animations"></a>Explicit Animations</h3><p>ä½¿ç”¨æ˜¾å¼åŠ¨ç”»çš„å¥½å¤„æ˜¯å¯ä»¥å®Œå…¨æ§åˆ¶åŠ¨ç”»çš„è¡Œä¸ºï¼Œæ¯”å¦‚è¿åŠ¨è½¨è¿¹ï¼ŒåŠ¨ç”»æ—¶é—´ç­‰ç­‰ã€‚</p>
<h4 id="Property-Animations"><a href="#Property-Animations" class="headerlink" title="Property Animations"></a>Property Animations</h4><ol>
<li><p><strong>CAAnimation</strong>ç±»æ˜¯æ‰€æœ‰Core Animationæ”¯æŒçš„åŠ¨ç”»ç±»çš„å…±æœ‰çš„çˆ¶ç±»ï¼›å®ƒæœ‰ä¸€ä¸ªå­ç±»æ˜¯<strong>CAPropertyAnimation</strong>ï¼Œä¹Ÿå°±æ˜¯å±æ€§åŠ¨ç”»ã€‚</p>
</li>
<li><p><strong>CABasicAnimation</strong>æ˜¯CAPropertyAnimationçš„ä¸€ä¸ªå­ç±»ã€‚CAPropertyAnimationæŒ‡å®šä¸€ä¸ªå±æ€§é€šè¿‡æŒ‡å®škeypathã€‚CABasicAnimationæœ‰3ä¸ªå±æ€§ï¼š<em>fromValue</em>, <em>toValue</em>, <em>byValue</em>ã€‚è¿™ä¸‰ä¸ªéƒ½æ˜¯idç±»å‹ï¼Œå› ä¸ºä»–ä»¬å¯ä»¥æ˜¯æ•°å€¼ï¼Œé¢œè‰²ï¼Œå›¾ç‰‡ç­‰ç­‰ã€‚å½“ç„¶åªéœ€è¦æŒ‡å®š3ä¸ªä¸­çš„ä¸¤ä¸ªå°±å¯ä»¥ç¡®å®šä¸€ä¸ªåŠ¨ç”»ã€‚</p>
</li>
<li><p>ä½¿ç”¨CABasicAnimationå°±æ˜¯æ˜¾å¼åŠ¨ç”»äº†ï¼Œæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre><code class="objective-c">//create a basic animation
CABasicAnimation *animation = [CABasicAnimation animation]; 
animation.keyPath = @&quot;backgroundColor&quot;;
animation.toValue = (__bridge id)color.CGColor;
//apply animation to layer
[self.colorLayer addAnimation:animation forKey:nil];
</code></pre>
</li>
<li><p>ä½¿ç”¨ä¸Šè¿°çš„ä»£ç åœ¨åŠ¨ç”»ç»“æŸåï¼Œé¢œè‰²è¿˜æ˜¯ä¼šå›åˆ°ä»¥å‰çš„é¢œè‰²ï¼Œæ˜¯å› ä¸ºåŠ¨ç”»åªæ˜¯æ”¹å˜äº†presentation layerï¼Œå¹¶æ²¡æœ‰æ”¹å˜model layerã€‚å®é™…ä¸Šï¼Œéšå¼åŠ¨ç”»æ”¹å˜å±æ€§æ—¶ï¼ŒåŠ¨ç”»ä½¿ç”¨çš„ä¹Ÿæ˜¯CABasicAnimationï¼Œå±æ€§æ”¹å˜æ—¶ï¼Œä¼šåœ¨<code>-actionForLayer:forKey:</code>æ–¹æ³•ä¸­è¿”å›ä¸€ä¸ªCABasicAnimationã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨åŠ¨ç”»æ‰§è¡Œä¹‹å‰æ”¹å˜å±æ€§ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">animation.fromValue = (__bridge id)self.colorLayer.backgroundColor; self.colorLayer.backgroundColor = color.CGColor;
</code></pre>
</li>
</ol>
<ol>
<li><p>é€‰æ‹©åœ¨åŠ¨ç”»ä¹‹å‰æ”¹å˜å±æ€§å€¼ï¼Œè€Œä¸æ˜¯åœ¨åŠ¨ç”»ç»“æŸä¹‹åã€‚æ˜¯å› ä¸ºï¼Œåœ¨åŠ¨ç”»ç»“æŸä¹‹åï¼Œä¼šå…ˆè·³å›åŸå§‹å€¼ï¼Œåœ¨è·³åˆ°æœ€ç»ˆå€¼ã€‚</p>
</li>
<li><p>ä½¿ç”¨CAAnimationDelegateå¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚å®ƒå¯ä»¥çŸ¥é“åŠ¨ç”»å‡†ç¡®çš„ç»“æŸæ—¶é—´ã€‚å®ç°<code>-animationDidStop:finished:</code>æ–¹æ³•å³å¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">// first specify delegate
animation.delegate = self;

// implement delegate method
- (void)animationDidStop:(CABasicAnimation *)anim finished:(BOOL)flag {
    //set the backgroundColor property to match animation toValue
    [CATransaction begin];
    [CATransaction setDisableActions:YES]; 
      self.colorLayer.backgroundColor = (__bridge CGColorRef)anim.toValue;         [CATransaction commit];
}
</code></pre>
</li>
<li><p>CABasicAnimationåœ¨ä½¿ç”¨<code>-addAnimation:forKey:</code>æ–¹æ³•æ·»åŠ ç»™CALayeræ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªNSStringç±»å‹çš„Keyã€‚è¿™ä¸ªKeyå¯ä»¥å”¯ä¸€çš„æ ‡ç¤ºä¸€ä¸ªanimationã€‚æ‰€ä»¥åœ¨<code>-animationDidStop:finished:</code>æ–¹æ³•ä¸­å¯ä»¥ä½¿ç”¨keyæ¥è¾¨åˆ«æ˜¯å¦æ˜¯æŸä¸ªç‰¹å®šçš„animationã€‚</p>
</li>
<li><p>CAAnimationè¿˜æœ‰ä¸€å¥—è‡ªå·±çš„æ–¹æ³•ï¼Œæ¥æ ‡ç¤ºä¸€ä¸ªanimationã€‚å¯ä»¥ä½¿ç”¨<code>-setValue:forKey:</code>ä»¥åŠ<code>-valueForKey:</code>æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">// when set up animation
[animation setValue:handView forKey:@&quot;handView&quot;];

// when finish animation
- (void)animationDidStop:(CABasicAnimation *)anim finished:(BOOL)flag {
      // get value that set last step
      UIView *handView = [anim valueForKey:@&quot;handView&quot;];
      // do something later
}
</code></pre>
</li>
<li><p>æ³¨æ„ï¼šè¿™ä¸ªåŠ¨ç”»ç»“æŸçš„delegateè¢«è°ƒç”¨ï¼Œå¯èƒ½å‘ç”Ÿåœ¨å…¶å€¼å›é€€ä¹‹å‰ã€‚æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆè¦è¯´åœ¨åŠ¨ç”»ä¹‹å‰å°±è®¾ç½®åŠ¨ç”»ç»“æŸçš„å€¼ã€‚</p>
</li>
<li><p><strong>CAKeyframeAnimation</strong>å¾ˆå¼ºå¤§ï¼Œå’ŒCABasicAnimationä¸€æ ·ï¼Œä¹Ÿæ˜¯CAPropertyAnimationçš„ä¸€ä¸ªå­ç±»ã€‚å®ƒå’ŒCABasicAnimationä¸€æ ·ï¼Œä¹Ÿåªå¯¹ä¸€ä¸ªå±æ€§è¿›è¡ŒåŠ¨ç”»ã€‚CAKeyframeAnimationåªéœ€è¦ä½ æ¥æä¾›å…³é”®å¸§ï¼Œç„¶åCore Animationä¼šè‡ªåŠ¨å¸®ä½ å¡«å……å…³é”®å¸§ä¹‹é—´çš„ç©ºç™½ã€‚çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
</li>
</ol>
<pre><code class="objective-c">   CAKeyframeAnimation *animation = [CAKeyframeAnimation animation]; animation.keyPath = @&quot;backgroundColor&quot;;
   animation.duration = 2.0;
   animation.values = @[
                       (__bridge id)[UIColor blueColor].CGColor, 
                         (__bridge id)[UIColor redColor].CGColor, 
                         (__bridge id)[UIColor greenColor].CGColor, 
                         (__bridge id)[UIColor blueColor].CGColor 
                       ];
   //apply animation to layer
   [self.colorLayer addAnimation:animation forKey:nil];
</code></pre>
<p>   é€šè¿‡<strong>values</strong>å±æ€§(æ˜¯ä¸€ä¸ªNSArray)ï¼ŒæŒ‡å®šå…³é”®å¸§ã€‚å¿…é¡»æŒ‡å®šå¼€å§‹å’Œç»“æŸçš„å¸§ï¼Œå› ä¸ºCAKeyframeAnimationä¸ä¼šé»˜è®¤ä½¿ç”¨è¿™ä¸ªå±æ€§å½“å‰çš„å€¼æ¥ä½œä¸ºç¬¬ä¸€å¸§ã€‚</p>
<ol>
<li>CAKeyframeAnimationè¿˜å¯ä»¥ä½¿ç”¨CGPathã€‚æ¥çœ‹çœ‹ä¾‹å­ï¼š</li>
</ol>
<pre><code class="objective-c">   //create a path
   UIBezierPath *bezierPath = [[UIBezierPath alloc] init]; 
   [bezierPath moveToPoint:CGPointMake(0, 150)]; 
   [bezierPath addCurveToPoint:CGPointMake(300, 150)
                 controlPoint1:CGPointMake(75, 0) 
                  controlPoint2:CGPointMake(225, 300)];

   //draw the path using a CAShapeLayer
   CAShapeLayer *pathLayer = [CAShapeLayer layer]; 
   pathLayer.path = bezierPath.CGPath; 
   pathLayer.fillColor = [UIColor clearColor].CGColor; 
   pathLayer.strokeColor = [UIColor redColor].CGColor; 
   pathLayer.lineWidth = 3.0f; 
   [self.containerView.layer addSublayer:pathLayer];

   //add the ship
   CALayer *shipLayer = [CALayer layer];
   shipLayer.frame = CGRectMake(0, 0, 64, 64); 
   shipLayer.position = CGPointMake(0, 150); 
   shipLayer.contents = (__bridge id)[UIImage imageNamed:@&quot;Ship.png&quot;].CGImage; [self.containerView.layer addSublayer:shipLayer];

   //create the keyframe animation
   CAKeyframeAnimation *animation = [CAKeyframeAnimation animation]; animation.keyPath = @&quot;position&quot;;
   animation.duration = 4.0;
   animation.path = bezierPath.CGPath;
   [shipLayer addAnimation:animation forKey:nil];
</code></pre>
<p>   æŒ‡å®šCAKeyframeAnimationçš„<strong>path</strong>å±æ€§ä¸ºä¸€ä¸ªCGPathã€‚ç„¶åå°±å¯ä»¥æ²¿ç€è¿™ä¸ªpathè¿åŠ¨ã€‚å¦å¤–ï¼ŒCAKeyframeAnimationè¿˜æœ‰ä¸€ä¸ª<strong>rotationMode</strong>å±æ€§ï¼Œè¯¥å±æ€§æŒ‡å®šåŠ¨ç”»çš„layerçš„æ—‹è½¬ç‰¹æ€§ã€‚å°†è¯¥å±æ€§æŒ‡å®šä¸ºkCAAnimationRotationAutoçš„è¯ï¼Œä¸Šé¢çš„shipLayerå°±ä¼šä¸€ç›´æ—‹è½¬ï¼Œä»¥è°ƒæ•´è§’åº¦å»å¯¹é½bezierPathçš„åˆ‡çº¿æ–¹å‘ã€‚</p>
<ol>
<li>CAPropertyAnimationä¸å•å•å¯ä»¥ä½œç”¨äºå®é™…å­˜åœ¨çš„å±æ€§ï¼Œè¿˜å¯ä»¥ä½œç”¨äºè™šæ‹Ÿçš„å±æ€§ã€‚æ˜¯ä¸€ä¸ªkeys pathï¼šæ¯”å¦‚<code>animation.keyPath = @&quot;transform.rotation&quot;;</code>ã€‚</li>
</ol>
<h4 id="Animation-Groups"><a href="#Animation-Groups" class="headerlink" title="Animation Groups"></a>Animation Groups</h4><ol>
<li><strong>CAAnimationGroup</strong>æ˜¯CAAnimationçš„ä¸€ä¸ªå­ç±»ï¼Œä»–å¯ä»¥èšé›†ä¸€å †åŠ¨ç”»ã€‚</li>
<li>ä»–æœ‰ä¸€ä¸ª<strong>animations</strong>å±æ€§ï¼Œæ˜¯ä¸€ä¸ªåŒ…å«CAAnimationçš„æ•°ç»„ã€‚</li>
</ol>
<h4 id="Transitions"><a href="#Transitions" class="headerlink" title="Transitions"></a>Transitions</h4><p><strong>CATransition</strong>ä¹Ÿæ˜¯CAAnimationçš„ä¸€ä¸ªå­ç±»ï¼Œå®ƒå½±å“æ•´ä¸ªlayerã€‚å®ƒä¼šå…ˆå¯¹åŸå…ˆçš„layerç…§ä¸ªå¿«ç…§ï¼Œç„¶ååˆ›å»ºæ–°çš„layerã€‚ä¹‹åä»¥åŠ¨ç”»çš„å½¢å¼ï¼Œå°†æ–°çš„layerå¿«ç…§ï¼Œæ›¿ä»£åŸå…ˆçš„layerå¿«ç…§ï¼Œæ¯”æ–¹è¯´ä»å·¦å‘å³æ¨å…¥ã€‚å®ƒä¸»è¦ç”¨æ¥åŠ¨ç”»ä¸€äº›ä¸å¯åŠ¨ç”»çš„å±æ€§ï¼Œæ¯”å¦‚UIImageçš„imageå±æ€§ã€‚çœ‹çœ‹ä»£ç ï¼š</p>
<pre><code class="objective-c">@interface ViewController ()
@property (nonatomic, weak) IBOutlet UIImageView *imageView; 
@property (nonatomic, copy) NSArray *images;
@end

@implementation ViewController
- (void)viewDidLoad {
    [super viewDidLoad];
    //set up images
    self.images = @[[UIImage imageNamed:@&quot;Anchor.png&quot;], 
                    [UIImage imageNamed:@&quot;Cone.png&quot;],
                    [UIImage imageNamed:@&quot;Igloo.png&quot;], 
                    [UIImage imageNamed:@&quot;Spaceship.png&quot;]];
}

- (IBAction)switchImage {
    //set up crossfade transition
    CATransition *transition = [CATransition animation]; 
      transition.type = kCATransitionFade;
    //apply transition to imageview backing layer
    [self.imageView.layer addAnimation:transition forKey:nil];

      //cycle to next image
    UIImage *currentImage = self.imageView.image;
    NSUInteger index = [self.images indexOfObject:currentImage]; 
      index = (index + 1) % [self.images count]; 
      self.imageView.image = self.images[index];
}
@end
</code></pre>
<p>CALayerçš„contentså±æ€§ï¼Œè‡ªåŠ¨åº”ç”¨CATransitionåŠ¨ç”»ï¼Œå½“æ”¹å˜ä¸€ä¸ªä¸æ˜¯backing layerçš„contentsæ—¶ï¼Œä¼šè‡ªåŠ¨åº”ç”¨åŠ¨ç”»ã€‚</p>
<p>è‡ªå·±å®ç°CATransactionæ•ˆæœï¼š</p>
<ol>
<li>CALayerçš„<code>-renderInContext:</code>æ–¹æ³•å¯ä»¥ç”¨æ¥è·å–å°†å½“å‰çš„layerçš„contentsç”»åˆ°ä¸€ä¸ªcontexté‡Œé¢ï¼Œä¹Ÿå°±å®ç°äº†è·å–å½“å‰çš„å¿«ç…§ã€‚</li>
<li>å°†è¿™ä¸ªå¿«ç…§æ”¾åœ¨å½“å‰å±å¹•çš„æœ€ä¸Šé¢ï¼Œæ©ç›–ä½åŸæ¥çš„viewï¼›ä¹‹åå°±å¯ä»¥åœ¨åŸæ¥çš„viewä¸Šé¢è¿›è¡Œå˜åŒ–äº†ã€‚</li>
<li>å†ä½¿ç”¨åŠ¨ç”»æ¨å‡ºè¿™ä¸ªå¿«ç…§ï¼Œå°±å®Œæˆäº†transitionã€‚</li>
</ol>
<p>çœ‹çœ‹ä»£ç å®ç°ï¼š</p>
<pre><code class="objective-c">- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.
    UIView *baseView = [[UIView alloc]initWithFrame:self.view.bounds];
    baseView.backgroundColor = [UIColor yellowColor];
    [self.view addSubview:baseView];

    // preserve the current snapshot
    UIGraphicsBeginImageContextWithOptions(self.view.bounds.size, YES, 0.0);
    [baseView.layer renderInContext:UIGraphicsGetCurrentContext()];
    UIImage *coverImage = UIGraphicsGetImageFromCurrentImageContext();

    // insert snapshot view
    UIImageView *coverView = [[UIImageView alloc]initWithImage:coverImage];
    coverView.frame = self.view.bounds;
    [self.view addSubview:coverView];

    // update original view
    baseView.backgroundColor = [UIColor redColor];
    [UIView animateWithDuration:1.0 animations:^{
        CGAffineTransform transform = CGAffineTransformMakeScale(0.1, 0.1);
        transform = CGAffineTransformRotate(transform, M_PI_2);
        coverView.transform = transform;
        coverView.alpha = 0.5;
    } completion:^(BOOL finished) {
        [coverView removeFromSuperview];
    }];
}
</code></pre>
<h4 id="Canceling-an-Animation-in-Progress"><a href="#Canceling-an-Animation-in-Progress" class="headerlink" title="Canceling an Animation in Progress"></a>Canceling an Animation in Progress</h4><ol>
<li>å½“ä½¿ç”¨CALayerçš„<code>-addAnimation:forKey:</code>æ–¹æ³•ç»™ä¸€ä¸ªlayeræ·»åŠ äº†åŠ¨ç”»ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨<code>-(CAAnimation *)animationForKey:(NSString *)key;</code>æ–¹æ³•æ¥æ ¹æ®keyé‡æ–°è·å–è¿™ä¸ªanimationã€‚</li>
<li>ä¿®æ”¹æ­£åœ¨è¿è¡Œçš„åŠ¨ç”»çš„å±æ€§ï¼Œæ˜¯æ²¡æœ‰æ•ˆæœçš„ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨<code>- (void)removeAnimationForKey:(NSString *)key;</code>æ–¹æ³•æ¥åˆ é™¤layerçš„æŸä¸ªanimationã€‚</li>
<li>å¯ä»¥ä½¿ç”¨<code>- (void)removeAllAnimations;</code>æ¥åˆ é™¤layerçš„æ‰€æœ‰åŠ¨ç”»ã€‚</li>
<li>åªè¦ä¸€åˆ é™¤åŠ¨ç”»ï¼Œå±å¹•å°±ä¼šæ ¹æ®model layeræ¥é‡æ–°ç»˜åˆ¶ã€‚</li>
</ol>
<h3 id="Layer-Time"><a href="#Layer-Time" class="headerlink" title="Layer Time"></a>Layer Time</h3><h4 id="The-CAMediaTiming-Protocol"><a href="#The-CAMediaTiming-Protocol" class="headerlink" title="The CAMediaTiming Protocol"></a>The CAMediaTiming Protocol</h4><ol>
<li><p><strong>CAMediaTiming</strong>åè®®å®šä¹‰äº†å¤šç§å±æ€§åŠæ–¹æ³•ç”¨æ¥æ§åˆ¶åŠ¨ç”»å·¥ç¨‹ä¸­çš„æ—¶é—´ï¼ŒCALayerå’ŒCAAnimationéƒ½ç¬¦åˆè¯¥åè®®ã€‚</p>
</li>
<li><p><strong>duration</strong>å±æ€§ï¼šä¸€æ¬¡åŠ¨ç”»æ‰§è¡Œçš„æ—¶é—´ã€‚</p>
</li>
<li><p><strong>repeatCount</strong>å±æ€§ï¼šåŠ¨ç”»é‡å¤æ‰§è¡Œçš„æ¬¡æ•°ã€‚å¯ä»¥æ˜¯å°æ•°ï¼Œæ¯”å¦‚3.5æ¬¡ã€‚ã€‚</p>
</li>
<li><p>durationå’ŒrepeatCountçš„é»˜è®¤å€¼éƒ½æ˜¯0ï¼Œä½†ä¸è¡¨ç¤º0æ¬¡å’Œ0ç§’ã€‚è¡¨ç¤ºçš„æ˜¯é»˜è®¤çš„0.25så’Œ1æ¬¡ã€‚</p>
</li>
<li><p>è¿˜å¯ä»¥ä½¿ç”¨<strong>repeatDuration</strong>å±æ€§ï¼ŒæŒ‡å®šæ•´ä¸ªé‡å¤åŠ¨ç”»çš„æ—¶é—´ï¼›<strong>autoreverses</strong>å±æ€§æŒ‡å®šåŠ¨ç”»æ˜¯å¦è¦åŸè·¯å¾„åç€æ¥ä¸€éã€‚</p>
</li>
<li><p>æ¯ä¸ªåŠ¨ç”»çš„æ—¶é—´éƒ½æ˜¯å„æˆä½“ç³»çš„ã€‚æ¯ä¸ªåŠ¨ç”»å†…çš„æ—¶é—´å¯ä»¥è¢«å»¶è¿Ÿï¼ŒåŠ é€Ÿï¼Œå‡é€Ÿç­‰ç­‰ã€‚</p>
</li>
<li><p><strong>beginTime</strong>å±æ€§ï¼šå¦‚æœä¸€ä¸ªanimationæ˜¯åœ¨ä¸€ä¸ªanimation groupä¸­ï¼Œåˆ™beginTimeå°±æ˜¯å…¶parent objectâ€”â€”animation group å¼€å§‹çš„ä¸€ä¸ªåç§»ã€‚å¦‚æœä¸€ä¸ªanimation çš„ beginTimeä¸º5ï¼Œåˆ™æ­¤åŠ¨ç”»åœ¨group aniamtionå¼€å§‹ä¹‹åçš„5såœ¨å¼€å§‹åŠ¨ç”»ã€‚å¦‚æœä¸€ä¸ªanimationæ˜¯ç›´æ¥æ·»åŠ åœ¨layerä¸Šï¼ŒbeginTimeåŒæ ·æ˜¯æ˜¯å…¶parent objectâ€”â€”layer å¼€å§‹çš„ä¸€ä¸ªåç§»ï¼Œä½†æ˜¯ä¸€ä¸ªlayerçš„beginningæ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¶é—´ï¼ˆçŒœæƒ³layerçš„beginningå¯èƒ½æ˜¯å…¶è¢«æ·»åŠ åˆ°layer treeä¸Šçš„æ—¶é—´ï¼‰ï¼Œå› æ­¤ä¸èƒ½ç®€å•çš„è®¾ç½®beginTimeä¸º5å»å»¶è¿ŸåŠ¨ç”»5sä¹‹åå¼€å§‹ï¼Œå› ä¸ºæœ‰å¯èƒ½layerçš„beginningåŠ ä¸Š5sä¹‹åä¹Ÿæ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¶é—´ï¼ˆå¾ˆæœ‰å¯èƒ½ï¼‰ï¼Œå› æ­¤ï¼Œå½“è¦å»¶è¿Ÿä¸€ä¸ªæ·»åŠ åˆ°layerä¸Šçš„åŠ¨ç”»çš„æ—¶å€™ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªaddTimeï¼Œå› æ­¤ï¼š</p>
<pre><code class="objective-c">addTime = [layer convertTime:CACurrentMediaTime() fromLayer:nil]; // å–å¾—layeræ—¶é—´ç³»ä¸‹çš„ç°åœ¨æ—¶é—´
animation.beginTime = addTime + delay; // è®¾ç½®animationçš„æ—¶é—´ç³»çš„åŸç‚¹ï¼Œè¦å‚ç…§layerçš„æ—¶é—´ç³»ã€‚
</code></pre>
<p>å¦‚æœä¸€ä¸ªlayerä»–è‡ªå·±çš„beginTimeå·²ç»è®¾ç½®ï¼Œåˆ™animationçš„addTimeçš„è®¡ç®—å¿…é¡»åœ¨layerçš„beginTimeè®¾ç½®ä¹‹åï¼Œå› ä¸ºè¦æœ‰ä¸€ä¸ªæ—¶é—´çš„è½¬ç§»ï¼Œå…·ä½“çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<pre><code class="objective-c">CFTimeInterval currentTime = CACurrentMediaTime();
CFTimeInterval currentTimeInSuperLayer = [superLayer convertTime:currentTime fromLayer:nil];
layer.beginTime = currentTimeInSuperLayer + 2; // è®¾ç½®layerçš„æ—¶é—´ç³» ä»layerçš„superLayerè¿›è¡Œè®¾ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´layerçš„æ—¶é—´ç³»çš„åŸç‚¹æ˜¯ç°åœ¨çš„Globalæ—¶é—´åœ¨superLayeræ—¶é—´ç³»é‡Œé¢åŠ 2sã€‚ ä½†æ˜¯è¦æŠŠç°åœ¨çš„globalæ—¶é—´æ¢æˆsuperLayerçš„æ—¶é—´ã€‚
CFTimeInterval currentTimeInLayer = [layer convertTime:currentTimeInSuperLayer fromLayer:superLayer];
CFTimeInterval addTime = currentTimeInLayer;
CAAnimationGroup *group = [CAAnimationGroup animation];
group.beginTime = addTime + 1; // è®¾ç½®groupAnimationçš„æ—¶é—´ç³»ï¼Œ æ˜¯ç°åœ¨æ—¶é—´çš„Globalæ—¶é—´åœ¨layerçš„æ—¶é—´ç³»é‡Œé¢åŠ 1sã€‚(è‹¥speedéƒ½ä¸€æ ·çš„è¯ï¼Œé‚£ä¹ˆå°±æ˜¯layeræ—¶é—´ç³»çš„-1sçš„ä½ç½®)ã€‚
group.animations = [NSArray arrayWithObject:anim];
group.duration = 2;
anim.beginTime = 0.5;
[layer addAnimation:group forKey:nil];
</code></pre>
<p>â€‹</p>
</li>
<li><p><strong>speed</strong>å±æ€§ï¼šè¡¨ç¤ºçš„æ˜¯æ—¶é—´çš„ç³»æ•°ã€‚é»˜è®¤ä¸º1ï¼Œè¡¨ç¤º1å€é€Ÿã€‚å¦‚æœdurationæ˜¯1sï¼Œä½†æ˜¯speedæ˜¯2ï¼Œé‚£ä¹ˆæ‰§è¡Œæ—¶é—´åªæœ‰0.5sï¼Œä¹Ÿå°±æ˜¯2å€é€Ÿã€‚</p>
</li>
<li><p><strong>timeOffset</strong>å±æ€§ï¼šè¡¨ç¤ºåŠ¨ç”»ä»timeOffsetçš„ä½ç½®å¼€å§‹ï¼ŒåŠ¨ç”»åˆ°ç»ˆç‚¹ç»“æŸåå›åˆ°èµ·ç‚¹å†åŠ¨ç”»åˆ°timeOffsetçš„ä½ç½®ã€‚å®ƒè®¡ç®—å‡ºæ¥çš„å¼€å§‹ä½ç½®ä¸å—speedçš„å½±å“ã€‚</p>
</li>
<li><p>å½“è®¾ç½®<strong>removeOnCompletion</strong>å±æ€§ä¸ºNOæ—¶ï¼Œè¯´æ˜åŠ¨ç”»å®Œæˆæ—¶ï¼Œè¿™ä¸ªåŠ¨ç”»æ²¡æœ‰ä»layerä¸Šé¢åˆ é™¤ã€‚è¿™æ—¶å€™å¯ä»¥è®¾ç½®<strong>fillMode</strong>å±æ€§ã€‚è¿™ä¸ªå±æ€§é»˜è®¤ä¸ºkCAFillModeRemovedï¼Œè¡¨ç¤ºè¢«åŠ¨ç”»çš„å±æ€§åœ¨model layerä¸Šé¢éƒ½ä¸æ›¾å˜åŒ–ã€‚å¯ä»¥å°†fillModeå±æ€§è®¾ç½®æˆå…¶ä»–çš„ï¼Œé‚£ä¹ˆmodel layerä¸Šé¢çš„å±æ€§ä¼šåœ¨åŠ¨ç”»ç»“æŸæ—¶è‡ªåŠ¨æ›´æ–°å°†å…¶è®¾ç½®æˆpresentation layerä¸Šé¢ä¸€æ ·çš„å€¼ã€‚è¿™ä¸ªæ—¶å€™è¦æ³¨æ„ï¼Œåœ¨æ·»åŠ animationçš„æ—¶å€™è¦æŒ‡å®šä¸€ä¸ªkeyï¼Œä»¥ç¡®ä¿ä¹‹åå¯ä»¥æ–¹ä¾¿åˆ é™¤è¿™ä¸ªåŠ¨ç”»ã€‚</p>
</li>
</ol>
<h4 id="Hierarchical-Time"><a href="#Hierarchical-Time" class="headerlink" title="Hierarchical Time"></a>Hierarchical Time</h4><ol>
<li><p>layerçš„åŠ¨ç”»æ—¶é—´ä¹Ÿæ˜¯æœ‰ç›¸å¯¹åæ ‡ç³»çš„ï¼Œç±»ä¼¼layerçš„ä½ç½®ï¼Œæ—¶é—´ä¹Ÿæ˜¯ç›¸å¯¹äºsuper layerçš„ã€‚</p>
</li>
<li><p>æ”¹å˜CALayeræˆ–è€…CAGroupAnimationçš„beginTimeï¼ŒtimeOffsetä»¥åŠspeedå±æ€§ä¼šå½±å“åˆ°sublayerçš„åŠ¨ç”»æ—¶é—´ã€‚</p>
</li>
<li><p>Core Animationæœ‰ä¸€ä¸ª<strong>global time</strong>çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªè®¾å¤‡çš„å„ä¸ªç¨‹åºé—´å…±åŒçš„ä¸€ä¸ªæ—¶é—´ä½“ç³»ã€‚å®ƒæ˜¯ä¸€ä¸ª<em>mach time</em>ï¼Œå¯ä»¥é€šè¿‡ä¸‹åˆ—ä»£ç è·å¾—å½“å‰çš„global timeï¼š</p>
<pre><code class="objective-c">CFTimeInterval time = CACurrentMediaTime();
</code></pre>
<p>è¿™ä¸ªå‡½æ•°è¿”å›çš„å€¼å¾ˆå¥‡æ€ªï¼Œå®ƒè¡¨ç¤ºè®¾å¤‡ä»ä¸Šä¸€æ¬¡rebootåˆ°ç°åœ¨çš„ç§’æ•°ã€‚</p>
</li>
<li><p>æ¯ä¸ªCALayerå’ŒCAAnimationè¿˜æœ‰è‡ªå·±çš„ä¸€ä¸ª<strong>local time</strong>çš„æ¦‚å¿µã€‚å¯ä»¥å°†2ä¸ªlayerä¹‹é—´çš„æ—¶é—´è¿›è¡Œè½¬æ¢ï¼š</p>
<pre><code class="objective-c">- (CFTimeInterval)convertTime:(CFTimeInterval)t fromLayer:(CALayer *)l; 
- (CFTimeInterval)convertTime:(CFTimeInterval)t toLayer:(CALayer *)l;
</code></pre>
</li>
<li><p>ä½¿ç”¨<code>self.window.layer.speed = 100;</code>ä¼šä½¿ä½ çš„æ•´ä¸ªappä»¥100å€é€Ÿè¿è¡Œã€‚</p>
</li>
<li><p>æ¥çœ‹ä¸€ä¸ªè‡ªå·±å†™çš„ä»£ç ï¼š</p>
<pre><code class="objective-c">- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.
    UIView *baseView1 = [[UIView alloc]initWithFrame:CGRectMake(50, 50, 50, 50)];
    baseView1.backgroundColor = [UIColor redColor];
    [self.view addSubview:baseView1];
    UIView *baseView2 = [[UIView alloc]initWithFrame:CGRectMake(50, 250, 50, 50)];
    baseView2.backgroundColor = [UIColor redColor];
    [self.view addSubview:baseView2];
    UIView *baseView3 = [[UIView alloc]initWithFrame:CGRectMake(50, 450, 50, 50)];
    baseView3.backgroundColor = [UIColor redColor];
    [self.view addSubview:baseView3];
    UIView *baseView = [[UIView alloc]initWithFrame:CGRectMake(50, 50, 50, 50)];
    baseView.backgroundColor = [UIColor yellowColor];
    [self.view addSubview:baseView];

    CABasicAnimation *animation = [CABasicAnimation animation];
    animation.duration = 4;
    //animation.repeatCount = 2;
    //baseView.layer.speed = 0.5;
    animation.keyPath = @&quot;position&quot;;
    animation.toValue = [NSValue valueWithCGPoint:CGPointMake(75, 475)];
    animation.timeOffset = 2;
    //animation.removedOnCompletion = NO;
    //animation.fillMode = kCAFillModeBoth;
    animation.beginTime = [baseView.layer convertTime:CACurrentMediaTime() fromLayer:nil] + 2;
    [baseView.layer addAnimation:animation forKey:@&quot;base&quot;];
}
</code></pre>
</li>
</ol>
<h4 id="Manual-Animation"><a href="#Manual-Animation" class="headerlink" title="Manual Animation"></a>Manual Animation</h4><p>çœ‹æ®µä»£ç ï¼š</p>
<pre><code class="objective-c">@interface ViewController ()
@property (nonatomic, strong) CALayer *doorLayer;
@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.
    self.doorLayer = [CALayer layer];
    self.doorLayer.frame = CGRectMake(0, 0, 128, 256);
    self.doorLayer.position = CGPointMake(150 - 64, 150);
    self.doorLayer.anchorPoint = CGPointMake(0, 0.5);
    //self.doorLayer.contents = (__bridge id)[UIImage imageNamed:@&quot;Door.png&quot;].CGImage;
    self.doorLayer.backgroundColor = [UIColor redColor].CGColor;
    [self.view.layer addSublayer:self.doorLayer];

    //apply perspective transform
    CATransform3D perspective = CATransform3DIdentity; perspective.m34 = -1.0 / 500.0;
    self.view.layer.sublayerTransform = perspective;
    //add pan gesture recognizer to handle swipes
    UIPanGestureRecognizer *pan = [[UIPanGestureRecognizer alloc] init];
    [pan addTarget:self action:@selector(pan:)];
    [self.view addGestureRecognizer:pan];
    //pause all layer animations
    self.doorLayer.speed = 0.0;
    //apply swinging animation (which won&#39;t play because layer is paused)
    CABasicAnimation *animation = [CABasicAnimation animation];
    animation.keyPath = @&quot;transform.rotation.y&quot;; animation.toValue = @(-M_PI_2);
    animation.duration = 1.0;
    [self.doorLayer addAnimation:animation forKey:nil];
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

- (void)pan:(UIPanGestureRecognizer *)pan {
    //get horizontal component of pan gesture
    CGFloat x = [pan translationInView:self.view].x;
    //convert from points to animation duration //using a reasonable scale factor
    x /= 200.0f;
    //update timeOffset and clamp result
    CFTimeInterval timeOffset = self.doorLayer.timeOffset;
    timeOffset = MIN(0.999, MAX(0.0, timeOffset - x));
    self.doorLayer.timeOffset = timeOffset;
    //reset pan gesture
    [pan setTranslation:CGPointZero inView:self.view];
}

@end
</code></pre>
<p>ç”±äºåœ¨åŠ¨ç”»æ‰§è¡Œè¿‡ç¨‹ä¸­æ— æ³•æ”¹å˜animationçš„å±æ€§ï¼Œæ‰€ä»¥å¯ä»¥æ›´æ”¹å®ƒçš„ä¸Šä¸€çº§ï¼Œä¹Ÿå°±æ˜¯layerçš„å±æ€§ã€‚å°†speedè®¾ç½®æˆ0ï¼Œæ‰€ä»¥åŠ¨ç”»æš‚åœï¼Œç›¸å½“äºåŠ¨ç”»ä¸€ç›´åœ¨æ‰§è¡Œå´å§‹ç»ˆæ˜¯åœ¨ç¬¬ä¸€å¸§ä¸Šé¢æ‰§è¡Œã€‚æ ¹æ®æ‰‹åŠ¿æ¥æ”¹å˜layerçš„timeOffsetï¼Œé‚£ä¹ˆåœ¨ä¸‹ä¸€æ¬¡åŠ¨ç”»æ¸²æŸ“å±å¹•çš„æ—¶å€™ï¼ˆä¹Ÿå°±æ˜¯ç”»ä¸‹ä¸€å¸§presentation layerçš„æ—¶å€™ï¼‰ï¼ŒåŠ¨ç”»å‘ç°è¿˜å¤„åœ¨ç¬¬ä¸€å¸§ï¼Œä½†æ˜¯timeOffsetå·²ç»å˜äº†ï¼Œæ‰€ä»¥å°±è·Ÿç€æ‰‹æŒ‡ç§»åŠ¨äº†ã€‚</p>
<h3 id="Easing"><a href="#Easing" class="headerlink" title="Easing"></a>Easing</h3><h4 id="Animation-Velocity"><a href="#Animation-Velocity" class="headerlink" title="Animation Velocity"></a>Animation Velocity</h4><ol>
<li>Easingæ˜¯ä¸ºäº†æ¨¡ä»¿ç°å®ä¸­çš„æœ‰åŠ é€Ÿåº¦çš„è¿™ç§è¿åŠ¨ã€‚</li>
<li>ä¸ºäº†ä½¿ç”¨easingï¼Œå¯ä»¥è®¾ç½®CAAnimationçš„<strong>timingFunction</strong>å±æ€§ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨CATransactionçš„<code>+setAnimationTimingFunction:</code>æ–¹æ³•å°†easingåº”ç”¨åˆ°éšå¼åŠ¨ç”»ä¸Šé¢ã€‚è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ª<strong>CAMediaTimingFunction</strong>å¯¹è±¡ã€‚</li>
<li>åˆ›å»ºCAMediaTimingFunctionå¯¹è±¡çš„æ–¹æ³•å¾ˆå¤šã€‚ç®€å•çš„å°±æ˜¯ä½¿ç”¨<code>+timingFunctionWithName:</code>æ–¹æ³•ã€‚åœ¨UIViewçš„åŠ¨ç”»ä¸­ï¼ŒkCAMediaTimingFunctionEaseInEaseOutæ˜¯é»˜è®¤çš„ï¼Œä½†æ˜¯CAAnimationå°±è¦ä½ è‡ªå·±å»æŒ‡å®šä¸€ä¸ªã€‚æ³¨æ„éšå¼åŠ¨ç”»ä¸­çš„é»˜è®¤å€¼æ˜¯kCAMediaTimingFunctionDefaultï¼Œä½†æ˜¯æ˜¾å¼åŠ¨ç”»ä¸­æ²¡æœ‰é»˜è®¤çš„å€¼ã€‚</li>
<li>CAKeyframeAnimationæœ‰ä¸€ä¸ª<strong>timingFunctions</strong>å±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚æ•°ç»„çš„é•¿åº¦æ˜¯<strong>keyframes</strong>æ•°ç»„çš„é•¿åº¦å‡ä¸€ã€‚å®ƒè¡¨ç¤ºæ¯ä¸ªå…³é”®å¸§ä¹‹é—´çš„easingå±æ€§ã€‚</li>
</ol>
<h4 id="Custom-Easing-Functions"><a href="#Custom-Easing-Functions" class="headerlink" title="Custom Easing Functions"></a>Custom Easing Functions</h4><ol>
<li><p>å¯ä»¥ä½¿ç”¨CAMediaTimingFunctionçš„<code>+functionWithControlPoints::::</code>æ–¹æ³•æ¥åˆ›å»ºè‡ªå®šä¹‰çš„easingæ•ˆæœã€‚è¿™ä¸ªæ–¹æ³•çš„å‘½åä¸å¤ªç¬¦åˆappleçš„è§„èŒƒã€‚</p>
</li>
<li><p>ä¸Šé¢å‡½æ•°çš„4ä¸ªç‚¹ç”¨æ¥æ„æˆä¸€ä¸ªbezierPathï¼Œè¿™ä¸ªbezierPathå¯ä»¥è¡¨ç¤ºè¿™ä¸ªåŠ¨ç”»çš„easingæ•ˆæœã€‚bezierPathçš„åˆ‡çº¿å°±æ˜¯é€Ÿåº¦ã€‚todo å›¾ç‰‡</p>
</li>
<li><p>appleå®šä¹‰çš„å‡ ä¸ªeasingæ•ˆæœä¹Ÿæ˜¯è¿™æ ·å®ç°çš„ï¼Œå¯ä»¥ä½¿ç”¨CAMediaTimingFunctionçš„<code>-getControlPointAtIndex:values:</code>æ–¹æ³•æ¥è·å–4ä¸ªç‚¹ã€‚ç¬¬ä¸€ä¸ªç‚¹æ˜¯èµ·ç‚¹ï¼Œç¬¬å››ä¸ªç‚¹æ˜¯ç»ˆç‚¹ï¼Œä¸­é—´ä¸¤ä¸ªç‚¹æ˜¯æ§åˆ¶ç‚¹1å’Œæ§åˆ¶ç‚¹2ã€‚æ¥çœ‹çœ‹å°†å‡ ç§ç³»ç»Ÿå®ç°çš„easingæ•ˆæœçš„bezierPathç”»å‡ºæ¥çš„ä»£ç ï¼š</p>
<pre><code class="objective-c">- (void)viewDidLoad {
    [super viewDidLoad];
    //create timing function
    CAMediaTimingFunction *function = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseOut];
    //get control points
    CGPoint controlPoint1, controlPoint2;
    [function getControlPointAtIndex:1 values:(float *)&amp;controlPoint1];         [function getControlPointAtIndex:2 values:(float *)&amp;controlPoint2];
    //create curve
    UIBezierPath *path = [[UIBezierPath alloc] init]; 
      [path moveToPoint:CGPointZero];
    [path addCurveToPoint:CGPointMake(1, 1) controlPoint1:controlPoint1 controlPoint2:controlPoint2];
    //scale the path up to a reasonable size for display
    [path applyTransform:CGAffineTransformMakeScale(200, 200)];
    //create shape layer
    CAShapeLayer *shapeLayer = [CAShapeLayer layer]; 
      shapeLayer.strokeColor = [UIColor redColor].CGColor; 
      shapeLayer.fillColor = [UIColor clearColor].CGColor; 
      shapeLayer.lineWidth = 4.0f;
    shapeLayer.path = path.CGPath; 
      [self.layerView.layer addSublayer:shapeLayer];
    //flip geometry so that 0,0 is in the bottom-left
    self.layerView.layer.geometryFlipped = YES; 
}
</code></pre>
</li>
<li><p>å¥‡æ€ªçš„æ˜¯è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼Œå®ƒä¸ä¼ CGPointï¼Œè€Œæ˜¯ä¼ é€’çš„floatã€‚å¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">[CAMediaTimingFunction functionWithControlPoints:1 :0 :0.75 :1];
</code></pre>
<p>å…¶ä¸­ï¼ˆ1ï¼Œ0ï¼‰è¡¨ç¤ºç¬¬ä¸€ä¸ªæ§åˆ¶ç‚¹ï¼Œï¼ˆ0.75ï¼Œ 1ï¼‰è¡¨ç¤ºç¬¬äºŒä¸ªæ§åˆ¶ç‚¹ã€‚</p>
</li>
<li><p>è‡³äºæ›´åŠ å¤æ‚çš„easingæ•ˆæœå¯ä»¥ä½¿ç”¨Keyframe-Based Easingã€‚å°±æ˜¯å°†å¤æ‚çš„easingåˆ†æˆå¤šä¸ªkeyframeï¼Œæ¯ä¸ªkeyframeä¹‹é—´ç”±ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰easingæ•ˆæœæ¥å®ç°ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦ç¹ççš„è®¡ç®—é‡ã€‚ todo å¤æ‚çš„bezierPathçš„å›¾ç‰‡</p>
</li>
<li><p>è¿˜æœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•å°±æ˜¯ï¼šæ¯1/60så®šä¹‰ä¸€ä¸ªkeyframeï¼Œåœ¨æ¯ä¸ªkeyframeä¹‹é—´éƒ½æ˜¯çº¿æ€§å˜åŒ–çš„ã€‚åªè¦æ±‚å¾—æ¯ä¸ªkeyframeçš„ä½ç½®å°±å¯ä»¥åšå‡ºæµç•…çš„åŠ¨ç”»ã€‚å–1/60sæ˜¯å› ä¸ºiOS1/60sæ¸²æŸ“ä¸€æ¬¡å±å¹•ï¼Œè¿™ä¸ªå€¼å·²ç»æ˜¯æœ€ä½³çš„äº†ï¼Œæ¯æ¬¡æ¸²æŸ“å±å¹•çš„æ—¶å€™éƒ½æœ‰ä¸€ä¸ªè‡ªå·±è®¾çš„å€¼ï¼Œå·²ç»æ˜¯åˆ°è¾¾æœ€ç²¾ç¡®çš„æ§åˆ¶äº†ã€‚å…¶å®è¿™ä¸ªæ—¶å€™ä¸¤ä¸ªå…³é”®å¸§ä¹‹é—´ç”¨ä»€ä¹ˆå˜åŒ–éƒ½æ— æ‰€è°“çš„ï¼Œä»–åªæ˜¯æ¸²æŸ“ä¸¤æ¬¡è€Œå·²ï¼Œä¸å­˜åœ¨ä»€ä¹ˆå˜åŒ–ã€‚è‡³äºæ¯ä¸ªå…³é”®å¸§çš„ä½ç½®å¦‚ä½•æ±‚å¾—ï¼Œå¯ä»¥åœ¨<a href="http://robertpenner.com/easingæ‰¾åˆ°ç®—æ³•ã€‚" target="_blank" rel="external">http://robertpenner.com/easingæ‰¾åˆ°ç®—æ³•ã€‚</a></p>
</li>
</ol>
<h3 id="Timer-Based-Animation"><a href="#Timer-Based-Animation" class="headerlink" title="Timer-Based Animation"></a>Timer-Based Animation</h3><h4 id="Frame-Timing"><a href="#Frame-Timing" class="headerlink" title="Frame Timing"></a>Frame Timing</h4><ol>
<li><p>ä¸Šé¢è®²åˆ°çš„1/60så®šä¹‰ä¸€ä¸ªkeyframeï¼Œå…¶å®è¿˜å¯ä»¥ä½¿ç”¨NSTimeræ¥å®ç°ã€‚ä¹Ÿå°±æ˜¯1/60så°±æ‰§è¡Œä¸€æ¬¡æ›´æ–°å±æ€§çš„æ“ä½œï¼Œç„¶åå°±ä¼šé‡æ–°ç»˜åˆ¶å‡ºæ¥ã€‚ä½†æ˜¯ä½¿ç”¨NSTimerä¼šä¸å¤ªç²¾ç¡®ã€‚</p>
</li>
<li><p>NSTimerå’Œå±å¹•é‡æ–°ç»˜åˆ¶éƒ½æ˜¯ä¸»çº¿ç¨‹çš„ä»»åŠ¡ï¼Œä¸»çº¿ç¨‹ä¸­çš„ä»»åŠ¡éƒ½è¦ç­‰åˆ°ä¹‹å‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆåå†å¼€å§‹æ‰§è¡Œã€‚æ‰€ä»¥å½“åˆ°äº†æ‰§è¡ŒNSTimeræˆ–è€…å½“éœ€è¦å¼€å§‹é‡æ–°ç»˜åˆ¶å±å¹•æ—¶ï¼Œå¦‚æœè¿™æ—¶å€™ä¹‹å‰çš„ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œç»“æŸï¼Œåˆ™éœ€è¦ç­‰å¾…ã€‚è¿™æ—¶æ— è®ºNSTimerè¿˜æ˜¯é‡æ–°ç»˜åˆ¶éƒ½ä¼šæœ‰ä¸€äº›å»¶è¿Ÿã€‚æ‰€ä»¥å¯èƒ½å‡ºç°ï¼Œéœ€è¦ç»˜åˆ¶æ—¶ï¼ŒNSTimerè¿˜æ²¡æ›´æ–°ï¼Œæˆ–è€…åœ¨ä¸€æ¬¡ç»˜åˆ¶æ—¶NSTimerå·²ç»æ›´æ–°äº†å¤šæ¬¡çš„æƒ…å†µã€‚è¿™æ—¶å€™å°±ä¼šå‡ºç°animationçš„è¿Ÿæ»æˆ–è€…è·³å¸§ã€‚çœ‹çœ‹è¿™ä¸ªçš„è§£å†³æ–¹æ¡ˆã€‚</p>
</li>
<li><p><strong>CADisplayLink</strong>å’ŒNSTimerç±»ä¼¼ï¼Œä½†æ˜¯ä»–èƒ½ä¿è¯åœ¨å±å¹•é‡æ–°ç»˜åˆ¶ä¹‹å‰è¢«è§¦å‘ã€‚ä½†æ˜¯ä»–ä¸æ˜¯é€šè¿‡æŒ‡å®šä¸€ä¸ª<strong>timeInterval</strong>æ¥è§¦å‘ï¼Œè€Œæ˜¯é€šè¿‡<strong>frameInterval</strong>æ¥æŒ‡å®šä¸¤æ¬¡è§¦å‘ä¹‹é—´ç›¸éš”å¤šå°‘å¸§ã€‚ä½†æ˜¯å®ƒè¿˜æ˜¯æ— æ³•ä¿è¯é‡æ–°ç»˜åˆ¶å±å¹•èƒ½æŒ‰æ—¶å‘ç”Ÿã€‚</p>
</li>
<li><p>æ ¹æ®ä¸Šé¢çš„é—®é¢˜ï¼Œè¿™æ—¶å°±éœ€è¦ç²¾ç¡®è®¡ç®—ä¸Šä¸€å¸§å‘ç”Ÿçš„æ—¶é—´ï¼Œå’Œå½“å‰å¸§å‘ç”Ÿçš„æ—¶é—´ã€‚ä¸¤è€…ç›¸å‡å°±å¯ä»¥çŸ¥é“é—´éš”æ—¶é—´ï¼Œå°±èƒ½ç®—å‡ºç°åœ¨è¿™ä¸€å¸§è¯¥åŠ¨ç”»åˆ°ä»€ä¹ˆç¨‹åº¦ã€‚æ¥çœ‹çœ‹ä»£ç ï¼š</p>
<pre><code class="objective-c">- (void)animate {
    //reset ball to top of screen
    self.ballView.center = CGPointMake(150, 32);
    //configure the animation
    self.duration = 1.0;
    self.timeOffset = 0.0;
    self.fromValue = [NSValue valueWithCGPoint:CGPointMake(150, 32)];             self.toValue = [NSValue valueWithCGPoint:CGPointMake(150, 268)];
    //stop the timer if it&#39;s already running
    [self.timer invalidate];
    //start the timer
    self.lastStep = CACurrentMediaTime();
    self.timer = [CADisplayLink displayLinkWithTarget:self
    selector:@selector(step:)]; 
      [self.timer addToRunLoop:[NSRunLoop mainRunLoop] forMode:NSDefaultRunLoopMode];
}
- (void)step:(CADisplayLink *)timer {
    //calculate time delta
    CFTimeInterval thisStep = CACurrentMediaTime(); 
      CFTimeInterval stepDuration = thisStep - self.lastStep; self.lastStep = thisStep;
    //update time offset
    self.timeOffset = MIN(self.timeOffset + stepDuration, self.duration);
    //get normalized time offset (in range 0 - 1)
    float time = self.timeOffset / self.duration;
    //apply easing
    time = bounceEaseOut(time);
    //interpolate position
    id position = [self interpolateFromValue:self.fromValue toValue:self.toValue time:time]; 
      self.ballView.center = [position CGPointValue];
    //stop the timer if we&#39;ve reached the end of the animation
    if (self.timeOffset &gt;= self.duration) {
        [self.timer invalidate];
        self.timer = nil; 
    }
}
</code></pre>
</li>
</ol>
<h4 id="Physical-Simulation"><a href="#Physical-Simulation" class="headerlink" title="Physical Simulation"></a>Physical Simulation</h4><p>çœ‹çš„æ™•å¤´è½¬å‘ã€‚ã€‚ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="http://blog.csdn.net/yaozhuoyu/article/details/9566511" target="_blank" rel="external">CAMediaTiming åè®®å±æ€§è¯¦è§£</a></li>
<li><a href="http://robertpenner.com/easing" target="_blank" rel="external">Robert Penner`s Easing Functions</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> è¯»ä¹¦ç¬”è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS Core Animation - The Layer Beneath]]></title>
      <url>/2016/07/01/iOS-Core-Animation-reading-note-one/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><strong>iOS Core Animation</strong>  è¯»ä¹¦ç¬”è®°ï¼ˆä¸€ï¼‰<strong>The Layer Beneath</strong></p>
<a id="more"></a>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="The-Layer-Tree"><a href="#The-Layer-Tree" class="headerlink" title="The Layer Tree"></a>The Layer Tree</h3><ol>
<li><strong>Layer Kit</strong>: é«˜æ•ˆçš„ï¼Œç¡¬ä»¶åŠ é€Ÿçš„æ··åˆæ¡†æ¶ï¼Œ ç”¨æ¥æ›¿ä»£ä»¥Quartzä¸ºåŸºç¡€çš„ï¼Œç›¸å¯¹ä½æ•ˆçš„AppKitæ¡†æ¶ã€‚å®ƒä¹Ÿå°±æ˜¯Core Animationçš„åŸºç¡€ã€‚</li>
<li><strong>Core Animation</strong> ä¸ä»…ä»…åªå’ŒåŠ¨ç”»æœ‰å…³ï¼Œå®ƒæ˜¯iOSçš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œä½ åœ¨å±å¹•ä¸Šçœ‹åˆ°çš„æ‰€æœ‰ä¸œè¥¿éƒ½ç”±å®ƒæ¥powerã€‚</li>
<li><strong>Core Animation</strong>çš„ä¸»è¦å·¥ä½œæ˜¯å°†å„ä¸ªå¯è§†åŒ–çš„layeræ˜¾ç¤ºåœ¨å±å¹•ä¸Šé¢ã€‚ä¹Ÿå°±æ˜¯å°†layer treeæ˜¾ç¤ºå‡ºæ¥ã€‚</li>
<li><strong>UIView</strong> handles touch events and supports <em>Core Graphics</em>-based drawing, affine transform, and simple animations such as sliding and fading.</li>
<li>ä½†æ˜¯UIViewå¹¶ä¸æ˜¯äº²è‡ªå¤„ç†è¿™äº›ä»»åŠ¡ä¸­çš„å¤§éƒ¨åˆ†ã€‚æ¸²æŸ“ï¼Œå¸ƒå±€ï¼ŒåŠ¨ç”»â€¦è¿™äº›ä»»åŠ¡å…¶å®éƒ½æ˜¯ç”±<em>Core Animation</em>é‡Œé¢çš„<strong>CALayer</strong>æ¥å®Œæˆçš„ã€‚</li>
<li><em>CALayer</em>ä¸è´Ÿè´£ç”¨æˆ·äº¤äº’(<strong>user interaction</strong>)ï¼Œå’Œ<em>responder chain</em>æ²¡æœ‰è”ç³»ã€‚</li>
<li>æ¯ä¸€ä¸ªUIViewéƒ½æœ‰ä¸€ä¸ªlayerå±æ€§ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªCALayerã€‚å®é™…ä¸Šï¼ŒUIViewå¹¶æ²¡æœ‰åšä»€ä¹ˆäº‹æƒ…ï¼Œå…³äºåœ¨å±å¹•ä¸Šçš„æ˜¾ç¤ºå’ŒåŠ¨ç”»åŸºæœ¬ä¸Šéƒ½æ˜¯ç”±CALayeræ¥å®Œæˆã€‚UIViewå¯ä»¥è¯´åªæ˜¯ä¸€ä¸ªCALayerçš„wrapperï¼Œè´Ÿè´£ä¸€äº›æ‰‹åŠ¿å¤„ç†ï¼Œä»¥åŠä¸€äº›é«˜å±‚é¢çš„å¯¹äºCore Animationçš„ä¸€äº›APIçš„å°è£…ã€‚</li>
<li>æ€»ç»“æ¥è¯´ï¼šUIViewä¸»è¦è´Ÿè´£å¤„ç†äº‹ä»¶ä»¥åŠç”¨æˆ·äº¤äº’ï¼Œè€ŒCALayerä¸»è¦è´Ÿè´£æ˜¾ç¤ºå’ŒåŠ¨ç”»ã€‚</li>
</ol>
<h3 id="The-Backing-Image"><a href="#The-Backing-Image" class="headerlink" title="The Backing Image"></a>The Backing Image</h3><h4 id="The-Contents-Image"><a href="#The-Contents-Image" class="headerlink" title="The Contents Image"></a>The Contents Image</h4><ol>
<li><p>CALayerå¯ä»¥åŒ…å«ä¸€ä¸ªå›¾ç‰‡ï¼›å›¾ç‰‡é‡Œé¢ï¼Œä½ æƒ³æ˜¾ç¤ºå•¥å°±æ˜¾ç¤ºå•¥ã€‚è¿™å°±æ˜¯CALayerçš„<em>backing image</em>ã€‚</p>
</li>
<li><p>CALayeræœ‰ä¸€ä¸ª<strong>contents</strong>å±æ€§ï¼Œç»™è¿™ä¸ªcontentså±æ€§èµ‹å€¼å…¥é”…ä¸æ˜¯CGImageçš„è¯ï¼Œè¿™ä¸ªLayerè¿˜æ˜¯ä»€ä¹ˆéƒ½æ²¡æœ‰æ˜¾ç¤ºã€‚è¦è¿™èˆ¬èµ‹å€¼ï¼š</p>
<pre><code class="objective-c">layer.contents = (__bridge id)image.CGImage;
</code></pre>
<p>å› ä¸ºï¼Œè¦çœŸæ­£èµ‹å€¼ç»™contentså±æ€§çš„åº”è¯¥æ˜¯ä¸€ä¸ªCGImageRefï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘CGImageçš„ç»“æ„ä½“ï¼›è€ŒUIImageçš„CGImageå±æ€§å°±æ˜¯ä¸€ä¸ªCGImageRefï¼Œä½†ç”±äºä¸æ˜¯ä¸€ä¸ªOCå¯¹è±¡ï¼Œæ— æ³•èµ‹å€¼ç»™idï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨(__bridge id)æ¥è½¬æ¢ã€‚</p>
</li>
<li><p>CALyerçš„<strong>contentsGravity</strong>å±æ€§ç±»ä¼¼äºUIViewçš„contentModeã€‚</p>
</li>
<li><p>CALayerçš„<strong>contentsScale</strong>å±æ€§ä¸Retinaæœ‰å…³ã€‚ï¼ˆæœ‰ç‚¹ä¸æ‡‚ï¼‰</p>
</li>
<li><p><strong>contentsRect</strong>å±æ€§å°†backing imageé™åˆ¶åœ¨å½“å‰CALayerçŸ©å½¢çš„ä¸€ä¸ªå­æ¡†æ¡†é‡Œé¢ã€‚å®ƒä¸æ˜¯æŒ‰ç‚¹æ¥è®¡ç®—çš„ï¼›æŒ‰ç…§ç»Ÿä¸€çš„æ ‡å°ºï¼Œè¿™ä¸ªRectçš„é•¿å’Œå®½æœ€å°ä¸º0ï¼Œæœ€å¤§ä¸º1ã€‚</p>
</li>
<li><p>iOSä¸­ç”¨åˆ°3ä¸­åæ ‡ç±»å‹ï¼š</p>
<ol>
<li><p><strong>Points</strong>ï¼šæœ€å¸¸ç”¨çš„åæ ‡ç±»å‹ï¼Œpointè¡¨ç¤ºé€»è¾‘åƒç´ ã€‚åœ¨æ ‡å‡†æ¸…æ™°åº¦çš„è®¾å¤‡ä¸­ä¸€ä¸ªpointä»£è¡¨ä¸€ä¸ªpixelï¼›åœ¨Retinaè®¾å¤‡ä¸­ï¼Œä¸€ä¸ªpointä»£è¡¨2x2ä¸ªpixelã€‚</p>
</li>
<li><p><strong>Pixels</strong>: ä¸å¸¸ç”¨ï¼Œä¸€èˆ¬å’Œä½¿ç”¨pixelä½œä¸ºåº¦é‡çš„CGImageç­‰ä¸€åŒä½¿ç”¨ã€‚</p>
</li>
<li><p><strong>Unit</strong>ï¼šå°±æ˜¯contentsRectå±æ€§ç”¨åˆ°çš„åæ ‡ç³»ã€‚</p>
<p>exampleï¼š todo æ’å…¥ä¾‹å­</p>
</li>
</ol>
</li>
</ol>
<ol>
<li><p><strong>contentsCenter</strong>:è¯¥å±æ€§æ˜¯ä¸€ä¸ªCGRectï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªå¯ä¼¸ç¼©çš„åŒºåŸŸã€‚å…·ä½“çš„è§ä¸‹å›¾ï¼š(æœ‰ç‚¹ä¸æ¸…æ¥š)</p>
<p>exampleï¼š todo æ’å…¥å›¾ç‰‡</p>
<p>å…¶ä¸­å››ä¸ªé»„è‰²åŒºåŸŸç»„åˆèµ·æ¥æ˜¯åŸå›¾ã€‚é»„è‰²åŒºåŸŸå†…éƒ¨å››ä¸ªç‚¹å…¶å®åŸæ¥æ˜¯ä¸€ä¸ªç‚¹ï¼Œä¹Ÿå°±æ˜¯åŸå›¾çš„ä¸­å¿ƒç‚¹ã€‚</p>
</li>
</ol>
<h4 id="Custom-Drawing"><a href="#Custom-Drawing" class="headerlink" title="Custom Drawing"></a>Custom Drawing</h4><p>é™¤äº†å°†ä¸€ä¸ªCGImageæŒ‡æ´¾ç»™ä¸€ä¸ªCALayerçš„contentsä»¥å¤–ï¼Œè¿˜å¯ä»¥ç›´æ¥åœ¨CALayerçš„<em>backing image</em>ä¸Šé¢ç»˜å›¾ã€‚å…ˆæ¥çœ‹çœ‹æ•´ä¸ªCALayerç”Ÿæˆ<em>backing image</em>çš„è¿‡ç¨‹ã€‚</p>
<ol>
<li><p>æœ‰ä¸€ä¸ªCALayerDelegateçš„åè®®ï¼Œå½“CALayeréœ€è¦å¯¹å®ƒçš„contentè¿›è¡Œå¡«å……æ—¶ï¼Œä¼šå»è¯·æ±‚è¯¥åè®®çš„æ–¹æ³•ã€‚</p>
</li>
<li><p>CALayerå…ˆä¼šè¯·æ±‚ä¸‹åˆ—æ–¹æ³•ï¼š</p>
<pre><code class="objective-c">  - (void)displayLayer:(CALayer *)layer;
</code></pre>
<p>  åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢å¯ä»¥ç›´æ¥è®¾ç½®CALayerçš„contentså±æ€§ã€‚å¦‚æœå®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆCALayerä¸ä¼šå†å»è¯·æ±‚å…¶ä»–çš„æ–¹æ³•æ¥å¡«å……å®ƒçš„å†…å®¹ã€‚</p>
</li>
<li><p>å¦‚æœä¸Šä¸€æ­¥æœªå®ç°è¯¥æ–¹æ³•ï¼ŒCALayerä¼šå»è¯·æ±‚ä¸‹é¢çš„æ–¹æ³•ï¼š</p>
<pre><code class="objective-c">  - (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx;
</code></pre>
<p>  åœ¨è¯·æ±‚è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œ<strong>CALayerä¼šåˆ›å»ºä¸€ä¸ªç©ºç™½çš„backing image</strong>ï¼Œå’Œä¸€ä¸ªåŒ¹é…è¯¥backing imageçš„contextã€‚ç„¶åè°ƒç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œç»˜å›¾ã€‚</p>
</li>
<li><p>åªæœ‰åœ¨è°ƒç”¨äº†<code>[layer display];</code>æ–¹æ³•ä¹‹åï¼Œä¸Šé¢è¯´çš„è¿™äº›delegateæ‰ä¼šè¢«è°ƒç”¨ã€‚</p>
</li>
</ol>
<p>æ‰€ä»¥æ€»ç»“ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼Œé¦–å…ˆå¯ä»¥ç›´æ¥å¯¹CALayerçš„contentsè¿›è¡Œè®¾ç½®ï¼›ç„¶åå¦‚æœå‘ç°è°ƒç”¨äº†<code>[layer display];</code>æ–¹æ³•ï¼Œä¼šè°ƒç”¨<code>- (void)displayLayer:(CALayer *)layer;</code>æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢å¯ä»¥ç›´æ¥è®¾ç½®contentsï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®å°±æ²¿ç”¨ä¹‹å‰çš„contentsï¼›<strong>ä½†æ˜¯å¦‚æœè¿™ä¸ªæ–¹æ³•æ²¡æœ‰å®ç°çš„è¯ï¼Œdisplayæ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªç©ºç™½çš„backing imageæ¥å–ä»£ä¹‹å‰è®¾ç½®çš„contents</strong>ï¼Œç„¶åå†è°ƒç”¨<code>- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx;</code>æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢è¿›è¡Œç»˜å›¾ã€‚</p>
<p><strong>PS</strong>ï¼šCALayerçš„backgroundColorå’Œcontentsæ²¡æœ‰ä¸€ç‚¹å…³ç³»ï¼Œè¯¥æ€ä¹ˆè®¾ç½®å°±æ€ä¹ˆè®¾ç½®ã€‚</p>
<p>å†<strong>PS</strong>ï¼šæˆ‘ä»¬ä¸€èˆ¬æ˜¯ä¸éœ€è¦å»è°ƒç”¨æˆ–è€…å®ç°ä¸Šé¢è¯´çš„æ‰€æœ‰æ–¹æ³•çš„ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡ç›´æ¥è®¾ç½®UIViewæˆ–è€…æ˜¯CALayerçš„å±æ€§æ— æ³•è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯é‡å†™UIViewçš„<code>-drawRect:</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šå¸®æˆ‘ä»¬åœ¨æš—ä¸­å¤„ç†ä¸Šé¢è¯´åˆ°çš„å„ç§æ–¹æ³•ã€‚</p>
<p>å†å†<strong>PS</strong>ï¼šå¦‚æœä¸éœ€è¦è°ƒç”¨<code>-drawRect:</code>æ–¹æ³•ï¼Œé‚£ä¹ˆä¹…ä¸è¦å»é‡å†™å®ƒï¼›å› ä¸ºå³ä½¿æ˜¯ä¸€ä¸ªç©ºçš„<code>-drawRect:</code>æ–¹æ³•ï¼Œç¨‹åºä¹Ÿä¼šèŠ±å†…å­˜å’ŒCPUæ—¶é—´å»åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œç©ºçš„backing imageã€‚</p>
<h3 id="Layer-Geometry"><a href="#Layer-Geometry" class="headerlink" title="Layer Geometry"></a>Layer Geometry</h3><h4 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a>Layout</h4><ol>
<li>å¯¹äºè®¾ç½®UIViewçš„<em>frame</em>ï¼Œ<em>bounds</em>ä»¥åŠ<em>center</em>ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨å¯¹åº”CALayerçš„setterå’Œgetterå‡½æ•°ï¼Œå¯¹CALayerçš„ç›¸å¯¹åº”çš„å±æ€§è¿›è¡Œè®¾ç½®ã€‚</li>
<li>CALayerå¯¹åº”çš„å±æ€§æ˜¯ï¼š<em>frame</em>, <em>bounds</em>, <em>positions</em> å’Œ <em>anchorPoint</em>ã€‚å…¶ä¸­frameå’Œboundså¥½ç†è§£ã€‚<strong>position</strong>çš„å€¼æ˜¯çˆ¶layerçš„åæ ‡ç³»ä¸­çš„ï¼Œå®ƒè¡¨ç¤ºlayerçš„æ—‹è½¬ä¸­å¿ƒã€‚<strong>anchorPoint</strong>çš„å€¼è¡¨ç¤ºpositionçš„é‚£ä¸ªç‚¹åœ¨è‡ªå·±layerçš„boundsä¸Šçš„æ¯”ä¾‹ã€‚æ¯”å¦‚positionæ˜¯ä¸­ç‚¹ï¼Œé‚£ä¹ˆanchorPointå°±æ˜¯(0.5, 0.5)ï¼›å¦‚æœpositionåœ¨å·¦ä¸Šè§’ï¼Œé‚£ä¹ˆanchorPointå°±æ˜¯(0, 0)ã€‚</li>
<li>åœ¨iOSä¸­ï¼Œåæ ‡ç³»åŸç‚¹åœ¨å·¦ä¸Šè§’ï¼›åœ¨Mac OSä¸­ï¼Œåæ ‡ç³»åŸç‚¹åœ¨å·¦ä¸‹è§’ã€‚é€šè¿‡è®¾ç½®CALayerçš„<strong>geometryFlipped</strong>å±æ€§ï¼Œå¯ä»¥æ”¹å˜åæ ‡ç³»ä»å·¦ä¸Šå˜åˆ°å·¦ä¸‹ã€‚åªéœ€å°†geometryFlippedè®¾ç½®ä¸ºYESã€‚</li>
<li>UIViewæ˜¯ä¸¥æ ¼çš„äºŒç»´å¹³é¢ï¼›ä½†æ˜¯ï¼ŒCALayerå­˜åœ¨ä¸‰ç»´ç©ºé—´ã€‚CALayeræœ‰<strong>zPosition</strong>å’Œ<strong>anchorPointZ</strong>å±æ€§ã€‚é™¤äº†ç”¨åœ¨CATransform3Då¤–ï¼Œæ¯”è¾ƒæœ‰ç”¨çš„å°±æ˜¯æ”¹å˜layerçš„ç°å®é¡ºåºï¼ŒzPositionè¶Šå¤§ï¼Œè¶Šé å‰æ˜¾ç¤ºã€‚</li>
</ol>
<h4 id="Hit-Testing"><a href="#Hit-Testing" class="headerlink" title="Hit Testing"></a>Hit Testing</h4><ol>
<li>CALayerä¸çŸ¥é“responder chainçš„å­˜åœ¨ï¼Œä¸èƒ½ç›´æ¥å¤„ç†ç”¨æˆ·çš„äº¤äº’åŠ¨ä½œã€‚åªæœ‰å‡ ä¸ªå‡½æ•°å’Œç”¨æˆ·äº¤äº’æœ‰å…³ã€‚æ¯”å¦‚<code>-hitTest:</code>ã€‚</li>
<li><strong><code>-hitTest:</code></strong> è¿”å›CGPointçš„ç‚¹åœ¨å“ªä¸ªCALayerã€‚</li>
</ol>
<h4 id="Automatic-Layout"><a href="#Automatic-Layout" class="headerlink" title="Automatic Layout"></a>Automatic Layout</h4><ol>
<li>ä½ å¯ä»¥é€šè¿‡UIVIewçš„UIViewAutoresizingMaskå’ŒNSLayoutConstraintç›¸å…³çš„APIæ¥ä½¿ç”¨autolayoutã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³ç›´æ¥é€šè¿‡æ“ä½œCALayeræ¥ä½¿ç”¨autolayoutï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨CALayerDelegateçš„<code>- (void)layoutSublayersOfLayer:(CALayer *)layer;</code>æ–¹æ³•ã€‚ä½†æ˜¯å®ƒä¸å¥½ç”¨ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯ç›´æ¥æ“ä½œUIViewâ€¦</li>
<li>ä¸Šé¢æ˜¯ä¸€ä¸ªä½è¯ï¼šä½ æœ€å¥½ä½¿ç”¨å¸¦layerçš„viewæ¥ç»„ç»‡ä½ çš„ç•Œé¢ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å•ç‹¬çš„layerã€‚</li>
</ol>
<h3 id="Visual-Effects"><a href="#Visual-Effects" class="headerlink" title="Visual Effects"></a>Visual Effects</h3><ol>
<li><strong>cornerRadius</strong>é»˜è®¤çš„åªä¼šå½±å“background colorï¼Œä¸å¯¹backing imageäº§ç”Ÿå½±å“ã€‚ä½†æ˜¯åŠ ä¸Š<strong>masksToBounds</strong>ä¹‹åï¼Œlayerå°±ç¡®ä¿äº†åˆåœ†è§’çš„å±æ€§ã€‚</li>
<li>CALayerçš„borderæ˜¯è¢«èŠ±åœ¨CALayerçš„å†…éƒ¨çš„ï¼Œåœ¨ä»»ä½•çš„sublayerçš„ä¸Šé¢ã€‚</li>
<li>CALayerçš„shadowä¸åŒäºborderçš„æ˜¯ï¼šå®ƒæ˜¯åŸºäºbacking imageçš„è¾¹ç¼˜çš„ï¼Œè€Œä¸æ˜¯boundsçš„è¾¹ç¼˜ã€‚æœ‰ç‚¹å‰å®³</li>
<li>CALayerçš„shadowé€šå¸¸æ˜¯ç”»åœ¨boundsçš„å¤–éƒ¨çš„ï¼Œæ‰€ä»¥ä¼šè¢«masksToBoundsç»™åˆ‡æ‰ã€‚ã€‚ã€‚</li>
<li>CALayerçš„<strong>shadowPath</strong>å±æ€§å¯ä»¥å¼ºåˆ¶æŒ‡å®šä¸€ä¸ªshadowçš„å½¢çŠ¶ã€‚è¯¥å±æ€§çš„å€¼æ˜¯ä¸€ä¸ªCGPathRefã€‚å¯ä»¥ä½¿ç”¨UIBezierPathã€‚</li>
<li>CALayerçš„<strong>mask</strong>å±æ€§ä¹Ÿæ˜¯ä¸€ä¸ªCALayerã€‚ä½†æ˜¯å®ƒçš„ä½œç”¨æ˜¯å®šä¹‰è¿™ä¸ªçˆ¶layerçš„å¯è§çš„éƒ¨åˆ†ã€‚è¿™ä¸ªmask layeræœ€é‡è¦çš„å°±æ˜¯å®ƒçš„è½®å»“ï¼ˆå’Œä¸Šé¢çš„shadowçš„è¾¹ç¼˜æœ‰ç‚¹ç±»ä¼¼ï¼‰ï¼Œå®ƒçš„çˆ¶layeråªä¼šæ˜¾ç¤ºè½®å»“å†…çš„éƒ¨åˆ†ã€‚</li>
<li>CALayerçš„<strong>minificationFilter</strong>å’Œ<strong>magnificationFilter</strong>å±æ€§ç”¨äºæŒ‡å®šå›¾ç‰‡æ”¾å¤§ç¼©å°æ—¶å›¾ç‰‡çš„æ˜¾ç¤ºæ–¹å¼ã€‚ä¸“ä¸šä¸€ç‚¹è¯´å°±æ˜¯ç”Ÿæˆå›¾ç‰‡åƒç´ çš„ç®—æ³•ã€‚ä»–ä»¬æœ‰3ä¸ªé€‰é¡¹ï¼škCAFilterLinearï¼ŒkCAFilterNearestå’ŒkCAFilterTrilinerarã€‚å…¶ä¸­ï¼Œnearesté€‚åˆç”¨äºå°å›¾ç‰‡ä»¥åŠå›¾ç‰‡é¢œè‰²å˜åŒ–å¾ˆå°–é”çš„ï¼›è€Œå…¶ä»–ä¸¤ä¸ªç”¨äºå›¾ç‰‡é¢œè‰²å˜åŒ–æ¯”è¾ƒç¼“å’Œçš„ï¼Œä¹Ÿå°±æ˜¯å‡åŒ€çš„ï¼Œä¸ä¼šä¸¤ä¸ªç›¸é‚»åƒç´ ä¹‹é—´é¢œè‰²å‘ç”Ÿçªå˜ã€‚</li>
</ol>
<h3 id="Transforms"><a href="#Transforms" class="headerlink" title="Transforms"></a>Transforms</h3><h4 id="Affine-Transforms"><a href="#Affine-Transforms" class="headerlink" title="Affine Transforms"></a>Affine Transforms</h4><ol>
<li><p>åˆ©ç”¨CFAffineTransformçš„æ—¶å€™ï¼Œå…¶å®å¯ä»¥è®¡ç®—åŸæ¥viewçš„å››ä¸ªç‚¹å¯¹åº”çš„å˜åŒ–ä¹‹åçš„å››ä¸ªç‚¹ï¼Œæ¥ç¡®å®šå˜åŒ–ä¹‹åçš„viewçš„å½¢çŠ¶ä»¥åŠä½ç½®ã€‚</p>
</li>
<li><p>UIViewçš„<strong>transform</strong>å±æ€§æ˜¯ä¸€ä¸ªCGAffineTransformï¼ŒCALayerçš„<strong>transform</strong>å±æ€§æ˜¯ä¸€ä¸ªCATransform3Dã€‚CALayerä¸­å’ŒUIViewçš„transformç­‰åŒçš„ä¸€ä¸ªå±æ€§å«åš<strong>affineTransform</strong>ã€‚å…¶å®å¯¹UIViewçš„transformå±æ€§è¿›è¡Œæ“ä½œï¼Œå®é™…ä¸Šä¹Ÿæ˜¯å¯¹CALayerè¿›è¡Œæ“ä½œï¼Œå®ƒåªæ˜¯ä¸€ä¸ªå‘ä¸Šçš„åŒ…è£…è€Œå·²ã€‚</p>
</li>
<li><p>é€šè¿‡å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="objective-c">CGAffineTransform transform = CGAffineTransformIdentity;
transform = CGAffineTransformScale(transform, 0.5, 0.5);
transform = CGAffineTransformRotate(transform, M_PI / 180 * 30);
transform = CGAffineTransformTranslate(transform, 200, 0);
</code></pre>
<p>è®°ä½ï¼Œè¿™é‡Œæœ€åä¸€æ­¥å‘å³å¹³ç§»200ç‚¹ï¼Œå…¶å®å¹¶æ²¡æœ‰å¹³ç§»200ç‚¹ã€‚å› ä¸ºï¼Œè¿™æ ·è¿ç»­çš„å˜åŒ–ï¼Œå‘å³å¹³ç§»200ç‚¹çš„transformå—åˆ°äº†ä¹‹å‰ä¸¤æ­¥transformçš„å½±å“ã€‚å®ƒå…¶å®è¢«scaleäº†ä¸€åŠï¼Œç„¶åè¢«æ—‹è½¬äº†30åº¦ã€‚å¯ä»¥æƒ³è±¡æˆå‘å³200çš„å‘é‡å§(ä¸ç¡®å®š)ã€‚</p>
</li>
<li><p>è¿˜æœ‰ä¸€ç§å˜æ¢æ— æ³•ç”¨translateï¼Œ rotateå’Œscaleæ¥è¡¨ç¤ºã€‚é‚£å°±æ˜¯ï¼šåŸViewæ˜¯çŸ©å½¢ï¼Œå˜æ¢ä¹‹åäº†Viewå˜æˆäº†å¹³è¡Œå››è¾¹å½¢ã€‚æœ‰ç‚¹ç±»ä¼¼æŠ•å½±ã€‚é‚£æ ·çš„è¯å°±å¾—ç›´æ¥ä¿®æ”¹CGAffineTransformçŸ©é˜µä¸­çš„å€¼äº†ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code class="objective-c">CGAffineTransform transform = CGAffineTransformIdentity;
transform.c = -x;
transform.b = y;
</code></pre>
</li>
</ol>
<h4 id="3D-Transforms"><a href="#3D-Transforms" class="headerlink" title="3D Transforms"></a>3D Transforms</h4><ol>
<li>Core Graphics frameworkæ˜¯ä¸€ä¸ª2ç»´çš„ç”»å›¾çš„åº“ã€‚è€ŒCALayerçš„transformå±æ€§æ˜¯ä¸€ä¸ªCATransform3Dï¼Œ3Dçš„ã€‚æ‰€ä»¥éœ€è¦ç”¨åˆ°Core Animation frameworkã€‚</li>
<li>æ§åˆ¶é€è§†æ•ˆæœï¼Œä¹Ÿå°±æ˜¯è¿œå¤„çš„viewçœ‹ä¸Šå»æ¯”è¿‘å¤„çš„å°ã€‚è¿™ä¸ªæ•ˆæœå¯ä»¥é€šè¿‡æ§åˆ¶CATransform3Dçš„m34å€¼æ¥å®ç°ã€‚m34ç”¨æ¥è¡¨ç¤ºXï¼ŒYè½´çš„æ”¾å¤§ç³»æ•°ä¸viewè·ç¦»cameraçš„ç±»ä¼¼æ¯”å€¼çš„ä¸€ä¸ªä¸œè¥¿ã€‚m34é»˜è®¤ä¸º0ï¼Œå°†å®ƒå®šä¹‰æˆ -1.0/dï¼Œdè¡¨ç¤ºviewåˆ°é•œå¤´çš„è·ç¦»ï¼Œå–500-1000ä¹‹é—´çš„å€¼éƒ½å¯ä»¥ã€‚då–å€¼è¶Šå°ï¼Œé€è§†çš„æ•ˆæœè¶Šæ˜æ˜¾ã€‚todo æ¥ä¸¤å¼ å›¾</li>
<li>3Dæœ€è¿œç«¯çš„æ¶ˆå¤±ç‚¹å®šä¹‰åœ¨layerçš„anchorPointã€‚</li>
<li>CALayerçš„sublayerTransformå±æ€§å¯ä»¥ä¸ºsublayerç»Ÿä¸€æŒ‡å®šä»–ä»¬çš„perspectiveå’Œvanishing pointã€‚</li>
<li>æ²¿Yè½´æ—‹è½¬180åº¦ï¼Œå°±æŠŠlayerç¿»è½¬è¿‡æ¥äº†ï¼Œå‘ˆç°é•œåƒã€‚ä½†æ˜¯å¦‚æœå°†CALayerçš„<strong>doubleSided</strong>è®¾ç½®æˆNOï¼Œé‚£ä¹ˆåé¢å°±ä¸ä¼šè¢«drawå‡ºæ¥ã€‚</li>
<li>å¯¹äºå¤–éƒ¨çš„layerå¤–è½¬ï¼Œå†…éƒ¨çš„layerå†…è½¬ï¼Œå¾—åˆ†æƒ…å†µæ¥è®¨è®ºã€‚å¦‚æœæ˜¯æŒ‰ç…§Zè½´æ¥æ—‹è½¬ï¼Œé‚£ä¹ˆå†…éƒ¨çš„layeræ—‹è½¬è¢«æŠµæ¶ˆï¼Œæ­£é¢æ˜¾ç¤ºã€‚ä½†æ˜¯å¦‚æœæŒ‰ç…§Yè½´æ—‹è½¬ï¼Œè™½ç„¶å†…éƒ¨çš„æ—‹è½¬ä¹Ÿè¢«æŠµæ¶ˆï¼Œä½†æ˜¯æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„å…¶å®æ˜¯å†…éƒ¨layeråœ¨å¤–éƒ¨layerä¸Šçš„æŠ•å½±ï¼›æ­¤æ—¶å¤–éƒ¨layerå·²ç»å€¾æ–œäº†ï¼Œè™½ç„¶å†…éƒ¨layerå¾ˆæ­£ï¼Œä½†æ˜¯æ˜¾ç¤ºæŠ•å½±ä¸Šå»è¿˜æ˜¯å€¾æ–œçš„ã€‚todo æ¥å¼ å›¾</li>
<li>CATransform3D å…ˆä½ç§»å†æ—‹è½¬å’Œå…ˆæ—‹è½¬å†ä½ç§»æ˜¯ä¸ä¸€æ ·çš„ã€‚è¦å§‹ç»ˆæ‰¾åˆ°æ—‹è½¬ä»¥åŠå¹³ç§»çš„ä¸­å¿ƒç‚¹ï¼Œä»¥è¯¥ä¸­å¿ƒç‚¹å»ºç«‹ä¸‰ç»´åæ ‡ç³»ã€‚å½“æ—‹è½¬æˆ–å¹³ç§»æ—¶ï¼Œè¯¥åæ ‡ç³»ä¹Ÿä¼šè·Ÿç€æ—‹è½¬å’Œå¹³ç§»ï¼Œé‚£ä¹ˆä¸‹ä¸€æ­¥çš„é€‰è£…æˆ–å¹³ç§»è¦ä»¥å½“å‰æœ€æ–°çš„åæ ‡ç³»ä¸ºæ ‡å‡†ã€‚</li>
<li>UIViewçš„touch eventæ¥æ”¶é¡ºåºä¸zPositionæ— å…³ï¼Œè¿˜æ˜¯ä¸æ·»åŠ UIViewçš„é¡ºåºç›¸å…³ã€‚</li>
</ol>
<h3 id="Specialized-Layers"><a href="#Specialized-Layers" class="headerlink" title="Specialized Layers"></a>Specialized Layers</h3><h4 id="CAShapeLayer"><a href="#CAShapeLayer" class="headerlink" title="CAShapeLayer"></a>CAShapeLayer</h4><ol>
<li><p>CAShapeLayerä½¿ç”¨çŸ¢é‡ç”»å›¾ï¼Œè€Œä¸æ˜¯ä½å›¾(bitmap image)ã€‚</p>
</li>
<li><p>ç›¸æ¯”ä¸æ™®é€šçš„CALayerï¼Œå®ƒæ›´å¿«ï¼šç¡¬ä»¶åŠ é€Ÿï¼›å†…å­˜æ›´é«˜æ•ˆï¼šä¸éœ€è¦åˆ›å»ºbacking imageï¼›ä¸ä¼šè¢«è¾¹ç•Œé™åˆ¶ï¼ˆbacking imageçš„contextï¼‰ï¼›æ”¾å¤§ç¼©å°æ—¶ä¸æ˜¯åƒç´ åŒ–çš„ï¼šçŸ¢é‡å›¾ã€‚</p>
</li>
<li><p>åˆ›å»ºCAShapeLayerçš„CGPathæ—¶åªèƒ½åˆ›å»ºä¸€æ¬¡ï¼Œä¸èƒ½åˆ†å¼€å¤šæ¬¡åˆ›å»ºã€‚ä¹Ÿå°±æ˜¯è¯´CGPathçš„è·¯å¾„ï¼Œé¢œè‰²ï¼Œçº¿æ®µç²—ç»†ç­‰å±æ€§åªèƒ½åœ¨åˆ›å»ºæ—¶ä¸€æ¬¡æ€§å…¨éƒ¨è®¾ç½®ã€‚å¦‚æœæƒ³ç”»å¤šä¸ªä¸åŒç±»å‹(æ¯”å¦‚ï¼šä¸åŒé¢œè‰²ï¼Œä¸åŒç²—ç»†ç­‰)çš„shapeï¼Œé‚£ä¹ˆå°±å¾—åˆ›å»ºå¤šä¸ªlayerã€‚</p>
</li>
<li><p>CAShapeLayerçš„<strong>path</strong>å±æ€§æ˜¯ä¸€ä¸ªCGPathï¼Œä½†æ˜¯ä½¿ç”¨UIBezierPathï¼Œå¯ä»¥ç®€åŒ–æˆ‘ä»¬çš„ä½¿ç”¨ï¼Œä¸ç”¨æ‰‹åŠ¨å»é‡Šæ”¾CGPathã€‚</p>
</li>
<li><p>åˆ›å»ºä¸€ä¸ªåªæœ‰3ä¸ªè§’çš„bezierPathï¼š</p>
<pre><code class="objective-c">CGRect rect = CGRectMake(50, 50, 100, 100); CGSize radii = CGSizeMake(20, 20); UIRectCorner corners = UIRectCornerTopRight |
UIRectCornerBottomRight | UIRectCornerBottomLeft;
//create path
UIBezierPath *path = [UIBezierPath bezierPathWithRoundedRect:rect byRoundingCorners:corners cornerRadii:radii];
</code></pre>
<p>å¯ä»¥æŠŠè¿™ä¸ªCGPathæ„æˆçš„CAShapeLayerå½“åšæŸä¸ªCALayerçš„maskã€‚</p>
</li>
</ol>
<h4 id="CATextLayer"><a href="#CATextLayer" class="headerlink" title="CATextLayer"></a>CATextLayer</h4><ol>
<li><p>CATextLayeræä¾›äº†UILabelçš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œä»¥åŠä¸€äº›è‡ªå·±çš„åŠŸèƒ½ï¼Œå¹¶ä¸”æ¯”UILabelæ¸²æŸ“çš„æ›´å¿«ã€‚</p>
</li>
<li><p>CATextLayerè¦æ³¨æ„æä¾›<strong>contentsScale</strong>å±æ€§ï¼Œä»¥ä¿è¯åœ¨å„ç§å±å¹•ä¸Šæ˜¾ç¤ºæ­£ç¡®ã€‚</p>
</li>
<li><p>å®ƒçš„<strong>font</strong>å±æ€§æ˜¯ä¸€ä¸ªCFTypeRefï¼Œæ‰€ä»¥å¯ä»¥ç»™ä»–CTFontRefæˆ–è€…æ˜¯CGFontRefï¼›è€Œä¸”è¿™ä¸¤ä¸ªå’ŒUIFontä¸€æ ·ä¸ä¼šå‹ç¼©point sizeï¼Œä¹Ÿå°±æ˜¯å­—ä½“å¤§å°ï¼›æ‰€ä»¥è¿˜éœ€è¦è‡ªå·±æŒ‡å®š<strong>fontSize</strong>å±æ€§ã€‚</p>
</li>
<li><p>CATextLayeråœ¨iOS3.2çš„æ—¶å€™å°±å·²ç»æ”¯æŒattributed stringäº†ï¼Œæ¯”UILabelç­‰UIKitå…ƒç´ æ›´æ—©ã€‚</p>
</li>
<li><p>ä½†æ˜¯å®ƒçš„è¡Œé—´è·å’Œå­—é—´è·æ¯”UILabelçš„è¡¨ç°è¦å·®ã€‚</p>
</li>
<li><p>CALayerä¸å¤ªæ”¯æŒautolayoutå’Œautoresizingâ€¦</p>
</li>
<li><p><strong>å¦‚ä½•è®©ä¸€ä¸ªUIViewçš„root layerä¸æ˜¯æ™®é€šçš„CALayerå‘¢ï¼Ÿ</strong>UIViewé€šè¿‡<code>+ (Class)layerClass;</code>æ–¹æ³•æ¥è¿”å›root layerçš„ç±»å‹ï¼›æ‰€ä»¥åªéœ€è¦åœ¨æˆ‘ä»¬è‡ªå·±çš„Viewç±»é‡Œé¢é‡å†™è¯¥æ–¹æ³•å°±å¯ä»¥ã€‚</p>
<pre><code class="objective-c">@implementation LayerLabel  // è‡ªå®šä¹‰çš„UIView
+ (Class)layerClass {  // override layerClass of UIView
      return [CATextLayer class];
}
</code></pre>
<p>é‚£ä¹ˆè¿™æ—¶å°±ä¸ä¼šè°ƒç”¨<code>-drawRect:</code>æ–¹æ³•æ¥ç»˜å›¾ï¼Œè€Œæ˜¯ä½¿ç”¨CATextLayerè‡ªå·±æ¥æ¸²æŸ“æ–‡å­—ã€‚å°†CATextLayerä½œä¸ºUILabelçš„root layerè¿˜æœ‰ä¸ªå¥½å¤„ï¼Œå°±æ˜¯ä¸éœ€è¦è®¾ç½®contentsScaleã€‚å› ä¸ºè¿™ä¸ªè¢«UIViewè‡ªå·±è®¾ç½®äº†ã€‚è¿™ä¹Ÿä½è¯äº†ä½¿ç”¨å¸¦layerçš„Viewæ¯”å•ç‹¬ä½¿ç”¨layerè¦æ–¹ä¾¿ã€‚</p>
</li>
</ol>
<h4 id="CATransformLayer"><a href="#CATransformLayer" class="headerlink" title="CATransformLayer"></a>CATransformLayer</h4><ol>
<li><p>å®ƒçš„å­˜åœ¨è§£å†³äº†ä¹‹å‰è¯´çš„å¤–éƒ¨layerå¤–è½¬å†…éƒ¨layerå†…è½¬ï¼Œä½†æ˜¯å†…éƒ¨layeræ˜¾ç¤ºå¥‡æ€ªçš„é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜çš„æ ¹æœ¬åŸå› å°±æ˜¯æ‰€æœ‰sublayeréƒ½è¢«containerLayerç»™æ‰å¹³åŒ–å¾—æ˜¾ç¤ºåœ¨å®ƒè‡ªå·±çš„ç©ºé—´å†…ï¼Œæœ‰ç‚¹å‰¥å¤º3dæ•ˆæœçš„æ„Ÿè§‰ã€‚</p>
</li>
<li><p>CATransformLayerä¸èƒ½ç”¨äºæ˜¾ç¤ºä»»ä½•å†…å®¹ï¼Œå®ƒå¿…é¡»åŒ…å«ä¸€äº›sublayerã€‚å®ƒæœ‰å¯ä»¥åº”ç”¨äºsublayerçš„transformï¼Œå¯ä»¥ä½¿sublayerç«‹ä½“åŒ–èµ·æ¥ã€‚</p>
</li>
<li><p>è¿™ä¸ªä¾‹å­å¾ˆèµï¼š</p>
<pre><code class="objective-c">@interface ViewController ()
@property (nonatomic, weak) IBOutlet UIView *containerView; 
@end
@implementation ViewController
- (CALayer *)faceWithTransform:(CATransform3D)transform {
    //create cube face layer
    CALayer *face = [CALayer layer];
    face.frame = CGRectMake(-50, -50, 100, 100);

    //apply a random color
    CGFloat red = (rand() / (double)INT_MAX); 
    CGFloat green = (rand() / (double)INT_MAX); 
    CGFloat blue = (rand() / (double)INT_MAX); 
    face.backgroundColor = [UIColor colorWithRed:red green:green blue:blue alpha:1.0].CGColor;

     //apply the transform and return
    face.transform = transform;

    return face; 
}

- (CALayer *)cubeWithTransform:(CATransform3D)transform {
    //create cube layer
    CATransformLayer *cube = [CATransformLayer layer];

    //add cube face 1
    CATransform3D ct = CATransform3DMakeTranslation(0, 0, 50); 
    [cube addSublayer:[self faceWithTransform:ct]];

    //add cube face 2
    ct = CATransform3DMakeTranslation(50, 0, 0); 
    ct = CATransform3DRotate(ct, M_PI_2, 0, 1, 0); 
    [cube addSublayer:[self faceWithTransform:ct]];

    //add cube face 3
    ct = CATransform3DMakeTranslation(0, -50, 0); 
    ct = CATransform3DRotate(ct, M_PI_2, 1, 0, 0); 
    [cube addSublayer:[self faceWithTransform:ct]];

    //add cube face 4
    ct = CATransform3DMakeTranslation(0, 50, 0); 
    ct = CATransform3DRotate(ct, -M_PI_2, 1, 0, 0); 
    [cube addSublayer:[self faceWithTransform:ct]];

    //add cube face 5
    ct = CATransform3DMakeTranslation(-50, 0, 0); 
    ct = CATransform3DRotate(ct, -M_PI_2, 0, 1, 0); 
    [cube addSublayer:[self faceWithTransform:ct]];

    //add cube face 6
    ct = CATransform3DMakeTranslation(0, 0, -50); 
    ct = CATransform3DRotate(ct, M_PI, 0, 1, 0); 
    [cube addSublayer:[self faceWithTransform:ct]];

    //center the cube layer within the container
    CGSize containerSize = self.containerView.bounds.size; 
    cube.position = CGPointMake(containerSize.width / 2.0, containerSize.height / 2.0);

    //apply the transform and return
    cube.transform = transform;
    return cube; 
}

- (void)viewDidLoad { 
    [super viewDidLoad];
    //set up the perspective transform
    CATransform3D pt = CATransform3DIdentity; 
    pt.m34 = -1.0 / 500.0; 
    self.containerView.layer.sublayerTransform = pt;

    //set up the transform for cube 1 and add it
    CATransform3D c1t = CATransform3DIdentity; 
    c1t = CATransform3DTranslate(c1t, -100, 0, 0); 
    CALayer *cube1 = [self cubeWithTransform:c1t]; 
    [self.containerView.layer addSublayer:cube1];

    //set up the transform for cube 2 and add it
    CATransform3D c2t = CATransform3DIdentity;
    c2t = CATransform3DTranslate(c2t, 100, 0, 0); 
    c2t = CATransform3DRotate(c2t, -M_PI_4, 1, 0, 0); 
    c2t = CATransform3DRotate(c2t, -M_PI_4, 0, 1, 0); 
    CALayer *cube2 = [self cubeWithTransform:c2t]; 
    [self.containerView.layer addSublayer:cube2];
}
@end
</code></pre>
<p>todo add picture</p>
</li>
</ol>
<h4 id="CAGradientLayer"><a href="#CAGradientLayer" class="headerlink" title="CAGradientLayer"></a>CAGradientLayer</h4><ol>
<li>æµ‹è¯•äº†é‡å†™Viewçš„layerClassæ–¹æ³•ä¹‹åå‘ç°ï¼Œå¯¹äºCATextLayerï¼Œä¸ä¼šè°ƒç”¨<code>-drawRect;</code>æ–¹æ³•ï¼Œä½†æ˜¯å¯¹äºå…¶ä»–ç§ç±»çš„layerï¼Œè¿˜æ˜¯ä¼šè°ƒç”¨<code>-drawRect;</code>æ–¹æ³•ã€‚</li>
<li>ç¡¬ä»¶åŠ é€Ÿã€‚</li>
<li><strong>colors</strong>å±æ€§æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚é‡Œé¢è£…çš„æ˜¯CGColorRefï¼Œä¸æ˜¯UIColorã€‚æ‰€ä»¥è¿˜æ˜¯éœ€è¦ä½¿ç”¨<code>(__bridge id)</code>ã€‚<strong>startPoint</strong>å’Œ<strong>endPoint</strong>æŒ‡å®šæ¸å˜æ–¹å‘ï¼Œè¿™ä¸¤ä¸ªå±æ€§ä½¿ç”¨çš„æ˜¯<em>unit coordinates</em>ã€‚</li>
<li>colorså±æ€§å¯ä»¥æ·»åŠ ä»»æ„ä¸ªé¢œè‰²ï¼Œé»˜è®¤çš„ä»–ä»¬æ˜¯å‡åŒ€åˆ†å¸ƒçš„ï¼›ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>locations</strong>å±æ€§æ”¹å˜ä»–ä»¬çš„åˆ†å¸ƒã€‚<strong>locations</strong>å±æ€§æ˜¯ä¸€ä¸ªè£…ç€NSNumber(float value)çš„æ•°ç»„ï¼Œä»0-1ï¼Œè¡¨ç¤ºå„ç§colorçš„ç»ˆåŒºæ®µã€‚</li>
</ol>
<h4 id="CAReplicatorLayer"><a href="#CAReplicatorLayer" class="headerlink" title="CAReplicatorLayer"></a>CAReplicatorLayer</h4><ol>
<li><p>å®ƒæ˜¯ç”¨æ¥é«˜æ•ˆçš„ç”Ÿæˆä¸€ç³»åˆ—ç›¸ä¼¼çš„layerã€‚</p>
</li>
<li><p><strong>instanceCount</strong>å±æ€§æŒ‡å®šcopyçš„ä¸ªæ•°ï¼Œ<strong>instanceTransform</strong>å±æ€§æŒ‡å®šå˜åŒ–ï¼Œå„ä¸ªå˜åŒ–æ˜¯å åŠ çš„ã€‚</p>
</li>
<li><p>è¯´ä¸æ¸…æ¥šï¼Œç›´æ¥ä¸Šä»£ç â€¦</p>
<pre><code class="objective-c">@interface ViewController ()
@property (nonatomic, weak) IBOutlet UIView *containerView; 
@end

@implementation ViewController
- (void)viewDidLoad {
    [super viewDidLoad];

    //create a replicator layer and add it to our view
    CAReplicatorLayer *replicator = [CAReplicatorLayer layer]; 
    replicator.frame = self.containerView.bounds; 
    [self.containerView.layer addSublayer:replicator];

    //configure the replicator
    replicator.instanceCount = 10;

    //apply a transform for each instance
    CATransform3D transform = CATransform3DIdentity;
    transform = CATransform3DTranslate(transform, 0, 200, 0); 
    transform = CATransform3DRotate(transform, M_PI / 5.0, 0, 0, 1);

    transform = CATransform3DTranslate(transform, 0, -200, 0); 
    replicator.instanceTransform = transform;

    //apply a color shift for each instance
    replicator.instanceBlueOffset = -0.1; 
    replicator.instanceGreenOffset = -0.1;

    //create a sublayer and place it inside the replicator
    CALayer *layer = [CALayer layer];
    layer.frame = CGRectMake(100.0f, 100.0f, 100.0f, 100.0f); 
    layer.backgroundColor = [UIColor whiteColor].CGColor; 
    [replicator addSublayer:layer];
}
@end
</code></pre>
<p>todo add picture</p>
</li>
</ol>
<h4 id="CAScrollLayer"><a href="#CAScrollLayer" class="headerlink" title="CAScrollLayer"></a>CAScrollLayer</h4><ol>
<li>ä¸€ä¸ªå¯ä»¥scrollçš„layerï¼Œæœ‰ä¸€ä¸ªæ–¹æ³•<code>-scrollToPoint:</code>ã€‚å› ä¸ºCALayeræ— æ³•å¤„ç†ç”¨æˆ·æ‰‹åŠ¿æ“ä½œï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯è¿™ä¸ªlayeræ‰€èƒ½åšçš„æ‰€æœ‰äº‹äº†ã€‚ã€‚ã€‚å¯ä»¥ä»UIViewçš„å±‚é¢è·å–æ‰‹åŠ¿æ‰€å¤„çš„pointï¼Œå†å°†è¯¥pointä¼ é€’ç»™CAScrollLayerã€‚</li>
<li>è¯¥layeræ»‘åŠ¨çš„æ—¶å€™ï¼Œæ”¹å˜çš„æ˜¯layerçš„boundsã€‚</li>
</ol>
<h4 id="OtherLayer"><a href="#OtherLayer" class="headerlink" title="OtherLayer"></a>OtherLayer</h4><ol>
<li>Core Animationä½¿ç”¨CPUæ¥å¤„ç†å›¾ç‰‡ï¼Œè€Œä¸æ˜¯æ›´å¿«çš„GPUã€‚</li>
</ol>
]]></content>
      
        <categories>
            
            <category> è¯»ä¹¦ç¬”è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[å§æ§½]]></title>
      <url>/2016/06/07/ollie/</url>
      <content type="html"><![CDATA[<p>æ˜¨å¤©æ™šä¸Šï¼Œä¹Ÿå°±æ˜¯2016-6-6è¿™ä¹ˆä¸ª666çš„æ—¥å­ï¼Œæˆ‘ollieè¿‡ä¸€ç«‹äº†=ã€‚=</p>
]]></content>
      
        <categories>
            
            <category> æ‚ä¸ƒæ‚å…« </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[å¼¹æ¡†æŒ‰é’®è§†å›¾]]></title>
      <url>/2016/05/19/ios-pop-menu/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ®µæ—¶é—´åˆåœ¨å¿™é¡¹ç›®çš„äº‹ï¼Œå¯¹<a href="https://github.com/Coding/Coding-iOS" target="_blank" rel="external">Coding-iOS</a>æºç çš„å­¦ä¹ åªèƒ½å…ˆæš‚æä¸€æ—ã€‚ä»Šå¤©æŠ½ç©ºæ¥çœ‹çœ‹ä¸€ä¸ªCoding-iOSä¸­ä¸€ä¸ªæœ‰è¶£çš„å®ç°ã€‚è¿™ä¸ªå’Œå¾®åšé‡Œé¢å‘é€å¾®åšæ—¶çš„åŠ¨æ•ˆç±»ä¼¼ã€‚æ•ˆæœå¦‚ä¸‹ğŸ‘‡<br><img src="/lionheart/1605/weibo.gif" alt="weibo"></p>
<a id="more"></a>
<h2 id="å‰è¨€äºŒ"><a href="#å‰è¨€äºŒ" class="headerlink" title="å‰è¨€äºŒ"></a>å‰è¨€äºŒ</h2><p>æºç åœ¨<a href="https://github.com/xhzengAIB/PopMenu" target="_blank" rel="external">è¿™é‡Œ</a><br>æˆ‘è‡ªå·±ä¹Ÿç®€å•çš„å®ç°äº†ä¸€éï¼Œçœ‹çœ‹æ•ˆæœğŸ‘‡<br><img src="/lionheart/1605/weibomy.gif" alt="weibomy"><br>æˆ‘ä¹ŸæŠŠæºç ä¸Šä¼ åˆ°<a href="https://github.com/vanney9/blogDemo/tree/master/testweibo" target="_blank" rel="external">github</a>äº†</p>
<h2 id="åˆ†æä¸€æ³¢"><a href="#åˆ†æä¸€æ³¢" class="headerlink" title="åˆ†æä¸€æ³¢"></a>åˆ†æä¸€æ³¢</h2><p>è¿™ä¸ªPopMenuä¸»è¦ç”±2éƒ¨åˆ†æ„æˆï¼šæ¨¡ç³ŠèƒŒæ™¯å’ŒæŒ‰é’®</p>
<ol>
<li>æ¨¡ç³ŠèƒŒæ™¯<br>æ¨¡ç³ŠèƒŒæ™¯ç›´æ¥å°±æ˜¯ç™½è‰²åŠé€æ˜çš„Viewï¼Œå®ƒæ˜¯PopMenuè¿™ä¸ªViewçš„æœ€åº•å±‚çš„å­Viewã€‚è¿™ä¸ªæ¨¡ç³ŠèƒŒæ™¯Viewçš„é€æ˜åº¦ä»0-&gt;0.5æ¸å˜ï¼Œå½“è¿™ä¸ªåŠ¨ç”»å®Œæˆä¹‹åï¼Œå¼€å§‹æ˜¾ç¤ºæŒ‰é’®çš„åŠ¨ç”»ã€‚</li>
<li>æŒ‰é’®<br>è¯´æ˜¯æŒ‰é’®ï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„Viewï¼Œå®ƒç”±ä¸€ä¸ªå›¾ç‰‡(UIImageView)å’Œä¸€ä¸ªæ ‡é¢˜(UILabel)æ„æˆã€‚è¿™äº›æŒ‰é’®ä¹Ÿæ˜¯PopMenuè¿™ä¸ªViewçš„å­Viewã€‚</li>
<li>PopMenu View<br>è¿™ä¸ªViewæ˜¯ä¸»è§†å›¾ï¼Œå®ƒåŒ…æ‹¬æœ€åº•å±‚çš„æ¨¡ç³ŠèƒŒæ™¯è§†å›¾å’Œå¤šä¸ªæŒ‰é’®è§†å›¾ã€‚åœ¨è¿™ä¸ªè§†å›¾å†…éƒ¨å®šä¹‰äº†å‡ ä¸ªé‡è¦çš„æ–¹æ³•<ul>
<li>å®šä¹‰æ¯ä¸€ä¸ªæŒ‰é’®è§†å›¾çš„å…¶å®ä½ç½®å’Œæœ€ç»ˆä½ç½®</li>
<li>æœªæ¯ä¸ªæŒ‰é’®è§†å›¾æ·»åŠ åŠ¨ç”»</li>
</ul>
</li>
</ol>
<h2 id="æŒ‰é’®ä½ç½®"><a href="#æŒ‰é’®ä½ç½®" class="headerlink" title="æŒ‰é’®ä½ç½®"></a>æŒ‰é’®ä½ç½®</h2><p>å…ˆæ¥çœ‹çœ‹æŒ‰é’®è§†å›¾çš„æœ€ç»ˆä½ç½®ğŸ‘‡<br><img src="/lionheart/1605/finalPosition.png" alt="finalPosition"><br>ç»™æ¯ä¸ªè§†å›¾å®šå¤§å°å¾ˆç®€å•ï¼šå…ˆå®šæ­»é«˜åº¦ä¸º110ï¼Œå†æ ¹æ®æ¯è¡Œæ”¾ç½®å‡ ä¸ªæŒ‰é’®å®šä¹‰æŒ‰é’®çš„å®½åº¦(ä¾‹å¦‚æœ¬æ–‡æ¯è¡Œ3ä¸ªæŒ‰é’®ï¼Œé‚£å°±å±å¹•å®½åº¦é™¤ä»¥3)ï¼›æœ€åå®šä¹‰æŒ‰é’®åœ¨PopMenuè§†å›¾ä¸­çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„å·¦ä¸Šè§’ç›¸å¯¹äºä¸»è§†å›¾çš„åæ ‡ï¼Œè¿™ä¸ªç¨åŠ è®¡ç®—å°±å¯å¾—å‡ºã€‚<br>è€Œæ¯ä¸ªæŒ‰é’®å…¶å®å¼€å§‹çš„ä½ç½®æ˜¯åœ¨å±å¹•ä¸Šæ–¹çš„ï¼Œé‚£ä¹ˆæ¯ä¸ªæŒ‰é’®çš„èµ·å§‹ä½ç½®ä¹Ÿå°±æ˜¯æœ€ç»ˆä½ç½®å‘ä¸Šå¹³ç§»ä¸€ä¸ªç›¸åŒçš„é‡ï¼Œç›´è‡³ç§»å‡ºå±å¹•ä¸Šæ–¹ä¸ºæ­¢ã€‚</p>
<h2 id="ä¸‹è½åŠ¨ç”»"><a href="#ä¸‹è½åŠ¨ç”»" class="headerlink" title="ä¸‹è½åŠ¨ç”»"></a>ä¸‹è½åŠ¨ç”»</h2><p>ä»”ç»†ç§ç§ï¼Œæ¯ä¸ªæŒ‰é’®çš„ä¸‹è½åŠ¨ç”»æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å¼€å§‹æ—¶é—´ä¸åŒè€Œå·²ã€‚æ‰€ä»¥è¿™äº›æŒ‰é’®åŠ¨ç”»çš„è®¾ç½®åªéœ€ç”¨å¼€å§‹æ—¶é—´è¿›è¡ŒåŒºåˆ†å³å¯ã€‚è¿™é‡Œçš„åŠ¨ç”»ä½¿ç”¨äº†<a href="https://github.com/facebook/pop" target="_blank" rel="external">POPAnimation</a>ï¼Œå®ƒæ˜¯Facebookçš„ä¸€ä¸ªè‘—åçš„å¼€æºåº“ã€‚<br>æ¥çœ‹çœ‹åŠ¨ç”»çš„æºä»£ç ğŸ‘‡</p>
<pre><code>        - (void)startAnimationFromPosition:(CGRect)from toPosition:(CGRect)to atView:(UIView *)view beginTime:(CFTimeInterval)beginTime {
            POPSpringAnimation *springAnimation = [POPSpringAnimation animation]; // æ–°å»ºä¸€ä¸ªå¼¹ç°§åŠ¨ç”»
            springAnimation.property = [POPAnimatableProperty propertyWithName:kPOPViewFrame]; // è¿™ä¸ªåŠ¨ç”»ä½œç”¨äºViewçš„Frame
            springAnimation.removedOnCompletion = YES; // åŠ¨ç”»æ‰§è¡Œç»“æŸååˆ é™¤è¯¥åŠ¨ç”»
            springAnimation.beginTime = beginTime + CACurrentMediaTime(); // å®šä¹‰åŠ¨ç”»å¼€å§‹æ—¶é—´ï¼Œ ç°åœ¨æ—¶é—´åŠ ä¸Šä¸€ä¸ªåŠ¨ç”»æ‰§è¡Œå»¶è¿Ÿ
            springAnimation.springBounciness = 6; // å®šä¹‰å¼¹ç°§åŠ¨ç”»å¼¹åŠ¨ç¨‹åº¦
            springAnimation.springSpeed = 2; // å®šä¹‰åŠ¨ç”»çš„é€Ÿåº¦

            springAnimation.fromValue = [NSValue valueWithCGRect:from]; // å®šä¹‰åŠ¨ç”»å¼€å§‹ä½ç½®
            springAnimation.toValue = [NSValue valueWithCGRect:to]; // å®šä¹‰åŠ¨ç”»ç»“æŸä½ç½®

            [view pop_addAnimation:springAnimation forKey:@&quot;vanney9&quot;]; // ç»™è§†å›¾æ·»åŠ è¯¥åŠ¨ç”»ï¼Œè¿™ä¸ªè§†å›¾å°±æ˜¯ä¸Šé¢çš„æŒ‰é’®è§†å›¾
        }

        // æŒ‰é’®è°ƒç”¨åŠ¨ç”»
        [self startAnimationFromPosition:from toPosition:to atView:button beginTime:0.1 * index];
</code></pre><p>POPAnimationçš„ä½¿ç”¨å¾ˆç®€å•ï¼Œé¦–å…ˆå®šä¹‰åŠ¨ç”»è¦åšä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™å¼€å§‹æ‰§è¡Œï¼ŒåŠ¨ç”»çš„èµ·å§‹å’Œç»“æŸä½ç½®ç­‰ç­‰ã€‚ã€‚ã€‚åŠ¨ç”»å®šä¹‰å®Œæˆä¹‹åï¼Œå°†è¯¥åŠ¨ç”»é™„åŠ åˆ°ä¸€ä¸ªè§†å›¾ä¸Šé¢ï¼Œè¿™é‡Œå°±æ˜¯å°†å¼¹ç°§åŠ¨ç”»èµ‹äºˆæŒ‰é’®è§†å›¾ï¼›ç„¶åæ¯ä¸ªæŒ‰é’®è§†å›¾çš„åŠ¨ç”»çš„æ‰§è¡Œæ—¶é—´éƒ½æ˜¯æŒ‰ä¸€å®šé—´éš”éš”å¼€çš„ã€‚è¿™æ ·å°±å®Œæˆäº†ä¸Šå›¾æ‰€å±•ç¤ºçš„æ•ˆæœã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://github.com/xhzengAIB/PopMenu" target="_blank" rel="external">PopMenu</a></li>
<li><a href="https://github.com/facebook/pop" target="_blank" rel="external">Facebook POPå¼€æºåº“</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[iOSå…³äºæ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½]]></title>
      <url>/2016/05/12/app-download-uoload-manager/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘è¿˜åœ¨è·Ÿç€<a href="https://github.com/Coding/Coding-iOS" target="_blank" rel="external">Coding-iOSæºç </a>å­¦ä¹ iOSå¼€å‘ï¼Œç°åœ¨æ¥ä»‹ç»ä¸€ä¸‹Coding-iOSçš„æ–‡ä»¶ä¸‹è½½å’Œä¸Šä¼ æœºåˆ¶ã€‚å…¶å®è¯´å®è¯ï¼Œåœ¨å†™è¿™æ–‡ç« çš„æ—¶å€™æˆ‘å¯¹è¿™ä¸ªæœºåˆ¶çš„æ€»ä½“æŠŠæ¡ä¹Ÿä¸æ˜¯å¾ˆå…¨é¢ï¼›ä¸‹é¢æˆ‘å°†é€šè¿‡æºç å†æ¥ç†Ÿæ‚‰ä¸€éè¿™ä¸ªå…¨è¿‡ç¨‹ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»çš„æ˜¯ä¸‹è½½æµç¨‹ã€‚</p>
<a id="more"></a>
<h2 id="æºç å…ˆè¡Œ"><a href="#æºç å…ˆè¡Œ" class="headerlink" title="æºç å…ˆè¡Œ"></a>æºç å…ˆè¡Œ</h2><h3 id="Coding-FileManager"><a href="#Coding-FileManager" class="headerlink" title="Coding_FileManager"></a><code>Coding_FileManager</code></h3><p>Coding-iOSä¸­å°†æ–‡ä»¶ä¸‹è½½ä¸ä¸Šä¼ æœ‰å…³çš„æ–¹æ³•éƒ½å°è£…åœ¨<code>Coding_FileManager.h</code>å’Œ<code>Coding_FileManager.m</code>æ–‡ä»¶é‡Œé¢ã€‚å…ˆæ¥çœ‹çœ‹å…¶ä¸­çš„ä¸»è¦ä»£ç ğŸ‘‡<br><code>Coding_FileManager</code>é‡Œé¢åŒ…å«3ä¸ªç±»ï¼š<code>Coding_FileManager</code>ç±»ï¼Œ<code>Coding_DownloadTask</code>ç±»å’Œ<code>Coding_UploadTask</code>ç±»ã€‚å…¶ä¸­çš„Coding_UploadTaskç±»ä¸ä¸Šä¼ æœ‰å…³ï¼Œè¿™é‡Œä¸åšä»‹ç»ã€‚</p>
<h4 id="Coding-DownloadTaskç±»"><a href="#Coding-DownloadTaskç±»" class="headerlink" title="Coding_DownloadTaskç±»"></a><code>Coding_DownloadTask</code>ç±»</h4><p>Coding_DownloadTaskç±»ç”¨æ¥å°è£…æ¯ä¸€ä¸ªä¸‹è½½ä»»åŠ¡ï¼Œå®ƒåŒ…å«ä¸€ä¸ªä¸‹è½½ä»»åŠ¡ï¼Œä¸‹è½½è¿›åº¦å’Œå½“å‰ä¸‹è½½çš„æ–‡ä»¶åï¼Œä»£ç å¦‚ä¸‹ğŸ‘‡</p>
<pre><code>        @interface Coding_DownloadTask : NSObject
        @property (nonatomic, strong) NSURLSessionDownloadTask *task;  // ä¸‹è½½ä»»åŠ¡
        @property (nonatomic, strong) NSProgress *progress;  // ä¸‹è½½è¿›åº¦
        @property (nonatomic, strong) NSString *fileName;  // ä¸‹è½½æ–‡ä»¶å

        + (Coding_DownloadTask *)cDownloadTaskWith:(NSURLSessionDownloadTask *)task progress:(NSProgress *)progress fileName:(NSString *)fileName;  // åˆå§‹åŒ–å‡½æ•°
        - (void)cancel;  // å–æ¶ˆå½“å‰ä¸‹è½½å‡½æ•°
        @end
</code></pre><p>ä»–çš„ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ä¹Ÿå¾ˆç®€å•ï¼šğŸ‘‡</p>
<pre><code>        + (Coding_DownloadTask *)cDownloadTaskWith:(NSURLSessionDownloadTask *)task progress:(NSProgress *)progress fileName:(NSString *)fileName {
            Coding_DownloadTask *cDownloadTask = [Coding_DownloadTask alloc] init];
            cDownloadTask.task = task;
            cDownloadTask.progress = progress;
            cDownloadTask.fileName = fileName;

            return cDownloadTask;
        }

        - (void)cancel {
            if (_task &amp;&amp; (_task.state == NSURLSessionTaskStateRunning || _task.state == NSURLSessionTaskStateSuspended)) {
                [_task cancel];  // å…ˆåˆ¤æ–­taskçš„stateï¼Œ å¦‚æœå¯ä»¥å–æ¶ˆï¼Œ é‚£å°±å–æ¶ˆ
            }
        }
</code></pre><h4 id="Coding-FileManagerç±»"><a href="#Coding-FileManagerç±»" class="headerlink" title="Coding_FileManagerç±»"></a><code>Coding_FileManager</code>ç±»</h4><p>è¿™ä¸ªç±»æ˜¯æ–‡ä»¶ä¸‹è½½ä¸Šä¼ æœºåˆ¶é‡Œé¢çš„æœ€æœ€æœ€æ ¸å¿ƒçš„ç±»ï¼Œå¥½å¥½æ¥çœ‹çœ‹ğŸ‘‡</p>
<ol>
<li><p>ç±»çš„å£°æ˜</p>
<pre><code>     @interface Coding_FileManager : NSObject
     + (Coding_FileManager *)sharedManager;  // å•ä¾‹æ¨¡å¼
     + (AFURLSessionManager *)af_manager;
     - (AFURLSessionManager *)af_manager;

     + (Coding_DownloadTask *)cDownloadTaskForKey:(NSString *)storage_key;  // æ ¹æ®ç‰¹å®šçš„keyè·å–ç‰¹å®šçš„Coding_DownloadTask
     + (NSURL *)diskDownloadUrlForKey:(NSString *)storage_key;  // æš‚æ—¶ä¸æ˜
     - (Coding_DownloadTask *)addDownloadTaskForObj:(id)obj completionHandler:(void (^)(NSURLResponse *response, NSURL *filePath, NSError *error))completionHandler;  // å¯¹äºæ–°æ–‡ä»¶ï¼Œæ–°å»ºä¸‹è½½ä»»åŠ¡
     @end
</code></pre></li>
<li>ç±»çš„å®ç°</li>
</ol>
<ul>
<li><code>å±æ€§</code><ol>
<li>1ä¸ªç›‘æ§æ–‡ä»¶å¤¹å˜åŒ–çš„å±æ€§ï¼šdocDownloadWatcherï¼Œå®ƒæ˜¯ä¸€ä¸ª<code>DirectoryWatcher</code>å¯¹è±¡ï¼Œç”¨æ¥ç›‘æ§APPä¸‹è½½æ–‡ä»¶å­˜æ”¾çš„æ–‡ä»¶å¤¹çš„åŠ¨æ€</li>
<li>2ä¸ªå­—å…¸ï¼ŒdownloadDictå’ŒdiskDownloadDictã€‚downloadDictç”¨æ¥å­˜æ”¾å½“å‰çš„ä¸‹è½½ä»»åŠ¡(Coding_DownloadTask)ï¼Œå®ƒçš„keyæ˜¯storage_keyï¼›diskDownloadDictç”¨æ¥å­˜æ”¾ä¸‹è½½çš„æ–‡ä»¶çš„è·¯å¾„URLï¼Œå®ƒçš„keyä¹Ÿæ˜¯storage_key</li>
<li>1ä¸ªNSURLï¼ŒdownloadDirectory, ç”¨æ¥å­˜æ”¾ä¸‹è½½æ–‡ä»¶çš„æ–‡ä»¶å¤¹çš„è·¯å¾„URL</li>
</ol>
</li>
<li><p><code>æ–¹æ³•</code></p>
<ol>
<li><p><code>sharedManager</code></p>
<pre><code>       // å•ä¾‹æ¨¡å¼åˆå§‹åŒ–Coding_FileManager
       + (Coding_FileManager *)sharedManager {
           static Coding_FileManager *manager = nil;
           static dispatch_once_t onceToken;
           dispatch_once(&amp;onceToken, ^{
               manager = [Coding_FileManager alloc] init];
               // åˆ›å»ºå­˜æ”¾ä¸‹è½½æ–‡ä»¶çš„æ–‡ä»¶å¤¹
               [manager urlForDownloadFolder];
           });

           return manager;
       }
</code></pre></li>
<li><p><code>init</code></p>
<pre><code>       // åˆå§‹åŒ–
       - (instancetype)init {
           self = [super init];
           if (self) {
               [[self class] createFolder:[[self class] downloadPath]]; // åˆ›å»ºä¸‹è½½ç›®å½•
               _downloadDict = [NSMutableDictionary alloc] init]; // åˆå§‹åŒ–å­˜æ”¾ä¸‹è½½ä»»åŠ¡çš„å­—å…¸
               _diskDownloadDict = [NSMutableDictionary alloc] init]; //
               _downloadDirectoryURL = nil; //åˆå§‹åŒ–ä¸‹è½½ç›®å½•çš„æ–‡ä»¶å¤¹URL
               _docDownloadWatcher = [DirectoryWatcher watchFolderWithPath:[[self class] downloadPath] delegate:self]; // æ·»åŠ æ–‡ä»¶å¤¹çŠ¶æ€ç›‘æ§å™¨
               [self directoryDidChange:_docDownloadWatcher]; // åˆå§‹åŒ–çš„æ—¶å€™å…ˆæ¥ä¹‹è¡Œä¸€éç›‘æ§ç¨‹åº
           }

           return self;
       }
</code></pre></li>
<li><p><code>urlForDownloadFolder</code></p>
<pre><code>       // åˆ›å»ºå­˜æ”¾ä¸‹è½½å›¾ç‰‡çš„æ–‡ä»¶å¤¹
       - (NSURL *)urlForDownloadFolder {
           if (!_downloadDirectoryURL) {
               if ([self class] createFolder:[[self class] downloadPath]) { // åˆ›å»ºå­˜æ”¾ä¸‹è½½æ–‡ä»¶çš„æ–‡ä»¶å¤¹
                   // æ–‡ä»¶å¤¹åˆ›å»ºæˆåŠŸ
                   _downloadDirectoryURL = [NSURL fileURLWithPath:[[self class] downloadPath] isDirectory:YES];
               } else {
                   // alert create folder error
               }
           }

           return _downloadDirectoryURL;
       }
</code></pre></li>
<li><code>downloadPath</code><pre><code>       // å¾—åˆ°ä¸‹è½½ç›®å½•æ–‡ä»¶å¤¹çš„è·¯å¾„, è¯¥APPçš„Documentç›®å½•ä¸‹é¢çš„Coding_Downloadæ–‡ä»¶å¤¹
       + (NSString *)downloadPath {
           NSString *documentPath = [NSSearchPathForDirecrotiesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];
           NSString *downloadPath = [documentPath stringByAppendingPathComponent:@&quot;Coding_Download&quot;];
           return downloadPath;
       }
</code></pre></li>
<li><p><code>createFolder</code></p>
<pre><code>       // åˆ›å»ºæ–‡ä»¶å¤¹
       + (BOOL) createFolder:(NSString *)path {
           BOOL isDir = NO;
           NSFileManager *fileManager = [NSFileManager defaultManager];
           BOOL existed = [fileManager fileExistsAtPath:path isDirectory:&amp;isDir];
           BOOL isCreated = NO;
           if (!(isDir == YES &amp;&amp; existed == YES)) {
               isCreated = [fileManager createDirectoryAtPath:path withIntermediateDirectories:YES attributes:nil error:nil];
           } else {
               isCreated = YES;
           }

           return isCreated;
       }
</code></pre></li>
<li><p><code>cDownloadTaskForKey</code></p>
<pre><code>       + (Coding_DownloadTask *)cDownloadTaskForKey:(NSString *)storage_key {
           if (!storage_key) {
               return nil;
           }

           // å½“å‰çš„æ¯ä¸ªä¸‹è½½ä»»åŠ¡ Coding_DownloadTask éƒ½å­˜æ”¾åœ¨ _downloadDict é‡Œé¢ï¼Œå¯¹åº”çš„keyæ˜¯storage_key
           return [self sharedManager].downloadDict objectForKey:storage_key];
       }
</code></pre></li>
<li><p><code>directoryDidChange:(DirectoryWatcher *)folderWatcher</code></p>
<pre><code>       // DirectoryWatcherçš„delegateï¼Œ å½“æ–‡ä»¶å¤¹é‡Œé¢çš„æ–‡ä»¶å˜åŠ¨æ—¶è§¦å‘
       - (void)directoryDidChange:(DirectoryWatcher *)folderWatcher {
           NSMutableDictionary *diskDict = _diskDownloadDict;
           NSString *path = [[self class] downloadPath];
           BOOL isDownload = YES;

           /* å…ˆç§»é™¤diskDicté‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶URLï¼Œå†å°†å½“å‰ä¸‹è½½ç›®å½•é‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶URLæ·»åŠ åˆ°diskDicté‡Œé¢ */
           [diskDict removeAllObjects];
           NSArray *fileContents = [NSFileManager defaultManager] contentsOfDirectoryAtPath:path error:NULL]; // è·å–pathæ–‡ä»¶å¤¹ä¸‹é¢çš„æ‰€æœ‰å†…å®¹ï¼Œå°†æ‰€æœ‰æ–‡ä»¶åå­˜æ”¾åœ¨fileContentsæ•°ç»„é‡Œé¢
           for (NSString *curFileName in [fileContents objectEnumerator]) { // éå†æ–‡ä»¶å
               NSString *filePath = [path stringByAppendingPathComponent:curFileName]; // å½“å‰æ–‡ä»¶çš„å®Œæ•´çš„è·¯å¾„
               NSURL *fileUrl = [NSURL fileURLWithPath:filePath]; // å½“å‰æ–‡ä»¶çš„URL
               BOOL isDirectory;
               [NSFileManager defaultManager] fileExistsAtPath:filePath isDirectory:&amp;isDirectory]; // åˆ¤æ–­å½“å‰æ–‡ä»¶æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹
               if (!isDirectory) { // å¦‚æœä¸æ˜¯æ–‡ä»¶å¤¹ï¼Œ å­˜å…¥diskDict
                   NSString *keyStr = [curFileName componentsSeparatedByString:@&quot;|&quot;].lastObject; // å› ä¸ºä¸‹è½½æ–‡ä»¶åå‘½åä¸º&#39;IMG_0002.JPG|||264314|||QiniuStorage|c09bd7ea-6be9-431c-afc1-884293895719.JPG&#39;ï¼Œ æœ€åçš„|åé¢æ˜¯storage_key
                   [diskDict setObject:fileUrl forKey:keyStr];
               }
           }
       }
</code></pre></li>
<li><p><code>addDownloadTaskForObj:completionHandler</code></p>
<pre><code>       // æ–°å»ºä¸‹è½½ä»»åŠ¡
       - (void)addDownloadTaskForObj:(id)obj completionHandler:(void (^)(NSURLResponse *response, NSURL *filePath, NSError *error))completionHandler {
           Coding_DownloadTask *cTask = nil;
           ProjectFile *file = (ProjectFile *)obj; // Coding-iOSä¸­çš„ä¸€ä¸ªmodel
           cTask = [self addDownloadTaskWithPath:file.downloadPath diskFileName:fileDiskFileName storage_key:file.storage_key completionHandler:completionHandler];

           return cTask;
       }
</code></pre></li>
<li><p><code>addDownloadTaskWithPath:diskFileName:storage_key:completionHandler</code></p>
<pre><code>       // æ–°å»ºä¸‹è½½ä»»åŠ¡ å…·ä½“çš„
       - (void)addDownloadTaskWithPath:(NSString *)downloadPath diskFileName:(NSString *)diskFileName storage_key:(NSString)storage_key completionHandler:(void (^)(NSURLResponse *response, NSURL *filePath, NSError *error))completionHandler {
           NSProgress *progress;
           NSURL *downloadPath = [NSURL URLWithString:downloadPath];
           NSURLRequest *request = [NSURLRequest requestWithURL:downloadPath];
           NSURLSessionDownloadTask *downloadTask = [self.af_manager downloadTaskWithRequest:request progress:&amp;progress destination:^NSURL *(NSURL *targetPath, NSURLResponse *response) {
               NSURL *downloadURL = [Coding_FileManager sharedManager] urlForDownloadFolder];
               Coding_DownloadTask *cDownloadTask = [Coding_FileManager cDownloadTaskForResponse:response];
               if (cDownloadTask) {
                   downloadUrl = [downloadUrl URLByAppendingPathComponent:cDownloadTask.diskFileName];
               } else {
                   downloadUrl = [downloadUrl URLByAppendingPathComponent:[response suggestedFileName]];
               }

               return downloadUrl; // è¿”å›å­˜å‚¨çš„ç›®æ ‡ä½ç½®
           } completionHandler:^(NSURLResponse *response, NSURL *filePath, NSError *error) {
               if (error) {
                   [Coding_FileManager cancelCDownloadTaskForKey:storage_key];
               } else {
                   [Coding_FileManager cancelCDownloadTaskForResponse:response];
               }
           }];

           Coding_DownloadTask *cDownloadTask = [Coding_DownloadTask cDownloadTaskWithTask:downloadTask progress:progress fileName:diskFileName];

           [self.downloadDict setObject:cDownloadTask forKey:storage_key];
           [downloadTask resume];
           return cDownloadTask;
       }
</code></pre></li>
</ol>
</li>
</ul>
<h2 id="å®åŠ›åˆ†æ"><a href="#å®åŠ›åˆ†æ" class="headerlink" title="å®åŠ›åˆ†æ"></a>å®åŠ›åˆ†æ</h2><p>æºç å·²ç»ä»‹ç»å®Œäº†ï¼Œæ¥åˆ†æä¸€æ³¢ã€‚æ³¨æ„ä¸‹é¢å‡ ä¸ªè¦ç‚¹ğŸ‘‡</p>
<ol>
<li>æ¯ä¸ªä¸‹è½½ä»»åŠ¡éƒ½æ˜¯ä¸€ä¸ª<code>Coding_DownloadTask</code>ç±»çš„å®ä¾‹ï¼Œè¿™ä¸ªç±»é‡Œé¢æœ‰ä¸ªNSURLSessionDownloadTaskå±æ€§</li>
<li>æ‰€æœ‰ä¸‹è½½æœ‰å…³çš„æ“ä½œéƒ½ä¼šæ¶‰åŠåˆ°ä¸€ä¸ªç±»<code>Coding_FileManager</code>ï¼ŒCodingä¼šåˆ›å»ºä¸€ä¸ª<code>Coding_FileManager</code>çš„å•ä¾‹ç±»ï¼ˆæ—¢ï¼šAPPç”Ÿå‘½å‘¨æœŸå†…åªä¼šæœ‰ä¸€ä¸ªè¿™ä¸ªç±»çš„å®ä¾‹ï¼‰ã€‚è¯¥å®ä¾‹æœ‰ä¸¤ä¸ªå­—å…¸ï¼š1ä¸ªè´Ÿè´£å­˜å‚¨å·²ç»ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶çš„æ–‡ä»¶URLï¼Œå¦ä¸€ä¸ªè´Ÿè´£å­˜å‚¨å½“å‰è¿˜åœ¨è¿›è¡Œçš„ä¸‹è½½ä»»åŠ¡(Coding_DownloadTask)ã€‚è¿™ä¸¤ä¸ªå­—å…¸çš„keyç”±åå°å®šä¹‰ï¼Œæ¯ä¸ªæ–‡ä»¶ï¼ä»»åŠ¡å¯¹åº”å”¯ä¸€çš„ä¸€ä¸ªstorage_key</li>
<li>æ‰€æœ‰ä¸‹è½½çš„æ–‡ä»¶å­˜æ”¾åœ¨APPçš„Documentæ–‡ä»¶å¤¹ä¸‹é¢çš„Coding_Downloadæ–‡ä»¶å¤¹ä¸‹é¢ï¼Œåœ¨åˆ›å»ºå•ä¾‹ç±»Coding_FileManagerçš„æ—¶å€™æ£€æµ‹è¯¥æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºã€‚</li>
<li>å¼€å§‹ä¸€ä¸ªæ–°çš„ä¸‹è½½ä»»åŠ¡å…¶å®å°±æ˜¯åˆ›å»ºä¸€ä¸ªNSURLSessionDownloadTaskï¼Œç„¶åå†å°†è¯¥NSURLSessionDownloadTaskå°è£…è¿›Coding_DownloadTaskã€‚è€Œåˆ›å»ºè¯¥NSURLSessionDownloadTaskç”¨çš„æ˜¯AFURLSessionManagerçš„downloadTaskWithRequestæ–¹æ³•ã€‚</li>
<li>æœ‰ä¸€ä¸ªç›‘æ§ä¸‹è½½æ–‡ä»¶å¤¹å†…å®¹å˜åŒ–çš„ç›‘æ§å™¨ï¼Œæ¯å½“æ–‡ä»¶å¤¹å†…å®¹å˜åŒ–æ—¶ï¼ˆæ–‡ä»¶è¢«åˆ é™¤æˆ–æ–‡ä»¶ä¸‹è½½å®Œæˆï¼‰å®ƒä¼šè‡ªåŠ¨æ›´æ–°å­˜æ”¾ä¸‹è½½æ–‡ä»¶è·¯å¾„URLçš„å­—å…¸ï¼Œä¹Ÿå°±æ˜¯æ›´æ–°å½“å‰APPä¸‹è½½äº†å“ªäº›æ–‡ä»¶</li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ€åæ¥ç”¨ç²¾ç‚¼çš„è¯­è¨€æ¥æ€»ç»“ä¸€ç•ªï¼š</p>
<ol>
<li>æ¯ä¸ªä¸‹è½½ä»»åŠ¡ï¼æ–‡ä»¶éƒ½æœ‰å”¯ä¸€ä¸ä¹‹å¯¹åº”çš„storage_keyã€‚æ¯å½“æ–°æ¥ä¸€ä¸ªä¸‹è½½ä»»åŠ¡æ—¶ï¼Œå…ˆæŸ¥çœ‹å·²ç»å®Œæˆçš„æ–‡ä»¶é‡Œé¢æ˜¯å¦åŒ…æ‹¬äº†è¯¥æ–‡ä»¶(å³ï¼šæŸ¥çœ‹å­˜æ”¾å·²ä¸‹è½½æ–‡ä»¶çš„å­—å…¸æ˜¯å¦æœ‰è¯¥storage_key)ã€‚è‹¥å·²ç»ä¸‹è½½ï¼Œåˆ™å®Œæˆä¸‹è½½ä»»åŠ¡ï¼›è¿˜æœªä¸‹è½½ï¼Œè¿›è¡Œç¬¬äºŒæ­¥ã€‚</li>
<li>åˆ¤æ–­è¯¥ä»»åŠ¡æ˜¯å¦å­˜åœ¨(å³ï¼šæŸ¥çœ‹å­˜å‚¨ä¸‹è½½ä»»åŠ¡çš„å­—å…¸ï¼Œçœ‹æ˜¯å¦æœ‰è¯¥storage_key)ã€‚è‹¥è¯¥ä»»åŠ¡å­˜åœ¨ï¼Œè¯´æ˜ä¹‹å‰è¿™ä¸ªä»»åŠ¡å¯èƒ½è¢«æš‚åœäº†ï¼Œé‚£ä¹ˆç»§ç»­è¯¥ä¸‹è½½ä»»åŠ¡ï¼Œå¹¶è·³è¿‡æ­¥éª¤3ï¼›è‹¥è¯¥ä»»åŠ¡ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆè¿›è¡Œç¬¬ä¸‰æ­¥ã€‚</li>
<li>æ ¹æ®ä»»åŠ¡çš„storage_keyï¼Œæ–‡ä»¶çš„urlåˆ›å»ºCoding_DownloadTaskï¼Œå…¶å®ä¸»è¦çš„æ˜¯åˆ›å»ºä¸€ä¸ªNSURLSessionDownloadTaskï¼Œç„¶åå°†è¯¥Coding_DownloadTaskå­˜æ”¾åˆ°å­˜å‚¨ä¸‹è½½ä»»åŠ¡çš„å­—å…¸ä¸­ï¼Œå¹¶å¼€å§‹ä¸‹è½½æ–‡ä»¶ã€‚</li>
<li>å½“æ–‡ä»¶ä¸‹è½½å®Œæˆæ—¶å€™ï¼Œä»å­˜å‚¨ä¸‹è½½ä»»åŠ¡çš„å­—å…¸ä¸­å°†è¿™ä¸ªä»»åŠ¡åˆ é™¤ï¼›å¹¶ä¸”æ–‡ä»¶ä¼šè¢«å­˜æ”¾åˆ°ç›¸åº”çš„æ–‡ä»¶å¤¹ï¼Œè§¦å‘æ–‡ä»¶å¤¹ç›‘æ§å™¨çš„å‡½æ•°ï¼Œå°†è¯¥æ–‡ä»¶çš„æ–‡ä»¶URLæ·»åŠ åˆ°å­˜å‚¨å·²ç»ä¸‹è½½å®Œæˆçš„æ–‡ä»¶URLçš„å­—å…¸ä¸­ã€‚</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://github.com/Coding/Coding-iOS" target="_blank" rel="external">Coding-iOS</a></li>
</ul>
<h2 id="P-S"><a href="#P-S" class="headerlink" title="P.S"></a>P.S</h2><p>å·²ç»è¿‡äº†2ä¸ªå¤§å†°çº¢èŒ¶äº†ï¼Œä¸€ç«‹è¿˜ä¼šè¿œå˜›ï½ï½ï½</p>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[NSObject+ObjectMap æºç åˆ†æ]]></title>
      <url>/2016/05/07/NSObject-ObjectMap/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>iOSåº”ç”¨ä»APIè·å¾—çš„æ•°æ®æœ‰å¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†æ˜¯ä»¥JSONæ ¼å¼è¿”å›çš„ï¼Œé€šè¿‡AFNetworkingï¼Œè¿™ç§JSONæ ¼å¼ä¼šè¢«è½¬æ¢æˆNSDictionaryæˆ–è€…NSArrayï¼Œä»è€Œè¢«APPæ‰€æ¥æ”¶ã€‚<br>è¿™æ—¶ï¼Œå¦‚æœèƒ½å°†è¿™äº›NSDictionary/NSArrayè½¬åŒ–æˆAPPä¸­å·²ç»å°è£…å¥½çš„å„ç§Modelï¼Œå°†æå¤§çš„ç®€åŒ–APPçš„å¼€å‘ã€‚<br>æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹åº“å·²ç»å®ç°äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæ¯”è¾ƒçŸ¥åçš„å°±æœ‰<a href="https://github.com/CoderMJLee/MJExtension" target="_blank" rel="external">MJExtension</a></p>
<blockquote>
<p>MJExtension: A fast, convenient and nonintrusive conversion between JSON and model. Your model class donâ€™t need to extend another base class. You donâ€™t need to modify any model file.</p>
</blockquote>
<p>å—¯ï¼Œè¿™ä¸ªç¬¬ä¸‰æ–¹åº“å¾ˆæœ‰åï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œä½¿ç”¨ä¹Ÿæ–¹ä¾¿ï¼Œä½†æ˜¯æœ¬æ–‡å¹¶ä¸ä»‹ç»å®ƒã€‚åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢ï¼Œæˆ‘å°†ä»‹ç»ä¸€ä¸ªå°çš„ä»JSONåˆ°Modelè¿›è¡Œè½¬æ¢çš„ç¬¬ä¸‰æ–¹åº“ï¼Œè¿™ä¸ªåº“å°åˆ°æ²¡æœ‰ä¸€ä¸ªåƒæ ·çš„åå­—ï¼Œæˆ‘åœ¨githubä¸Šä¹Ÿåªæ‰¾åˆ°äº†ä¸€ä¸ªæ¨¡ç³Šçš„åœ°å€ï¼š<a href="https://github.com/uacaps/NSObject-ObjectMap" target="_blank" rel="external">uacaps/NSObject-ObjectMap</a> (<em>æ³¨</em> ä¸èƒ½ç¡®è®¤æ˜¯å¦æ˜¯æœ¬æ–‡æ‰€ä»‹ç»çš„)ã€‚<br>å¦å¤–ï¼Œæˆ‘ä¹Ÿå°†æœ¬æ–‡æ‰€ä»‹ç»çš„è¿™ä¸ªç¬¬ä¸‰æ–¹åº“ä¸Šä¼ åˆ°æˆ‘çš„<a href="https://github.com/vanney9/blogDemo/tree/master/NSObject%2BObjectMap" target="_blank" rel="external">github</a>ä¸Šå»äº†ã€‚</p>
<a id="more"></a>
<h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p>è¯´æ­£äº‹ï¼Œè¿™ä¸ªç¬¬ä¸‰æ–¹åº“åªåŒ…å«2ä¸ªæ–‡ä»¶ï¼Œ<code>NSObject+ObjectMap.h</code>å’Œ<code>NSObject+ObjectMap.m</code>ã€‚ä»åå­—å¯ä»¥çœ‹å‡ºï¼Œå®ƒåº”è¯¥æ˜¯å®ç°äº†NSObjectç±»çš„ä¸€ä¸ªcategoryï¼Œçš„ç¡®ä¹Ÿæ˜¯å¦‚æ­¤çš„ã€‚ç”¨ä¸‹é¢å‡ å¼ å›¾æ¥è¯´è¯´è¿™ä¸ªåº“å…·ä½“å¹²äº†äº›ä»€ä¹ˆã€‚</p>
<ol>
<li>APPé€šè¿‡APIè·å¾—Serveræä¾›çš„æ•°æ®æ˜¯JSONæ ¼å¼çš„ï¼Œå¦‚ä¸‹ğŸ‘‡<br><img src="/lionheart/1605/json.png" alt="JSON"></li>
<li>è¯¥JSONæ ¼å¼çš„æ•°æ®ç»è¿‡AFNetworkingè¿”å›ç»™APPçš„æ•°æ®å½¢å¼æ˜¯<code>NSDictionary</code>({â€¦})æˆ–è€…<code>NSArray</code>([â€¦])</li>
<li>è¿™äº›æ•°æ®ç»è¿‡<code>NSObject+ObjectMap</code>è½¬åŒ–æˆæœ€ç»ˆçš„modelå¯¹è±¡ï¼Œå¦‚ä¸‹ğŸ‘‡<br><img src="/lionheart/1605/model.png" alt="Model"></li>
</ol>
<h2 id="æ­£ç»çš„æºç åˆ†æ"><a href="#æ­£ç»çš„æºç åˆ†æ" class="headerlink" title="æ­£ç»çš„æºç åˆ†æ"></a>æ­£ç»çš„æºç åˆ†æ</h2><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>ä»Network Requestä¸­å¾—åˆ°çš„æ•°æ®å¦‚ä¸‹ğŸ‘‡<br><img src="/lionheart/1605/json.png" alt="JSON"><br>è°ƒç”¨NSObject+ObjectMapä¸­çš„å‡½æ•°ï¼Œå°†JSON-&gt;Model</p>
<pre><code>        id resultData = [data valueForKeyPath:@&quot;data&quot;];
        ProjectTopics *resultT = [NSObject objectOfClass:@&quot;ProjectTopics&quot; fromJSON:resultData];
</code></pre><h3 id="æ­£ç»å®ç°"><a href="#æ­£ç»å®ç°" class="headerlink" title="æ­£ç»å®ç°"></a>æ­£ç»å®ç°</h3><p><code>+(id)objectOfClass:(NSString *)object fromJSON:(NSDictionary *)dict;</code><br>è¯¥å‡½æ•°æ˜¯æœ¬æ–‡åˆ†æçš„æ ¸å¿ƒï¼Œå®ƒå®ç°äº†å°†JSON-&gt;Modelï¼Œæ¥çœ‹çœ‹å®ƒå…·ä½“æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<h4 id="åˆå§‹åŒ–Modelå¯¹è±¡-ä¾‹å­ä¸­ä½¿ç”¨çš„æ˜¯ProjectTopicså¯¹è±¡-ï¼Œå€ŸåŠ©NSClassFromStringçš„å¸®åŠ©"><a href="#åˆå§‹åŒ–Modelå¯¹è±¡-ä¾‹å­ä¸­ä½¿ç”¨çš„æ˜¯ProjectTopicså¯¹è±¡-ï¼Œå€ŸåŠ©NSClassFromStringçš„å¸®åŠ©" class="headerlink" title="åˆå§‹åŒ–Modelå¯¹è±¡(ä¾‹å­ä¸­ä½¿ç”¨çš„æ˜¯ProjectTopicså¯¹è±¡)ï¼Œå€ŸåŠ©NSClassFromStringçš„å¸®åŠ©"></a>åˆå§‹åŒ–Modelå¯¹è±¡(ä¾‹å­ä¸­ä½¿ç”¨çš„æ˜¯<code>ProjectTopics</code>å¯¹è±¡)ï¼Œå€ŸåŠ©<code>NSClassFromString</code>çš„å¸®åŠ©</h4><pre><code>        id newObject = [[NSClassFromString(object) alloc] init];
</code></pre><h4 id="è·å–ProjectTopicså¯¹è±¡çš„å…¨éƒ¨å±æ€§"><a href="#è·å–ProjectTopicså¯¹è±¡çš„å…¨éƒ¨å±æ€§" class="headerlink" title="è·å–ProjectTopicså¯¹è±¡çš„å…¨éƒ¨å±æ€§"></a>è·å–<code>ProjectTopics</code>å¯¹è±¡çš„å…¨éƒ¨å±æ€§</h4><pre><code>        [newObject propertyDictionary];
</code></pre><p>å…·ä½“çœ‹çœ‹å¦‚ä½•å®ç°</p>
<pre><code>        - (NSDictionary *)propertyDictionary {
              NSMutableDictionary *dict = [NSMutableDictionary dictionary];

              unsigned count;
              objc_property_t *properties = class_copyPropertyList([self class], &amp;count);

              for (int i = 0; i &lt; count; i++) {
                  NSString *key = [NSString stringWithUTF8String:property_getName(properties[i])];
                  [dict setObject:key forKey:key];
              }

              free(properties);

              // Add all superclass properties as well, until it hits NSObject
              NSString *superClassName = [[self superclass] nameOfClass];
              if (![superClassName isEqualToString:@&quot;NSObject&quot;]) {
                  for (NSString *property in [[[self superclass] propertyDictionary] allKeys]) {
                      [dict setObject:property forKey:property];
                  }
              }

              return dict;
          }
</code></pre><p><strong> å…³é”®å‡½æ•° </strong></p>
<ul>
<li><code>objc_property_t *class_copyPropertyList(Class cls, unsigned int *outCount)</code>:<br>  è¯¥å‡½æ•°å°†ProjectTopicsç±»çš„å±æ€§æ‹·è´åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œå¹¶è¿”å›è¯¥æ•°ç»„ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯<code>objc_property_t</code>ç±»å‹</li>
<li><code>const char *property_getName(objc_property_t property)</code><br>  è¯¥å‡½æ•°ä¼ å…¥ä¸€ä¸ªobjc_property_tå‚æ•°ï¼Œå¹¶è¿”å›è¯¥å±æ€§çš„å±æ€§å</li>
</ul>
<p><strong> å…³é”®æ­¥éª¤ </strong></p>
<ul>
<li>è·å–ProjectTopicsç±»çš„æ‰€æœ‰å±æ€§åï¼Œå°†æ‰€æœ‰å±æ€§åæ·»åŠ å…¥ä¸€ä¸ªNSDictionary<ul>
<li>å¦‚æœçˆ¶ç±»ä¸æ˜¯NSObjectï¼Œä¹Ÿå°†çˆ¶ç±»çš„æ‰€æœ‰å±æ€§ååŠ å…¥åŒä¸€ä¸ªNSDictionary</li>
</ul>
</li>
</ul>
<p>æœ€ç»ˆå¾—åˆ°çš„NSDictionaryå¦‚ä¸‹ğŸ‘‡<br><img src="/lionheart/1605/property.png" alt="property"></p>
<h4 id="éå†ä¼ å…¥çš„NSDictionaryï¼šdict-ä¸ºProjectTopicsç±»çš„å„ä¸ªå±æ€§èµ‹å€¼"><a href="#éå†ä¼ å…¥çš„NSDictionaryï¼šdict-ä¸ºProjectTopicsç±»çš„å„ä¸ªå±æ€§èµ‹å€¼" class="headerlink" title="éå†ä¼ å…¥çš„NSDictionaryï¼šdict,ä¸ºProjectTopicsç±»çš„å„ä¸ªå±æ€§èµ‹å€¼"></a>éå†ä¼ å…¥çš„NSDictionaryï¼š<code>dict</code>,ä¸ºProjectTopicsç±»çš„å„ä¸ªå±æ€§èµ‹å€¼</h4><p>å…ˆå†æ¥çœ‹çœ‹è¿™ä¸ªdictğŸ‘‡<br><img src="/lionheart/1605/json.png" alt="JSON"><br>å› ä¸ºä¼ å…¥<code>dict</code>ä¸­çš„æ¯ä¸ªkeyå…¶å®å°±æ˜¯ProjectTopicsç±»ä¸­çš„æ¯ä¸ªå±æ€§åï¼Œæ‰€ä»¥å°±å¯ä»¥ç›´æ¥èµ‹å€¼äº†ã€‚å½“ç„¶å…¶ä¸­ä¹Ÿåˆ†3ä¸­æƒ…å†µï¼Œ</p>
<ol>
<li><p>æœ€ç®€å•çš„æƒ…å†µï¼Œè¿™ä¸ªkeyå¯¹åº”çš„å€¼æ—¢ä¸æ˜¯NSArrayï¼Œä¹Ÿä¸æ˜¯NSDictionary(æ¯”å¦‚id, owner_idç­‰)ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œç›´æ¥èµ‹å€¼ï¼Œä»£ç å¦‚ä¸‹ğŸ‘‡</p>
<pre><code>       objc_property_t property = class_getProperty([newObject class], [propertyName UTF8String]);
       if (!property) {
           continue;
       }
       NSString *classType = [newObject typeFromProperty:property];

       // check if NSDate or not
       if ([classType isEqualToString:@&quot;T@\&quot;NSDate\&quot;&quot;]) {
           //                1970å¹´çš„longå‹æ•°å­—
           NSObject *obj = [dict objectForKey:key];
           if ([obj isKindOfClass:[NSNumber class]]) {
               NSNumber *timeSince1970 = (NSNumber *)obj;
               NSTimeInterval timeSince1970TimeInterval = timeSince1970.doubleValue/1000;
               NSDate *date = [NSDate dateWithTimeIntervalSince1970:timeSince1970TimeInterval];
               [newObject setValue:date forKey:propertyName];
           }else{
               //                            æ—¥æœŸå­—ç¬¦ä¸²
               NSDateFormatter *formatter = [[NSDateFormatter alloc] init];
               [formatter setDateFormat:OMDateFormat];
               [formatter setTimeZone:[NSTimeZone timeZoneWithAbbreviation:OMTimeZone]];
               NSString *dateString = [[dict objectForKey:key] stringByReplacingOccurrencesOfString:@&quot;T&quot; withString:@&quot; &quot;];
               [newObject setValue:[formatter dateFromString:dateString] forKey:propertyName];
           }
       }
       else {
           if ([dict objectForKey:key] != [NSNull null]) {
               [newObject setValue:[dict objectForKey:key] forKey:propertyName];
           }
           else {
               [newObject setValue:nil forKey:propertyName];
           }
       }
</code></pre><p>ä¸Šè¿°ä»£ç è¯´äº†å¾ˆå¤šï¼Œä½†æ˜¯ä¸»è¦æ˜¯åŒºåˆ†è¯¥å±æ€§æ˜¯å¦æ˜¯ä¸€ä¸ªNSDate,å¦‚æœä¸æ˜¯çš„è¯å°±ç›´æ¥é€šè¿‡ä¸‹é¢ä»£ç èµ‹å€¼å°±å®Œæˆäº†</p>
<pre><code>       [newObject setValue:[dict objectForKey:key] forKey:propertyName]; // KVO
</code></pre><p>è‡³äºå¦‚ä½•åˆ¤æ–­å±æ€§æ˜¯å¦æ˜¯NSDateï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªå…³é”®å‡½æ•°</p>
<ul>
<li><code>objc_property_t class_getProperty(Class cls, const char *name)</code><br>è¯¥å‡½æ•°ä¼ å…¥ç±»å’Œå­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ª<code>objc_property_t</code>ç±»å‹çš„å±æ€§</li>
<li><code>- (NSString *)typeFromProperty:(objc_property_t)property;</code><br>è¯¥å‡½æ•°çš„å®ç°å¦‚ä¸‹<pre><code>       return [[NSString stringWithUTF8String:property_getAttributes(property)] componentsSeparatedByString:@&quot;,&quot;][0];
</code></pre>å®ƒè¿”å›çš„NSStringæ˜¯é•¿è¿™æ ·çš„ï¼šT@â€NSDateâ€,&amp;,N,V_last_activity_at ï¼ T@â€NSStringâ€,&amp;,N,V_companyï¼›æ‰€ä»¥å¯ä»¥æ ¹æ®æ˜¯å¦æœ‰NSDateè¿›è¡Œåˆ¤æ–­</li>
</ul>
</li>
<li>å¦‚æœè¿™ä¸ªkeyå¯¹åº”çš„æ˜¯ä¸€ä¸ªNSDictionaryå¯¹è±¡ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªå±æ€§ä¹Ÿæ˜¯å¦å¤–ä¸€ä¸ªModelå¯¹è±¡ï¼Œå¯¹è¯¥å±æ€§é€’å½’è°ƒç”¨ä¸Šé¢æ–¹æ³•å³å¯å®ç°èµ‹å€¼ã€‚ä»£ç å¦‚ä¸‹ğŸ‘‡<pre><code>       NSString *propertyType = [newObject classOfPropertyNamed:propertyName];
       id nestedObj = [NSObject objectOfClass:propertyType fromJSON:[dict objectForKey:key]];
       [newObject setValue:nestedObj forKey:propertyName];
</code></pre>å…¶ä¸­çš„propertyTypeå…¶å®å°±æ˜¯é€šè¿‡ä¸Šé¢è®²é“çš„<code>property_getAttributes</code>å‡½æ•°ï¼Œå¹¶è§£æ<code>T@&quot;User&quot;,&amp;,N,V_owner ï¼ T@&quot;Project&quot;,&amp;,N,V_project</code>è¿™ç§ç±»ä¼¼çš„å­—ç¬¦ä¸²ï¼Œæ¥å¾—åˆ°è¿™ä¸ªModelå¯¹è±¡çš„ç±»å‹(æ¯”å¦‚ Userï¼Œ Projectç±»å‹ç­‰)</li>
<li>å¦‚æœè¿™ä¸ªkeyå¯¹åº”çš„æ˜¯ä¸€ä¸ªNSArrayå¯¹è±¡ï¼Œé‚£ä¹ˆå°±å¾—é€šè¿‡<code>ProjectTopics.m</code>ä¸­çš„<code>propertyArrayMap</code>å¾—çŸ¥è¿™ä¸ªNSArrayé‡Œé¢è£…çš„åˆ°åº•æ˜¯ä»€ä¹ˆå¯¹è±¡ã€‚<br>å…ˆæ¥çœ‹çœ‹ProjectTopics.mé‡Œé¢å¯¹propertyArrayMapçš„è®¾ç½®ï¼š<pre><code>       _propertyArrayMap = [NSDictionary dictionaryWithObjectsAndKeys:@&quot;ProjectTopic&quot;, @&quot;list&quot;, nil];
</code></pre>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ<code>ProjectTopics</code>çš„<code>list</code>å±æ€§æ˜¯ä¸€ä¸ªNSArrayå¯¹è±¡ï¼Œè¿™ä¸ªNSArrayé‡Œé¢è£…çš„æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„<code>ProjectTopic</code>å¯¹è±¡ã€‚è¿™å°±å¥½åŠäº†ï¼Œå¯¹è¿™äº›ProjectTopicå¯¹è±¡æŒ‰ç…§ä¸Šè¿°çš„æ–¹æ³•å¯¹ä»–ä»¬è¿›è¡Œèµ‹å€¼ã€‚</li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»ç®—å†™å®Œäº†ã€‚ã€‚ã€‚æ„Ÿè§‰å†™çš„å¾ˆä¹±ã€‚ã€‚ã€‚<br>æ€»ä¹‹å°±æ˜¯å¯¹å…³äºå¯¹è±¡çš„å‡ ä¸ªå±æ€§è¿›è¡Œæ“ä½œï¼š</p>
<ol>
<li><code>[[NSClassFromString(object) alloc] init];</code><br>è¿™ä¸ªå‡½æ•°å¯ä»¥æ ¹æ®å­—ç¬¦ä¸²è·å¾—å¯¹è±¡ï¼Œæ¯”å¦‚æ ¹æ®â€ProjectTopicsâ€æ¥åˆå§‹åŒ–ä¸€ä¸ªProjectTopicså¯¹è±¡</li>
<li><code>objc_property_t *class_copyPropertyList(Class cls, unsigned int *outCount)</code><br>è¿™ä¸ªå‡½æ•°å¯ä»¥è·å¾—å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œå¹¶è¿”å›ä¸€ä¸ªéƒ½æ˜¯ç”±<code>objc_property_t</code>ç»„æˆçš„æ•°ç»„</li>
<li><code>const char *property_getName(objc_property_t property)</code><br>è¿™ä¸ªå‡½æ•°å¯ä»¥è·å¾—å±æ€§çš„å±æ€§åï¼Œæ„æ€å°±æ˜¯è¯´objc_property_tæ˜¯å±æ€§ï¼Œä½†å°±æ˜¯ä¸èƒ½ä»¥å­—ç¬¦ä¸²æ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™ä¸ªå‡½æ•°å°±å¯ä»¥å°†å±æ€§æ˜¾ç¤ºå‡ºæ¥(æ¯”å¦‚ï¼šâ€listâ€å•Š,â€pageâ€å•Š,â€totalRowâ€å•Š ç­‰ç­‰)</li>
<li><code>objc_property_t class_getProperty(Class cls, const char *name)</code><br>è¿™ä¸ªå‡½æ•°å’Œ3ç›¸åï¼Œæ ¹æ®å±æ€§åè·å¾—å±æ€§ (æ„Ÿè§‰objc_property_tå°±æ˜¯ä¸€ä¸ªéš¾ä»¥è¡¨è¿°çš„ä¸œè¥¿)</li>
<li><code>const char *property_getAttributes(objc_property_t property)</code><br>è¿™ä¸ªå‡½æ•°æ ¹æ®å±æ€§è¿”å›å±æ€§çš„ç±»å‹ï¼Œæ¯”å¦‚è¯´<code>owner</code>å±æ€§æ˜¯ä¸€ä¸ª<code>User</code>å¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°å°±è¿”å›<code>@&quot;User&quot;,&amp;,N,V_owner</code></li>
<li><code>[newObject setValue:[dict objectForKey:key] forKey:propertyName];</code><br>ç»™å±æ€§èµ‹å€¼ï¼Œ æ¯”å¦‚propertyNameæ˜¯owner, é‚£ä¹ˆå°±ç»™ä»–èµ‹ä¸€ä¸ªUserå¯¹è±¡ã€‚ç®€å•ç²—æš´</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/ObjCRuntimeRef/" target="_blank" rel="external">Objective-C Runtime Reference</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS Method Swizzling]]></title>
      <url>/2016/03/26/iOS-method-swizzling/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ‰ä¸ªå¥‡æ€ªçš„éœ€æ±‚ï¼šæ¯ä¸ªUIViewControlleråœ¨viewDidAppear:å’ŒviewWillAppear:æ–¹æ³•ä¸­éƒ½éœ€è¦æ‰§è¡Œä¸€äº›æ“ä½œã€‚è¿™é‡Œä»‹ç»ä¸€ç§iOS Method Swizzlingæ–¹æ³•:è®©viewDidAppear:å’ŒcustomViewDidAppear:æ–¹æ³•è°ƒæ¢å®ç°æ–¹å¼ï¼›è®©viewWillAppear:å’ŒcustomViewWillAppear:æ–¹æ³•è°ƒæ¢å®ç°æ–¹å¼ã€‚</p>
<a id="more"></a>
<h2 id="å®ç°è¿‡ç¨‹"><a href="#å®ç°è¿‡ç¨‹" class="headerlink" title="å®ç°è¿‡ç¨‹"></a>å®ç°è¿‡ç¨‹</h2><ol>
<li>æ–°å»ºUIViewControllerçš„ä¸€ä¸ªcategory - Swizzle<ol>
<li>åœ¨Swizzleä¸­å®ç°customViewDidAppear:æ–¹æ³•å’ŒcustomViewWillAppear:æ–¹æ³•ã€‚</li>
<li>å¹¶ä¸”é‡å†™<code>load</code>æ–¹æ³•ï¼Œåœ¨loadæ–¹æ³•ä¸­å°†æŒ‡å‘viewDidAppear:å®ç°çš„æŒ‡é’ˆå’ŒæŒ‡å‘customViewDidAppear:å®ç°çš„æŒ‡é’ˆå¯¹è°ƒï¼›å°†æŒ‡å‘viewWillAppear:å®ç°çš„æŒ‡é’ˆå’ŒæŒ‡å‘customViewWillAppear:å®ç°çš„æŒ‡é’ˆå¯¹è°ƒ</li>
</ol>
</li>
<li>å‡½æ•°æŒ‡é’ˆå¯¹è°ƒå®ç°</li>
<li>åœ¨AppDelegate.mä¸­importè¿™ä¸ªSwizzle categoryã€‚é‚£ä¹ˆåœ¨æ‰€æœ‰çš„UIViewControlleræ‰§è¡Œloadæ–¹æ³•æ—¶éƒ½ä¼šæ‰§è¡ŒSwizzleä¸­é‡å†™çš„loadæ–¹æ³•ï¼Œä»¥å®ç°æ–¹æ³•çš„å¯¹è°ƒï¼›æ‰€ä»¥ä¹‹åæ­£å¸¸è°ƒç”¨viewDidAppear:æˆ–æ˜¯viewWillAppear:æ—¶ï¼Œå…¶å®æ˜¯è°ƒç”¨çš„customViewDidAppear:å’ŒcustomViewWillAppear:æ–¹æ³•</li>
</ol>
<h2 id="å…·ä½“ä»£ç å®ç°"><a href="#å…·ä½“ä»£ç å®ç°" class="headerlink" title="å…·ä½“ä»£ç å®ç°"></a>å…·ä½“ä»£ç å®ç°</h2><ol>
<li><p>Swizzle category</p>
<pre><code>     @implementation UIViewController (Swizzle)

     + (void)load {
         swizzleAllViewController();
     }

     - (void)customViewDidAppear:(BOOL)animated {
         // do something here
         [self customViewDidAppear:animated]; // å…¶å®æ˜¯è°ƒç”¨çš„viewDidAppear:
     }

     - (void)customviewWillAppear:(BOOL)animated {
         // do something here
         [self customviewWillAppear:animated]; // å…¶å®æ˜¯è°ƒç”¨çš„viewWillAppear:
     }

     @end

     // å‡½æ•°æŒ‡é’ˆå¯¹è°ƒ
     void swizzleAllViewController() {
         Swizzle([UIViewController class], @selector(viewDidAppear:), @selector(customViewDidAppear:));
         //Swizzle([UIViewController class], @selector(viewWillDisappear:), @selector(customViewWillDisappear:));
         Swizzle([UIViewController class], @selector(viewWillAppear:), @selector(customviewWillAppear:));
     }
</code></pre></li>
<li><p>å‡½æ•°æŒ‡é’ˆå¯¹è°ƒçš„å®ç°</p>
<pre><code>     void Swizzle(Class c, SEL origSEL, SEL newSEL) {
         Method origMethod = class_getInstanceMethod(c, origSEL);
         Method newMethod = nil;
         if (!origMethod) {
             origMethod = class_getClassMethod(c, origSEL);
             if (!origMethod) {
                 return;
             }
             newMethod = class_getClassMethod(c, newSEL);
             if (!newMethod) {
                 return;
             }
         } else {
             newMethod = class_getInstanceMethod(c, newSEL);
             if (!newMethod) {
                 return;
             }
         }

         if (class_addMethod(c, origSEL, method_getImplementation(newMethod), method_getTypeEncoding(newMethod))) {
             NSLog(@&quot;vanney code log... errorhappened&quot;);
             class_replaceMethod(c, newSEL, method_getImplementation(origMethod), method_getTypeEncoding(origMethod));
         } else {
             method_exchangeImplementations(origMethod, newMethod);
         }
     }
</code></pre></li>
</ol>
<h2 id="P-S"><a href="#P-S" class="headerlink" title="P.S"></a>P.S</h2><p>ä»¥ä¸Šä»£ç éƒ½å‚è€ƒè‡ª<a href="https://github.com/Coding/Coding-iOS" target="_blank" rel="external">Coding-iOS</a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://github.com/Coding/Coding-iOS" target="_blank" rel="external">Coding-iOS</a></li>
<li><a href="http://blog.csdn.net/yiyaaixuexi/article/details/9374411" target="_blank" rel="external">Objective-Cçš„hookæ–¹æ¡ˆï¼ˆä¸€ï¼‰: Method Swizzling</a></li>
<li><a href="http://stackoverflow.com/questions/13326435/nsobject-load-and-initialize-what-do-they-do" target="_blank" rel="external">NSObject +load and +initialize - What do they do?</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[iOSä»å›¾åº“æˆ–ç›¸æœºè·å¾—å›¾ç‰‡]]></title>
      <url>/2016/03/24/iOS-camera-picture-album/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸€æ¬¾Appå¾ˆæœ‰å¯èƒ½éœ€è¦è®¿é—®ç³»ç»Ÿçš„å›¾åº“ï¼ˆç…§ç‰‡ï¼‰æˆ–è€…é€šè¿‡ç›¸æœºæ¥è·å–å›¾ç‰‡ï¼Œæ¯”å¦‚æ›´æ¢ç”¨æˆ·å¤´åƒç­‰ç­‰ã€‚æ•ˆæœå¦‚å›¾ğŸ‘‡</p>
<p><img src="/lionheart/1603/camerademo.gif" alt="camera demo"></p>
<p>ä¸‹é¢æ¥çœ‹çœ‹å¦‚ä½•å®ç°</p>
<a id="more"></a>
<h2 id="æŸ¥çœ‹è®¿é—®æƒé™"><a href="#æŸ¥çœ‹è®¿é—®æƒé™" class="headerlink" title="æŸ¥çœ‹è®¿é—®æƒé™"></a>æŸ¥çœ‹è®¿é—®æƒé™</h2><p>Appåœ¨ç¬¬ä¸€æ¬¡è®¿é—®ç³»ç»Ÿç…§ç‰‡æˆ–è€…ç›¸æœºæ—¶ï¼Œé€šå¸¸éœ€è¦è¯¢é—®æ˜¯å¦æœ‰æƒé™å»accessç›¸ç‰‡å›¾åº“æˆ–è€…ä½¿ç”¨ç›¸æœºã€‚å¯ä»¥é€šè¿‡ä¸‹é¢ä»£ç å¾—çŸ¥ç›®å‰è¯¥appçš„æƒé™ğŸ‘‡</p>
<pre><code>        @import AVFoundation;
        @import Photos;

        // æ£€æŸ¥ä½¿ç”¨ç›¸ç‰‡çš„æƒé™ï¼Œ YESä¸ºå¯ä»¥è®¿é—®ï¼ŒNOä¸ºä¸èƒ½ä½¿ç”¨
        + (BOOL)checkPhotoLibraryAuthorizationStatus {
            if ([PHPhotoLibrary responseToSelector:@selector(authorizationStatus)]) {
                PHAuthorizationStatus status = [PHPhotoLibrary authorizationStatus]; // è·å–å½“å‰appå¯¹ç›¸ç‰‡çš„æƒé™
                if (status == PHAuthorizationStatusDenied || status == PHAuthorizationStatusRestricted) { // è‹¥å½“å‰æƒé™ä¸ºä¸å…è®¸ä½¿ç”¨
                    [self showSettingAlertStr:@&quot;è¯·åœ¨iPhoneçš„â€œè®¾ç½®-&gt;éšç§-&gt;ç…§ç‰‡â€ä¸­æ‰“å¼€æœ¬åº”ç”¨çš„è®¿é—®æƒé™&quot;]; // æç¤ºç”¨æˆ·å»**è®¾ç½®**ä¸­æ›´æ”¹æƒé™
                    return NO;
                }
            }

            return YES;
        }

        // æ£€æŸ¥ä½¿ç”¨ç›¸æœºçš„æƒé™ï¼Œ YESä¸ºå¯ä»¥ä½¿ç”¨ï¼Œ NOä¸ºä¸èƒ½è®¿é—®
        + (BOOL)checkCameraAuthorizationStatus {
            if (![UIImagePickerController isSourceTypeAvailable:UIImagePickerControllerSourceTypeCamera]) { // åˆ¤æ–­è¯¥è®¾å¤‡æ˜¯å¦æ”¯æŒæ‹ç…§
                alert(@&quot;è¯¥è®¾å¤‡ä¸èƒ½æ‹ç…§&quot;)ï¼›
                return NO;
            }

            if ([AVCaptureDevice responseToSelector:@selector(authorizationStatusForMediaType:)]) {
                AVAuthorizationStatus status = [AVCaptureDevice authorizationStatusForMediaType:AVMediaTypeVideo]; // è·å–å½“å‰appå¯¹ç›¸æœºçš„æƒé™
                if (status == AVAuthorizationStatusDenied || status == AVAuthorizationStatusRestricted) { // è‹¥å½“å‰æƒé™ä¸ºä¸å…è®¸ä½¿ç”¨
                    [self showSettingAlertStr:@&quot;è¯·åœ¨iPhoneçš„â€œè®¾ç½®-&gt;éšç§-&gt;ç›¸æœºâ€ä¸­æ‰“å¼€æœ¬åº”ç”¨çš„è®¿é—®æƒé™&quot;]; // æç¤ºç”¨æˆ·å»**è®¾ç½®**ä¸­æ›´æ”¹æƒé™
                    return NO;
                }
            }

            return YES;
        }

        // æç¤ºç”¨æˆ·å»è®¾ç½®ä¸­æ›´æ”¹æƒé™
        + (void)showSettingAlertStr:(NSString *)tipStr {
            if (floor(NSFoundationVersionNumber) &gt; NSFoundationVersionNumber_iOS_7_1) { // iOS7.1ä¹‹åçš„å¯ä»¥ç›´æ¥è¿›å…¥è®¾ç½®
                // æ–°å»ºæç¤ºå¼¹æ¡†
                UIAlertView *alertView = [UIAlertView bk_alertViewWithTitle:@&quot;æç¤º&quot; message:tipStr];
                [alertView bk_setCancelButtonWithTitle:@&quot;å–æ¶ˆ&quot; handler:nil];
                [alertView bk_addButtonWithTitle:@&quot;&quot; handler:nil];
                [alertView bk_setDidDismissBlock:^(UIAlertView *alertView, NSInteger buttonIndex) {
                    if (buttonIndex == 1) {
                        // è·³è½¬åˆ°è®¾ç½®ç•Œé¢è¿›è¡Œè®¾ç½®
                        UIApplication *app = [UIApplication sharedApplication];
                        NSURL *settingsURL = [NSURL urlWithString:UIApplicationOpenSettingsURLString];
                        if ([app canOpenURL:settingsURL]) {
                            [app openURL:settingsURL];
                        }
                    }
                }];
            }
        }
</code></pre><p>æ•ˆæœå¦‚ä¸‹ğŸ‘‡<br><img src="/lionheart/1603/authorizationdemo.gif" alt="autorization demo"></p>
<h2 id="UIImagePickerController"><a href="#UIImagePickerController" class="headerlink" title="UIImagePickerController"></a>UIImagePickerController</h2><p><a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIImagePickerController_Class/" target="_blank" rel="external">UIImagePickerController</a>æ˜¯ç³»ç»Ÿæä¾›çš„ç”¨æ¥æ‹ç…§æˆ–è€…ä½¿ç”¨ç³»ç»Ÿç›¸ç‰‡çš„ç”¨æˆ·ç•Œé¢ã€‚</p>
<p>ä½¿ç”¨UIImagePickerControlleréœ€æ³¨æ„ï¼š</p>
<ol>
<li>sourceTypeå±æ€§: è¯¥å±æ€§è¯´æ˜UIImagePickerControllerä¼šå¦‚ä½•æ˜¾ç¤ºç•Œé¢ã€‚å¦‚æœsourceTypeä¸ºUIImagePickerControllerSourceTypeCameraï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šå‘ˆç°ä¸€ä¸ªæ‹ç…§çš„ç•Œé¢ï¼›å¦‚æœsourceTypeä¸ºUIImagePickerControllerSourceTypeSavedPhotosAlbumï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šå‘ˆç°ä¸€ä¸ªé€‰å–ç³»ç»Ÿç…§ç‰‡çš„ç•Œé¢</li>
<li>æ£€æŸ¥appæ˜¯å¦æœ‰æƒé™ä½¿ç”¨ç›¸æœºæˆ–è€…ç³»ç»Ÿç›¸ç‰‡</li>
</ol>
<p>ä¸‹é¢æ¥çœ‹çœ‹ä½¿ç”¨ç¤ºä¾‹ğŸ‘‡</p>
<pre><code>        + (void)showImagePickerController {
            UIImagePickerController *pickerController = [UIImagePickerController alloc] init]; // åˆå§‹åŒ–
            pickerController.delegate = self;
            pickerController.allowsEditing = YES; //å…è®¸ç”¨æˆ·ç¼–è¾‘æ‹æ‘„çš„å›¾ç‰‡æˆ–è€…é€‰å–çš„ç›¸å†Œçš„å›¾ç‰‡
            if (camera) { // é€‰æ‹©ç›¸æœº
                if (![Helper checkCameraAuthorizationStatus]) { // æ ¹æ®ä¸Šæ–‡çš„å‡½æ•°ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ä½¿ç”¨ç›¸æœºçš„æƒé™
                    return;
                }
                pickerController.sourceType = UIImagePickerControllerSourceTypeCamera; // æŒ‡å®šsourceTypeä¸ºCameraï¼ŒpickerControllerå°†ä¼šæä¾›ä¸€ä¸ªæ‹æ‘„çš„ç•Œé¢
            } else { // é€‰æ‹©ç³»ç»Ÿå›¾åº“
                if (![Helper checkPhotoLibraryAuthorizationStatus]) { // æ ¹æ®ä¸Šæ–‡å‡½æ•°ï¼Œåˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿaccessç³»ç»Ÿå›¾åº“
                    return;
                }
                pickerController.sourceType = UIImagePickerControllerSourceTypeSavedPhotosAlbum; // æŒ‡å®šsourceTypeä¸ºSavedPhotosAlbumï¼ŒpickerControllerå°†ä¼šæä¾›ä¸€ä¸ªé€‰å–ç³»ç»Ÿç›¸ç‰‡çš„ç•Œé¢
            }
            [self presentViewController:pickerController animated:YES completion:nil]; // å±•ç¤ºUIImagePickerController
        }


        // UIImagePickerControllerDelegate

        // è¿›å…¥UIImagePickerControlleråå¦‚æœé€‰æ‹©`cancel` å°±ä¸åšä»€ä¹ˆå¤„ç†
        - (void)imagePickerControllerDidCancel:(UIImagePickerController *)picker {
            [picker dismissViewControllerAnimated:YES completion:nil];
        }

        // è¿›å…¥UIImagePickerControlleråå¦‚æœé€‰æ‹©`done` åšä¸€äº›å¤„ç†
        - (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary&lt;NSString *, id&gt;*)info {
            // æ¨å‡ºUIImagePickerControllerå¹¶å¤„ç†é€‰å–çš„å›¾ç‰‡
            [picker dismissViewControllerAnimated:YES completion:^{
                UIImage *editedImage, *originalImage;
                editedImage = [info objectForKey:UIImagePickerControllerEditedImage]; // è·å–ç¼–è¾‘åçš„å›¾ç‰‡

                // do something here: like take this edited image as user avatar or something else

                // å¦‚æœæ˜¯ç›¸æœºæ‹æ‘„çš„å›¾ç‰‡ï¼Œé‚£ä¹ˆå°†åŸå›¾ä¿å­˜åˆ°ç³»ç»Ÿå›¾åº“
                if (picker.sourceType == UIImagePickerControllerSourceTypeCamera) {
                    originalImage = [info objectForKey:UIImagePickerControllerOriginalImage]; // è·å–ç¼–è¾‘ä¹‹å‰çš„å›¾ç‰‡
                    UIImageWriteToSavedPhotosAlbum(originalImage, self, nil, NULL); //å°†å›¾ç‰‡ä¿å­˜
                }
            }];
        }
</code></pre><h2 id="P-S"><a href="#P-S" class="headerlink" title="P.S"></a>P.S</h2><p>æœ¬æ–‡ä»£ç éƒ½å‚è€ƒè‡ª<a href="https://github.com/Coding/Coding-iOS" target="_blank" rel="external">Coding-iOS</a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://github.com/Coding/Coding-iOS" target="_blank" rel="external">Coding-iOS</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[iOSå…¨å±€è®¾ç½®]]></title>
      <url>/2016/03/24/iOS-global-setting/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸€ä¸ªiOSé¡¹ç›®ï¼Œæœ‰å¾ˆå¤šä¸œè¥¿æ˜¯å…¨å±€é€šç”¨çš„ï¼Œæ¯”å¦‚å…¨å±€å¸¸é‡ç­‰ç­‰ã€‚åœ¨æ•´ä¸ªé¡¹ç›®çš„æŸä¸ªåœ°æ–¹ï¼Œå¯¹å…¶è¿›è¡Œå…¨å±€è®¾ç½®ï¼Œä¼šæå¤§çš„æ–¹ä¾¿ç¨‹åºçš„ç¼–å†™ï¼Œè€Œä¸”ç®€åŒ–ç¨‹åºçš„ç»“æ„ã€‚</p>
<h2 id="ä¸åŒç±»å‹çš„å…¨å±€è®¾ç½®"><a href="#ä¸åŒç±»å‹çš„å…¨å±€è®¾ç½®" class="headerlink" title="ä¸åŒç±»å‹çš„å…¨å±€è®¾ç½®"></a>ä¸åŒç±»å‹çš„å…¨å±€è®¾ç½®</h2><a id="more"></a>
<ol>
<li>ç”¨æˆ·ç™»å½•ï¼Œç”¨æˆ·æ•°æ®å…¨å±€å­˜å‚¨</li>
</ol>
<h2 id="ç”¨æˆ·ç™»å½•ï¼Œç”¨æˆ·æ•°æ®å…¨å±€å­˜å‚¨"><a href="#ç”¨æˆ·ç™»å½•ï¼Œç”¨æˆ·æ•°æ®å…¨å±€å­˜å‚¨" class="headerlink" title="ç”¨æˆ·ç™»å½•ï¼Œç”¨æˆ·æ•°æ®å…¨å±€å­˜å‚¨"></a>ç”¨æˆ·ç™»å½•ï¼Œç”¨æˆ·æ•°æ®å…¨å±€å­˜å‚¨</h2><p>ç”¨æˆ·ç™»å½•æ—¶ï¼Œå¯¹ç”¨æˆ·æ•°æ®è¿›è¡Œå­˜å‚¨ï¼Œåœ¨å…¨å±€éƒ½å¯ä»¥è·å¾—å½“å‰ç™»å½•ç”¨æˆ·çš„æ•°æ®ã€‚æ¥çœ‹çœ‹å¦‚ä½•å®ç°</p>
<h3 id="NSUserDefaults"><a href="#NSUserDefaults" class="headerlink" title="NSUserDefaults"></a><code>NSUserDefaults</code></h3><p><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/" target="_blank" rel="external">NSUserDefaults</a>ç”¨æ¥å­˜å‚¨è½»é‡çº§çš„æœ¬åœ°æ•°æ®ç°å¸¸åˆé€‚ï¼Œå°±æ¯”å¦‚è¯´å½“å‰çš„ç™»å½•ç”¨æˆ·æ•°æ®ï¼ˆç”¨æˆ·åï¼Œå¯†ç ç­‰ç­‰ï¼‰ã€‚NSUserDefaultså­˜å‚¨æ—¶æ”¯æŒçš„æ•°æ®ç±»å‹æœ‰ NSNumber, NSString, NSDate, NSArray, NSDictionary, BOOLã€‚å®ƒæœ‰ç‚¹ç±»ä¼¼é”®å€¼å¯¹ã€‚</p>
<h3 id="plist"><a href="#plist" class="headerlink" title="plist"></a><code>plist</code></h3><p>plistæ˜¯<code>Property List</code>çš„ç¼©å†™ï¼Œå®ƒæ˜¯ä¸€ä¸ªxmlæ ¼å¼çš„æ–‡ä»¶ï¼Œç”¨æ¥å­˜å‚¨ä¸²è¡ŒåŒ–åçš„å¯¹è±¡ã€‚å› æ­¤plistæ–‡ä»¶å¯ä»¥ç”¨æ¥å­˜å‚¨å†å²ç™»å½•ç”¨æˆ·çš„æ•°æ®ã€‚</p>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h4 id="ç”¨æˆ·ç™»å½•æ—¶"><a href="#ç”¨æˆ·ç™»å½•æ—¶" class="headerlink" title="ç”¨æˆ·ç™»å½•æ—¶"></a>ç”¨æˆ·ç™»å½•æ—¶</h4><pre><code>        + (void)doLogin:(NSDictionary *)loginData {
            NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults]; // è·å–é»˜è®¤çš„NSUserDefaults
            [defaults setObject:[NSNumber numberWithBool:YES] forKey:@&quot;loginStatus&quot;]; // è®¾ç½®ç™»å½•çŠ¶æ€ä¸ºå·²ç™»å½•
            [defaults setObject:loginData forKey:@&quot;loginData&quot;]; // å­˜å‚¨å½“å‰ç™»å½•ç”¨æˆ·æ•°æ®ã€‚æ³¨ï¼šloginDataä¸ºNSDictionaryï¼Œé‡Œé¢å¯ä»¥å­˜æ”¾usernameã€passwordã€emailç­‰ä¿¡æ¯
            [defaults synchronize]; // åŒæ­¥æ•°æ®
            [self saveLoginData:loginData]; // ä½¿ç”¨plistå­˜å‚¨å†å²ç™»å½•ç”¨æˆ·æ•°æ®ï¼Œåœ¨åæ–‡ä¼šæœ‰ä»‹ç»
        }
</code></pre><p>è¿™é‡Œä½¿ç”¨NSUserDefaultså­˜å‚¨ç™»å½•æ—¶çš„æ•°æ®ï¼š</p>
<ol>
<li>ä½¿ç”¨loginStatusé”®æ¥å­˜å‚¨ç™»å½•çŠ¶æ€ï¼šYESè¡¨ç¤ºå·²ç™»å½•ï¼ŒNOè¡¨ç¤ºæœªç™»é™†</li>
<li>ä½¿ç”¨loginDataé”®æ¥å­˜å‚¨ç™»å½•ç”¨æˆ·çš„æ•°æ®ï¼šè¯¥é”®å¯¹åº”çš„å€¼æ˜¯ä¸€ä¸ªNSDictionaryï¼Œè¯¥å­—å…¸é‡Œé¢å¯ä»¥åŒ…å«usernameã€passwordã€emailç­‰ä¸å½“å‰ç”¨æˆ·ç›¸å…³çš„æ•°æ®</li>
<li>[defaults synchronize]; è¯¥æ–¹æ³•è¡¨ç¤ºå°†NSUserDefaultsæ•°æ®åŒæ­¥åˆ°ç£ç›˜ï¼Œæ­¤ä¸¾é¿å…äº†ç¨‹åºæ„å¤–é€€å‡ºè€Œå¯¼è‡´æ•°æ®æœªå­˜å‚¨çš„æƒ…å†µ</li>
<li>saveLoginDataæ–¹æ³•å°†è¿™ä¸ªç”¨æˆ·æ•°æ®å†™å…¥plistæ–‡ä»¶ï¼Œè¾¾åˆ°å­˜å‚¨å†å²æ•°æ®çš„ç›®çš„ï¼Œåé¢ä¼šä»‹ç»</li>
</ol>
<h4 id="ç”¨æˆ·é€€å‡ºæ—¶"><a href="#ç”¨æˆ·é€€å‡ºæ—¶" class="headerlink" title="ç”¨æˆ·é€€å‡ºæ—¶"></a>ç”¨æˆ·é€€å‡ºæ—¶</h4><pre><code>+ (void)doLogout {
    NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults]; // è·å–é»˜è®¤çš„NSUserDefaults
    [defaults setObject:[NSNumber numberWithBool:NO] forKey:@&quot;loginStatus&quot;]; // è®¾ç½®ç™»å½•çŠ¶æ€ä¸ºæœªç™»é™†
    [defaults synchronize]; // åŒæ­¥æ•°æ®
    // do something else, like clear cookies
}
</code></pre><p>è¿™é‡Œå°†ç”¨æˆ·ç™»å½•çŠ¶æ€è®¾ç½®ä¸ºæœªç™»é™†ï¼Œå¹¶åŒæ­¥æ•°æ®</p>
<h4 id="åˆ¤æ–­æ˜¯å¦ç™»å½•"><a href="#åˆ¤æ–­æ˜¯å¦ç™»å½•" class="headerlink" title="åˆ¤æ–­æ˜¯å¦ç™»å½•"></a>åˆ¤æ–­æ˜¯å¦ç™»å½•</h4><pre><code>+ (BOOL)isLogin {
    NSNumber *loginStatus = [NSUserDefaults standardUserDefaults] objectForKey:@&quot;loginStatus&quot;]; // è·å–ç”¨æˆ·ç™»å½•çŠ¶æ€
    if (loginStatus.boolValue) { // åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå¹¶è¿”å›
        return YES;
    } else {
        return NO;
    }
}
</code></pre><p>è·å–NSUserDefaultsä¸­loginStatusé”®çš„å€¼æ¥è·å–ç”¨æˆ·çš„ç™»å½•çŠ¶æ€</p>
<h4 id="è·å–å½“å‰ç™»å½•ç”¨æˆ·"><a href="#è·å–å½“å‰ç™»å½•ç”¨æˆ·" class="headerlink" title="è·å–å½“å‰ç™»å½•ç”¨æˆ·"></a>è·å–å½“å‰ç™»å½•ç”¨æˆ·</h4><pre><code>+ (User *)curLoginUser {
    NSDictionary *loginData = [NSUserDefaults standardUserDefaults] objectForKey:@&quot;loginData&quot;]; // è·å–å½“å‰ç”¨æˆ·æ•°æ®
    User *curLoginUser = loginData ? [NSObject objectOfClass:@&quot;User&quot; fromJSON:loginData]; // è½¬åŒ–ä¸ºUserå¯¹è±¡
    return curLoginUser;
}
</code></pre><p>è·å–NSUserDefaultsä¸­loginDataçš„NSDictionaryï¼Œå¹¶è½¬åŒ–ä¸ºUserå¯¹è±¡è¿”å›ã€‚æ³¨ï¼šUserå¯¹è±¡ä¸ºä¸€ä¸ªmodelã€‚</p>
<h4 id="å­˜å‚¨å†å²æ•°æ®"><a href="#å­˜å‚¨å†å²æ•°æ®" class="headerlink" title="å­˜å‚¨å†å²æ•°æ®"></a>å­˜å‚¨å†å²æ•°æ®</h4><pre><code>+ (NSString *)loginDataListPath {
    NSString *documentPath = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject]; // è¿”å›appå­˜æ”¾æ•°æ®çš„Documentsæ–‡ä»¶å¤¹è·¯å¾„
    NSString *listPath = [documentPath stringByAppendingPathComponent:@&quot;login_list.plist&quot;]; // è¿”å›å­˜æ”¾å†å²æ•°æ®çš„plistæ–‡ä»¶çš„è·¯å¾„ï¼Œä»–åœ¨Documentsæ–‡ä»¶å¤¹é‡Œé¢
    return listPath;
}

+ (NSMutableDictionary *)readLoginDataList {
    NSMutableDictionary *loginDataList = [NSMutableDictionary dictionaryWithContentsOfFile:[self loginDataListPath]]; // è¯»å–plistæ–‡ä»¶å†…å®¹ï¼Œå¹¶å°†å®ƒå­˜æ”¾åœ¨NSMutableDictionaryä¸­è¿”å›
    return loginDataList;
}

+ (BOOL)saveLoginData:(NSDictionary *)loginData {
    BOOL save = NO;
    if (loginData) {
        NSMutableDictionary *loginDataList = [self readLoginDataList]; // è·å–å·²ç»å­˜å‚¨çš„ç”¨æˆ·æ•°æ®
        User *curUser = [NSObject objectOfClass:@&quot;User&quot; fromJSON:loginData]; // è½¬åŒ–ä¸ºUserå¯¹è±¡
        if (curUser.username.length &gt; 0) {
            [loginDataList setObject:loginData forKey:curUser.username]; // æ›´æ–°å†å²æ•°æ®ä¸­è¯¥ç”¨æˆ·çš„æ•°æ®
            save = YES;
        }
        if (save) {
          save = [loginDataList writeToFile:[self loginDataListPath] atomically:YES]; // å°†æ•°æ®å†™å…¥plistæ–‡ä»¶
        }
    }
}
</code></pre><p>ä»¥ä¸Šä»£ç ä¸­åŒ…æ‹¬ä¸‰ä¸ªå‡½æ•°ï¼š</p>
<ol>
<li>loginDataListPath: è¯¥å‡½æ•°è¿”å›plistæ–‡ä»¶çš„è·¯å¾„</li>
<li>readLoginDataList: è¯¥å‡½æ•°è¯»å–plistæ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œä»¥NSDictionaryçš„æ–¹å¼è¿”å›</li>
<li>saveLoginData: æ›´æ–°readLoginDataListä¸­è¿”å›çš„å†å²æ•°æ®ï¼ŒåŠ å…¥å½“å‰ç™»å½•ç”¨æˆ·çš„æ•°æ®ï¼›å¹¶å†æ¬¡å°†å·²ç»æ›´æ–°çš„å†å²ç”¨æˆ·æ•°æ®å†™å…¥plistæ–‡ä»¶</li>
</ol>
<h4 id="p-s"><a href="#p-s" class="headerlink" title="p.s"></a>p.s</h4><p>ä»¥ä¸Šä»£ç å‡å‚ç…§<a href="https://github.com/Coding/Coding-iOS" target="_blank" rel="external">Coding-iOS</a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/" target="_blank" rel="external">NSUserDefaults Reference</a></li>
<li><a href="https://github.com/Coding/Coding-iOS" target="_blank" rel="external">Coding-iOS</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[2016-week4]]></title>
      <url>/2016/03/19/2016-week4/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸Šå‘¨æœ«å»è§è€åŒå­¦äº†ï¼Œweek3å°±ä¸å†™äº†=ã€‚ï¼ éƒ½æ˜¯å€Ÿå£å•Šï¼Œæ¥çœ‹çœ‹è¿™å‘¨ç¢°ä¸Šä¸€äº›ä»€ä¹ˆé—®é¢˜ã€‚</p>
<h2 id="é—®é¢˜åˆ—è¡¨"><a href="#é—®é¢˜åˆ—è¡¨" class="headerlink" title="é—®é¢˜åˆ—è¡¨"></a>é—®é¢˜åˆ—è¡¨</h2><a id="more"></a>
<ol>
<li><code>edgesForExtendedLayout</code></li>
<li>è·å–ç‰ˆæœ¬å·</li>
<li>æ–‡æœ¬è‡ªåŠ¨è°ƒæ•´å¤§å°</li>
<li>AppStore, Settingsé¡µé¢è·³è½¬</li>
</ol>
<h2 id="edgesForExtendedLayout"><a href="#edgesForExtendedLayout" class="headerlink" title="edgesForExtendedLayout"></a><code>edgesForExtendedLayout</code></h2><p>ç»å¸¸ä¼šç¢°åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼šUITabBarControlleråŒ…å«å¤šä¸ªUINavgationControllerï¼Œæ¯ä¸ªUINavgationControlleråˆåŒ…å«ç€è‡ªå·±çš„ViewControllerã€‚è¿™ä¸ªæ—¶å€™ViewControllerçš„frameå æ®äº†æ•´ä¸ªå±å¹•ï¼ˆæ—¢åŒ…æ‹¬äº†NavBarçš„åœ°æ–¹ï¼ŒåˆåŒ…æ‹¬äº†TabBarçš„åœ°æ–¹ï¼‰ï¼Œå¾ˆçƒ¦ï¼›å¦‚ä½•è®©è¿™æ ·çš„ViewControllerçš„Viewåªå æ®NavBarå’ŒTabBarä¹‹é—´çš„åŒºåŸŸå‘¢ï¼Ÿ<br>è¿™æ—¶å°±éœ€è¦<a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIViewController_Class/#//apple_ref/occ/instp/UIViewController/edgesForExtendedLayout" target="_blank" rel="external">edgesForExtendedLayout</a>å±æ€§äº†ã€‚<br><code>edgesForExtendedLayout</code>æ˜¯UIViewControllerçš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒåªåœ¨ViewControlleråµŒåœ¨å…¶ä»–å®¹å™¨å†…æ—¶æ‰èµ·ä½œç”¨ï¼Œæ¯”å¦‚UINavgationControllerã€‚é»˜è®¤çš„å€¼æ˜¯UIRectEdgeAllï¼Œå°†å®ƒè®¾ç½®ä¸ºUIRectEdgeNoneæ—¶å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚å¦‚ä¸‹ğŸ‘‡</p>
<pre><code>        // åœ¨ViewControllerçš„viewDidLoadé‡Œé¢è®¾ç½®
        self.edgesForExtendedLayout = UIRectEdgeNone;
</code></pre><p>æ•ˆæœå¦‚ä¸‹ğŸ‘‡<br><img src="/lionheart/1603/edges.png" alt="edgesForExtendedLayout"></p>
<h2 id="è·å–ç‰ˆæœ¬å·"><a href="#è·å–ç‰ˆæœ¬å·" class="headerlink" title="è·å–ç‰ˆæœ¬å·"></a>è·å–ç‰ˆæœ¬å·</h2><pre><code>        NSString *version = [NSBundle mainBundle] objectForInfoDictionaryKey:@&quot;CFBundleVersion&quot;];
</code></pre><h2 id="æ–‡æœ¬è‡ªåŠ¨è°ƒæ•´å¤§å°"><a href="#æ–‡æœ¬è‡ªåŠ¨è°ƒæ•´å¤§å°" class="headerlink" title="æ–‡æœ¬è‡ªåŠ¨è°ƒæ•´å¤§å°"></a>æ–‡æœ¬è‡ªåŠ¨è°ƒæ•´å¤§å°</h2><p>UILabelä¸€ä¸‹2ä¸ªå±æ€§ï¼Œå¯ä»¥è®©æ–‡æœ¬å­—ä½“å¤§å°è‡ªåŠ¨è°ƒæ•´ä»¥é€‚åº”UILabelçš„frame:</p>
<ol>
<li><code>adjustsFontSizeToFitWidth</code>: è¯¥å±æ€§é»˜è®¤ä¸ºNOã€‚å½“è®¾ç½®å®ƒä¸ºYESæ—¶ï¼Œå½“æ–‡æœ¬çš„é•¿åº¦è¶…è¿‡UILabelæ—¶ï¼Œä¼šè‡ªåŠ¨ç¼©å°æ–‡æœ¬å­—ä½“ï¼Œä»¥é€‚åº”UILabelçš„frameã€‚è¯¥å±æ€§è¦é…åˆminimumScaleFactorä½¿ç”¨ã€‚</li>
<li><code>minimumScaleFactor</code>: è¯¥å±æ€§è¡¨ç¤ºUILabelçš„å­—ä½“æœ€å°çš„ç¼©æ”¾ç¨‹åº¦ã€‚å®ƒçš„é»˜è®¤å€¼ä¸º0ï¼Œä½†å¹¶ä¸æ˜¯è¯´å­—ä½“å¤§å°ä¸º0ï¼Œè€Œæ˜¯ä½¿ç”¨å½“å‰æŒ‡å®šçš„å­—ä½“å¤§å°ã€‚</li>
</ol>
<h2 id="AppStore-Settingsé¡µé¢è·³è½¬"><a href="#AppStore-Settingsé¡µé¢è·³è½¬" class="headerlink" title="AppStore, Settingsé¡µé¢è·³è½¬"></a>AppStore, Settingsé¡µé¢è·³è½¬</h2><ol>
<li>è·³è½¬åˆ°AppStoreç•Œé¢<br>ç»å¸¸éœ€è¦å¯¹appè¿›è¡Œè¯„åˆ†ï¼Œè¿™æ—¶å°±éœ€è¦è·³è½¬åˆ°AppStoreï¼Œè·³è½¬æ–¹æ³•å¦‚ä¸‹ğŸ‘‡<pre><code>     NSString *appStoreUrlStr = @&quot;itms-apps://itunes.apple.com/WebObjects/MZStore.woa/wa/viewContentsUserReviews?type=Purple    +Software&amp;id=923676989&quot;; // è·å–Codingçš„AppStoreçš„url, æ³¨æ„è¿™é‡Œè¦å°†https:æ¢æˆitms-apps: è²Œä¼¼æ˜¯ä¸ºäº†é¿å…é‡å®šå‘
     [UIApplication sharedApplication] openURL:[NSURL urlWithString:appStoreUrlStr]; // è·³è½¬åˆ°AppStore
</code></pre></li>
<li>è·³è½¬åˆ°è®¾ç½®é¡µé¢<pre><code>     [UIApplication sharedApplication] openURL:[NSURL urlWithString:UIApplicationOpenSettingsURLString];
</code></pre></li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://stackoverflow.com/questions/433907/how-to-link-to-apps-on-the-app-store" target="_blank" rel="external">How to link to apps on the app store</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> æ‚ä¸ƒæ‚å…« </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Mac Colorful Terminal]]></title>
      <url>/2016/03/19/mac-colorful-terminal/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šå¤©è£…å®ŒMysqlä¹‹åå‘ç°ä¹‹å‰ç»ˆç«¯çš„é¢œè‰²ä¸è§äº†ï¼Œæœ¬æ¥é‚£é¢œè‰²çœ‹çš„ä¹ŸæŒºæ“è›‹çš„ã€‚Googleä¹‹åå‘ç°äº†<a href="https://github.com/altercation/solarized" target="_blank" rel="external">solarized</a>ã€‚æ¥çœ‹çœ‹æ•ˆæœğŸ‘‡</p>
<p><img src="/lionheart/1603/maccolorfulterminaldemo.png" alt="mac colorful terminal"></p>
<a id="more"></a>
<h2 id="å…·ä½“æ­¥éª¤"><a href="#å…·ä½“æ­¥éª¤" class="headerlink" title="å…·ä½“æ­¥éª¤"></a>å…·ä½“æ­¥éª¤</h2><ol>
<li><code>Terminal</code>è®¾ç½®</li>
<li><code>Vim</code>è®¾ç½®</li>
<li><code>ls</code>è®¾ç½®</li>
</ol>
<h2 id="Terminalè®¾ç½®"><a href="#Terminalè®¾ç½®" class="headerlink" title="Terminalè®¾ç½®"></a>Terminalè®¾ç½®</h2><ol>
<li><p>githubä¸‹è½½solarized</p>
<pre><code>     $ git clone git://github.com/altercation/solarized.git
</code></pre></li>
<li><p>å¯¼å…¥terminalé…ç½®æ–‡ä»¶</p>
<p>æ‰“å¼€<code>Terminal</code>çš„åå¥½è®¾ç½®ï¼Œå¯¼å…¥ä¸‹é¢çš„é…ç½®æ–‡ä»¶</p>
<pre><code>     solarized/osx-terminal.app-colors-solarized/Solarized Dark ansi.terminal
</code></pre></li>
</ol>
<h2 id="Vimè®¾ç½®"><a href="#Vimè®¾ç½®" class="headerlink" title="Vimè®¾ç½®"></a><code>Vim</code>è®¾ç½®</h2><p>Vimä¿æŒå’ŒTerminalç›¸åŒçš„é…è‰²ï¼Œè®¾ç½®å¦‚ä¸‹ğŸ‘‡</p>
<pre><code>        $ cd solarized
        $ cd vim-colors-solarized/colors
        $ mkdir -p ~/.vim/colors
        $ cp solarized.vim ~/.vim/colors/

        $ vim ~/.vimrc
        syntax enable
        set background=dark
        colorscheme solarized
</code></pre><h2 id="lsè®¾ç½®"><a href="#lsè®¾ç½®" class="headerlink" title="lsè®¾ç½®"></a><code>ls</code>è®¾ç½®</h2><ol>
<li>å®‰è£…<code>Coreutils</code><pre><code>     $ brew install coreutils
</code></pre></li>
<li>ç”Ÿæˆé¢œè‰²é…ç½®æ–‡ä»¶<pre><code>     $ gdircolors --print-database &gt; ~/.dir_colors
</code></pre></li>
<li>ç¼–è¾‘é…ç½®æ–‡ä»¶(.bash_profile)<br>åœ¨.bash_profileæ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢å‡ è¡ŒğŸ‘‡<pre><code>     if brew list | grep coreutils &gt; /dev/null ; then
         PATH=&quot;$(brew --prefix coreutils)/libexec/gnubin:$PATH&quot;
         alias ls=&#39;ls -F --show-control-chars --color=auto&#39;
         eval `gdircolors -b $HOME/.dir_colors`
     fi
</code></pre></li>
</ol>
<p><strong>p.s</strong> ç…§åšå°±å¥½äº†=ã€‚=</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://github.com/altercation/solarized" target="_blank" rel="external">altercation/solarized</a></li>
<li><a href="http://www.vpsee.com/2013/09/use-the-solarized-color-theme-on-mac-os-x-terminal/" target="_blank" rel="external">åœ¨ Mac OS X ç»ˆç«¯é‡Œä½¿ç”¨ Solarized é…è‰²æ–¹æ¡ˆ</a></li>
<li><a href="http://chaishiwei.com/blog/247.html" target="_blank" rel="external">å®šåˆ¶ä»¥åŠå½©è‰²åŒ–è‡ªå·±çš„ Mac OS X ç»ˆç«¯</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> æ‚ä¸ƒæ‚å…« </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[ActionSheetPickeræºç åˆ†æ]]></title>
      <url>/2016/03/15/ActionSheetPicker-sourcecode-analyse/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><a href="https://github.com/skywinder/ActionSheetPicker-3.0" target="_blank" rel="external">ActionSheetPicker</a>å¯ä»¥å¿«é€Ÿç”ŸæˆUIPickerView+UIActionSheetçš„æ•ˆæœã€‚æ•ˆæœå¦‚ä¸‹ğŸ‘‡</p>
<p><img src="/lionheart/1603/actionsheetdemo.gif" alt="action sheet demo"></p>
<a id="more"></a>
<h2 id="ActionSheetPickerä»£ç ç»“æ„"><a href="#ActionSheetPickerä»£ç ç»“æ„" class="headerlink" title="ActionSheetPickerä»£ç ç»“æ„"></a>ActionSheetPickerä»£ç ç»“æ„</h2><p>ä»<a href="https://github.com/skywinder/ActionSheetPicker-3.0" target="_blank" rel="external">github</a>ä¸Šå°†é¡¹ç›®æ‹·è´ä¸‹æ¥åï¼Œå¯ä»¥çœ‹åˆ°ActionSheetPickerçš„æ–‡ä»¶ç›®å½•å¦‚ä¸‹ğŸ‘‡</p>
<p><img src="/lionheart/1603/actionsheetdocument.png" alt="Action Sheet Picker Document"></p>
<p>ActionSheetPickerå¯ä»¥å®ç°4ç§ç±»å‹çš„picker:</p>
<ol>
<li>ActionSheetStringPicker</li>
<li>ActionSheetDistancePicker</li>
<li>ActionSheetDatePicker</li>
<li>ActionSheetCustomPicker</li>
</ol>
<p>è¿™4ç§pickeréƒ½æ˜¯ç»§æ‰¿è‡ªAbstractActionSheetPickerã€‚ä¸‹é¢ä»¥ActionSheetStringPickerä¸ºä¾‹ï¼Œæ¥åˆ†æActionSheetPickerçš„æºç ã€‚</p>
<h2 id="ActionSheetStringPickerä½¿ç”¨ç¤ºä¾‹"><a href="#ActionSheetStringPickerä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ActionSheetStringPickerä½¿ç”¨ç¤ºä¾‹"></a>ActionSheetStringPickerä½¿ç”¨ç¤ºä¾‹</h2><p>ActionSheetStringPickerçš„ä½¿ç”¨å¾ˆç®€å•ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ğŸ‘‡</p>
<pre><code>                [ActionSheetStringPicker showPickerWithTitle:nil rows:@[@&quot;ç”·&quot;, @&quot;å¥³&quot;, @&quot;æœªçŸ¥&quot;] initialSelection:1 doneBlock:^(ActionSheetStringPicker *picker, NSInteger selectedIndex, id selectedValue) {

                } cancelBlock:nil origin:self.view];
</code></pre><p>æ•ˆæœå¦‚ä¸‹ğŸ‘‡</p>
<p><img src="/lionheart/1603/stringpickerdemo.png" alt="stringPicker demo"></p>
<h2 id="ActionSheetStringPickerå®ç°è¿‡ç¨‹"><a href="#ActionSheetStringPickerå®ç°è¿‡ç¨‹" class="headerlink" title="ActionSheetStringPickerå®ç°è¿‡ç¨‹"></a>ActionSheetStringPickerå®ç°è¿‡ç¨‹</h2><ol>
<li>æ–°å»ºä¸€ä¸ªCGSizeä¸º(Screen_Width, 260)çš„UIViewï¼Œè¿™ä¸ªviewä¹Ÿæ˜¯pickeræœ€å¤–å±‚çš„viewï¼Œæˆ‘ä»¬ç§°å®ƒä¸º<code>masterView</code>ã€‚</li>
<li>åœ¨masterViewçš„æœ€ä¸Šæ–¹çš„44pointsåŒºåŸŸå†…åˆ›å»ºä¸€ä¸ªUIToolBarï¼Œæˆ‘ä»¬ç§°å®ƒä¸º<code>toolBar</code>ã€‚åœ¨è¿™ä¸ªtoolBaré‡Œé¢æ·»åŠ <code>cancelButton</code>å’Œ<code>doneButton</code>ï¼Œä»¥åŠè¿™ä¸ªpickerçš„<code>title</code>ã€‚ï¼ˆè¿™é‡Œçš„titleä¸ºç©ºï¼‰</li>
<li>æ‰§è¡Œ<code>configuredPickerView</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¿…é¡»åœ¨<code>ActionSheetStringPicker.m</code>ä¸­é‡å†™ã€‚è¿™ä¸ªæ–¹æ³•é‡Œé¢åˆ›å»ºäº†ä¸€ä¸ªUIPickerViewï¼Œæˆ‘ä»¬ç§°å®ƒä¸º<code>pickerView</code>ã€‚è¿™ä¸ªpickerViewå æ®äº†masterViewä¸‹é¢çš„216pointsçš„ç©ºé—´ã€‚ï¼ˆ<strong>æ³¨</strong> : UIPickerViewDeledate å’Œ UIPickerViewDataSource ä¹Ÿåœ¨ ActionSheetStringPicker.m é‡Œé¢å®ç°ã€‚</li>
<li>å®ç°ActionSheetçš„æ•ˆæœï¼šåœ¨ï¼ˆSWActionSheetç±»ä¸­å®ç°ï¼‰ã€‚è¯¥ç±»åˆ›å»ºä¸€ä¸ªUIWindowï¼Œå¹¶å°†ä¸Šé¢åˆ›å»ºçš„masterViewæ·»åŠ åˆ°è¯¥UIWindowçš„rootControllerçš„viewçš„subviewä¸­ï¼Œå¹¶æ˜¾ç¤ºè¯¥UIWindowã€‚</li>
</ol>
<h2 id="ActionSheetStringPickerç»“æ„ç¤ºæ„å›¾"><a href="#ActionSheetStringPickerç»“æ„ç¤ºæ„å›¾" class="headerlink" title="ActionSheetStringPickerç»“æ„ç¤ºæ„å›¾"></a>ActionSheetStringPickerç»“æ„ç¤ºæ„å›¾</h2><p><img src="/lionheart/1603/ActionSheetPicker.png" alt="ActionSheetPicker"></p>
<p>æ ¹æ®ç»“æ„ç¤ºæ„å›¾å¯ä»¥çŸ¥é“ï¼š</p>
<ol>
<li>ActionSheetStringPickeræ–°å»ºäº†ä¸€ä¸ª<code>UIWindow</code>,å¹¶ä¸”è¿™ä¸ªUIWindowé®æŒ¡ä½äº†é»˜è®¤çš„UIWindow(é»˜è®¤æ˜¯åœ¨AppDelegate.mä¸­å£°æ˜)</li>
<li>UIWindowçš„rootControlleræ˜¯ä¸€ä¸ª<code>SWActionSheetVC</code>å®ä¾‹,è¿™ä¸ªSWActionSheetVCæ·»åŠ äº†ä¸€ä¸ª<code>SWActionSheet</code>è§†å›¾</li>
<li>SWActionSheetçš„subviewæ˜¯<code>masterView</code></li>
<li>masterViewåˆ†æˆ2ä¸ªéƒ¨åˆ†:ä¸€ä¸ªæ˜¯ä¸Šéƒ¨çš„<code>UIToolBar</code>,å¦ä¸€ä¸ªæ˜¯ä¸‹éƒ¨çš„<code>UIPickerView</code></li>
</ol>
<h2 id="ActionSheetStringPickerçš„é‡è¦å‡ ä¸ªæ–‡ä»¶-ç±»"><a href="#ActionSheetStringPickerçš„é‡è¦å‡ ä¸ªæ–‡ä»¶-ç±»" class="headerlink" title="ActionSheetStringPickerçš„é‡è¦å‡ ä¸ªæ–‡ä»¶(ç±»)"></a>ActionSheetStringPickerçš„é‡è¦å‡ ä¸ªæ–‡ä»¶(ç±»)</h2><ol>
<li><p>SWActionSheet.m</p>
<p>è¯¥æ–‡ä»¶å®ç°äº†2ä¸ªç±»,<code>SWActionSheet</code>å’Œ<code>SWActionSheetVC</code>ã€‚è¿™ä¸¤ä¸ªç±»æ¨¡ä»¿äº†UIActionSheetçš„å®ç°ã€‚ä»–ä»¬åˆ›å»ºäº†æ–°çš„UIWindow,å¹¶å°†åœ¨AbstractActionSheetPicker.mä¸­åˆ›å»ºçš„masterViewæ·»åŠ åˆ°è§†å›¾ä¸­ã€‚</p>
</li>
<li><p>AbstractActionSheetPicker.m</p>
<p>è¯¥æ–‡ä»¶å®ç°äº†<code>AbstractActionSheetPicker</code>ç±»,è¿™ä¸ªç±»æ˜¯åˆ›å»º4ç§ä¸åŒç±»å‹çš„Pickerçš„åŸºç±»ã€‚åœ¨è¯¥ç±»ä¸­åˆ›å»ºäº†ä¸€ä¸ª<code>masterView</code>,å¹¶åˆ›å»ºäº†masterViewä¸Šéƒ¨çš„<code>UIToolBar</code>ã€‚</p>
</li>
<li><p>ActionSheetStringPicker.m</p>
<p>è¯¥æ–‡ä»¶å®ç°äº†<code>ActionSheetStringPicker</code>ç±»ï¼4ç§è¿™ä¸ªåº“æä¾›çš„pickerä¹‹ä¸€ã€‚è¿™ä¸ªç±»æœ€ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯å®ç°äº†<code>UIPickerView</code>,ä»¥åŠUIPickerViewçš„ä¸€äº›æ‰€éœ€çš„delegateã€‚è¿™é‡Œåˆ›å»ºçš„<code>UIPickerView</code>ä¼šè¢«æ·»åŠ åˆ°<code>masterView</code>çš„subviewä¸­ã€‚è¿˜æœ‰å°±æ˜¯ç”¨æˆ·å®šä¹‰çš„doneBlockä»¥åŠcancelBlockéƒ½ä¼šå­˜å‚¨åœ¨è¿™ä¸ªç±»ä¸­ã€‚</p>
</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://github.com/skywinder/ActionSheetPicker-3.0" target="_blank" rel="external">skywinder/ActionSheetPicker-3.0</a></li>
</ul>
<h2 id="P-S"><a href="#P-S" class="headerlink" title="P.S"></a>P.S</h2><p>è¿™ä¸ªåº“æ˜¯ä¸èƒ½ç›´æ¥ç®€å•çš„å®ç°ä¸‹é¢çš„æ•ˆæœçš„ğŸ‘‡</p>
<p><img src="/lionheart/1603/custompickerdemo.gif" alt="custom picker demo"></p>
<p>æ‰€ä»¥å‘¢ï¼Ÿ<br>æˆ‘å†™äº†ä¸€ä¸ª<code>ActionSheetStringDictPicker</code>ç±»,ç”¨æ³•å¦‚ä¸‹ğŸ‘‡</p>
<pre><code>                [ActionSheetStringDictPicker showPickerWithTitle:nil firstRow:firstArray secondDict:secondDict initialIndexs:@[@1, @1] doneBlock:^(ActionSheetStringDictPicker *picker, NSArray *selectedIndexs, id selectedValues) {
                        // do something here
                } cancelBlock:nil origin:self.view];
</code></pre><p>å‚æ•°è®¾ç½®:</p>
<ol>
<li><code>firstRow</code>: pickerä¸­ç¬¬ä¸€åˆ—çš„å†…å®¹,æ˜¯ä¸€ä¸ª<code>NSArray</code></li>
<li><code>secondDict</code>: pickerä¸­ç¬¬äºŒåˆ—çš„å†…å®¹,æ˜¯ä¸€ä¸ª<code>NSDictionary</code>ã€‚è¿™ä¸ªNSDictionaryçš„é”®æ˜¯ç¬¬ä¸€åˆ—firstRowçš„å€¼;æ¯ä¸ªé”®å¯¹åº”çš„å€¼æ˜¯ä¸€ä¸ªNSArray,è¿™ä¸ªæ•°ç»„æ˜¯ç¬¬äºŒåˆ—çš„å†…å®¹ã€‚å½“ç¬¬ä¸€åˆ—çš„å€¼å˜åŒ–æ—¶ï¼Œç¬¬äºŒåˆ—çš„å†…å®¹ä¼šå®æ—¶å˜åŒ–ã€‚</li>
</ol>
<p>ActionSheetStringDictPickerçš„ä»£ç <a href="https://github.com/vanney9/blogDemo/tree/master/actionsheetstringdictpicker" target="_blank" rel="external">ğŸ‘‰åœ¨è¿™é‡ŒğŸ‘ˆ</a></p>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[2016 Week 2]]></title>
      <url>/2016/03/05/2016-week2/</url>
      <content type="html"><![CDATA[<h2 id="å¼€ç¯‡"><a href="#å¼€ç¯‡" class="headerlink" title="å¼€ç¯‡"></a>å¼€ç¯‡</h2><p>ç¬¬äºŒæ˜ŸæœŸå¼€å§‹ï¼Œå…ˆå’Œæµ©å“¥å»çœ‹äº†ç¾äººé±¼ï¼Œå°±å¼€å§‹æ¯å¤©ç»§ç»­Coding-iOSçš„å­¦ä¹ äº†ã€‚ä¸ªäººæ„Ÿè§‰è¿™ä¸ª<a href="https://github.com/Coding/Coding-iOS" target="_blank" rel="external">Coding-iOS</a>é¡¹ç›®ä»£ç å†™çš„çœŸå¥½ï¼Œå¼€æºä¹‹åç®€ç›´å°±æ˜¯iOSèœé¸¡å¼€å‘è€…çš„ç¦éŸ³ã€‚è‡ªå·±å†™èµ·æ¥ä¹‹åï¼Œæ‰å‘ç°codingé€Ÿåº¦çœŸçš„æ˜¯æ…¢ï¼ã€‚ï¼</p>
<h2 id="é—®é¢˜åˆ—è¡¨"><a href="#é—®é¢˜åˆ—è¡¨" class="headerlink" title="é—®é¢˜åˆ—è¡¨"></a>é—®é¢˜åˆ—è¡¨</h2><a id="more"></a>
<ol>
<li><code>UITextField</code>æœ‰å…³</li>
<li>è‡ªå®šä¹‰<code>UITableViewCell</code>æµç¨‹</li>
<li><code>NSUserDefaults</code>åŸºç¡€</li>
<li><code>dispatch_once</code> å’Œ <code>static</code> å˜é‡</li>
<li>åˆ›å»º<code>category</code></li>
<li><code>SHA1</code>åŠ å¯†</li>
<li>2ç§<code>enum</code>ç±»å‹</li>
<li>Codingè°ƒç”¨APIæµç¨‹</li>
<li><code>MBProgressHUD</code>åŸºç¡€</li>
<li><code>keyWindow</code></li>
<li>æ–‡ä»¶æ“ä½œæœ‰å…³</li>
<li>è´¦æˆ·è¾“å…¥æç¤ºæ¡†</li>
<li><code>enumerateObjectsUsingBlock:</code></li>
<li>2ç§<code>UITableViewCell</code>é‡ç”¨æ–¹å¼</li>
<li><code>NSRange</code>åŸºç¡€</li>
<li><code>CAShapeLayer</code>åŸºç¡€</li>
<li>æ˜¾ç¤º/éšè—å¯¼èˆªæ </li>
<li>ViewControllerä¹‹é—´åˆ‡æ¢å¡é¡¿</li>
<li><code>SDWebImageOptions</code></li>
<li>åœ¨<code>category</code>ä¸­æ–°å¢<code>property</code></li>
<li>ç”¨æˆ·åå­˜å‚¨æ•´ä¸ªæµç¨‹</li>
<li><code>UIAlertController</code>åŸºç¡€</li>
</ol>
<h2 id="UITextFieldæœ‰å…³"><a href="#UITextFieldæœ‰å…³" class="headerlink" title="UITextFieldæœ‰å…³"></a><code>UITextField</code>æœ‰å…³</h2><p>ä»‹ç»å‡ ä¸ªUITextFieldçš„å±æ€§å’Œæ–¹æ³•</p>
<ol>
<li><code>secureTextEntry</code>: è¾“å…¥çš„æ–‡æœ¬ä¸å¯è§ï¼Œå¤šç”¨äºå¯†ç è¾“å…¥</li>
<li><code>clearButtonMode</code>: æ¸…ç©ºæ–‡æœ¬è¾“å…¥çš„æŒ‰é’®çš„æ¨¡å¼æ§åˆ¶ï¼Œå±äº<code>UITextFieldViewMode</code>ã€‚ç»å¸¸ç”¨åˆ°çš„æœ‰:<code>UITextFieldViewModeNever</code>, <code>UITextFieldViewModeWhileEditing</code></li>
<li>è§¦å‘äº‹ä»¶: å¸¸ç”¨çš„æœ‰ å¼€å§‹ç¼–è¾‘(<code>UIControlEventEditingDidBegin</code>), æ–‡æœ¬å˜æ›´(<code>UIControlEventEditingChanged</code>), ç»“æŸç¼–è¾‘(<code>UIControlEventEditingDidEnd</code>)</li>
<li><code>keyboardType</code>: é”®ç›˜ç±»å‹ï¼Œå¯é€‰çš„æœ‰ <code>UIKeyboardTypeEmailAddress</code>,<br><code>UIKeyboardTypeDefault</code>ç­‰</li>
</ol>
<h2 id="è‡ªå®šä¹‰UITableViewCellæµç¨‹"><a href="#è‡ªå®šä¹‰UITableViewCellæµç¨‹" class="headerlink" title="è‡ªå®šä¹‰UITableViewCellæµç¨‹"></a>è‡ªå®šä¹‰<code>UITableViewCell</code>æµç¨‹</h2><p>å‚è€ƒè¿™é‡Œ</p>
<h2 id="NSUserDefaultsåŸºç¡€"><a href="#NSUserDefaultsåŸºç¡€" class="headerlink" title="NSUserDefaultsåŸºç¡€"></a><code>NSUserDefaults</code>åŸºç¡€</h2><p>NSUserDefaultsé€‚åˆå­˜å‚¨è½»é‡çº§çš„æœ¬åœ°æ•°æ®ï¼Œéå¸¸é€‚åˆç”¨æ¥å­˜å‚¨ç™»å½•ç•Œé¢çš„æ•°æ®ï¼ˆç”¨æˆ·åï¼Œå¯†ç ç­‰ç­‰ï¼‰ã€‚ç”¨æ³•ä¹Ÿå¾ˆç®€å•ğŸ‘‡</p>
<ol>
<li>å­˜å‚¨æ•°æ®<pre><code>     NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];        // è·å– defaults
     [defaults setObject:loginData forKey:@&quot;loginData&quot;];                      // å­˜æ”¾ç™»å½•æ•°æ®
     [defaults synchronize];                                                  // åŒæ­¥åˆ°ç£ç›˜ï¼Œé¿å…æ•°æ®ä¸¢å¤±
</code></pre></li>
<li>è¯»å–æ•°æ®<pre><code>     NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];        // è·å– defaults
     NSDictionary *loginData = [defaults objectForKey:@&quot;loginData&quot;];          // è·å–ç™»å½•æ•°æ®
</code></pre></li>
</ol>
<h2 id="dispatch-once-å’Œ-static-å˜é‡"><a href="#dispatch-once-å’Œ-static-å˜é‡" class="headerlink" title="dispatch_once å’Œ static å˜é‡"></a><code>dispatch_once</code> å’Œ <code>static</code> å˜é‡</h2><p><code>dispatch_once</code>å‡½æ•°åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œç»å¸¸ç”¨æ¥åˆ›å»ºå•ä¾‹å®ä¾‹ï¼Œå…ˆæ¥çœ‹çœ‹<code>dispatch_once</code>å‡½æ•°</p>
<pre><code>        void dispatch_once(dispatch_once_t *predicate, dispatch_block_t block);
</code></pre><p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡çš„ä»£ç å—ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”¨æ¥åˆ¤æ–­ä»£ç å—æ˜¯å¦è¢«æ‰§è¡Œã€‚è¯¥å‡½æ•°ä¸<code>static</code>å˜é‡ä¸€åŒä½¿ç”¨ï¼Œçœ‹çœ‹å…·ä½“ä»£ç ğŸ‘‡</p>
<pre><code>        + (instancetype)sharedManager {
            static Coding_NetAPIManager *manager = nil;
            static dispatch_once_t pred;
            dispatch_once(&amp;pred, ^{
                manager = [[Coding_NetAPIManager alloc] init];
            });

            return manager;
        }
</code></pre><p>ä¸Šé¢çš„<code>static</code>å˜é‡å±äºç±»æˆå‘˜ï¼Œå¦‚æœæ²¡æœ‰åœ¨.hæ–‡ä»¶ä¸­å£°æ˜è¯¥staticå˜é‡ï¼Œé‚£ä¹ˆä»–å°±æ˜¯ç§æœ‰çš„ç±»æˆå‘˜ã€‚ç±»æˆå‘˜ä¸èƒ½é€šè¿‡å®ä¾‹å¯¹è±¡æˆ–æ˜¯å®ä¾‹æ–¹æ³•(-)å»è®¿é—®ï¼Œåªèƒ½é€šè¿‡ç±»å®ä¾‹æˆ–æ˜¯ç±»æ–¹æ³•(+)è®¿é—®ã€‚</p>
<h2 id="åˆ›å»ºcategoryæ–‡ä»¶"><a href="#åˆ›å»ºcategoryæ–‡ä»¶" class="headerlink" title="åˆ›å»ºcategoryæ–‡ä»¶"></a>åˆ›å»ºcategoryæ–‡ä»¶</h2><p>è¿™ä¸ªå¾ˆç®€å•å•¦ï¼Œxcode -&gt; New File -&gt; Objective-C File -&gt; å¡«å†™æ‰€éœ€ä¿¡æ¯ -&gt; Finish<br>ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ª<code>UIButton+Common</code>çš„category,åº”è¯¥ğŸ‘‡<br><img src="/lionheart/1603/category.png" alt="category"></p>
<h2 id="SHA1åŠ å¯†"><a href="#SHA1åŠ å¯†" class="headerlink" title="SHA1åŠ å¯†"></a><code>SHA1</code>åŠ å¯†</h2><p>åŠ å¯†æ–¹æ³•å¦‚ä¸‹ğŸ‘‡</p>
<pre><code>        - (NSString *)sha1Str {
            const char *cstr = [self cStringUsingEncoding:NSUTF8StringEncoding];
            NSData *data = [NSData dataWithBytes:cstr length:self.length];

            uint8_t digest[CC_SHA1_DIGEST_LENGTH];

            CC_SHA1(data.bytes, (CC_LONG)data.length, digest);

            NSMutableString *output = [NSMutableString stringWithCapacity:CC_SHA1_DIGEST_LENGTH * 2];

            for (int i = 0; i &lt; CC_SHA1_DIGEST_LENGTH; i++) {
                [output appendFormat:@&quot;%02x&quot;, digest[i]];
            }

            return output;
        }
</code></pre><p><strong>æ³¨æ„</strong> è¯¥æ–¹æ³•å†™åœ¨äº†NSStringçš„categoryé‡Œé¢</p>
<h2 id="2ç§enumç±»å‹"><a href="#2ç§enumç±»å‹" class="headerlink" title="2ç§enumç±»å‹"></a>2ç§<code>enum</code>ç±»å‹</h2><p>æŒ‡å®šenumæœ‰ä¸¤ç§æ–¹å¼:<br>1.</p>
<pre><code>        typedef enum {
            Get = 0,
            Post,
            Put,
            Delete
        } NetworkMethod;
</code></pre><p>2.</p>
<pre><code>        typedef NS_ENUM(NSInteger, IllegalContentType) {
            IllegalContentTypeTweet = 0,
            IllegalContentTypeTopic,
            IllegalContentTypeProject,
            IllegalContentTypeWebsite
        };
</code></pre><h2 id="Codingè°ƒç”¨APIæµç¨‹"><a href="#Codingè°ƒç”¨APIæµç¨‹" class="headerlink" title="Codingè°ƒç”¨APIæµç¨‹"></a>Codingè°ƒç”¨APIæµç¨‹</h2><p>å‚è€ƒè¿™é‡Œ</p>
<h2 id="MBProgressHUDåŸºç¡€"><a href="#MBProgressHUDåŸºç¡€" class="headerlink" title="MBProgressHUDåŸºç¡€"></a><code>MBProgressHUD</code>åŸºç¡€</h2><p><a href="https://github.com/jdg/MBProgressHUD" target="_blank" rel="external"><code>MBProgressHUD</code></a>æ˜¯ä¸€ä¸ªç”¨æ¥æ˜¾ç¤ºæç¤ºä¿¡æ¯çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ•ˆæœå›¾å¦‚ä¸‹ğŸ‘‡<br><img src="/lionheart/1603/mbprogresshud.gif" alt="MBProgressHUD demo"></p>
<p>äº‹ä¾‹ä»£ç ï¼š</p>
<pre><code>        - (void)viewDidLoad {
            [super viewDidLoad];
            // Do any additional setup after loading the view, typically from a nib.
            MBProgressHUD  *hud = [MBProgressHUD showHUDAddedTo:self.view animated:YES];
            hud.mode = MBProgressHUDModeText;
            hud.detailsLabelFont = [UIFont boldSystemFontOfSize:15];
            hud.detailsLabelText = @&quot;tip from vanney9.com&quot;;
            hud.margin = 10;
            hud.removeFromSuperViewOnHide = YES;
            [hud hide:YES afterDelay:2.0f];
        }
</code></pre><h2 id="keyWindow"><a href="#keyWindow" class="headerlink" title="keyWindow"></a><code>keyWindow</code></h2><pre><code>        [UIApplication sharedApplication].keyWindow
</code></pre><p>APPä¸»ç•Œé¢</p>
<h2 id="æ–‡ä»¶æ“ä½œæœ‰å…³"><a href="#æ–‡ä»¶æ“ä½œæœ‰å…³" class="headerlink" title="æ–‡ä»¶æ“ä½œæœ‰å…³"></a>æ–‡ä»¶æ“ä½œæœ‰å…³</h2><p>3ä¸ªä¸æ–‡ä»¶æ“ä½œç›¸å…³çš„æ–¹æ³•</p>
<ol>
<li>[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];<br>è¯¥æ–¹æ³•è¿”å›è¯¥APPçš„Documentsç›®å½•ï¼Œåœ¨çœŸæœºä¸Šæ˜¾ç¤ºçš„ç»“æœå¦‚ä¸‹:<pre><code>     /var/mobile/Containers/Data/Application/7DB19AAA-B9E7-40D8-AAFA-C5BA2FA91CF0/Documents
</code></pre>åœ¨æ¨¡æ‹Ÿæœºä¸Šæ˜¾ç¤ºçš„ç»“æœå¦‚ä¸‹:<pre><code>     /Users/vanney/Library/Developer/CoreSimulator/Devices/FF2B6585-B815-4762-AC40-268D51742C85/data/Containers/Data/Application/82FEAB7E-9245-4BA8-88ED-A559034BA5F0/Documents
</code></pre></li>
<li>[NSMutableDictionary dictionaryWithContentsOfFile:@â€file nameâ€];<br>è¯¥æ–¹æ³•è¯»å–<code>@&quot;file name&quot;</code>è¿™ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹ï¼ˆæ³¨æ„ï¼šè¯¥æ–‡ä»¶åº”è¯¥å­˜æ”¾é”®å€¼å¯¹ï¼Œä¸€èˆ¬XMLæ–‡ä»¶ï¼‰ï¼Œå¹¶è¿”å›ç”±è¯¥é”®å€¼å¯¹ç»„æˆçš„NSMutableDictionary</li>
<li>[loginDataList writeToFile:@â€file nameâ€ atomically:YES];<br>è¯¥æ–¹æ³•ä¸­çš„loginDataListæ˜¯ä¸€ä¸ªNSMutableDictionary,è¿™ä¸ªæ–¹æ³•å°†é”®å€¼å¯¹å†™å…¥<code>@&quot;file name&quot;</code>è¿™ä¸ªæ–‡ä»¶ä¸­</li>
</ol>
<h2 id="è´¦æˆ·è¾“å…¥æç¤ºæ¡†"><a href="#è´¦æˆ·è¾“å…¥æç¤ºæ¡†" class="headerlink" title="è´¦æˆ·è¾“å…¥æç¤ºæ¡†"></a>è´¦æˆ·è¾“å…¥æç¤ºæ¡†</h2><p>æ•ˆæœå¦‚ä¸‹å›¾ğŸ‘‡<br><img src="/lionheart/1603/easeinput.png" alt="easeinput demo"><br>å®ç°è¯¥æ•ˆæœçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºæç¤ºçš„UITableView<br>æ˜¾ç¤ºæç¤ºçš„ç™½è‰²æ¡†æ¡†å®é™…ä¸Šæ˜¯ä¸€ä¸ªUITableViewï¼ŒUITableViewçš„å†…å®¹æ ¹æ®å½“å‰å·²ç»è¾“å…¥çš„å†…å®¹è¿›è¡Œæ”¹å˜ï¼Œè‹¥æ²¡æœ‰è¾“å…¥åˆ°@ç¬¦å·ï¼Œå°±ä»ä¹‹å‰è¾“å…¥è¿‡çš„è´¦æˆ·ä¸­æœç´¢ï¼›è‹¥å·²ç»è¾“å…¥äº†@ç¬¦å·ï¼Œå°±æ˜¾ç¤ºä¸åŒçš„é‚®ç®±åç¼€ã€‚</li>
<li>å°†ä¸Šä¸€æ­¥åˆ›å»ºçš„UITableViewæ·»åŠ åˆ°è¾“å…¥è´¦å·ï¼Œå¯†ç çš„UITableViewä¸­ï¼Œå¹¶å°†æç¤ºæ¡†UITableViewçš„ä½ç½®å®šåœ¨è´¦å·çš„cellä¸‹é¢ã€‚</li>
<li>è‡³äºä¸¤ä¸ªUITableViewçš„äº¤äº’ï¼šå½“è´¦å·çš„cellä¸­çš„UITextFieldå†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè°ƒç”¨æç¤ºæ¡†UITableViewçš„ä¸€ä¸ªblockï¼Œä¼ å…¥å½“å‰UITextFieldçš„æ–‡æœ¬ï¼Œå¯¹æç¤ºçš„å†…å®¹è¿›è¡Œå®æ—¶çš„å˜æ¢ã€‚</li>
</ol>
<h2 id="enumerateObjectsUsingBlock"><a href="#enumerateObjectsUsingBlock" class="headerlink" title="enumerateObjectsUsingBlock:"></a><code>enumerateObjectsUsingBlock:</code></h2><p><code>enumerateObjectsUsingBlock:</code>æ–¹æ³•å’Œ<code>for-in</code>ç±»ä¼¼ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ğŸ‘‡</p>
<pre><code>        NSDictionary *dict = @{@&quot;a&quot;: @&quot;1&quot;, @&quot;b&quot;: @&quot;2&quot;};
        [dict enumerateKeysAndObjectsUsingBlock:^(id key, id obj, BOOL *stop) {
            NSLog(@&quot;key: %@, value: %@&quot;, key, obj);
        }];
</code></pre><p>æ¨èä½¿ç”¨<code>for-in</code>æ–¹æ³•ï¼Œå¿«ã€‚</p>
<h2 id="2ç§UITableViewCellé‡ç”¨æ–¹å¼"><a href="#2ç§UITableViewCellé‡ç”¨æ–¹å¼" class="headerlink" title="2ç§UITableViewCellé‡ç”¨æ–¹å¼"></a>2ç§<code>UITableViewCell</code>é‡ç”¨æ–¹å¼</h2><p><code>UITableViewCell</code>æœ‰ä¸¤ç§dequeueReuseæ–¹æ³•ï¼š</p>
<ol>
<li><code>- (id)dequeueReusableCellWithIdentifier:(NSString *)identifier;</code><br>è¯¥æ–¹æ³•æ˜¯ä¸ç”¨äº‹å…ˆæ³¨å†ŒCellï¼Œä½†æ˜¯å®ƒå¯èƒ½è¿”å›nilï¼›æ‰€ä»¥å½“è¿”å›nilæ—¶ï¼Œéœ€è¦é‡æ–°initã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ğŸ‘‡<pre><code>     static NSString *CellIdentifier = @&quot;Cell&quot;;
     UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier];
     if (cell == nil) {
         cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier];
     }
</code></pre></li>
<li><code>- (id)dequeueReusableCellWithIdentifier:(NSString *)identifier forIndexPath:(NSIndexPath *)indexPath;</code><br>è¯¥æ–¹æ³•åœ¨iOS6ä¸­å–ä»£äº†ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå®ƒå¯ä»¥ä¿è¯ä¸€å®šä¼šè¿”å›UITableViewCellï¼Œä½†æ˜¯åœ¨åˆå§‹åŒ–UITableViewæ—¶ï¼Œéœ€è¦è¿›è¡ŒUITableViewCellçš„æ³¨å†Œï¼Œå¦‚ä¸‹ğŸ‘‡<pre><code>     [_tableView registerClass:[CustomCell class] forCellReuseIdentifier:@&quot;Cell&quot;];
</code></pre>äºæ˜¯åœ¨é‡ç”¨UITableViewCellï¼Œä¸éœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºnilï¼Œä»£ç å¦‚ä¸‹ğŸ‘‡<pre><code>     CustomCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;Cell&quot; forIndexPath:indexPath];
</code></pre></li>
</ol>
<h2 id="NSRangeåŸºç¡€"><a href="#NSRangeåŸºç¡€" class="headerlink" title="NSRangeåŸºç¡€"></a><code>NSRange</code>åŸºç¡€</h2><p>NSRangeæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ğŸ‘‡</p>
<pre><code>        typedef struct _NSRange {
            NSUInteger location;
            NSUInteger length;
        } NSRange;
</code></pre><p>å…¶ä¸­<code>location</code>è¡¨ç¤ºèµ·å§‹ä½ç½®ï¼Œ<code>length</code>è¡¨ç¤ºé•¿åº¦ã€‚</p>
<h2 id="CAShapeLayeråŸºç¡€"><a href="#CAShapeLayeråŸºç¡€" class="headerlink" title="CAShapeLayeråŸºç¡€"></a><code>CAShapeLayer</code>åŸºç¡€</h2><p><code>CAShapeLayer</code>ç»§æ‰¿è‡ª<code>CALayer</code>ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå½¢çŠ¶ï¼Œæœ‰ä¸€ä¸ª<code>path</code>å±æ€§ç”¨æ¥æè¿°è¯¥å½¢çŠ¶ï¼Œç„¶åå¯ä»¥å¯¹è¿™ä¸ªå½¢çŠ¶è¿›è¡Œæè¾¹ï¼Œå¡«å……ç­‰æ“ä½œã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ğŸ‘‡</p>
<pre><code>        CAShapeLayer *layer = [CAShapeLayer layer];
        // åˆ›å»ºpath, ç»™layeræ·»åŠ path, é‡Šæ”¾path
        CGMutablePathRef pathRef = CGPathCreateMutable();
        CGRect bounds = CGRectInset(cell.bounds, 0, 0);
        CGPathAddRect(pathRef, nil, bounds);
        layer.path = pathRef;
        CFRelease(pathRef);
        // å¯¹layerè¿›è¡Œå¡«å……æ“ä½œ
        layer.fillColor = [UIColor colorWithWhite:1.0 alpha:0.8].CGColor;
        // æ·»åŠ layer
        UIView *bgView = [[UIView alloc] initWithFrame:bounds];
        [bgView.layer addSublayer:layer];
</code></pre><h2 id="æ˜¾ç¤º-éšè—å¯¼èˆªæ "><a href="#æ˜¾ç¤º-éšè—å¯¼èˆªæ " class="headerlink" title="æ˜¾ç¤º/éšè—å¯¼èˆªæ "></a>æ˜¾ç¤º/éšè—å¯¼èˆªæ </h2><p>ä½¿ç”¨ä¸‹åˆ—æ–¹æ³•å®ç°å¯¼èˆªæ çš„æ˜¾ç¤ºæˆ–è€…éšè—</p>
<pre><code>        - (void)viewWillAppear:(BOOL)animated {
            [super viewWillAppear:animated];
            // éšè—å¯¼èˆªæ ï¼Œè‹¥Hiddenè®¾ä¸ºNOï¼Œåˆ™æ˜¾ç¤ºå¯¼èˆªæ 
            [self.navigationController setNavigationBarHidden:YES animated:YES];
        }
</code></pre><h2 id="ViewControllerä¹‹é—´åˆ‡æ¢å¡é¡¿"><a href="#ViewControllerä¹‹é—´åˆ‡æ¢å¡é¡¿" class="headerlink" title="ViewControllerä¹‹é—´åˆ‡æ¢å¡é¡¿"></a>ViewControllerä¹‹é—´åˆ‡æ¢å¡é¡¿</h2><p>å¯èƒ½çš„åŸå› ï¼šæ²¡æœ‰è®¾ç½®ViewControllerçš„backgroundColorï¼ã€‚ï¼</p>
<h2 id="SDWebImageOptions"><a href="#SDWebImageOptions" class="headerlink" title="SDWebImageOptions"></a><code>SDWebImageOptions</code></h2><pre><code>        typedef NS_OPTIONS(NSUInteger, SDWebImageOptions) {
            SDWebImageRetryFailed = 1 &lt;&lt; 0,//ä¸‹è½½å¤±è´¥äº†ä¼šå†æ¬¡å°è¯•ä¸‹è½½
            WebImageLowPriority = 1 &lt;&lt; 1,//å½“UIScrollViewç­‰æ­£åœ¨æ»šåŠ¨æ—¶ï¼Œå»¶è¿Ÿä¸‹è½½å›¾ç‰‡ï¼ˆæ”¾ç½®scrollViewæ»šåŠ¨å¡ï¼‰
            SDWebImageCacheMemoryOnly = 1 &lt;&lt; 2,//åªç¼“å­˜åˆ°å†…å­˜ä¸­
            SDWebImageProgressiveDownload = 1 &lt;&lt; 3,// å›¾ç‰‡ä¼šè¾¹ä¸‹è¾¹æ˜¾ç¤º
            SDWebImageRefreshCached = 1 &lt;&lt; 4,//å°†ç¡¬ç›˜ç¼“å­˜äº¤ç»™ç³»ç»Ÿè‡ªå¸¦çš„NSURLCacheå»å¤„ç†
            SDWebImageContinueInBackground = 1 &lt;&lt; 5,//åå°ä¸‹è½½
            SDWebImageHandleCookies = 1 &lt;&lt; 6,// é€šè¿‡è®¾ç½®NSMutableURLRequest.HTTPShouldHandleCookies = YESæ¥å¤„ç†å­˜å‚¨åœ¨NSHTTPCookieStoreä¸­çš„cookie
            SDWebImageAllowInvalidSSLCertificates = 1 &lt;&lt; 7,// å…è®¸ä¸å—ä¿¡ä»»çš„SSLè¯ä¹¦ã€‚ä¸»è¦ç”¨äºæµ‹è¯•ç›®çš„ã€‚
            SDWebImageHighPriority = 1 &lt;&lt; 8,
            SDWebImageDelayPlaceholder = 1 &lt;&lt; 9,
            SDWebImageTransformAnimatedImage = 1 &lt;&lt; 10,
        };
</code></pre><h2 id="åœ¨categoryä¸­æ–°å¢property"><a href="#åœ¨categoryä¸­æ–°å¢property" class="headerlink" title="åœ¨categoryä¸­æ–°å¢property"></a>åœ¨<code>category</code>ä¸­æ–°å¢<code>property</code></h2><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨categoryä¸­æ˜¯ä¸èƒ½æ–°å¢propertyçš„ï¼Œè¦æŒ‰å¦‚ä¸‹æ­¥éª¤è¿›è¡Œï¼ã€‚ï¼</p>
<ol>
<li>å¯¼å…¥å¤´æ–‡ä»¶<pre><code>     #import &lt;objc/runtime.h&gt;
</code></pre></li>
<li>æ–°å¢@property<pre><code>     @property (nonatomic, strong) UIActivityIndicatorView *buttonIndicatorView;
</code></pre></li>
<li><p>è‡ªå®šä¹‰<code>setter</code>å’Œ<code>getter</code></p>
<pre><code>     static char EAButtonIndicatorViewKey;

     - (void)setButtonIndicatorView:(UIActivityIndicatorView *)buttonIndicatorView {
         objc_setAssociatedObject(self, &amp;EAButtonIndicatorViewKey, buttonIndicatorView, OBJC_ASSOCIATION_RETAIN_NONATOMIC);  
     }

     - (UIActivityIndicatorView *)buttonIndicatorView {
         return objc_getAssociatedObject(self, &amp;EAButtonIndicatorViewKey);
     }
</code></pre></li>
</ol>
<h2 id="ç”¨æˆ·åå­˜å‚¨æ•´ä¸ªæµç¨‹"><a href="#ç”¨æˆ·åå­˜å‚¨æ•´ä¸ªæµç¨‹" class="headerlink" title="ç”¨æˆ·åå­˜å‚¨æ•´ä¸ªæµç¨‹"></a>ç”¨æˆ·åå­˜å‚¨æ•´ä¸ªæµç¨‹</h2><p>å‚è€ƒè¿™é‡Œ</p>
<h2 id="UIAlertControlleråŸºç¡€"><a href="#UIAlertControlleråŸºç¡€" class="headerlink" title="UIAlertControlleråŸºç¡€"></a><code>UIAlertController</code>åŸºç¡€</h2><p>ä»iOS8å¼€å§‹ï¼Œ<code>UIAlertController</code>å¼€å§‹æ›¿ä»£<code>UIAlertAction</code>,å…ˆæ¥çœ‹çœ‹UIAlertControllerçš„æ•ˆæœå›¾ğŸ‘‡<br><img src="/lionheart/1603/alertcontroller.png" alt="UIAlertController demo"><br>å®ç°ä»£ç ğŸ‘‡</p>
<pre><code>        UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@&quot;æç¤º&quot; message:@&quot;æ¬¢è¿æ³¨å†Œ Codingï¼Œè¯·å°½å¿«å»é‚®ç®±æŸ¥æ”¶é‚®ä»¶å¹¶æ¿€æ´»è´¦å·ã€‚å¦‚è‹¥åœ¨æ”¶ä»¶ç®±ä¸­æœªçœ‹åˆ°æ¿€æ´»é‚®ä»¶ï¼Œè¯·ç•™æ„ä¸€ä¸‹åƒåœ¾é‚®ä»¶ç®±(T_T)ã€‚&quot; preferredStyle:UIAlertControllerStyleAlert];
        UIAlertAction *ok = [UIAlertAction actionWithTitle:@&quot;çŸ¥é“äº†&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) {
            [alertController dismissViewControllerAnimated:YES completion:nil];
        }];

        [alertController addAction:ok];
        [self presentViewController:alertController animated:YES completion:nil];
</code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://blog.csdn.net/ryantang03/article/details/8622415" target="_blank" rel="external">iOSå­¦ä¹ ç¬”è®°42â€”åˆ©ç”¨dispatch_onceåˆ›å»ºå•ä¾‹</a></li>
<li><a href="http://tutuge.me/2015/03/21/effective-objective-c-5-enum/" target="_blank" rel="external">Enum-æšä¸¾çš„æ­£ç¡®ä½¿ç”¨-Effective-Objective-C-è¯»ä¹¦ç¬”è®°-Item-5</a></li>
<li><a href="http://blog.sunnyxx.com/2014/04/30/ios_iterator/" target="_blank" rel="external">iosä¸­é›†åˆéå†æ–¹æ³•çš„æ¯”è¾ƒå’ŒæŠ€å·§</a></li>
<li><a href="http://eric-gao.iteye.com/blog/2234047" target="_blank" rel="external">UITableViewçš„ä¸¤ç§é‡ç”¨Cellæ–¹æ³•çš„åŒºåˆ«</a></li>
<li><a href="http://www.henishuo.com/ios-cashapelayer-learning/" target="_blank" rel="external">iOS CAShapeLayerç²¾è®²</a></li>
<li><a href="http://www.jianshu.com/p/c07df06c60be" target="_blank" rel="external">SDWebImageæºç å‰–æ</a></li>
</ul>
<h2 id="P-S"><a href="#P-S" class="headerlink" title="P.S"></a>P.S</h2><p>ä»¥ä¸Šéƒ½ä¸æ˜¯é‡ç‚¹ï¼Œé‡ç‚¹æ˜¯ollieè¦è¿‡ç«‹äº†ï¼ã€‚ï¼</p>
]]></content>
      
        <categories>
            
            <category> æ‚ä¸ƒæ‚å…« </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[JazzHands]]></title>
      <url>/2016/02/27/jazzhands/</url>
      <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="https://github.com/IFTTT/JazzHands" target="_blank" rel="external">JazzHands</a>, Githubä¸Šçš„å¼€æºåº“ï¼Œéå¸¸é€‚ç”¨äºappçš„ä»‹ç»ç•Œé¢ã€‚å…ˆçœ‹çœ‹æ•ˆæœå›¾ğŸ‘‡<br><img src="/lionheart/1602/jazzhandsdemo.gif" alt="JazzHands demo"><br><a href="https://github.com/vanney9/blogDemo/tree/master/blogJazzHands" target="_blank" rel="external">ğŸ‘‰demoä»£ç åœ¨è¿™é‡ŒğŸ‘ˆ</a></p>
<a id="more"></a>
<h2 id="ä¸»è¦æµç¨‹"><a href="#ä¸»è¦æµç¨‹" class="headerlink" title="ä¸»è¦æµç¨‹"></a>ä¸»è¦æµç¨‹</h2><ol>
<li>åˆ›å»ºJazzHandsViewController</li>
<li>å®šä¹‰ä»‹ç»é¡µé¢çš„é¡µæ•°</li>
<li>æ·»åŠ å›¾ç‰‡</li>
<li>å®šä¹‰æ¯å¼ å›¾ç‰‡çš„ä½ç½®</li>
<li>æ·»åŠ æ»‘åŠ¨æ—¶å€™çš„æ•ˆæœ</li>
</ol>
<h2 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h2><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><ol>
<li><p>ä½¿ç”¨cocoapodæ·»åŠ JazzHands</p>
<pre><code> pod &#39;JazzHands&#39;, &#39;2.0.8&#39;
</code></pre></li>
<li><p>åˆ›å»ºå·¥ç¨‹ï¼Œæ–°å¢<code>JazzHandsViewController</code>,<br>ç»§æ‰¿è‡ª<code>IFTTTAnimatedPagingScrollViewController</code></p>
</li>
<li><p>å¯¼å…¥å¤´æ–‡ä»¶</p>
<pre><code> #import &lt;IFTTTJazzHands.h&gt;
</code></pre></li>
</ol>
<h3 id="å®šä¹‰é¡µé¢é¡µæ•°"><a href="#å®šä¹‰é¡µé¢é¡µæ•°" class="headerlink" title="å®šä¹‰é¡µé¢é¡µæ•°"></a>å®šä¹‰é¡µé¢é¡µæ•°</h3><p>å…¶å®å°±æ˜¯é‡å†™ <code>- (NSUInteger)numberOfPages;</code> å‡½æ•°</p>
<h3 id="æ·»åŠ subView"><a href="#æ·»åŠ subView" class="headerlink" title="æ·»åŠ subView"></a>æ·»åŠ subView</h3><p>å°†æ¯å¼ å›¾ç‰‡å°è£…åˆ°UIImageView,å¹¶æ·»åŠ åˆ°<code>JazzHandsViewController</code>çš„subViewé‡Œé¢<br>å…³é”®ä»£ç :<br><img src="/lionheart/1602/jazzhandscode1.png" alt="JazzHands code1"></p>
<h3 id="å®šä¹‰æ¯å¼ å›¾ç‰‡ä½ç½®"><a href="#å®šä¹‰æ¯å¼ å›¾ç‰‡ä½ç½®" class="headerlink" title="å®šä¹‰æ¯å¼ å›¾ç‰‡ä½ç½®"></a>å®šä¹‰æ¯å¼ å›¾ç‰‡ä½ç½®</h3><p>ä½¿ç”¨<code>keepView:onPages:</code>æˆ–è€…<code>keepView:onPages:atTimes:</code>å®šä¹‰ä½ç½®</p>
<h4 id="keepView-onPages"><a href="#keepView-onPages" class="headerlink" title="keepView:onPages:"></a>keepView:onPages:</h4><pre><code>    [self keepView:iconView onPage:i];
</code></pre><p>iè¡¨ç¤ºç›®å‰å¤„äºä»‹ç»é¡µé¢çš„ç¬¬ié¡µï¼Œè¯¥å‡½æ•°è¯´æ˜<code>iconView</code>åªèƒ½æ˜¾ç¤ºåœ¨ç¬¬ié¡µé¢ä¸Š</p>
<h4 id="keepView-onPages-atTimes"><a href="#keepView-onPages-atTimes" class="headerlink" title="keepView:onPages:atTimes:"></a>keepView:onPages:atTimes:</h4><p><strong>è¿™ç¯‡æ–‡ç« çš„ç²¾åæ‰€åœ¨ï¼ã€‚ï¼</strong></p>
<pre><code>    [self keepView:tipView onPages:@[@(i + 1), @(i), @(i - 1)] atTimes:@[@(i - 1), @(i), @(i + 1)]];
</code></pre><p>ä¸Šé¢çš„è¯­å¥è¯´æ˜äº†3ä»¶äº‹:(å°†iè®¾ä¸º2è¿›è¡Œè¯´æ˜ï¼Œ æ‰€æœ‰ <strong>3</strong> å¯¹åº” <strong>i + 1</strong>, <strong>2</strong> å¯¹åº” <strong>i</strong>, <strong>1</strong> å¯¹åº” <strong>i - 1</strong>)</p>
<ol>
<li><code>tipView</code>å¯ä»¥æ˜¾ç¤ºåœ¨ç¬¬3ï¼Œ2ï¼Œ1é¡µé¢ä¸Š</li>
<li>å½“å½“å‰å±å¹•æ˜¾ç¤ºçš„æ˜¯ç¬¬2é¡µé¢æ—¶ï¼Œ<code>tipView</code>åº”è¯¥åœ¨ç¬¬2é¡µé¢ï¼›å½“å½“å‰å±å¹•æ˜¾ç¤ºçš„æ˜¯ç¬¬1é¡µé¢æ—¶ï¼Œ<code>tipView</code>åº”è¯¥åœ¨ç¬¬3é¡µé¢ï¼šè¿™è¯´æ˜äº†å½“å±å¹•ä»ç¬¬2é¡µæ»‘åŠ¨åˆ°ç¬¬1é¡µæ—¶(æ„ä¼šä¸€ä¸‹ï¼šè¿™é‡Œæ‰‹æŒ‡çš„æ“ä½œæ˜¯å‘ğŸ‘‰æ»‘åŠ¨)ï¼Œ<code>tipView</code>ä»ç¬¬2é¡µæ»‘åŠ¨åˆ°äº†ç¬¬3é¡µ(æ„ä¼šä¸€ä¸‹ï¼šå°±æ˜¯<code>tipView</code>å’»å’»çš„ä¸€ä¸‹è·Ÿç€æ‰‹æŒ‡è¢«æ»‘åˆ°ğŸ‘‰ï¼Œå¹¶ä¸”æ¯”åé¢çš„é¡µé¢æ›´å¿«åœ°æ»‘å‡ºç•Œé¢äº†)</li>
<li>å½“å½“å‰å±å¹•æ˜¾ç¤ºçš„æ˜¯ç¬¬2é¡µé¢æ—¶ï¼Œ<code>tipView</code>åº”è¯¥åœ¨ç¬¬2é¡µé¢ï¼›å½“å½“å‰å±å¹•æ˜¾ç¤ºçš„æ˜¯ç¬¬3é¡µé¢æ—¶ï¼Œ<code>tipView</code>åº”è¯¥åœ¨ç¬¬1é¡µé¢ï¼šè¿™è¯´æ˜äº†å½“å±å¹•ä»ç¬¬2é¡µæ»‘åŠ¨åˆ°ç¬¬3é¡µæ—¶(æ„ä¼šä¸€ä¸‹ï¼šè¿™é‡Œæ‰‹æŒ‡çš„æ“ä½œæ˜¯å‘ğŸ‘ˆæ»‘åŠ¨)ï¼Œ<code>tipView</code>ä»ç¬¬2é¡µæ»‘åŠ¨åˆ°äº†ç¬¬1é¡µ(æ„ä¼šä¸€ä¸‹ï¼šå°±æ˜¯<code>tipView</code>å’»å’»çš„ä¸€ä¸‹è·Ÿç€æ‰‹æŒ‡è¢«æ»‘åˆ°ğŸ‘ˆï¼Œå¹¶ä¸”æ¯”åé¢çš„é¡µé¢æ›´å¿«åœ°æ»‘å‡ºç•Œé¢äº†)</li>
</ol>
<h3 id="æ·»åŠ æ»‘åŠ¨æ—¶å€™çš„æ•ˆæœ"><a href="#æ·»åŠ æ»‘åŠ¨æ—¶å€™çš„æ•ˆæœ" class="headerlink" title="æ·»åŠ æ»‘åŠ¨æ—¶å€™çš„æ•ˆæœ"></a>æ·»åŠ æ»‘åŠ¨æ—¶å€™çš„æ•ˆæœ</h3><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯æ·¡å…¥æ·¡å‡ºæ•ˆæœ,é€šè¿‡<code>IFTTTAlphaAnimation</code>æ§åˆ¶viewçš„é€æ˜åº¦<br>å…³é”®ä»£ç ï¼š<br><img src="/lionheart/1602/jazzhandscode2.png" alt="JazzHands code2"><br>è¿˜æ˜¯å°†iè®¾ä¸º2è¿›è¡Œè¯´æ˜ï¼š</p>
<ol>
<li>å½“å½“å‰é¡µé¢åˆšå¥½åœ¨ç¬¬2é¡µçš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯ä¸é€æ˜çš„ï¼Œå®Œå…¨æ˜¾ç¤º</li>
<li>å½“å½“å‰é¡µé¢åˆšå¥½åœ¨ç¬¬2.5/1.5é¡µçš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯å®Œå…¨é€æ˜çš„ï¼Œä¸æ˜¾ç¤º</li>
<li>åœ¨1.5-2.5ä¹‹é—´,<code>tipView</code>æ¸å˜æ˜¾ç¤º</li>
</ol>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><ol>
<li>åŠ¨ç”»å¯ä»¥åˆ†ä¸º2éƒ¨åˆ†ï¼Œæ·¡å…¥æ·¡å‡ºå’Œæ»‘åŠ¨</li>
<li>æ»‘åŠ¨çš„æ§åˆ¶ä½¿ç”¨<code>keepView:onPages:</code>æˆ–è€…<code>keepView:onPages:atTimes:</code>ï¼Œè¿™éƒ¨åˆ†å…³é”®åœ¨äºæ„ä¼šâ€¦</li>
<li>æ·¡å…¥æ·¡å‡ºä½¿ç”¨<code>IFTTTAlphaAnimation</code>æ§åˆ¶</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://github.com/IFTTT/JazzHands" target="_blank" rel="external">JazzHands</a></li>
<li><a href="https://github.com/Coding/Coding-iOS" target="_blank" rel="external">Coding iOS å®¢æˆ·ç«¯æºä»£ç </a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[2016 Week 1]]></title>
      <url>/2016/02/27/2016-week1/</url>
      <content type="html"><![CDATA[<p>å¼€å¹´ç¬¬ä¸€å‘¨ï¼Œå‡†å¤‡æ¢ä¸ªæ–¹å¼å†™åšå®¢ã€‚å°±å½“å‘¨è®°å§ï¼Œå¯ä»¥è‚¯å®šè¿™ç§æ¨¡å¼ä¹Ÿæ˜¯æŒç»­ä¸äº†å¤šä¹…çš„ï¼ã€‚ï¼</p>
<h2 id="å¼€ç¯‡"><a href="#å¼€ç¯‡" class="headerlink" title="å¼€ç¯‡"></a>å¼€ç¯‡</h2><p>2æœˆ20å·å›åˆ°æ­¦æ±‰ï¼›21å·å›åˆ°å­¦æ ¡ï¼Œè¢«åŸºå‹å«è¿‡å»çœ‹ä¸‰æ‰“ç™½éª¨ç²¾ï¼ˆå…¶å®æƒ³å»çœ‹ç¾äººé±¼æ¥ç€çš„â€¦ï¼‰ï¼›ç„¶åå°±å¼€å§‹å·¥ä½œäº†ã€‚<br>å¼€å­¦ç¬¬ä¸€å‘¨ï¼Œæ²¡å•¥å…·ä½“çš„ä»»åŠ¡ã€‚è‡ªå·±åœ¨githubä¸Šæ‰¾äº†<a href="https://github.com/Coding/Coding-iOS" target="_blank" rel="external">Coding_iOS</a>çš„æºç ï¼Œç…§ç€åšäº†èµ·æ¥ã€‚æ¥çœ‹çœ‹ç¬¬ä¸€å‘¨ç¢°åˆ°çš„å„ç±»é—®é¢˜ã€‚</p>
<a id="more"></a>
<h2 id="é—®é¢˜åˆ—è¡¨"><a href="#é—®é¢˜åˆ—è¡¨" class="headerlink" title="é—®é¢˜åˆ—è¡¨"></a>é—®é¢˜åˆ—è¡¨</h2><ol>
<li>çŠ¶æ€æ ï¼ˆ<code>UIStatusBar</code>)çš„æ˜¾ç¤º</li>
<li>å¯¼èˆªæ ï¼ˆ<code>UINavigationBar</code>ï¼‰çš„è®¾ç½®</li>
<li>åˆ¤æ–­iPhoneæœºå‹</li>
<li>ç¬¬ä¸‰æ–¹åº“: <code>JazzHands</code></li>
<li><code>UIPageControl</code>ä½¿ç”¨</li>
<li>åœ†è§’Button</li>
<li>ViewControllerçš„ä¸¤ç§è·³è½¬</li>
<li>UITableViewçš„<code>tableHeaderView</code>å’Œ<code>tableFooterView</code></li>
<li><code>UIActionSheet</code>ä½¿ç”¨</li>
<li>SDWebImage cacheç›¸å…³</li>
</ol>
<p>è¿›å…¥æ­£æ–‡â€¦</p>
<h2 id="çŠ¶æ€æ ï¼ˆUIStatusBar-çš„æ˜¾ç¤º"><a href="#çŠ¶æ€æ ï¼ˆUIStatusBar-çš„æ˜¾ç¤º" class="headerlink" title="çŠ¶æ€æ ï¼ˆUIStatusBar)çš„æ˜¾ç¤º"></a>çŠ¶æ€æ ï¼ˆ<code>UIStatusBar</code>)çš„æ˜¾ç¤º</h2><p>ä¹‹å‰æœ‰ä¸€ç¯‡åšå®¢è®²åˆ°UIStatusBarçš„è®¾ç½®(<a href="http://vanney9.com/2016/01/05/iOS-navbar-statusbar-setting/" target="_blank" rel="external">iOSå¯¼èˆªæ å’ŒçŠ¶æ€æ è®¾ç½®</a>),è¿™é‡Œçš„æ˜¯å¦ä¸€ç§æ–¹æ³•â€“å…¨å±€è®¾ç½®UIStatusBarã€‚</p>
<ol>
<li>åœ¨.plistæ–‡ä»¶ä¸­ï¼Œå°†<code>UIViewControllerBasedStatusBarAppearance</code>è®¾ç½®ä¸ºNO</li>
<li>è¦å…¨å±€è®¾ç½®UIStatusBarçš„è¯<pre><code> [[UIApplication sharedApplication] setStatusBarStyle:UIStatusBarStyleLightContent]; // å°†çŠ¶æ€äº†è®¾ç½®ä¸ºäº®è‰²ï¼ˆç™½è‰²ï¼‰
 [[UIApplication sharedApplication] setStatusBarStyle:UIStatusBarStyleDefault]; // å°†çŠ¶æ€æ è¿˜åŸä¸ºé»˜è®¤ï¼ˆé»‘è‰²ï¼‰
</code></pre></li>
</ol>
<h2 id="å¯¼èˆªæ ï¼ˆUINavigationBarï¼‰çš„è®¾ç½®"><a href="#å¯¼èˆªæ ï¼ˆUINavigationBarï¼‰çš„è®¾ç½®" class="headerlink" title="å¯¼èˆªæ ï¼ˆUINavigationBarï¼‰çš„è®¾ç½®"></a>å¯¼èˆªæ ï¼ˆ<code>UINavigationBar</code>ï¼‰çš„è®¾ç½®</h2><p>åŒæ ·ï¼Œåœ¨<a href="http://vanney9.com/2016/01/05/iOS-navbar-statusbar-setting/" target="_blank" rel="external">iOSå¯¼èˆªæ å’ŒçŠ¶æ€æ è®¾ç½®</a>è¿™ç¯‡é‡Œè®²è¿‡UINavigationBarçš„è®¾ç½®ï¼Œè¿™é‡Œè¯´çš„æ˜¯å…¨å±€è®¾ç½®UINavigationBarçš„æ–¹æ³•ã€‚<br>æ–¹æ³•å…¶å®å¾ˆç®€å•å•¦ï¼Œå°±æ˜¯é€šè¿‡<code>[UINavigationBar appearance]</code>è·å¾—è®¾ç½®UINavigationBarçš„å…¨å±€ä»£ç†ï¼Œä¸€èˆ¬åœ¨ <strong>AppDelegate.m</strong> æ–‡ä»¶é‡Œé¢è®¾ç½®ã€‚ä»£ç å¦‚ä¸‹ğŸ‘‡</p>
<pre><code>        UINavigationBar *navBarAppearance = [UINavigationBar appearance];
        [navBarAppearance setBarTintColor:[UIColor colorWithHexString:@&quot;0x28303b&quot;]];
        [navBarAppearance setTintColor:[UIColor whiteColor]];
        NSDictionary *textAttributes = @{ NSFontAttributeName : [UIFont boldSystemFontOfSize:kNavTitleFontSize],
                                      NSForegroundColorAttributeName : [UIColor whiteColor] };
        [navBarAppearance setTitleTextAttributes:textAttributes];
</code></pre><h2 id="åˆ¤æ–­iPhoneæœºå‹"><a href="#åˆ¤æ–­iPhoneæœºå‹" class="headerlink" title="åˆ¤æ–­iPhoneæœºå‹"></a>åˆ¤æ–­iPhoneæœºå‹</h2><p>åˆ¤æ–­iPhoneæœºå‹çš„ä»£ç ï¼Œä¼šç»å¸¸ç”¨åˆ°ï¼Œå°±æ”¾åœ¨.pchæ–‡ä»¶é‡Œé¢å§ã€‚ä»£ç å¦‚ä¸‹ğŸ‘‡</p>
<pre><code>    #define kDevice_Is_iPhone6 ([UIScreen instancesRespondToSelector:@selector(currentMode)] ? CGSizeEqualToSize(CGSizeMake(750, 1334), [[UIScreen mainScreen] currentMode].size) : NO)
</code></pre><p>å¦å¤–ï¼Œå„ç§æœºå‹å¯¹åº”çš„CGSize:</p>
<ol>
<li>iPhone4(s): CGSizeMake(640, 960)</li>
<li>iPhone5(s): CGSizeMake(640, 1136)</li>
<li>iPhone6(s): CGSizeMake(750, 1334)</li>
<li>iPhone6(s)Plus: CGSizeMake(1242, 2208)</li>
</ol>
<h2 id="ç¬¬ä¸‰æ–¹åº“-JazzHands"><a href="#ç¬¬ä¸‰æ–¹åº“-JazzHands" class="headerlink" title="ç¬¬ä¸‰æ–¹åº“: JazzHands"></a>ç¬¬ä¸‰æ–¹åº“: <code>JazzHands</code></h2><p><a href="https://github.com/IFTTT/JazzHands" target="_blank" rel="external">JazzHands</a>, è¶…é€‚åˆç”¨æ¥åšå¼€å§‹ç•Œé¢ï¼Œæ¥çœ‹ä¸‹é¢çš„åŠ¨æ€å›¾ğŸ‘‡<br><img src="/lionheart/1602/jazzhands.gif" alt="JazzHands demo"><br>æœ‰å…³JazzHandsçš„å…·ä½“ä½¿ç”¨å°†åœ¨<a href="/2016/02/27/jazzhands/">è¿™ç¯‡æ–‡ç« (JazzHands)</a>é‡Œé¢ä»‹ç»ï¼ã€‚ï¼</p>
<h2 id="UIPageControlä½¿ç”¨"><a href="#UIPageControlä½¿ç”¨" class="headerlink" title="UIPageControlä½¿ç”¨"></a><code>UIPageControl</code>ä½¿ç”¨</h2><p>ä¸»è¦å°±æ˜¯UIPageControlçš„å‡ ä¸ªå±æ€§:</p>
<ol>
<li>numberOfPages: æ€»é¡µæ•°</li>
<li>currentPage: å½“å‰é¡µæ•°</li>
<li>pageIndicatorTintColor: å°åœ†ç‚¹çš„é»˜è®¤é¢œè‰²</li>
<li>currentPageIndicatorTintColor: é«˜äº®å½“å‰å°åœ†ç‚¹çš„é¢œè‰²</li>
</ol>
<h2 id="åœ†è§’Button"><a href="#åœ†è§’Button" class="headerlink" title="åœ†è§’Button"></a>åœ†è§’Button</h2><p>è®¾ç½®åœ†è§’Buttonä¸è®¾ç½®åœ†è§’ç›¸åŒï¼Œå…³é”®å°±æ˜¯è®¾ç½®:</p>
<ol>
<li><code>button.layer.masksToBounds = YES;</code></li>
<li><p><code>button.layer.cornerRadius = cornerRadius;</code><br>å…·ä½“ä»£ç å¦‚ä¸‹ğŸ‘‡</p>
<pre><code>     self.loginButton = [UIButton buttonWithType:UIButtonTypeCustom];
     self.loginButton.backgroundColor = [UIColor whiteColor];
     [self.loginButton setTitle:@&quot;ç™»å½•&quot; forState:UIControlStateNormal];
     [self.loginButton setTitleColor:darkColor forState:UIControlStateNormal];
     self.loginButton.titleLabel.font = [UIFont boldSystemFontOfSize:20];

     [self.loginButton addTarget:self action:@selector(loginButtonClick) forControlEvents:UIControlEventTouchUpInside];

     [self.view addSubview:self.loginButton];
     [self.loginButton mas_makeConstraints:^(MASConstraintMaker *make) {
         // auto-layout code here...
     }];

     self.loginButton.layer.masksToBounds = YES;
     self.loginButton.layer.cornerRadius = buttonHeight / 2;
     self.loginButton.layer.borderColor = darkColor.CGColor;
     self.loginButton.layer.borderWidth = 1.0f;
</code></pre></li>
</ol>
<h2 id="ViewControllerçš„ä¸¤ç§è·³è½¬"><a href="#ViewControllerçš„ä¸¤ç§è·³è½¬" class="headerlink" title="ViewControllerçš„ä¸¤ç§è·³è½¬"></a>ViewControllerçš„ä¸¤ç§è·³è½¬</h2><p>åœ¨ViewControllerä¹‹é—´è·³è½¬ï¼Œæœ‰ä¸€ä¸‹2ç§æ–¹æ³•ï¼š</p>
<ol>
<li><code>[self presentViewController:loginVC animated:YES completion:nil];</code><br>è¿™ç§æ–¹æ³•å®ç°ä» self(Source ViewController) è·³è½¬åˆ° loginVC(Dest ViewController)</li>
<li><code>[self.navigationController pushViewController:destVC animated:YES];</code><br>è¿™ç§æ–¹æ³•å®ç°ä» self(Source ViewController) è·³è½¬åˆ° destVC(Dest ViewController), ä½†æ˜¯è¿™é‡Œçš„self(ViewController)å¿…é¡»åœ¨ä¸€ä¸ªUINavigationControlleré‡Œé¢</li>
</ol>
<h2 id="UITableViewçš„tableHeaderViewå’ŒtableFooterView"><a href="#UITableViewçš„tableHeaderViewå’ŒtableFooterView" class="headerlink" title="UITableViewçš„tableHeaderViewå’ŒtableFooterView"></a>UITableViewçš„<code>tableHeaderView</code>å’Œ<code>tableFooterView</code></h2><ol>
<li>tableHeaderView - table - tableFooterView ä¾æ¬¡æ’åˆ—</li>
<li>è¿™ä¸¤ä¸ªviewå±äºscrollview, ä»–ä»¬ä¼šéšç€tableä¸€èµ·ç§»åŠ¨</li>
</ol>
<h2 id="UIActionSheetä½¿ç”¨"><a href="#UIActionSheetä½¿ç”¨" class="headerlink" title="UIActionSheetä½¿ç”¨"></a><code>UIActionSheet</code>ä½¿ç”¨</h2><p>å…ˆçœ‹çœ‹å®ç°æ•ˆæœğŸ‘‡<br><img src="/lionheart/1602/uiactionsheet.png" alt="UIActionSheet demo"></p>
<p>å…·ä½“å®ç°:</p>
<ol>
<li>åˆå§‹åŒ–<pre><code>     _actionSheet = [[UIActionSheet alloc] initWithTitle:nil
                                                delegate:self
                                       cancelButtonTitle:@&quot;Cancel&quot;
                                  destructiveButtonTitle:nil
                                       otherButtonTitles:@&quot;Clear Cache&quot;, nil];
</code></pre></li>
<li>å®ç°<code>UIActionSheetDelegate</code>çš„ç‚¹å‡»æ—¶é—´å§”æ‰˜<pre><code>     - (void)actionSheet:(UIActionSheet *)actionSheet clickedButtonAtIndex:(NSInteger)buttonIndex {
         switch (buttonIndex) {
             case 0:
                 // do something here
                 break;
             case 1:
                 // do something here
                 break;
             default:
                 break;
         }
     }
</code></pre></li>
</ol>
<h2 id="SDWebImage-cacheç›¸å…³"><a href="#SDWebImage-cacheç›¸å…³" class="headerlink" title="SDWebImage cacheç›¸å…³"></a>SDWebImage cacheç›¸å…³</h2><ol>
<li>æ¸…é™¤ç¼“å­˜<pre><code>     SDWebImageManager *imageManager = [SDWebImageManager sharedManager];
     [imageManager.imageCache clearDiskOnCompletion:^{
         NSLog(@&quot;vanney code log... cache cleared&quot;);
     }];
</code></pre></li>
<li>æ˜¾ç¤ºç¼“å­˜ä¿¡æ¯<pre><code>     SDWebImageManager *imageManager = [SDWebImageManager sharedManager];
     [imageManager.imageCache getSize]; // ç¼“å­˜çš„å¤§å° é™¤2æ¬¡1024 å¾—åˆ°MB
     [imageManager.imageCache getDiskCount]; // ç¼“å­˜å›¾ç‰‡çš„æ•°é‡
</code></pre></li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://www.jianshu.com/p/b18de01e0cc8" target="_blank" rel="external">SDWebImageæºç å­¦ä¹ -One</a>  </li>
<li><a href="https://github.com/Coding/Coding-iOS" target="_blank" rel="external">Coding iOS å®¢æˆ·ç«¯æºä»£ç </a>            </li>
</ul>
]]></content>
      
        <categories>
            
            <category> æ‚ä¸ƒæ‚å…« </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[UITableViewåŸºç¡€åº”ç”¨]]></title>
      <url>/2016/01/11/UITableView-Demo/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šå¤©ä»‹ç»ä¸€ä¸ªç®€å•çš„UITableViewï¼Œç®€å•çš„ç•Œé¢ï¼Œæ¶‰åŠåˆ°UITableViewçš„ä¸€äº›åŸºç¡€çš„DataSourceå’ŒDelegateã€‚<br>æ•ˆæœå›¾ğŸ‘‡</p>
<p><img src="/lionheart/1601/tableViewDemo.png" alt="UITableView Demo"></p>
<a id="more"></a>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>æœ€è¿‘åœ¨è·Ÿç€githubä¸Šçš„ä¸€ä¸ªé¡¹ç›®ï¼š<a href="https://github.com/meilbn/MyOne-iOS" target="_blank" rel="external">MyOne-iOS</a>ï¼Œåšç€é«˜ä»¿çš„ä¸€ä¸ªappï¼ˆéŸ©å¯’å‡ºå“ï¼‰ï¼Œå…¶ä¸­çš„è®¾ç½®ç•Œé¢å°±éœ€è¦åšåˆ°ä¸Šè¿°çš„æ•ˆæœã€‚æ•ˆæœå›¾ä½¿ç”¨äº†UITableViewï¼Œå®ƒæ¶‰åŠåˆ°UITableViewåŸºç¡€çš„DataSourceå’ŒDelegateã€‚ä¸‹é¢æˆ‘å°±æ¥åˆ†äº«ä¸€ä¸‹å…¶ä¸­ä»£ç ã€‚</p>
<h2 id="UITableViewä»£ç å®ç°"><a href="#UITableViewä»£ç å®ç°" class="headerlink" title="UITableViewä»£ç å®ç°"></a>UITableViewä»£ç å®ç°</h2><p>UITableViewæŒ‰Sectionæ¥åˆ†æˆå„ä¸ªåŒºåŸŸï¼Œå…¶ä¸­æ¯ä¸ªSectionåˆåŒ…å«ä¸€ä¸ªHeaderå’Œå¤šä¸ªCellã€‚æ•ˆæœå›¾ä¸­ä¸€çœ¼çœ‹å‡ºè¯¥UITableViewåˆ†ä¸º4ä¸ªSectionã€‚å› æ­¤UITableViewçš„ä»£ç æ€è·¯ä¹Ÿåº”è¯¥æŒ‰Sectionæ¥å±•å¼€ã€‚</p>
<h3 id="UITableViewçš„æ•´ä½“è®¾è®¡"><a href="#UITableViewçš„æ•´ä½“è®¾è®¡" class="headerlink" title="UITableViewçš„æ•´ä½“è®¾è®¡"></a>UITableViewçš„æ•´ä½“è®¾è®¡</h3><p>æ‰€è°“æ•´ä½“è®¾è®¡å°±æ˜¯è®¾è®¡UITableViewçš„æ¯ä¸ªSectionçš„å…±æœ‰ç‰¹æ€§ï¼Œä»¥åŠUITableViewçš„DataSourceã€‚<br>å…ˆæ¥çœ‹çœ‹DataSource(ä½¿ç”¨æ•°ç»„æ¥å­˜æ”¾)ï¼š</p>
<p><img src="/lionheart/1601/datasourceset.png" alt="DataSource Set"></p>
<p><strong>æ³¨æ„:</strong> è¿™é‡Œå¤šè®¾è®¡äº†ä¸€ä¸ªSectionï¼Œå°†åœ¨<a href="#jump">åé¢è§£é‡Š</a>ã€‚</p>
<p>å†æ¥è®¾è®¡UITableViewçš„å…±æœ‰ç‰¹æ€§:</p>
<p><img src="/lionheart/1601/tableviewbaseproperty.png" alt="UITableView Property"></p>
<h3 id="Section-numberå’ŒCell-number"><a href="#Section-numberå’ŒCell-number" class="headerlink" title="Section numberå’ŒCell number"></a>Section numberå’ŒCell number</h3><p>UITableViewæ•´ä½“è®¾è®¡ç»“æŸåï¼Œå°±è¯¥æƒ³æƒ³è¿™ä¸ªUITableViewç»™æœ‰å¤šå°‘ä¸ªSectionï¼Œä»¥åŠæ¯ä¸ªSectionè¯¥æœ‰å‡ ä¸ªCellã€‚å®ƒå…¶å®éƒ½åŒ…å«åœ¨ä¸Šä¸€æ­¥çš„DataSourceçš„æ•°ç»„ä¸­ã€‚<br>UITableViewé€šè¿‡ä¸€ä¸‹ä¸¤ä¸ªUITableViewDataSourceæ–¹æ³•å¾—åˆ°Sectionå’ŒCellå¾—æ•°ç›®ï¼š</p>
<pre><code>    - (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView;
    - (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section;
</code></pre><h3 id="Section-Headerè®¾è®¡"><a href="#Section-Headerè®¾è®¡" class="headerlink" title="Section Headerè®¾è®¡"></a>Section Headerè®¾è®¡</h3><p>Section Headerçš„è®¾è®¡åŒ…æ‹¬è®¾è®¡Headerçš„é«˜åº¦ä»¥åŠHeaderçš„Viewï¼Œé€šè¿‡å¦‚ä¸‹ä¸¤ä¸ªUITableViewDataSourceå®ç°ï¼š</p>
<pre><code>    - (CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section;    //  è¿”å›Section Headeré«˜åº¦
    - (UIView *)tableView:(UITableView *)tableView viewForHeaderInSection:(NSInteger)section;     //  è¿”å›Section Headerçš„View
</code></pre><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="/lionheart/1601/sectionheader.png" alt="Section Header"></p>
<h3 id="Section-Cellè®¾è®¡"><a href="#Section-Cellè®¾è®¡" class="headerlink" title="Section Cellè®¾è®¡"></a>Section Cellè®¾è®¡</h3><p>Cellè®¾è®¡å°±æ˜¯å®ç°å¹¶è¿”å›ä¸€ä¸ªUITableViewCellï¼Œå®ƒé€šè¿‡UITableViewDataSourceæ–¹æ³•å®ç°ï¼š</p>
<pre><code>    - (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath;
</code></pre><p>æ³¨æ„åˆ°ï¼š</p>
<ol>
<li><p>iOSä¼šå¤ç”¨ä¸Šé¢ä»£ç æ³¨å†Œçš„UITableViewCellï¼Œ</p>
<pre><code> UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;stefanie&quot;];
</code></pre></li>
<li><p>æ¯ä¸ªUITableViewCellæœ‰ä¸€ä¸ªtextLabelå±æ€§ç”¨æ¥è®¾ç½®Cellçš„æ ‡é¢˜ï¼Œè¯¥å±æ€§æ˜¯ä¸€ä¸ªUILabelå¯¹è±¡</p>
<ol>
<li>æ¯ä¸ªUITableViewCellæœ‰ accessoryTypeå’Œ accessoryViewå±æ€§ï¼Œç”¨æ¥è®¾è®¡Cellæœ€å³è¾¹çš„æ ·å¼</li>
</ol>
</li>
</ol>
<p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="/lionheart/1601/tableviewcell.png" alt="UITableViewCell"></p>
<h3 id="å…¶ä»–ç›¸å…³"><a href="#å…¶ä»–ç›¸å…³" class="headerlink" title="å…¶ä»–ç›¸å…³"></a>å…¶ä»–ç›¸å…³</h3><ol>
<li><p>å½“æ‰‹æŒ‡é€‰ä¸­æŸä¸ªCellæ—¶ï¼Œæ”¹å˜UITableViewCellçš„èƒŒæ™¯è‰²ï¼›å½“æ‰‹æŒ‡ç¦»å¼€æ—¶èƒŒæ™¯è‰²è¿˜åŸã€‚åªéœ€å®ç°å¦‚ä¸‹UITableViewDelegateå°±å¯ï¼š</p>
<pre><code> - (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
     [tableView deselectRowAtIndexPath:indexPath animated:YES];
 }
</code></pre></li>
<li><p>é»˜è®¤æƒ…å†µä¸‹<span id="jump"></span>ï¼ŒHeaderçš„ä¸Šä¸‹éƒ½æ²¡æœ‰åˆ†å‰²çº¿ï¼Œåªæœ‰åœ¨ä¸¤ä¸ªCellä¹‹é—´æ‰æœ‰åˆ†å‰²çº¿ï¼Œè€Œä¸”ä¸åˆ°æœ€å·¦è¾¹ä½†åˆ°æœ€å³è¾¹ã€‚è¿™ä¹Ÿè§£é‡Šäº†ä¸Šé¢ä¸ºä»€ä¹ˆè¦å¤šè®¾è®¡ä¸€ä¸ªä¸UITableViewèƒŒæ™¯è‰²ç›¸åŒçš„ç©ºçš„Sectionã€‚å› ä¸ºå¦‚æœåªæœ‰4ä¸ªSectionï¼Œæœ€åçš„â€œé€€å‡ºå½“å‰è´¦å·â€ä¸‹æ–¹ä¼šæœ‰ä¸€ä¸ªå¥‡æ€ªçš„åˆ†å‰²çº¿ã€‚</p>
</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://github.com/meilbn/MyOne-iOS" target="_blank" rel="external">githubé«˜ä»¿ã€Šä¸€ä¸ªã€‹å®¢æˆ·ç«¯</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[iOSå¯¼èˆªæ å’ŒçŠ¶æ€æ è®¾ç½®]]></title>
      <url>/2016/01/05/iOS-navbar-statusbar-setting/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>çº¯ä»£ç è®¾ç½®iOSå¯¼èˆªæ å’ŒçŠ¶æ€æ ã€‚æ•ˆæœå›¾ğŸ‘‡</p>
<p><img src="/lionheart/1601/navbar.png" alt="iOSå¯¼èˆªæ å’ŒçŠ¶æ€æ è®¾ç½®"></p>
<a id="more"></a>
<h2 id="å¯¼èˆªæ è®¾ç½®-Navigation-Bar"><a href="#å¯¼èˆªæ è®¾ç½®-Navigation-Bar" class="headerlink" title="å¯¼èˆªæ è®¾ç½®(Navigation Bar)"></a>å¯¼èˆªæ è®¾ç½®(Navigation Bar)</h2><p>iOSä¸­çš„å¯¼èˆªæ ä½¿ç”¨<a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UINavigationBar_Class/" target="_blank" rel="external">UINavigationBar</a>ï¼Œå®ƒç»§æ‰¿è‡ªUIViewã€‚å¯ä»¥é€šè¿‡å®ƒæ§åˆ¶å¯¼èˆªæ æ˜¾ç¤ºçš„å†…å®¹ç­‰ç­‰ï¼Œä¸€ä¸ªå¯¼èˆªæ é€šå¸¸åŒ…æ‹¬ï¼šæ ‡é¢˜å’Œå·¦å³ä¾§æŒ‰é’®ã€‚</p>
<h3 id="UINavigationBarç¤ºæ„å›¾"><a href="#UINavigationBarç¤ºæ„å›¾" class="headerlink" title="UINavigationBarç¤ºæ„å›¾:"></a>UINavigationBarç¤ºæ„å›¾:</h3><p><img src="/lionheart/1601/navbardetail.png" alt="nav bar detail"></p>
<p>UINavigationBarå‡ ä¸ªé‡è¦å±æ€§ï¼š</p>
<ol>
<li><strong>tintColor</strong>: å¯¼èˆªæ å·¦å³ä¾§æŒ‰é’®çš„é¢œè‰²</li>
<li><strong>titleTextAttributes</strong>: å¯¼èˆªæ æ ‡é¢˜çš„å±æ€§</li>
<li><strong>translucent</strong>: å¯¼èˆªæ åŠé€æ˜å±æ€§ï¼Œæ˜¯ä¸€ä¸ªBOOLå€¼ï¼Œé»˜è®¤ä¸ºYESï¼ˆå³ï¼šé»˜è®¤å¯¼èˆªæ æ˜¯åŠé€æ˜çš„ï¼‰</li>
<li><strong>barTintColor</strong>: å¯¼èˆªæ èƒŒæ™¯è‰²</li>
</ol>
<h3 id="UINavigationBarå†…éƒ¨ç»“æ„"><a href="#UINavigationBarå†…éƒ¨ç»“æ„" class="headerlink" title="UINavigationBarå†…éƒ¨ç»“æ„:"></a>UINavigationBarå†…éƒ¨ç»“æ„:</h3><p>å¯¼èˆªæ (UINavigationBar)å†…éƒ¨å¯ä»¥åŒ…å«å¤šä¸ªUINavigationItemï¼ŒUINavigationBarçš„UINavigationItemå¯ä»¥é€šè¿‡å®ƒçš„itemså±æ€§è·å¾—ã€‚<br>UINavigationBaré€šè¿‡ç±»ä¼¼è¿›æ ˆå’Œå‡ºæ ˆçš„æ–¹å¼å‹å…¥å’Œå¼¹å‡ºUINavigationItemã€‚é€šå¸¸åªéœ€ä¸€ä¸ªUINavigationItemã€‚</p>
<ol>
<li>å‘UINavigationBarä¸­æ’å…¥UINavigationItem:<pre><code> - (void)pushNavigationItem:(UINavigationItem *)item animated:(BOOL)animated
</code></pre></li>
<li>å¼¹å‡ºæœ€ä¸Šæ–¹çš„ä¸€ä¸ªUINavigationItem:<pre><code> - (UINavigationItem *)popNavigationItemAnimated:(BOOL)animated
</code></pre></li>
<li>è·å–æœ€ä¸Šæ–¹çš„UINavigationItem: é€šè¿‡UINavigationBarçš„topItemå±æ€§</li>
</ol>
<h3 id="UINavigationItem"><a href="#UINavigationItem" class="headerlink" title="UINavigationItem:"></a>UINavigationItem:</h3><p><a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UINavigationItem_Class/index.html#//apple_ref/doc/c_ref/UINavigationItem" target="_blank" rel="external">UINavigationItem</a>ç®¡ç†ç€æ˜¾ç¤ºåœ¨UINavigationBarä¸­çš„å†…å®¹ã€‚ä¸€ä¸ªUINavigationItemé€šå¸¸åŒ…å«:æ ‡é¢˜å’Œå·¦å³ä¾§çš„æŒ‰é’®ã€‚</p>
<h4 id="é‡è¦å±æ€§"><a href="#é‡è¦å±æ€§" class="headerlink" title="é‡è¦å±æ€§"></a>é‡è¦å±æ€§</h4><ol>
<li><strong>title</strong>: æ ‡é¢˜</li>
<li><strong>leftBarButtonItem</strong>: å·¦ä¾§æŒ‰é’®</li>
<li><strong>rightBarButtonItem</strong>: å³ä¾§æŒ‰é’®</li>
</ol>
<h4 id="å·¦å³ä¾§æŒ‰é’®è®¾ç½®"><a href="#å·¦å³ä¾§æŒ‰é’®è®¾ç½®" class="headerlink" title="å·¦å³ä¾§æŒ‰é’®è®¾ç½®"></a>å·¦å³ä¾§æŒ‰é’®è®¾ç½®</h4><p>å·¦å³ä¾§æŒ‰é’®é€šå¸¸éƒ½æ˜¯UIBarButtonItemå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç è®¾ç½®ï¼š</p>
<pre><code>    UIBarButtonItem *btnLeft = [[UIBarButtonItem alloc] initWithTitle:@&quot;Back&quot; style:UIBarButtonItemStyleDone target:self action:nil];
</code></pre><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°:"></a>ä»£ç å®ç°:</h3><p><img src="/lionheart/1601/navbarcode.png" alt="navbar code"></p>
<h2 id="çŠ¶æ€æ è®¾ç½®-Status-Bar"><a href="#çŠ¶æ€æ è®¾ç½®-Status-Bar" class="headerlink" title="çŠ¶æ€æ è®¾ç½®(Status Bar)"></a>çŠ¶æ€æ è®¾ç½®(Status Bar)</h2><p>çŠ¶æ€æ å°±æ˜¯ç°å®æ—¶é—´ï¼Œè¿è¥å•†ï¼Œç”µé‡çš„åœ°æ–¹ï¼›å¦‚æœå¯¼èˆªæ èƒŒæ™¯è‰²ä¸ºæ·±è‰²çš„è¯ï¼Œé»˜è®¤çš„çŠ¶æ€æ æ— æ³•æ¸…æ¥šçš„æ˜¾ç¤ºã€‚<br>çŠ¶æ€æ çš„è®¾ç½®æ­¥éª¤æœ‰å¦‚ä¸‹å‡ æ­¥ï¼š</p>
<ol>
<li>åœ¨.plistæ–‡ä»¶å°† UIViewControllerBasedStatusBarAppearance è®¾ç½®ä¸º YES</li>
<li>åœ¨ viewDidLoad æ–¹æ³•ä¸­æ·»åŠ <pre><code> [self setNeedsStatusBarAppearanceUpdate];
</code></pre></li>
<li>æ·»åŠ  preferredStatusBarStyle æ–¹æ³•ï¼š<pre><code> - (UIStatusBarStyle)preferredStatusBarStyle
 {
     return UIStatusBarStyleLightContent;
 }
</code></pre></li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://stackoverflow.com/questions/19029833/ios-7-navigation-bar-text-and-arrow-color" target="_blank" rel="external">IOS 7 Navigation Bar text and arrow color</a></li>
<li><a href="http://stackoverflow.com/questions/17678881/how-to-change-status-bar-text-color-in-ios-7" target="_blank" rel="external">How to change Status Bar text color in iOS 7</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[ShortCut(å¿«æ·é”®) ï¼ Xcode]]></title>
      <url>/2015/12/12/ShortCut-xcode/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰æ®µæ—¶é—´å¬äº†å‰ç«¯åŒå­¦å…³äºSublime Textç¼–è¾‘å™¨ä½¿ç”¨å¿«æ·é”®çš„åˆ†äº«ï¼Œæ„è¯†åˆ°å¿«æ·é”®çš„ç¡®æ˜¯æé«˜å¼€å‘é€Ÿç‡çš„ç¥å™¨ã€‚ç†Ÿæ‚‰æŒæ¡æ‰€ç”¨ç¼–è¾‘å™¨çš„å¿«æ·é”®ï¼Œä¹Ÿå°†æå¤§çš„å‘æŒ¥å‡ºç¼–è¾‘å™¨çš„å¨åŠ›ã€‚ä¸‹é¢å°±ä»‹ç»ä¸€äº›Xcodeçš„å¿«æ·é”®ï¼ˆéšæ—¶æ›´æ–°è¡¥å……ï¼‰ã€‚</p>
<a id="more"></a>
<h2 id="Xcodeå¸¸ç”¨ç¬¦å·ç®€å†™"><a href="#Xcodeå¸¸ç”¨ç¬¦å·ç®€å†™" class="headerlink" title="Xcodeå¸¸ç”¨ç¬¦å·ç®€å†™"></a>Xcodeå¸¸ç”¨ç¬¦å·ç®€å†™</h2><ol>
<li>command: <strong>âŒ˜</strong></li>
<li>option: <strong>âŒ¥</strong></li>
<li>shift: <strong>â‡§</strong></li>
<li>caps lock: <strong>â‡ª</strong></li>
<li>control: <strong>âŒƒ</strong></li>
</ol>
<h2 id="Xcode-ShortCut"><a href="#Xcode-ShortCut" class="headerlink" title="Xcode ShortCut"></a>Xcode ShortCut</h2><ol>
<li>.hå’Œ.mæ–‡ä»¶åˆ‡æ¢: control + cmd + â†‘ <strong>(âŒƒ + âŒ˜ + â†‘)</strong></li>
<li>æ˜¾ç¤º/éšè—å¯¼èˆªæ : cmd + 0 <strong>(âŒ˜ + 0)</strong></li>
<li>è¿è¡Œç¨‹åº: cmd + R <strong>(âŒ˜ + R)</strong></li>
<li>å±•å¼€/æŠ˜å å‡½æ•°: option + cmd + â† | â†’ <strong>(âŒ¥ + âŒ˜ + â† | â†’)</strong></li>
<li>ğŸ‘ˆ/ğŸ‘‰é€‰æ‹©ä¸€ä¸ªå•è¯: shift + option + â† | â†’ <strong>(â‡§ + âŒ¥ + â† | â†’)</strong></li>
<li>ğŸ‘ˆ/ğŸ‘‰é€‰æ‹©åˆ°è¡Œå¤´/è¡Œå°¾: shift + cmd + â† | â†’ <strong>(â‡§ + âŒ˜ + â† | â†’)</strong></li>
<li>å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå°¾: cmd + â†’ <strong>(âŒ˜ + â†’)</strong></li>
<li>å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå¤´: cmd + â† <strong>(âŒ˜ + â†)</strong> //è§‰å¾—å¾ˆé¸¡è‚‹çš„ä¸€ä¸ªå¿«æ·é”®ï¼Œ åæ¥è¢«æˆ‘ç”¨æ’ä»¶è¦†ç›–äº†è¿™ä¸€å¿«æ·é”®</li>
<li>åˆ‡æ¢tab: cmd + shift + [ | ] <strong>(âŒ˜ + â‡§ + [ | ])</strong></li>
<li>å±•å¼€/æ˜¾ç¤ºå·¥å…·æ : cmd + option + 0 <strong>(âŒ˜ + âŒ¥ + 0)</strong></li>
<li>æ–°å»ºæ–‡ä»¶: cmd + N <strong>(âŒ˜ + N)</strong></li>
<li>clean: cmd + shift + K <strong>(âŒ˜ + â‡§ + K)</strong></li>
<li>build: cmd + B <strong>(âŒ˜ + B)</strong></li>
</ol>
<h2 id="Xcode-simulator-ShortCut"><a href="#Xcode-simulator-ShortCut" class="headerlink" title="Xcode simulator ShortCut"></a>Xcode simulator ShortCut</h2><ol>
<li>è½¬æ¢å±å¹•æ˜¾ç¤ºæ–¹å‘: cmd + â† | â†’ <strong>(âŒ˜ + â† | â†’)</strong></li>
<li>å±å¹•æˆªå›¾: cmd + S <strong>(âŒ˜ + S)</strong></li>
<li>Homeé”®: shift + cmd + H <strong>(â‡§ + âŒ˜ + H)</strong>, åŒå‡»Homeé”®å°±æ˜¯ <strong>â‡§ + âŒ˜ + H + H</strong></li>
</ol>
<h2 id="å®‰è£…Package-Manager-Alcatraz"><a href="#å®‰è£…Package-Manager-Alcatraz" class="headerlink" title="å®‰è£…Package Manager:Alcatraz"></a>å®‰è£…Package Manager:Alcatraz</h2><p>Alcatrazæ˜¯ä¸€ä¸ªå¼€æºçš„Xcodeæ’ä»¶ç®¡ç†å™¨,æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥å‘½ä»¤:</p>
<pre>curl -fsSL https://raw.githubusercontent.com/supermarin/Alcatraz/deploy/Scripts/install.sh | sh</pre>

<p>æ‰“å¼€Alcatraz: shift + cmd + 9 <strong>(â‡§ + âŒ˜ + 9)</strong></p>
<p>æœç´¢XCode4_beginning_of_lineå¹¶å®‰è£…ï¼Œè¦†ç›–åŸæœ‰çš„ç§»åŠ¨å…‰æ ‡åˆ°è¡Œå¤´çš„å¿«æ·é”®ã€‚æ‰€ä»¥:<br><br>å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªéç©ºç™½å¤„: cmd + â† <strong>(cmd + â†)</strong></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://softu.cn/447" target="_blank" rel="external">Macå¦‚ä½•è¾“å…¥âŒ˜ã€âŒ¥ã€â‡§ã€âŒƒã€â‹ç­‰ç‰¹æ®Šå­—ç¬¦</a></li>
<li><a href="http://alcatraz.io/" target="_blank" rel="external">Alcatraz:The package manager for Xcode</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[nginxé…ç½®çš„ä¸€äº›é—®é¢˜]]></title>
      <url>/2015/08/03/nginx-conf-problem/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©å°å­¦å¼Ÿé—®äº†äº›å…³äºnginxå’Œcié…ç½®çš„é—®é¢˜ï¼Œä¸»è¦å°±æ˜¯å»æ‰index.phpåå¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä½†æ˜¯åŠ ä¸Šindex.phpåå±…ç„¶ä¸èƒ½æ­£å¸¸è®¿é—®ï¼Œè€Œä¸”é‡å®šå‘åˆ°äº†welcome/indexé¡µé¢ï¼Œæœ€åçš„æœ€åï¼Œè¿˜æ˜¯å°å­¦å¼Ÿæ‰¾åˆ°äº†è§£å†³æ–¹æ³•=.=</p>
<a id="more"></a>
<p>å…ˆä¸Šé“¾æ¥</p>
<ol>
<li><a href="http://blog.sina.com.cn/s/blog_48d40b7a0100saqh.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_48d40b7a0100saqh.html</a></li>
<li><a href="http://www.chenyudong.com/archives/codeigniter-in-nginx-and-url-rewrite.html" target="_blank" rel="external">http://www.chenyudong.com/archives/codeigniter-in-nginx-and-url-rewrite.html</a></li>
<li><a href="http://blog.csdn.net/ei__nino/article/details/8599304" target="_blank" rel="external">http://blog.csdn.net/ei__nino/article/details/8599304</a></li>
</ol>
<p>ç›®å‰è¿˜ä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œå…ˆçœ‹çœ‹å‰ånginxé…ç½®çš„ä¸åŒ<br>å…ˆå‰çš„é…ç½®ï¼š<br><img src="/lionheart/nginx_conf_old.png"><br>åæ¥çš„é…ç½®ï¼š<br><img src="/lionheart/nginx_conf_new.png"></p>
<p>ä½†æ˜¯ä¸ºä»€ä¹ˆè¦è¿™æ ·é…ç½®å‘¢â€¦ è¿˜ä¸æ¸…æ¥š</p>
]]></content>
      
        <categories>
            
            <category> server </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[é‡è¯†git]]></title>
      <url>/2015/07/28/review-git/</url>
      <content type="html"><![CDATA[<p>ã€€ã€€ä»Šå¤©ï¼Œåœ¨<a href="www.coding.net">coding.net</a>ä¸Šé¢ï¼Œè‡ªå·±è§äº†ä¸€ä¸ªé¡¹ç›®æ¥ç†Ÿæ‚‰gitçš„åŸºæœ¬æ“ä½œã€‚å¹¶æ²¡æœ‰ç”¨åˆ°githubï¼Œä¸»è¦ä½¿ç”¨çš„æ˜¯coding.netæ¥æ‰˜ç®¡ä»£ç ã€‚<br>ã€€ã€€æœ€ä¸»è¦çš„å‚è€ƒèµ„æ–™æ˜¯é˜®ä¸€å³°å¤§ç¥çš„ä¸€ç¯‡åšå®¢ï¼š<a href="http://www.ruanyifeng.com/blog/2014/06/git_remote.html" target="_blank" rel="external">Gitè¿œç¨‹æ“ä½œè¯¦è§£</a><br>ã€€ã€€ä¸‹é¢å¯¹ä»Šå¤©çš„ä¸€ç³»åˆ—æ“ä½œåšä¸ªè®°å½•ï¼Œä»¥ä¾¿ä»¥åä½¿ç”¨ã€‚<br><a id="more"></a></p>
<h4 id="åœ¨coding-netä¸Šé¢æ–°å»ºé¡¹ç›®"><a href="#åœ¨coding-netä¸Šé¢æ–°å»ºé¡¹ç›®" class="headerlink" title="åœ¨coding.netä¸Šé¢æ–°å»ºé¡¹ç›®"></a>åœ¨coding.netä¸Šé¢æ–°å»ºé¡¹ç›®</h4><ol>
<li>åœ¨coding.netä¸Šé¢æ·»åŠ sshå…¬é’¥<br>$ cd ~/.ssh<pre><code> $ ssh-keygen
</code></pre>å°†ç”Ÿæˆçš„id_rsa.pubå¤åˆ¶ï¼Œæ·»åŠ åˆ°coding.netï¼Œå‚è€ƒ<a href="http://segmentfault.com/a/1190000002737818" target="_blank" rel="external"> å°†å…¬é’¥éƒ¨ç½²åˆ°è¿œç¨‹Gitä»“åº“ï¼ˆcoding.netï¼‰</a></li>
<li>æ–°å»ºé¡¹ç›®</li>
</ol>
<h4 id="æœ¬åœ°æ‹·è´è¿œç¨‹ä»“åº“"><a href="#æœ¬åœ°æ‹·è´è¿œç¨‹ä»“åº“" class="headerlink" title="æœ¬åœ°æ‹·è´è¿œç¨‹ä»“åº“"></a>æœ¬åœ°æ‹·è´è¿œç¨‹ä»“åº“</h4><pre><code>    $ git clone https://git.coding.net/xxx/xxx.git
</code></pre><h4 id="æœ¬åœ°æ·»åŠ ä»£ç ï¼Œå¹¶æäº¤åˆ°coding"><a href="#æœ¬åœ°æ·»åŠ ä»£ç ï¼Œå¹¶æäº¤åˆ°coding" class="headerlink" title="æœ¬åœ°æ·»åŠ ä»£ç ï¼Œå¹¶æäº¤åˆ°coding"></a>æœ¬åœ°æ·»åŠ ä»£ç ï¼Œå¹¶æäº¤åˆ°coding</h4><ol>
<li>åœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªæ–‡æ¡£ï¼Œ(example:README.md)ï¼Œç”±äºè¿œç¨‹ä»“åº“æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥è¿›è¡Œç¬¬ä¸€æ¬¡æäº¤æ—¶ï¼Œéœ€è¦æ‰§è¡Œï¼š<br>$ git add README.md<pre><code> $ git commit -m &#39;first commit&#39;
 $ git push origin master #git push &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;æœ¬åœ°åˆ†æ”¯&gt;:&lt;è¿œç¨‹åˆ†æ”¯&gt;
</code></pre>è¿™æ ·å°±å®Œæˆäº†ç¬¬ä¸€æ¬¡æäº¤ï¼Œä¹Ÿåœ¨æœ¬åœ°å’Œè¿œç«¯éƒ½å»ºç«‹äº†ä¸€ä¸ªmasteråˆ†æ”¯</li>
<li>å°†æœ¬åœ°å’Œè¿œç¨‹çš„ç›¸åŒåˆ†æ”¯å»ºç«‹è¿½è¸ªï¼š<br>$ git branch â€“set-upstream-to=origin/master master<br>è¿™æ ·ä»¥ååªéœ€è¦æ‰§è¡Œï¼š<pre><code>$ git pull OR git push
</code></pre>è€Œä¸ç”¨æ‰§è¡Œå¦‚ä¸‹ç¹çå‘½ä»¤ï¼š<pre><code>$ git pull &lt;è¿œç¨‹ä¸»æœº&gt; &lt;è¿œç¨‹åˆ†æ”¯&gt;:&lt;æœ¬åœ°åˆ†æ”¯&gt; OR git push &lt;è¿œç¨‹ä¸»æœº&gt; &lt;æœ¬åœ°åˆ†æ”¯&gt;:&lt;è¿œç¨‹åˆ†æ”¯&gt;
</code></pre>æ³¨æ„ï¼š ä¸Šè¿°ç¹çè¯­å¥ä¸­çš„å†’å·åé¢çš„å†…å®¹ä¸€èˆ¬å¯ä»¥çœç•¥ï¼Œå› ä¸ºè¿œç¨‹åˆ†æ”¯å’Œæœ¬åœ°åˆ†æ”¯ä¸€èˆ¬åå­—ç›¸åŒ</li>
<li>æ¯æ¬¡pullæˆ–æ˜¯pushæ˜¯éƒ½éœ€è¦è¾“å…¥usernameå’Œå¯†ç ï¼Œå¯ä»¥åœ¨.gitæ–‡ä»¶å¤¹ä¸‹é¢ä¿®æ”¹configæ–‡ä»¶ã€‚<br>url = <a href="https://[your" target="_blank" rel="external">https://[your</a> username]:[your password]@git.coding.net/xxx/xxx.git</li>
</ol>
<h4 id="æ–°å»ºåˆ†æ”¯"><a href="#æ–°å»ºåˆ†æ”¯" class="headerlink" title="æ–°å»ºåˆ†æ”¯"></a>æ–°å»ºåˆ†æ”¯</h4><ul>
<li>åœ¨coding.netä¸Šé¢æ–°å»ºä¸€ä¸ªdevåˆ†æ”¯ï¼Œä¸å½“å‰çš„masterä¸€è‡´ï¼Œåœ¨æœ¬åœ°é€šè¿‡å¦‚ä¸‹ä»£ç å°†å…¶æ‹·è´ä¸‹æ¥ï¼š<br>$ git branch dev  //æ–°å»ºæœ¬åœ°devåˆ†æ”¯<pre><code> $ git checkout dev //åˆ‡æ¢åˆ°æœ¬åœ°devåˆ†æ”¯
 $ git pull origin dev //æ‹·è´è¿œç¨‹devåˆ†æ”¯åˆ°æœ¬åœ°devåˆ†æ”¯
 $ git branch --set-upstream-to=origin/dev dev //å»ºç«‹devåˆ†æ”¯è¿½è¸ª
</code></pre>é€šè¿‡è¿™ç§æ–¹å¼å®ç°æœ¬åœ°devåˆ†æ”¯å’Œè¿œç«¯devåˆ†æ”¯çš„åŒæ­¥ï¼›å¹¶ä¸”ï¼Œç”±äºå»ºäº†è¿½è¸ªçš„åŸå› ï¼Œä¹‹ååœ¨devåˆ†æ”¯ä¸‹é¢çš„pullå’Œpushæ“ä½œä¹Ÿåªéœ€è¦git pullå’Œgit pushå°±è¡Œã€‚</li>
</ul>
<h4 id="æœ¬åœ°æ–°å»ºåˆ†æ”¯ï¼Œè¿½è¸ªè¿œç«¯åˆ†æ”¯"><a href="#æœ¬åœ°æ–°å»ºåˆ†æ”¯ï¼Œè¿½è¸ªè¿œç«¯åˆ†æ”¯" class="headerlink" title="æœ¬åœ°æ–°å»ºåˆ†æ”¯ï¼Œè¿½è¸ªè¿œç«¯åˆ†æ”¯"></a>æœ¬åœ°æ–°å»ºåˆ†æ”¯ï¼Œè¿½è¸ªè¿œç«¯åˆ†æ”¯</h4><p>è¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯ï¼šè¿œç«¯ç°åœ¨ä¸masterå’Œdevä¸¤ä¸ªåˆ†æ”¯ï¼Œè€Œæœ¬åœ°åªæœ‰masteråˆ†æ”¯ï¼›å¦‚ä½•åœ¨æœ¬åœ°åˆ›å»ºdevåˆ†æ”¯ï¼Œå¹¶è®©ä»–è¿½è¸ªè¿œç«¯devåˆ†æ”¯å‘¢ï¼ŸğŸ‘‡</p>
<pre><code>                git fetch                // æ£€æŸ¥è¿œç«¯åˆ†æ”¯æ›´æ–°
                git branch --track dev origin/dev    // æœ¬åœ°åˆ›å»ºdevåˆ†æ”¯å¹¶è¿½è¸ªè¿œç«¯origin/devåˆ†æ”¯
                git checkout dev                // åˆ‡æ¢åˆ°devåˆ†æ”¯
</code></pre><h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><ul>
<li><a href="http://www.ruanyifeng.com/blog/2014/06/git_remote.html" target="_blank" rel="external">Gitè¿œç¨‹æ“ä½œè¯¦è§£</a></li>
<li><a href="http://stackoverflow.com/questions/11262703/track-a-new-remote-branch-created-on-github" target="_blank" rel="external">Track a new remote branch created on GitHub</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> æ‚ä¸ƒæ‚å…« </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[pythonçˆ¬å–cs193pè¯¾ä»¶]]></title>
      <url>/2015/07/27/python-grab-cs193/</url>
      <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨ä¸Šstanfordçš„cs193pçš„è¯¾ç¨‹ï¼Œé—²ç€æ²¡äº‹ï¼Œå…ˆå°†å®ƒçš„è¯¾ä»¶ç”¨pythonä»ç½‘ä¸Šçˆ¬äº†ä¸‹æ¥â€¦</p>
<a id="more"></a>
<h4 id="ç›®æ ‡ç½‘ç«™"><a href="#ç›®æ ‡ç½‘ç«™" class="headerlink" title="ç›®æ ‡ç½‘ç«™"></a>ç›®æ ‡ç½‘ç«™</h4><p><a href="http://www.stanford.edu/class/cs193p/cgi-bin/drupal/downloads-2013-fall" target="_blank" rel="external">CS 193P iPhone Application Development</a><br><img src="/lionheart/cs193p_index.png"></p>
<h4 id="å…ˆçœ‹æºç "><a href="#å…ˆçœ‹æºç " class="headerlink" title="å…ˆçœ‹æºç "></a>å…ˆçœ‹æºç </h4><p><img src="/lionheart/cs193p_html_code.png"><br>åœ¨class=view-contentçš„divé‡Œé¢æ˜¯æ‰€éœ€çš„è¯¾ä»¶çš„ä¸‹è½½é“¾æ¥ï¼Œä»–ä»¬ä»¥&lt;h3$gt;å’Œ&lt;div&gt;çš„é¡ºåºæ’åˆ—ã€‚<br>çœ‹çœ‹æ¯ä¸ª&lt;div&gt;çš„å…·ä½“å†…å®¹<br><img src="/images/lionheart/cs193p_html_code1.png"><br>æ¯ä¸€ä¸ª&lt;div&gt;ä¸‹é¢çš„&lt;a&gt;æ ‡ç­¾é‡Œé¢çš„hrefé“¾æ¥æ‰€å¯¹åº”çš„å†…å®¹éƒ½åº”è¯¥ä¸‹è½½ä¸‹æ¥</p>
<h4 id="show-me-the-code"><a href="#show-me-the-code" class="headerlink" title="show me the code"></a>show me the code</h4><ol>
<li><p>mkdir.sh</p>
<blockquote>
<p>#!/bin/sh</p>
<p>for var in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18<br>do<br>ã€€ã€€mkdir $var<br>done</p>
</blockquote>
<p> åˆ›å»ºå¤šä¸ªç›®å½•ï¼Œç”¨æ¥å­˜æ”¾æ¯èŠ‚è¯¾çš„lecture</p>
</li>
<li><p>download-lecture.py</p>
<blockquote>
<p>import os<br>import requests<br>import bs4<br>import re</p>
<p>original_url = â€˜<a href="http://www.stanford.edu/class/cs193p/cgi-bin/drupal/downloads-2013-fall" target="_blank" rel="external">http://www.stanford.edu/class/cs193p/cgi-bin/drupal/downloads-2013-fall</a>â€˜<br>response = requests.get(original_url)<br>html = response.text<br>soup = bs4.BeautifulSoup(html)</p>
<p>view_content = soup.findAll(â€œdivâ€, {â€œclassâ€ : â€œview-contentâ€})</p>
<p>lectures = view_content[0].findAll(â€œh3â€);<br>for lecture in lectures:<br>ã€€ã€€lecture_title = lecture.text<br>ã€€ã€€lecture_content = lecture.findNextSibling(â€œdivâ€)<br>ã€€ã€€sample = lecture_content.find(â€œdivâ€, {â€œclassâ€ : â€œviews-field-field-sample-code-fidâ€})<br>ã€€ã€€slide = lecture_content.find(â€œdivâ€, {â€œclassâ€ : â€œviews-field-field-lecture-slides-fidâ€})</p>
<p>ã€€ã€€#regular expression<br>ã€€ã€€pattern = re.compile(râ€™Title: Lectureâ€™);<br>ã€€ã€€match = pattern.match(lecture_title);<br>ã€€ã€€if match:<br>ã€€ã€€ã€€ã€€title_array = lecture_title.split(â€˜: Lectureâ€™);<br>ã€€ã€€ã€€ã€€lecture_num = ((title_array[1].split(â€˜ â€˜))[1].split(â€˜:â€™))[0]<br>ã€€ã€€else:<br>ã€€ã€€ã€€ã€€continue</p>
<p>ã€€ã€€sample_urls = sample.findAll(â€˜aâ€™)<br>ã€€ã€€slide_urls = slide.findAll(â€˜aâ€™)</p>
<p> current_dir = â€˜cd â€˜ + lecture_num<br> os.system(current_dir)<br> for sample_url in sample_urls:<br>ã€€ã€€ã€€ã€€href = sample_url[â€˜hrefâ€™]<br>ã€€ã€€ã€€ã€€os.system(current_dir + â€˜ &amp;&amp; wget â€˜ + href)<br> for slide_url in slide_urls:<br>ã€€ã€€ã€€ã€€href = slide_url[â€˜hrefâ€™]<br>ã€€ã€€ã€€ã€€os.system(current_dir + â€˜ &amp;&amp; wget â€˜ + href)</p>
</blockquote>
<p> ä½¿ç”¨äº†BeautifulSoupæ¥åˆ†æHTMLä»£ç </p>
</li>
</ol>
]]></content>
      
        <categories>
            
            <category> æ‚ä¸ƒæ‚å…« </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Markdowning...]]></title>
      <url>/2015/07/22/Markdowning/</url>
      <content type="html"><![CDATA[<h2 id="markdown"><a href="#markdown" class="headerlink" title="markdown"></a>markdown</h2><blockquote>
<p>Markdownæ˜¯ä¸€ç§å¯ä»¥ä½¿ç”¨æ™®é€šæ–‡æœ¬ç¼–è¾‘å™¨ç¼–å†™çš„æ ‡è®°è¯­è¨€ï¼Œé€šè¿‡ç±»ä¼¼HTMLçš„æ ‡è®°è¯­æ³•ï¼Œå®ƒå¯ä»¥ä½¿æ™®é€šæ–‡æœ¬å†…å®¹å…·æœ‰ä¸€å®šçš„æ ¼å¼ã€‚ â€”-<a href="http://baike.baidu.com/link?url=NbjzNRdzUWluzLSRvvm7Tb-B3Qv4fqGSzZ36JaVtHNMubM6qxLrsoYUq3PcrMvDSCbV5kCCjzGw6jCVV_WyZTK" target="_blank" rel="external">ç™¾åº¦ç™¾ç§‘</a></p>
</blockquote>
<a id="more"></a>
<h2 id="editor"><a href="#editor" class="headerlink" title="editor"></a>editor</h2><p><a href="http://pad.haroopress.com/" target="_blank" rel="external">Haroopad</a>ï¼šä¸€æ¬¾è¦†ç›–ä¸‰å¤§ä¸»æµæ¡Œé¢ç³»ç»Ÿçš„ç¼–è¾‘å™¨ï¼Œæ”¯æŒ Windowsã€Mac OS X å’Œ Linuxã€‚ ä¸»é¢˜æ ·å¼ä¸°å¯Œï¼Œè¯­æ³•æ ‡äº®æ”¯æŒ 54 ç§ç¼–ç¨‹è¯­è¨€ã€‚è¯¥å·¥å…·é‡ç‚¹æ¨è Ubuntu/Linux ç”¨æˆ·ä½¿ç”¨ï¼Œä»æ­¤å¯ä»¥å‘Šåˆ« gedit åŠ  Markdown æ’ä»¶è¿™ç§å·¥ä½œæ–¹å¼äº†ã€‚<br>å¾ˆé€—çš„<strong>logo</strong> : <img src="http://pad.haroopress.com/assets/images/logo-small.png" alt=""></p>
<h2 id="syntax"><a href="#syntax" class="headerlink" title="syntax"></a>syntax</h2><p><a href="http://wowubuntu.com/markdown/#p" target="_blank" rel="external">Markdownè¯­æ³•è¯¦è§£</a></p>
<ol>
<li><strong>å¦‚ä½•è®¾ç½®å­—ä½“<font size="5" color="red"><em>å¤§</em></font><font size="2" color="blue"><em>å°</em></font></strong><br>ä½¿ç”¨<strong><em>html font</em></strong>â€¦æˆ‘ä»¥ä¸ºä¼šæœ‰ç®€å•çš„æ–¹æ³•â€¦(è¿™æ ·çš„è¯ä¸‹é¢å‡ ç‚¹ä¹Ÿå°±ä¸ä»‹ç»äº†ï¼Œmarkdownæ— æ³•å®Œæˆçš„å°±è€è€å®å®ç”¨htmläº†)</li>
<li><strong>å›¾ç‰‡ä½ç½®è°ƒæ•´</strong><br>ä½¿ç”¨<strong>&lt;img&gt;</strong>æ ‡ç­¾</li>
<li><strong>ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰</strong><br>è½¬ä¹‰ç”¨ <strong>\</strong><br>example : <strong>åŠ ç²—çš„ä¸¤ä¸ªæ˜Ÿå·</strong> <strong>**</strong>  (<strong>**\*\***</strong>)</li>
</ol>
]]></content>
      
        <categories>
            
            <category> æ‚ä¸ƒæ‚å…« </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Hello Hexo]]></title>
      <url>/2015/07/21/Hello-Hexo/</url>
      <content type="html"><![CDATA[<p>#Hexo</p>
<p><strong>Markdown?</strong></p>
<p>è¿˜åœ¨æ‰¾æ›´ç®€æ´ï¼Œç®€å•çš„å†™ä½œæ–¹å¼ï¼Œé¡ºä¾¿åˆ æ‰è‡ªå¸¦çš„hello world. è¯è¯´ï¼Œå¦‚ä½•æ’å›¾ï¼Ÿ</p>
]]></content>
      
        <categories>
            
            <category> æ‚ä¸ƒæ‚å…« </category>
            
        </categories>
        
        
    </entry>
    
  
  
    
    <entry>
      <title><![CDATA[Controls]]></title>
      <url>/about/controls.html</url>
      <content type="html"><![CDATA[<h2 id="é¡¹ç›®ç®€ä»‹"><a href="#é¡¹ç›®ç®€ä»‹" class="headerlink" title="é¡¹ç›®ç®€ä»‹"></a>é¡¹ç›®ç®€ä»‹</h2><p><strong>Controls</strong> æ˜¯æ‰‹æœºAppå’ŒWebé€šä¿¡çš„ç³»ç»Ÿã€‚å¯ä»¥é€šè¿‡ä»–ã€‚æ¥å®ç° Appæ§åˆ¶Webç«¯çš„å›¾ç‰‡ è¿™ä¸€åŠŸèƒ½ã€‚</p>
<p>å®ƒçš„ä¸»è¦åŠŸèƒ½æœ‰ï¼š</p>
<ol>
<li>é€šè¿‡æ“ä½œControlsï¼Œåœ¨Webä¸Šé¢æ˜¾ç¤ºç‰¹å®šçš„å›¾ç‰‡</li>
<li>é€šè¿‡æ“ä½œControlsï¼Œæ§åˆ¶Webç«¯å›¾ç‰‡çš„ç¼©æ”¾</li>
<li>é€šè¿‡æ“ä½œControlsï¼Œåœ¨Webç«¯çš„å›¾ç‰‡ä¸Šé¢æ‰“æ ‡è®°</li>
</ol>
<p>è¯¥é¡¹ç›®å¯ä»¥ç®—æ˜¯<a href="/about/sciencewall.html">ScienceWall</a>çš„ä¸€ä¸ªå­é¡¹ç›®</p>
<h2 id="ä¸»è¦å·¥ä½œ"><a href="#ä¸»è¦å·¥ä½œ" class="headerlink" title="ä¸»è¦å·¥ä½œ"></a>ä¸»è¦å·¥ä½œ</h2><p>è¯¥é¡¹ç›®ç”±æˆ‘å’Œä¸€åå‰ç«¯åŒå­¦ä»¥åŠä¸€åAndroidç«¯åŒå­¦å…±åŒå®Œæˆï¼Œæˆ‘æ˜¯è¿™ä¸ªé¡¹ç›®çš„ç»„é•¿ã€‚ä¸»è¦çš„å·¥ä½œæœ‰ï¼š</p>
<ol>
<li>ä½¿ç”¨Node.jsæ­å»ºç§»åŠ¨ç«¯å’ŒWebä¹‹é—´çš„åç«¯é€šä¿¡æœåŠ¡å™¨</li>
<li>æ­å»ºiOSå®¢æˆ·ç«¯ï¼Œä½¿ç”¨SocketIOç¬¬ä¸‰æ–¹åº“å®ç°ä¸Node.jsæœåŠ¡å™¨çš„é€šä¿¡</li>
</ol>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p><strong>æ³¨ï¼šiOSç«¯Demoè¿è¡Œåœ¨iPad mini4çœŸæœºä¸Šé¢ï¼› å¦å¤–Demoè§†é¢‘åŠ è½½è¿‡ç¨‹ä¸­å¯èƒ½æœ‰äº›å¡é¡¿ï¼Œè§†é¢‘åŠ è½½å®Œä¹‹åå†æ’­æ”¾ï¼Œæ•ˆæœæ›´ä½³ï¼</strong></p>
<p><strong>PS ï¼šAndroidç«¯åŒå­¦æ¯•ä¸šå•¦ï¼Œå°±ä¸æ¼”ç¤ºäº†ï¼›æ•ˆæœå’ŒiPadç±»ä¼¼</strong></p>
<p>å…ˆæ¥çœ‹çœ‹iPadå’ŒWebåŒæ—¶å½•åˆ¶çš„æ•ˆæœï¼š</p>
<video width="650" height="488" src="http://ota80mtsn.bkt.clouddn.com/demo" controls></video>

<h3 id="iPadç«¯"><a href="#iPadç«¯" class="headerlink" title="iPadç«¯"></a>iPadç«¯</h3><p>æ“ä½œiPadä¸Šé¢çš„å›¾ç‰‡ï¼Œæ‰€åšçš„æ“ä½œä¼šè‡ªåŠ¨åŒæ­¥åˆ°Webæµè§ˆå™¨ä¸Šé¢</p>
<video width="650" height="488" src="http://ota80mtsn.bkt.clouddn.com/controls1" controls></video>

<h3 id="Webç«¯"><a href="#Webç«¯" class="headerlink" title="Webç«¯"></a>Webç«¯</h3><p>Webç«¯å½•å±çš„æ—¶å€™ç›´æ¥å½•åˆ¶çš„GIFï¼Œè²Œä¼¼æœ‰ç‚¹å¤§=ã€‚=</p>
<p><img src="/lionheart/1707/webPort.gif" alt="Web Port"></p>
<p><strong>å¯ä»¥çœ‹åˆ°ï¼šå½“åœ¨iPadä¸Šå†™ä¸‹ â€œä½ å¥½â€ æ—¶ï¼Œåœ¨webç«¯å›¾ç‰‡çš„ç›¸åŒä½ç½®ä¹Ÿä¼šè‡ªåŠ¨å†™å‡º â€œä½ å¥½â€ï¼</strong></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å°±æ„Ÿè§‰è¿™åšå‡ºæ¥çš„æ•ˆæœå¾ˆå¥½ç©~~</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Genome Browser]]></title>
      <url>/about/genome-browser.html</url>
      <content type="html"><![CDATA[<h2 id="é¡¹ç›®ç®€ä»‹"><a href="#é¡¹ç›®ç®€ä»‹" class="headerlink" title="é¡¹ç›®ç®€ä»‹"></a>é¡¹ç›®ç®€ä»‹</h2><p><strong>Genome Browser</strong> æ˜¯ä¸€ä¸ªå±•ç¤ºåŸºå› ç»„æ•°æ®çš„å¯è§†åŒ–iOS APPã€‚è¯¥APPçš„ä¸»è¦åŠŸèƒ½å°±æ˜¯è§£æåºå¤§çš„åŸºå› ç»„æ•°æ®ï¼Œå†å°†æ‰€éœ€çš„éƒ¨åˆ†å¯è§†åŒ–çš„å±•ç¤ºå‡ºæ¥ã€‚</p>
<p>Webç«¯æœ‰å¤šä¸ªå¼€æºçš„Genome Browserï¼Œæˆ‘ä»¬å‚è€ƒäº†<a href="https://jbrowse.org/" target="_blank" rel="external">JBrowse</a>çš„å®ç°æ–¹å¼</p>
<h2 id="ä¸»è¦å·¥ä½œ"><a href="#ä¸»è¦å·¥ä½œ" class="headerlink" title="ä¸»è¦å·¥ä½œ"></a>ä¸»è¦å·¥ä½œ</h2><p>æˆ‘çš„ä¸»è¦å·¥ä½œæ˜¯è´Ÿè´£å‰æœŸçš„è°ƒç ”ï¼Œä»¥åŠåç»­çš„iOSå¼€å‘ã€‚</p>
<h3 id="å‰æœŸå‡†å¤‡å·¥ä½œ"><a href="#å‰æœŸå‡†å¤‡å·¥ä½œ" class="headerlink" title="å‰æœŸå‡†å¤‡å·¥ä½œ"></a>å‰æœŸå‡†å¤‡å·¥ä½œ</h3><h4 id="JBrowseæºç é˜…è¯»"><a href="#JBrowseæºç é˜…è¯»" class="headerlink" title="JBrowseæºç é˜…è¯»"></a>JBrowseæºç é˜…è¯»</h4><p>äº†è§£JBrowseçš„å¤§ä½“å·¥ä½œæµç¨‹ï¼Œä»¥ä¾¿æˆ‘ä»¬è‡ªå·±APPçš„å¼€å‘ã€‚ä¸»è¦æ˜¯JavaScriptçš„æºç ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­è¿˜è¦æ„Ÿè°¢å®éªŒå®¤å‰ç«¯åŒå­¦çš„å¸®åŠ©ã€‚</p>
<h4 id="htslibæºç ä¿®æ”¹ä»¥åŠäº¤å‰ç¼–è¯‘"><a href="#htslibæºç ä¿®æ”¹ä»¥åŠäº¤å‰ç¼–è¯‘" class="headerlink" title="htslibæºç ä¿®æ”¹ä»¥åŠäº¤å‰ç¼–è¯‘"></a>htslibæºç ä¿®æ”¹ä»¥åŠäº¤å‰ç¼–è¯‘</h4><p>htslibæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹å¼€æºåº“ï¼Œä¸»è¦åŠŸèƒ½å°±æ˜¯<strong>è§£æå­˜æ”¾åœ¨è¿œç«¯çš„åºå¤§çš„åŸºå› ç»„æ•°æ®</strong>ã€‚</p>
<p>æˆ‘éœ€è¦ä¿®æ”¹éƒ¨åˆ†æºä»£ç ä»¥é€‚åº”æˆ‘ä»¬è‡ªå·±çš„éœ€æ±‚ï¼›å¹¶å°†å…¶ç¼–è¯‘æˆiOSçš„é™æ€åº“ï¼Œä»¥ä¾›æˆ‘ä»¬çš„APPæ¥ä½¿ç”¨ã€‚</p>
<p>htslibæä¾›äº†ä¸€ä¸ªMakefileæ–‡ä»¶ï¼Œåœ¨PCç«¯ä½¿ç”¨çš„è¯ï¼Œç®€å•çš„ç¼–è¯‘ä¸‰éƒ¨æ›²å°±å¯ä»¥ç”ŸæˆPCæ‰€éœ€çš„åº“ã€‚ä½†æ˜¯æˆ‘ä»¬è¦å°†å®ƒç¼–è¯‘æˆiOSå¯ç”¨çš„åº“ï¼Œå°±éœ€è¦ä¿®æ”¹Makefileï¼š</p>
<ol>
<li>ä¿®æ”¹æ‰€ç”¨çš„ç¼–è¯‘å™¨</li>
<li>ä¿®æ”¹ä¾èµ–çš„ç³»ç»Ÿåº“çš„è·¯å¾„</li>
<li>è¯¥åº“ç¼–è¯‘æ‰€ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ä¹Ÿå¿…é¡»æ˜¯iOSå¯ç”¨çš„ç¬¬ä¸‰æ–¹åº“</li>
<li>ç­‰ç­‰â€¦</li>
</ol>
<h3 id="åç»­iOSå¼€å‘"><a href="#åç»­iOSå¼€å‘" class="headerlink" title="åç»­iOSå¼€å‘"></a>åç»­iOSå¼€å‘</h3><p>ä¸»è¦å·¥ä½œï¼š</p>
<ol>
<li>è°ƒç”¨ä¸Šé¢ç¼–è¯‘çš„<strong>htslib.a</strong>ï¼Œè§£æè¿œç«¯çš„ç”Ÿç‰©æ•°æ®</li>
<li>åœ¨æœ¬åœ°ä½¿ç”¨<strong>FMDB</strong>ç¼“å­˜è§£æçš„æ•°æ®</li>
<li>ä½¿ç”¨<strong>OpenGL ES</strong>ç»˜åˆ¶è§£æçš„æ•°æ®</li>
</ol>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p><strong>JBrowseå®ç°æ•ˆæœ</strong></p>
<p><img src="/lionheart/1707/jbrowse.png" alt="JBrowse"></p>
<p>å¯ä»¥çœ‹åˆ°JBrowseå¯ä»¥æ˜¾ç¤º3ç§åŸºå› ç»„æ•°æ®ï¼š</p>
<ol>
<li>FASTA ï¼šDNAçš„ç¢±åŸºåºåˆ—</li>
<li>BAM ï¼š DNAæµ‹åºç‰‡æ®µ</li>
<li>VCF ï¼š DNAæµ‹åºæ£€æµ‹å‡ºæ¥çš„åŸºå› å˜å¼‚</li>
</ol>
<p><strong>æˆ‘ä»¬è‡ªå·±çš„å®ç°æ•ˆæœ</strong></p>
<p><img src="/lionheart/1707/atcg.gif" alt="fasta"></p>
<p><img src="/lionheart/1707/bam.gif" alt="bam"></p>
<p>è¯¥é¡¹ç›®è¿›è¡Œåˆ°ä¸€åŠå°±æ²¡æœ‰ç»§ç»­äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªå®ç°äº†FASTAå’ŒBAMæ•°æ®çš„åŸºæœ¬æ˜¾ç¤ºã€‚æ˜¾ç¤ºå…¨éƒ¨ä½¿ç”¨OpenGL ESæ¥å®ç°ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è™½ç„¶è¿™ä¸ªé¡¹ç›®åˆšèµ·æ­¥ä¸ä¹…ï¼Œå°±æ²¡å†ç»§ç»­ä¸‹å»äº†ï¼›ä½†æ˜¯ä¹Ÿç»™åç»­çš„é¡¹ç›®<a href="/about/gene-plus.html">Gene Plus</a>å¥ å®šäº†ä¸€å®šçš„åŸºç¡€ã€‚ç¡¬è¦è¯´æ”¶è·ï¼Œé‚£å°±æ˜¯ï¼š</p>
<ol>
<li>è¿›ä¸€æ­¥äº†è§£äº†JavaScriptä»¥åŠå®ƒçš„è°ƒè¯•</li>
<li>æŒæ¡äº†åœ¨Macä¸Šé¢äº¤å‰ç¼–è¯‘iOSé™æ€åº“</li>
<li>å·©å›ºäº†OpenGL ESç»˜åˆ¶çš„åŸºæœ¬çŸ¥è¯†</li>
<li>é¡ºå¸¦äº†è§£äº†äº›å…³äºåŸºå› ç»„çš„ç”Ÿç‰©çŸ¥è¯†=ã€‚=</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://jbrowse.org/" target="_blank" rel="external">JBrowse</a></li>
<li><a href="https://github.com/GMOD/jbrowse" target="_blank" rel="external">JBrowseæºç </a></li>
<li><a href="https://github.com/samtools/htslib" target="_blank" rel="external">htslib</a></li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Gene Plus]]></title>
      <url>/about/gene-plus.html</url>
      <content type="html"><![CDATA[<h2 id="é¡¹ç›®ç®€ä»‹"><a href="#é¡¹ç›®ç®€ä»‹" class="headerlink" title="é¡¹ç›®ç®€ä»‹"></a>é¡¹ç›®ç®€ä»‹</h2><p><strong>Gene Plus</strong> æ˜¯ä¸ºGenePluså…¬å¸å¼€å‘çš„ä¸€ä¸ªåŸºäºåŸºå› æ£€æµ‹æŠ¥å‘Šçš„iPadç«¯çš„ååŒå¹³å°ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p>
<ol>
<li>åŸºå› æ£€æµ‹æŠ¥å‘Šçš„æ˜¾ç¤º</li>
<li>åŒ»ç”Ÿï¼Œç—…äººå’ŒåŸºå› åˆ†æå¸ˆ ä¸‰è€…ä¹‹é—´çš„ååŒ</li>
</ol>
<h2 id="ä¸»è¦å·¥ä½œ"><a href="#ä¸»è¦å·¥ä½œ" class="headerlink" title="ä¸»è¦å·¥ä½œ"></a>ä¸»è¦å·¥ä½œ</h2><p>è¿™ä¸ªé¡¹ç›®ç”±4ä¸ªäººå¼€å‘å®Œæˆï¼Œæˆ‘æ˜¯è¿™ä¸ªé¡¹ç›®çš„ç»„é•¿ã€‚æˆ‘çš„ä¸»è¦å·¥ä½œæœ‰ï¼š</p>
<ol>
<li>éƒ¨ç½²Gitä¸å…¶ä»–ç»„å‘˜ååŒå¼€å‘ï¼Œæ­å»ºAPPçš„æ•´ä½“æ¡†æ¶</li>
<li>ä½¿ç”¨Core Animationç­‰ç»˜åˆ¶ç—…äººåŸºå› æ£€æµ‹æŠ¥å‘Šä¸Šé¢çš„æ•°æ®ï¼Œå¹¶ä½¿è¿™äº›æ•°æ®å¯ä»¥äº¤äº’</li>
<li>åœ¨iOSä¸Šæ­å»ºåŒ»ç”Ÿï¼Œç—…äººï¼ŒåŸºå› åˆ†æå¸ˆä¸‰è€…çš„ååŒå¹³å°</li>
</ol>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p><strong>æ³¨ï¼šDemoè¿è¡Œåœ¨iPad mini4çœŸæœºä¸Šé¢ï¼› å¦å¤–Demoè§†é¢‘åŠ è½½è¿‡ç¨‹ä¸­å¯èƒ½æœ‰äº›å¡é¡¿ï¼Œè§†é¢‘åŠ è½½å®Œä¹‹åå†æ’­æ”¾ï¼Œæ•ˆæœæ›´ä½³ï¼</strong></p>
<h3 id="ä¸»è¦ç•Œé¢å±•ç¤º"><a href="#ä¸»è¦ç•Œé¢å±•ç¤º" class="headerlink" title="ä¸»è¦ç•Œé¢å±•ç¤º"></a>ä¸»è¦ç•Œé¢å±•ç¤º</h3><p><img src="/lionheart/1707/gp7.png" alt="gp"></p>
<p><img src="/lionheart/1707/gp1.png" alt="gp"></p>
<p><img src="/lionheart/1707/gp2.png" alt="gp"></p>
<p><img src="/lionheart/1707/gp3.png" alt="gp"></p>
<p><img src="/lionheart/1707/gp4.png" alt="gp"></p>
<p><img src="/lionheart/1707/gp5.png" alt="gp"></p>
<p><img src="/lionheart/1707/gp6.png" alt="gp"></p>
<h3 id="è§†é¢‘Demo"><a href="#è§†é¢‘Demo" class="headerlink" title="è§†é¢‘Demo"></a>è§†é¢‘Demo</h3><h4 id="ä¸»ä½“ç•Œé¢éƒ¨åˆ†"><a href="#ä¸»ä½“ç•Œé¢éƒ¨åˆ†" class="headerlink" title="ä¸»ä½“ç•Œé¢éƒ¨åˆ†"></a>ä¸»ä½“ç•Œé¢éƒ¨åˆ†</h4><video width="650" height="488" src="http://ota80mtsn.bkt.clouddn.com/gpmain1" controls></video>

<h4 id="æŠ¥å‘Šæ˜¾ç¤ºéƒ¨åˆ†"><a href="#æŠ¥å‘Šæ˜¾ç¤ºéƒ¨åˆ†" class="headerlink" title="æŠ¥å‘Šæ˜¾ç¤ºéƒ¨åˆ†"></a>æŠ¥å‘Šæ˜¾ç¤ºéƒ¨åˆ†</h4><video width="650" height="488" src="http://ota80mtsn.bkt.clouddn.com/gpdataviz1" controls></video>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¹‹å‰<a href="/about/genome-browser.html">Genome Browser</a>è‰è‰æ”¶åœºï¼Œå°±æ˜¯ä¸ºäº†å¼€å‘è¿™ä¸ªAPPï¼›ä¸è¿‡ä¹‹å‰çš„ç”Ÿç‰©çŸ¥è¯†çš„ç§¯ç´¯è¿˜æ˜¯å¯¹è¿™ä¸ªé¡¹ç›®æœ‰å¾ˆå¤§çš„å¸®åŠ©çš„ï¼Œä¸ç®—ç™½å¹²=ã€‚=</p>
<p>è¿™ä¸ªé¡¹ç›®çš„äº®ç‚¹å°±åœ¨äºï¼šåŸºå› æ£€æµ‹æŠ¥å‘Šçš„æ•°æ®å¯è§†åŒ–æ˜¾ç¤ºä¸Šé¢ã€‚å®ƒå°†æ¯ç‡¥çš„æŠ¥å‘Šï¼Œä»¥ç”ŸåŠ¨çš„å½¢å¼å±•ç°äº†å‡ºæ¥ï¼Œæ˜¾å¾—ç®€å•æ˜“æ‡‚ã€‚</p>
<p><strong>æ•´ä¸ªAPPçš„å®ç°è¿‡ç¨‹ä¸­ï¼Œå¯¹äºiOSçš„æ˜¾ç¤ºä»¥åŠç»˜åˆ¶ç­‰é—®é¢˜æœ‰äº†æ›´æ·±åˆ»çš„ç†è§£ï¼</strong></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[iD3]]></title>
      <url>/about/iD3.html</url>
      <content type="html"><![CDATA[<h2 id="é¡¹ç›®ç®€ä»‹"><a href="#é¡¹ç›®ç®€ä»‹" class="headerlink" title="é¡¹ç›®ç®€ä»‹"></a>é¡¹ç›®ç®€ä»‹</h2><p><strong>iD3</strong> æ˜¯ä¸€ä¸ªiOSä¸Šé¢çš„æ•°æ®å¯è§†åŒ–æ¡†æ¶ã€‚å®ƒçš„å®ç°å‚è€ƒäº†è‘—åçš„JavaScriptå¼€æºåº“ï¼š<a href="https://d3js.org/" target="_blank" rel="external">D3</a></p>
<p><strong>iD3å°½é‡ä¿æŒä¸D3ä¸€æ ·çš„APIï¼›è®©ä½¿ç”¨è€…åªéœ€è¦è¾“å…¥æ•°æ®ï¼Œå¹¶ä¸”è°ƒç”¨ç®€å•çš„æ¥å£ï¼Œå°±å¯ä»¥åœ¨iOSè®¾å¤‡ä¸Šæ˜¾ç¤ºä¸°å¯Œçš„å›¾å½¢ã€‚</strong></p>
<h2 id="ä¸»è¦åŠŸèƒ½"><a href="#ä¸»è¦åŠŸèƒ½" class="headerlink" title="ä¸»è¦åŠŸèƒ½"></a>ä¸»è¦åŠŸèƒ½</h2><p>è¿™ä¸ªå¯è§†åŒ–æ¡†æ¶æ‰€åšçš„äº‹æƒ…æ¦‚æ‹¬ä¸‹æ¥æœ‰ä»¥ä¸‹3ç‚¹ï¼š</p>
<ol>
<li>å¯¹è¾“å…¥çš„æ•°æ®è¿›è¡Œè§£æï¼›æ”¯æŒå¤šç§ç±»å‹çš„è¾“å…¥æ•°æ®ï¼šJSONï¼ŒCSVç­‰ç­‰</li>
<li>ä½¿ç”¨Objective-Cé‡å†™D3çš„é€»è¾‘ï¼Œæ¥å¯¹è§£æå®Œæ•°æ®åšè¿›ä¸€æ­¥çš„å¤„ç†</li>
<li>ä½¿ç”¨OpenGL ESæˆ–è€…Core Animationç­‰å·¥å…·ï¼Œå°†å¤„ç†å®Œçš„æ•°æ®æ˜¾ç¤ºå‡ºæ¥</li>
</ol>
<h2 id="é¡¹ç›®è¿›å±•"><a href="#é¡¹ç›®è¿›å±•" class="headerlink" title="é¡¹ç›®è¿›å±•"></a>é¡¹ç›®è¿›å±•</h2><p>D3æ˜¯ä¸€ä¸ªåºå¤§çš„ï¼Œä½†æ˜¯æ¨¡å—éå¸¸æ¸…æ™°çš„å¼€æºåº“ã€‚å®ƒåŒ…æ‹¬5å¤§å›¾å½¢æ¨¡å—å’Œè®¸è®¸å¤šå¤šçš„åŸºç¡€æ¨¡å—ã€‚</p>
<p>iD3ä¹Ÿæ˜¯å‚ç…§D3çš„å„ä¸ªæ¨¡å—æ¥ä¸€æ¬¡å®ç°çš„ã€‚ç›®å‰å®Œæˆäº†<strong>å¤§éƒ¨åˆ†åŸºç¡€æ¨¡å—å’Œ4å¤§å›¾å½¢æ¨¡å—</strong>ï¼š</p>
<ol>
<li><strong>D3-Chord</strong> å¼¦å›¾</li>
<li><strong>D3-Force</strong> åŠ›å¯¼å›¾</li>
<li><strong>D3-Hierarchy</strong> å±‚çº§å›¾</li>
<li><strong>D3-Shape</strong> åŸºæœ¬å›¾å½¢</li>
</ol>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p><strong>æ³¨ï¼šæ‰€æœ‰Demoå‡è¿è¡Œåœ¨iPad mini4çœŸæœºä¸Šé¢ï¼› å¦å¤–Demoè§†é¢‘åŠ è½½è¿‡ç¨‹ä¸­å¯èƒ½æœ‰äº›å¡é¡¿ï¼Œè§†é¢‘åŠ è½½å®Œä¹‹åå†æ’­æ”¾ï¼Œæ•ˆæœæ›´ä½³ï¼</strong></p>
<h3 id="D3-Chord"><a href="#D3-Chord" class="headerlink" title="D3-Chord"></a>D3-Chord</h3><p><strong>Chord(å¼¦å›¾)ï¼Œä¸»è¦ç”¨äºè¡¨ç¤ºä¸¤ä¸¤èŠ‚ç‚¹ä¹‹é—´çš„è”ç³»</strong></p>
<p>D3å®˜ç½‘ä¸Šé¢chordçš„demoï¼š<a href="https://bl.ocks.org/mbostock/4062006" target="_blank" rel="external">Chord Diagram</a></p>
<p>åŸå§‹æ•°æ®æ˜¯ä¸€ä¸ªçŸ©é˜µï¼š</p>
<pre><code> 11975,  5871, 8916, 2868,
  1951, 10048, 2060, 6171,
  8010, 16145, 8090, 8045,
  1013,   990,  940, 6907
</code></pre><p>ä½¿ç”¨iD3å®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼š</p>
<video width="650" height="488" src="http://ota80mtsn.bkt.clouddn.com/chord1" controls></video>

<h3 id="D3-Force"><a href="#D3-Force" class="headerlink" title="D3-Force"></a>D3-Force</h3><p><strong>Force(åŠ›å¯¼å›¾)å›¾ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½å—åˆ°åŠ›çš„ä½œç”¨è€Œè¿åŠ¨ï¼Œè¿™ç§æ˜¯ä¸€ç§éå¸¸ç»šä¸½çš„å›¾è¡¨ã€‚</strong> iD3ä½¿ç”¨OpenGL ESæ¥ç»˜åˆ¶åŠ›å¯¼å›¾ã€‚</p>
<p>D3å®˜ç½‘ä¸Šé¢forceçš„demoï¼š<a href="https://bl.ocks.org/mbostock/4062045" target="_blank" rel="external">Force-Directed Graph</a></p>
<p>åŸå§‹æ•°æ®è¡¨ç¤ºçš„æ˜¯èŠ‚ç‚¹ä»¥åŠèŠ‚ç‚¹ä¹‹é—´çš„è”ç³»ï¼š</p>
<pre><code class="json">// node.json
[
    {&quot;id&quot;: &quot;Myriel&quot;, &quot;group&quot;: 1},
    {&quot;id&quot;: &quot;Napoleon&quot;, &quot;group&quot;: 1},
    {&quot;id&quot;: &quot;Mlle.Baptistine&quot;, &quot;group&quot;: 1},
    {&quot;id&quot;: &quot;Mme.Magloire&quot;, &quot;group&quot;: 1},
    {&quot;id&quot;: &quot;CountessdeLo&quot;, &quot;group&quot;: 1},
    {&quot;id&quot;: &quot;Geborand&quot;, &quot;group&quot;: 1},
    {&quot;id&quot;: &quot;Champtercier&quot;, &quot;group&quot;: 1},
    {&quot;id&quot;: &quot;Cravatte&quot;, &quot;group&quot;: 1},
    {&quot;id&quot;: &quot;Count&quot;, &quot;group&quot;: 1},
    {&quot;id&quot;: &quot;OldMan&quot;, &quot;group&quot;: 1},
    {&quot;id&quot;: &quot;Labarre&quot;, &quot;group&quot;: 2},
    //  more data
}

// link.json
[
  {&quot;source&quot;: &quot;Napoleon&quot;, &quot;target&quot;: &quot;Myriel&quot;, &quot;value&quot;: 1},
  {&quot;source&quot;: &quot;Mlle.Baptistine&quot;, &quot;target&quot;: &quot;Myriel&quot;, &quot;value&quot;: 8},
  {&quot;source&quot;: &quot;Mme.Magloire&quot;, &quot;target&quot;: &quot;Myriel&quot;, &quot;value&quot;: 10},
  {&quot;source&quot;: &quot;Mme.Magloire&quot;, &quot;target&quot;: &quot;Mlle.Baptistine&quot;, &quot;value&quot;: 6},
  {&quot;source&quot;: &quot;CountessdeLo&quot;, &quot;target&quot;: &quot;Myriel&quot;, &quot;value&quot;: 1},
  {&quot;source&quot;: &quot;Geborand&quot;, &quot;target&quot;: &quot;Myriel&quot;, &quot;value&quot;: 1},
  {&quot;source&quot;: &quot;Champtercier&quot;, &quot;target&quot;: &quot;Myriel&quot;, &quot;value&quot;: 1},
  {&quot;source&quot;: &quot;Cravatte&quot;, &quot;target&quot;: &quot;Myriel&quot;, &quot;value&quot;: 1},
  {&quot;source&quot;: &quot;Count&quot;, &quot;target&quot;: &quot;Myriel&quot;, &quot;value&quot;: 2},
  {&quot;source&quot;: &quot;OldMan&quot;, &quot;target&quot;: &quot;Myriel&quot;, &quot;value&quot;: 1},
  {&quot;source&quot;: &quot;Valjean&quot;, &quot;target&quot;: &quot;Labarre&quot;, &quot;value&quot;: 1},
  // more data
]
</code></pre>
<p>ä½¿ç”¨iD3å®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼š</p>
<video width="650" height="488" src="http://ota80mtsn.bkt.clouddn.com/force1" controls></video>

<h3 id="D3-Hierarchy"><a href="#D3-Hierarchy" class="headerlink" title="D3-Hierarchy"></a>D3-Hierarchy</h3><p><strong>Hierarchy(å±‚çº§å›¾)ç”¨æ¥å±•ç¤ºå…·æœ‰å±‚çº§ç»“æ„çš„æ•°æ®</strong>ï¼Œæœ‰å¤šç§å±•ç°çš„å½¢å¼ï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li><a href="https://bl.ocks.org/mbostock/4739610f6d96aaad2fb1e78a72b385ab" target="_blank" rel="external">cluster</a></li>
<li><a href="https://bl.ocks.org/mbostock/ca5b03a33affa4160321" target="_blank" rel="external">pack</a></li>
<li><a href="https://bl.ocks.org/mbostock/4339184" target="_blank" rel="external">tree</a></li>
<li><a href="https://bl.ocks.org/mbostock/4063582" target="_blank" rel="external">treemap</a></li>
</ol>
<p>åŸå§‹æ•°æ®å…·æœ‰å±‚çº§ç»“æ„ï¼š</p>
<pre><code class="json">{
 &quot;name&quot;: &quot;flare&quot;,
 &quot;children&quot;: [
  {
   &quot;name&quot;: &quot;analytics&quot;,
   &quot;children&quot;: [
    {
     &quot;name&quot;: &quot;cluster&quot;,
     &quot;children&quot;: [
      {&quot;name&quot;: &quot;AgglomerativeCluster&quot;, &quot;size&quot;: 3938},
      {&quot;name&quot;: &quot;CommunityStructure&quot;, &quot;size&quot;: 3812},
      {&quot;name&quot;: &quot;HierarchicalCluster&quot;, &quot;size&quot;: 6714},
      {&quot;name&quot;: &quot;MergeEdge&quot;, &quot;size&quot;: 743}
     ]
    },
    {
     &quot;name&quot;: &quot;graph&quot;,
     &quot;children&quot;: [
      {&quot;name&quot;: &quot;BetweennessCentrality&quot;, &quot;size&quot;: 3534},
      {&quot;name&quot;: &quot;LinkDistance&quot;, &quot;size&quot;: 5731},
      {&quot;name&quot;: &quot;MaxFlowMinCut&quot;, &quot;size&quot;: 7840},
      {&quot;name&quot;: &quot;ShortestPaths&quot;, &quot;size&quot;: 5914},
      {&quot;name&quot;: &quot;SpanningTree&quot;, &quot;size&quot;: 3416}
     ]
    },
    {
     &quot;name&quot;: &quot;optimization&quot;,
     &quot;children&quot;: [
      {&quot;name&quot;: &quot;AspectRatioBanker&quot;, &quot;size&quot;: 7074}
     ]
    }
   ]
  },
// more data
]
</code></pre>
<p>ä½¿ç”¨iD3å®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼š</p>
<video width="650" height="488" src="http://ota80mtsn.bkt.clouddn.com/hierarchy1" controls></video>

<h3 id="D3-Shape"><a href="#D3-Shape" class="headerlink" title="D3-Shape"></a>D3-Shape</h3><p><strong>Shapeç”¨æ¥ç”ŸæˆåŸºæœ¬å›¾å½¢</strong>ï¼Œå¯ä»¥ç”Ÿæˆå¤šç§åŸºæœ¬å›¾å½¢ï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li><a href="https://bl.ocks.org/mbostock/8878e7fd82034f1d63cf" target="_blank" rel="external">pie é¥¼å›¾</a></li>
<li><a href="https://bl.ocks.org/mbostock/1550e57e12e73b86ad9e" target="_blank" rel="external">line æŠ˜çº¿å›¾</a></li>
<li><a href="https://bl.ocks.org/mbostock/3035090" target="_blank" rel="external">area é¢ç§¯å›¾å½¢</a></li>
<li><a href="https://bl.ocks.org/mbostock/3885211" target="_blank" rel="external">stack å¤šç§åŸºæœ¬å›¾å½¢å †å è€Œæˆå›¾å½¢</a></li>
<li>symbol è‡ªå®šä¹‰å›¾å½¢</li>
</ol>
<p>ä½¿ç”¨iD3å®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼š</p>
<video width="650" height="488" src="http://ota80mtsn.bkt.clouddn.com/shape1" controls></video>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ä¸ªåº“ç®—æ˜¯è‡ªå·±å†™çš„ç¬¬ä¸€ä¸ªå¤§å‹çš„åº“äº†ï¼Œå¾ˆå¤šåœ°æ–¹è¿˜æœ‰å¾…å®Œå–„ã€‚</p>
<p>ä¸»è¦çš„æ•°æ®å¤„ç†æ¨¡å—å€Ÿé‰´äº†D3ï¼Œæ„Ÿå—åˆ°äº†D3å¤„ç†æ•°æ®çš„å¨åŠ›ï¼Œæ¯•ç«Ÿè¿™æ˜¯ä¸€ä¸ªåœ¨Githubä¸Šæœ‰6ä¸‡å¤šstarçš„å¼€æºé¡¹ç›®å•Š=ã€‚=</p>
<p>ç”±äºD3ä½¿ç”¨SVGæ¥æ˜¾ç¤ºæ•°æ®ï¼Œæ‰€ä»¥åœ¨iOSä¸Šé¢å°±å¾—è‡ªå·±å®ç°ä¸€å¥—æ•°æ®çš„æ˜¾ç¤ºæ¨¡å—ï¼›è¿™é‡Œä¸»è¦è¿ç”¨äº†OpenGLï¼ŒCore Animationä»¥åŠCore Graphicsï¼Œå¹¶å°†å®ƒä»¬å°è£…æˆä¸€ä¸ªæ¨¡å—ç”¨æ¥é›†ä¸­æ˜¾ç¤ºæ•°æ®ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://d3js.org/" target="_blank" rel="external">D3 Data-Driven Documents</a></li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Signichat]]></title>
      <url>/about/signichat.html</url>
      <content type="html"><![CDATA[<h2 id="é¡¹ç›®ç®€ä»‹"><a href="#é¡¹ç›®ç®€ä»‹" class="headerlink" title="é¡¹ç›®ç®€ä»‹"></a>é¡¹ç›®ç®€ä»‹</h2><p><strong>Signichat</strong> æ˜¯ä¸€ä¸ªæä¾›<strong>å›¾ç‰‡åœ¨çº¿æµè§ˆï¼Œæ ‡è®°ï¼Œè®¨è®º</strong>çš„ä¼šè®®ç³»ç»Ÿã€‚</p>
<h2 id="ä¸»è¦å·¥ä½œ"><a href="#ä¸»è¦å·¥ä½œ" class="headerlink" title="ä¸»è¦å·¥ä½œ"></a>ä¸»è¦å·¥ä½œ</h2><p>è¿›å®éªŒå®¤çš„ç¬¬ä¸€ä¸ªé¡¹ç›®ï¼Œå…ˆæ˜¯è·Ÿåœ¨å­¦é•¿åé¢å†™ä¸€å†™PHPï¼›åæ¥å­¦é•¿æ¯•ä¸šäº†ï¼Œæˆ‘å°±æˆäº†åç«¯çš„è´Ÿè´£äºº=ã€‚=</p>
<p>ä¸»è¦å·¥ä½œæ˜¯ï¼š</p>
<ol>
<li>ç¼–å†™PHPä»£ç ï¼Œç»™å‰ç«¯å’Œç§»åŠ¨ç«¯æä¾›æ¥å£</li>
<li>NginxæœåŠ¡å™¨ï¼ŒMySQLæ•°æ®åº“è¿ç»´</li>
<li>ä½¿ç”¨PHPå®ç°å›¾ç‰‡å¤„ç†çš„æ•´ä¸ªæµç¨‹ï¼šå¤§å›¾ä¸Šä¼ EC2 -&gt; å›¾ç‰‡åˆ‡å‰² -&gt; å›¾ç‰‡å­˜å‚¨åˆ°S3</li>
<li>æ­å»ºNode.jsæœåŠ¡å™¨ï¼Œä½¿ç”¨WebRTCå®æ—¶è§†é¢‘èŠå¤©</li>
</ol>
<h2 id="ç›¸å…³åœ°å€"><a href="#ç›¸å…³åœ°å€" class="headerlink" title="ç›¸å…³åœ°å€"></a>ç›¸å…³åœ°å€</h2><p>Webç½‘ç«™ ï¼š <a href="http://www.signichat.com" target="_blank" rel="external">Signichat</a></p>
<p>APPä¸‹è½½ï¼š</p>
<ul>
<li><a href="https://itunes.apple.com/cn/app/signichat/id967104628?l=en&amp;mt=8" target="_blank" rel="external">iOSç«¯ä¸‹è½½ </a></li>
<li><a href="http://openbox.mobilem.360.cn/index/d/sid/2777089" target="_blank" rel="external">å®‰å“ç«¯ä¸‹è½½</a></li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[å…³äº]]></title>
      <url>/about/index.html</url>
      <content type="html"><![CDATA[<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯é»„ä¸–æ°ã€‚æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººæŠ€æœ¯åšå®¢ã€‚</p>
<p>è¿™ä¸ªåšå®¢ä¸»è¦è®°å½•äº†è‡ªå·±å¹³æ—¶ä¸€äº›ç¼–ç¨‹çš„å¿ƒå¾—å’Œä½“ä¼šï¼Œå½“ç„¶è¿˜æœ‰è¯»ä¹¦ç¬”è®°ï¼Œå¶å°”è¿˜ä¼šæœ‰äº›æ‚ä¸ƒæ‚å…«çš„ç”Ÿæ´»çäº‹ã€‚</p>
<p>æˆ‘æœ¬äººç›®å‰åœ¨åä¸­ç§‘æŠ€å¤§å­¦ç”µä¿¡å­¦é™¢è¯»ç ”ç©¶ç”Ÿï¼Œä¸»è¦ä»äº‹iOSå¼€å‘ã€‚ä¸‹é¢æ¥è¯´è¯´æˆ‘çš„æŠ€æœ¯å­¦ä¹ å†ç¨‹ï¼š</p>
<ul>
<li>å¤§ä¸€è‡³å¤§ä¸‰ï¼šä¸Šäº†Cè¯­è¨€çš„è¯¾ç¨‹ï¼Œç®—æ˜¯å…¥äº†ç¼–ç¨‹çš„é—¨ï¼›åæ¥è‡ªå­¦PHPï¼ŒJavaScriptï¼Œå€’è…¾äº†ä¸€æ®µæ—¶é—´çš„ç½‘ç«™å¼€å‘</li>
<li>å¤§å››ï¼šä¿ç ”åˆ°å®éªŒå®¤ä¹‹åå°±ä¸»è¦ä»äº‹åç«¯å¼€å‘ã€‚ä¸»è¦å·¥ä½œå°±æ˜¯ï¼šç¼–å†™PHPä»£ç ï¼ŒæœåŠ¡å™¨ä»¥åŠæ•°æ®åº“çš„è¿ç»´</li>
<li>ç ”ä¸€è‡³ç ”äºŒï¼šå¼€å§‹è½¬å‘iOSå¼€å‘ã€‚ä¹‹åå°±åŸºæœ¬ä¸Šå…¨èŒæŠ•å…¥åˆ°iOSæŠ€æœ¯çš„ç ”ç©¶ä¸­äº†ã€‚è¿™æœŸé—´ä¸åŒå­¦å®Œæˆäº†å¤šä¸ªæœ‰è¶£çš„é¡¹ç›®ï¼Œå¹¶å¤šæ¬¡æ‹…ä»»iOSç«¯è´Ÿè´£äºº</li>
<li>æœªæ¥ï¼šå†è¿›ä¸€æ­¥æå‡è‡ªå·±çš„iOSå¼€å‘æ°´å¹³ã€‚è¿˜æƒ³å­¦å­¦JavaScriptï¼ŒSwiftï¼ŒJavaç­‰å…¶ä»–è¯­è¨€ï¼Œæ¯•ç«ŸæŠ€å¤šä¸å‹èº«ï¼Œå¸Œæœ›èƒ½æˆä¸ºä¸€ä¸ªå¤§å‰ç«¯å¼€å‘äººå‘˜ã€‚å¦å¤–è¿˜æƒ³å»æ¥è§¦ä¸€ä¸‹ç›®å‰çš„æ–°å…´æŠ€æœ¯ï¼šAIï¼ŒVRï¼ŒARç­‰ï¼Œæ‹“å®½è‡ªå·±çš„çŸ¥è¯†é¢ã€‚</li>
</ul>
<p>æ¥çœ‹çœ‹ç›®å‰çš„æ­¦å™¨åº“ï¼š</p>
<ul>
<li>ç†Ÿæ‚‰Objective-Cç¼–ç¨‹</li>
<li>ç†Ÿæ‚‰PHPç¼–ç¨‹</li>
<li>äº†è§£C/C++</li>
<li>äº†è§£JavaScriptï¼Œ HTML/CSS</li>
<li>äº†è§£OpenGLä»¥åŠOpenGL ES</li>
<li>ç†Ÿæ‚‰Linuxä¸ŠWebæœåŠ¡å™¨è¿ç»´ï¼ŒMySQLè¿ç»´</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ScienceWall]]></title>
      <url>/about/sciencewall.html</url>
      <content type="html"><![CDATA[<h2 id="é¡¹ç›®ç®€ä»‹"><a href="#é¡¹ç›®ç®€ä»‹" class="headerlink" title="é¡¹ç›®ç®€ä»‹"></a>é¡¹ç›®ç®€ä»‹</h2><p><strong>ScienceWall</strong> æ˜¯ä¸ºç§‘ç ”äººå‘˜æ‰“é€ çš„ä¸€ä¸ª<strong>åœ¨çº¿æµè§ˆå¤§å›¾ï¼Œæ ‡è®°ï¼Œè®¨è®º</strong>çš„å¹³å°ã€‚</p>
<h2 id="ä¸»è¦å·¥ä½œ"><a href="#ä¸»è¦å·¥ä½œ" class="headerlink" title="ä¸»è¦å·¥ä½œ"></a>ä¸»è¦å·¥ä½œ</h2><p>è½¬iOSå¼€å‘ä¹‹åï¼Œå‚ä¸çš„ç¬¬ä¸€ä¸ªé¡¹ç›®</p>
<p>ä¸»è¦å·¥ä½œæ˜¯ï¼š</p>
<ol>
<li>ä¸å…¶ä»–æˆå‘˜ä¸€åŒç¼–å†™iOSç«¯APP</li>
<li>åå°è´Ÿè´£äººï¼šè´Ÿè´£PHPæ¥å£ç¼–å†™ï¼ŒæœåŠ¡å™¨ä»¥åŠæ•°æ®åº“è¿ç»´</li>
</ol>
<h2 id="ç›¸å…³åœ°å€"><a href="#ç›¸å…³åœ°å€" class="headerlink" title="ç›¸å…³åœ°å€"></a>ç›¸å…³åœ°å€</h2><p>Webç½‘ç«™ï¼š<a href="http://www.sciencewall.net" target="_blank" rel="external">ScienceWall</a></p>
<p>APPä¸‹è½½ï¼š</p>
<ul>
<li><a href="https://itunes.apple.com/cn/app/sciencewall/id1042268145?l=en&amp;mt=8" target="_blank" rel="external">iOSç«¯ä¸‹è½½</a></li>
<li><a href="https://play.google.com/store/apps/details?id=net.sciencewall" target="_blank" rel="external">å®‰å“ç«¯ä¸‹è½½</a></li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[categories]]></title>
      <url>/categories/index.html</url>
      <content type="html"></content>
    </entry>
    
    <entry>
      <title><![CDATA[tags]]></title>
      <url>/tags/index.html</url>
      <content type="html"></content>
    </entry>
    
  
</search>
